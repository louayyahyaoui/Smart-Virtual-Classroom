{"ast":null,"code":"/**\r\n * DevExtreme (ui/validation_engine.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _class = _interopRequireDefault(require(\"../core/class\"));\n\nvar _extend = require(\"../core/utils/extend\");\n\nvar _array = require(\"../core/utils/array\");\n\nvar _iterator = require(\"../core/utils/iterator\");\n\nvar _events_strategy = require(\"../core/events_strategy\");\n\nvar _errors = _interopRequireDefault(require(\"../core/errors\"));\n\nvar _common = require(\"../core/utils/common\");\n\nvar _type = require(\"../core/utils/type\");\n\nvar _number = _interopRequireDefault(require(\"../localization/number\"));\n\nvar _message = _interopRequireDefault(require(\"../localization/message\"));\n\nvar _promise = _interopRequireDefault(require(\"../core/polyfills/promise\"));\n\nvar _deferred = require(\"../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n\n  _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function (o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nvar STATUS = {\n  valid: \"valid\",\n  invalid: \"invalid\",\n  pending: \"pending\"\n};\n\nvar BaseRuleValidator = function () {\n  function BaseRuleValidator() {\n    this.NAME = \"base\";\n  }\n\n  var _proto = BaseRuleValidator.prototype;\n\n  _proto.defaultMessage = function (value) {\n    return _message.default.getFormatter(\"validation-\".concat(this.NAME))(value);\n  };\n\n  _proto.defaultFormattedMessage = function (value) {\n    return _message.default.getFormatter(\"validation-\".concat(this.NAME, \"-formatted\"))(value);\n  };\n\n  _proto._isValueEmpty = function (value) {\n    return !rulesValidators.required.validate(value, {});\n  };\n\n  _proto.validate = function (value, rule) {\n    var _this = this;\n\n    var valueArray = Array.isArray(value) ? value : [value];\n    var result = true;\n\n    if (valueArray.length) {\n      valueArray.every(function (itemValue) {\n        result = _this._validate(itemValue, rule);\n        return result;\n      });\n    } else {\n      result = this._validate(null, rule);\n    }\n\n    return result;\n  };\n\n  return BaseRuleValidator;\n}();\n\nvar RequiredRuleValidator = function (_BaseRuleValidator) {\n  _inheritsLoose(RequiredRuleValidator, _BaseRuleValidator);\n\n  function RequiredRuleValidator() {\n    var _this2;\n\n    _this2 = _BaseRuleValidator.call(this) || this;\n    _this2.NAME = \"required\";\n    return _this2;\n  }\n\n  var _proto2 = RequiredRuleValidator.prototype;\n\n  _proto2._validate = function (value, rule) {\n    if (!(0, _type.isDefined)(value)) {\n      return false;\n    }\n\n    if (false === value) {\n      return false;\n    }\n\n    value = String(value);\n\n    if (rule.trim || !(0, _type.isDefined)(rule.trim)) {\n      value = value.trim();\n    }\n\n    return \"\" !== value;\n  };\n\n  return RequiredRuleValidator;\n}(BaseRuleValidator);\n\nvar NumericRuleValidator = function (_BaseRuleValidator2) {\n  _inheritsLoose(NumericRuleValidator, _BaseRuleValidator2);\n\n  function NumericRuleValidator() {\n    var _this3;\n\n    _this3 = _BaseRuleValidator2.call(this) || this;\n    _this3.NAME = \"numeric\";\n    return _this3;\n  }\n\n  var _proto3 = NumericRuleValidator.prototype;\n\n  _proto3._validate = function (value, rule) {\n    if (false !== rule.ignoreEmptyValue && this._isValueEmpty(value)) {\n      return true;\n    }\n\n    if (rule.useCultureSettings && (0, _type.isString)(value)) {\n      return !isNaN(_number.default.parse(value));\n    } else {\n      return (0, _type.isNumeric)(value);\n    }\n  };\n\n  return NumericRuleValidator;\n}(BaseRuleValidator);\n\nvar RangeRuleValidator = function (_BaseRuleValidator3) {\n  _inheritsLoose(RangeRuleValidator, _BaseRuleValidator3);\n\n  function RangeRuleValidator() {\n    var _this4;\n\n    _this4 = _BaseRuleValidator3.call(this) || this;\n    _this4.NAME = \"range\";\n    return _this4;\n  }\n\n  var _proto4 = RangeRuleValidator.prototype;\n\n  _proto4._validate = function (value, rule) {\n    if (false !== rule.ignoreEmptyValue && this._isValueEmpty(value)) {\n      return true;\n    }\n\n    var validNumber = rulesValidators.numeric.validate(value, rule);\n    var validValue = (0, _type.isDefined)(value) && \"\" !== value;\n    var number = validNumber ? parseFloat(value) : validValue && value.valueOf();\n    var min = rule.min;\n    var max = rule.max;\n\n    if (!(validNumber || (0, _type.isDate)(value)) && !validValue) {\n      return false;\n    }\n\n    if ((0, _type.isDefined)(min)) {\n      if ((0, _type.isDefined)(max)) {\n        return number >= min && number <= max;\n      }\n\n      return number >= min;\n    } else {\n      if ((0, _type.isDefined)(max)) {\n        return number <= max;\n      } else {\n        throw _errors.default.Error(\"E0101\");\n      }\n    }\n  };\n\n  return RangeRuleValidator;\n}(BaseRuleValidator);\n\nvar StringLengthRuleValidator = function (_BaseRuleValidator4) {\n  _inheritsLoose(StringLengthRuleValidator, _BaseRuleValidator4);\n\n  function StringLengthRuleValidator() {\n    var _this5;\n\n    _this5 = _BaseRuleValidator4.call(this) || this;\n    _this5.NAME = \"stringLength\";\n    return _this5;\n  }\n\n  var _proto5 = StringLengthRuleValidator.prototype;\n\n  _proto5._validate = function (value, rule) {\n    var _value;\n\n    value = String(null !== (_value = value) && void 0 !== _value ? _value : \"\");\n\n    if (rule.trim || !(0, _type.isDefined)(rule.trim)) {\n      value = value.trim();\n    }\n\n    if (rule.ignoreEmptyValue && this._isValueEmpty(value)) {\n      return true;\n    }\n\n    return rulesValidators.range.validate(value.length, (0, _extend.extend)({}, rule));\n  };\n\n  return StringLengthRuleValidator;\n}(BaseRuleValidator);\n\nvar CustomRuleValidator = function (_BaseRuleValidator5) {\n  _inheritsLoose(CustomRuleValidator, _BaseRuleValidator5);\n\n  function CustomRuleValidator() {\n    var _this6;\n\n    _this6 = _BaseRuleValidator5.call(this) || this;\n    _this6.NAME = \"custom\";\n    return _this6;\n  }\n\n  var _proto6 = CustomRuleValidator.prototype;\n\n  _proto6.validate = function (value, rule) {\n    if (rule.ignoreEmptyValue && this._isValueEmpty(value)) {\n      return true;\n    }\n\n    var validator = rule.validator;\n    var dataGetter = validator && (0, _type.isFunction)(validator.option) && validator.option(\"dataGetter\");\n    var extraParams = (0, _type.isFunction)(dataGetter) && dataGetter();\n    var params = {\n      value: value,\n      validator: validator,\n      rule: rule\n    };\n\n    if (extraParams) {\n      (0, _extend.extend)(params, extraParams);\n    }\n\n    return rule.validationCallback(params);\n  };\n\n  return CustomRuleValidator;\n}(BaseRuleValidator);\n\nvar AsyncRuleValidator = function (_CustomRuleValidator) {\n  _inheritsLoose(AsyncRuleValidator, _CustomRuleValidator);\n\n  function AsyncRuleValidator() {\n    var _this7;\n\n    _this7 = _CustomRuleValidator.call(this) || this;\n    _this7.NAME = \"async\";\n    return _this7;\n  }\n\n  var _proto7 = AsyncRuleValidator.prototype;\n\n  _proto7.validate = function (value, rule) {\n    if (!(0, _type.isDefined)(rule.reevaluate)) {\n      (0, _extend.extend)(rule, {\n        reevaluate: true\n      });\n    }\n\n    if (rule.ignoreEmptyValue && this._isValueEmpty(value)) {\n      return true;\n    }\n\n    var validator = rule.validator;\n    var dataGetter = validator && (0, _type.isFunction)(validator.option) && validator.option(\"dataGetter\");\n    var extraParams = (0, _type.isFunction)(dataGetter) && dataGetter();\n    var params = {\n      value: value,\n      validator: validator,\n      rule: rule\n    };\n\n    if (extraParams) {\n      (0, _extend.extend)(params, extraParams);\n    }\n\n    var callbackResult = rule.validationCallback(params);\n\n    if (!(0, _type.isPromise)(callbackResult)) {\n      throw _errors.default.Error(\"E0103\");\n    }\n\n    return this._getWrappedPromise((0, _deferred.fromPromise)(callbackResult).promise());\n  };\n\n  _proto7._getWrappedPromise = function (promise) {\n    var deferred = new _deferred.Deferred();\n    promise.then(function (res) {\n      deferred.resolve(res);\n    }, function (err) {\n      var res = {\n        isValid: false\n      };\n\n      if ((0, _type.isDefined)(err)) {\n        if ((0, _type.isString)(err)) {\n          res.message = err;\n        } else {\n          if ((0, _type.isObject)(err) && (0, _type.isDefined)(err.message) && (0, _type.isString)(err.message)) {\n            res.message = err.message;\n          }\n        }\n      }\n\n      deferred.resolve(res);\n    });\n    return deferred.promise();\n  };\n\n  return AsyncRuleValidator;\n}(CustomRuleValidator);\n\nvar CompareRuleValidator = function (_BaseRuleValidator6) {\n  _inheritsLoose(CompareRuleValidator, _BaseRuleValidator6);\n\n  function CompareRuleValidator() {\n    var _this8;\n\n    _this8 = _BaseRuleValidator6.call(this) || this;\n    _this8.NAME = \"compare\";\n    return _this8;\n  }\n\n  var _proto8 = CompareRuleValidator.prototype;\n\n  _proto8._validate = function (value, rule) {\n    if (!rule.comparisonTarget) {\n      throw _errors.default.Error(\"E0102\");\n    }\n\n    if (rule.ignoreEmptyValue && this._isValueEmpty(value)) {\n      return true;\n    }\n\n    (0, _extend.extend)(rule, {\n      reevaluate: true\n    });\n    var otherValue = rule.comparisonTarget();\n    var type = rule.comparisonType || \"==\";\n\n    switch (type) {\n      case \"==\":\n        return value == otherValue;\n\n      case \"!=\":\n        return value != otherValue;\n\n      case \"===\":\n        return value === otherValue;\n\n      case \"!==\":\n        return value !== otherValue;\n\n      case \">\":\n        return value > otherValue;\n\n      case \">=\":\n        return value >= otherValue;\n\n      case \"<\":\n        return value < otherValue;\n\n      case \"<=\":\n        return value <= otherValue;\n    }\n  };\n\n  return CompareRuleValidator;\n}(BaseRuleValidator);\n\nvar PatternRuleValidator = function (_BaseRuleValidator7) {\n  _inheritsLoose(PatternRuleValidator, _BaseRuleValidator7);\n\n  function PatternRuleValidator() {\n    var _this9;\n\n    _this9 = _BaseRuleValidator7.call(this) || this;\n    _this9.NAME = \"pattern\";\n    return _this9;\n  }\n\n  var _proto9 = PatternRuleValidator.prototype;\n\n  _proto9._validate = function (value, rule) {\n    if (false !== rule.ignoreEmptyValue && this._isValueEmpty(value)) {\n      return true;\n    }\n\n    var pattern = rule.pattern;\n\n    if ((0, _type.isString)(pattern)) {\n      pattern = new RegExp(pattern);\n    }\n\n    return pattern.test(value);\n  };\n\n  return PatternRuleValidator;\n}(BaseRuleValidator);\n\nvar EmailRuleValidator = function (_BaseRuleValidator8) {\n  _inheritsLoose(EmailRuleValidator, _BaseRuleValidator8);\n\n  function EmailRuleValidator() {\n    var _this10;\n\n    _this10 = _BaseRuleValidator8.call(this) || this;\n    _this10.NAME = \"email\";\n    return _this10;\n  }\n\n  var _proto10 = EmailRuleValidator.prototype;\n\n  _proto10._validate = function (value, rule) {\n    if (false !== rule.ignoreEmptyValue && this._isValueEmpty(value)) {\n      return true;\n    }\n\n    return rulesValidators.pattern.validate(value, (0, _extend.extend)({}, rule, {\n      pattern: /^[\\d\\w._-]+@[\\d\\w._-]+\\.[\\w]+$/i\n    }));\n  };\n\n  return EmailRuleValidator;\n}(BaseRuleValidator);\n\nvar rulesValidators = {\n  required: new RequiredRuleValidator(),\n  numeric: new NumericRuleValidator(),\n  range: new RangeRuleValidator(),\n  stringLength: new StringLengthRuleValidator(),\n  custom: new CustomRuleValidator(),\n  async: new AsyncRuleValidator(),\n  compare: new CompareRuleValidator(),\n  pattern: new PatternRuleValidator(),\n  email: new EmailRuleValidator()\n};\n\nvar GroupConfig = _class.default.inherit({\n  ctor: function (group) {\n    this.group = group;\n    this.validators = [];\n    this._pendingValidators = [];\n    this._onValidatorStatusChanged = this._onValidatorStatusChanged.bind(this);\n\n    this._resetValidationInfo();\n\n    this._eventsStrategy = new _events_strategy.EventsStrategy(this);\n  },\n  validate: function () {\n    var _this11 = this;\n\n    var result = {\n      isValid: true,\n      brokenRules: [],\n      validators: [],\n      status: STATUS.valid,\n      complete: null\n    };\n\n    this._unsubscribeFromAllChangeEvents();\n\n    this._pendingValidators = [];\n\n    this._resetValidationInfo();\n\n    (0, _iterator.each)(this.validators, function (_, validator) {\n      var validatorResult = validator.validate();\n      result.isValid = result.isValid && validatorResult.isValid;\n\n      if (validatorResult.brokenRules) {\n        result.brokenRules = result.brokenRules.concat(validatorResult.brokenRules);\n      }\n\n      result.validators.push(validator);\n\n      if (validatorResult.status === STATUS.pending) {\n        _this11._addPendingValidator(validator);\n      }\n\n      _this11._subscribeToChangeEvents(validator);\n    });\n\n    if (this._pendingValidators.length) {\n      result.status = STATUS.pending;\n    } else {\n      result.status = result.isValid ? STATUS.valid : STATUS.invalid;\n\n      this._unsubscribeFromAllChangeEvents();\n\n      this._raiseValidatedEvent(result);\n    }\n\n    this._updateValidationInfo(result);\n\n    return (0, _extend.extend)({}, this._validationInfo.result);\n  },\n  _subscribeToChangeEvents: function (validator) {\n    validator.on(\"validating\", this._onValidatorStatusChanged);\n    validator.on(\"validated\", this._onValidatorStatusChanged);\n  },\n  _unsubscribeFromChangeEvents: function (validator) {\n    validator.off(\"validating\", this._onValidatorStatusChanged);\n    validator.off(\"validated\", this._onValidatorStatusChanged);\n  },\n  _unsubscribeFromAllChangeEvents: function () {\n    var _this12 = this;\n\n    (0, _iterator.each)(this.validators, function (_, validator) {\n      _this12._unsubscribeFromChangeEvents(validator);\n    });\n  },\n  _updateValidationInfo: function (result) {\n    this._validationInfo.result = result;\n\n    if (result.status !== STATUS.pending) {\n      return;\n    }\n\n    if (!this._validationInfo.deferred) {\n      this._validationInfo.deferred = new _deferred.Deferred();\n      this._validationInfo.result.complete = this._validationInfo.deferred.promise();\n    }\n  },\n  _addPendingValidator: function (validator) {\n    var foundValidator = (0, _common.grep)(this._pendingValidators, function (val) {\n      return val === validator;\n    })[0];\n\n    if (!foundValidator) {\n      this._pendingValidators.push(validator);\n    }\n  },\n  _removePendingValidator: function (validator) {\n    var index = (0, _array.inArray)(validator, this._pendingValidators);\n\n    if (index >= 0) {\n      this._pendingValidators.splice(index, 1);\n    }\n  },\n  _orderBrokenRules: function (brokenRules) {\n    var orderedRules = [];\n    (0, _iterator.each)(this.validators, function (_, validator) {\n      var foundRules = (0, _common.grep)(brokenRules, function (rule) {\n        return rule.validator === validator;\n      });\n\n      if (foundRules.length) {\n        orderedRules = orderedRules.concat(foundRules);\n      }\n    });\n    return orderedRules;\n  },\n  _updateBrokenRules: function (result) {\n    if (!this._validationInfo.result) {\n      return;\n    }\n\n    var brokenRules = this._validationInfo.result.brokenRules;\n    var rules = (0, _common.grep)(brokenRules, function (rule) {\n      return rule.validator !== result.validator;\n    });\n\n    if (result.brokenRules) {\n      brokenRules = rules.concat(result.brokenRules);\n    }\n\n    this._validationInfo.result.brokenRules = this._orderBrokenRules(brokenRules);\n  },\n  _onValidatorStatusChanged: function (result) {\n    if (result.status === STATUS.pending) {\n      this._addPendingValidator(result.validator);\n\n      return;\n    }\n\n    this._resolveIfComplete(result);\n  },\n  _resolveIfComplete: function (result) {\n    this._removePendingValidator(result.validator);\n\n    this._updateBrokenRules(result);\n\n    if (!this._pendingValidators.length) {\n      this._unsubscribeFromAllChangeEvents();\n\n      if (!this._validationInfo.result) {\n        return;\n      }\n\n      this._validationInfo.result.status = 0 === this._validationInfo.result.brokenRules.length ? STATUS.valid : STATUS.invalid;\n      this._validationInfo.result.isValid = this._validationInfo.result.status === STATUS.valid;\n      var res = (0, _extend.extend)({}, this._validationInfo.result, {\n        complete: null\n      });\n      var deferred = this._validationInfo.deferred;\n\n      this._resetValidationInfo();\n\n      this._raiseValidatedEvent(res);\n\n      deferred && setTimeout(function () {\n        deferred.resolve(res);\n      });\n    }\n  },\n  _raiseValidatedEvent: function (result) {\n    this._eventsStrategy.fireEvent(\"validated\", [result]);\n  },\n  _resetValidationInfo: function () {\n    this._validationInfo = {\n      result: null,\n      deferred: null\n    };\n  },\n  _synchronizeValidationInfo: function () {\n    if (this._validationInfo.result) {\n      this._validationInfo.result.validators = this.validators;\n    }\n  },\n  removeRegisteredValidator: function (validator) {\n    var index = (0, _array.inArray)(validator, this.validators);\n\n    if (index > -1) {\n      this.validators.splice(index, 1);\n\n      this._synchronizeValidationInfo();\n\n      this._resolveIfComplete({\n        validator: validator\n      });\n    }\n  },\n  registerValidator: function (validator) {\n    if ((0, _array.inArray)(validator, this.validators) < 0) {\n      this.validators.push(validator);\n\n      this._synchronizeValidationInfo();\n    }\n  },\n  reset: function () {\n    (0, _iterator.each)(this.validators, function (_, validator) {\n      validator.reset();\n    });\n    this._pendingValidators = [];\n\n    this._resetValidationInfo();\n  },\n  on: function (eventName, eventHandler) {\n    this._eventsStrategy.on(eventName, eventHandler);\n\n    return this;\n  },\n  off: function (eventName, eventHandler) {\n    this._eventsStrategy.off(eventName, eventHandler);\n\n    return this;\n  }\n});\n\nvar ValidationEngine = {\n  groups: [],\n  getGroupConfig: function (group) {\n    var result = (0, _common.grep)(this.groups, function (config) {\n      return config.group === group;\n    });\n\n    if (result.length) {\n      return result[0];\n    }\n  },\n  findGroup: function ($element, model) {\n    var $dxGroup = $element.parents(\".dx-validationgroup\").first();\n\n    if ($dxGroup.length) {\n      return $dxGroup.dxValidationGroup(\"instance\");\n    }\n\n    return model;\n  },\n  initGroups: function () {\n    this.groups = [];\n    this.addGroup();\n  },\n  addGroup: function (group) {\n    var config = this.getGroupConfig(group);\n\n    if (!config) {\n      config = new GroupConfig(group);\n      this.groups.push(config);\n    }\n\n    return config;\n  },\n  removeGroup: function (group) {\n    var config = this.getGroupConfig(group);\n    var index = (0, _array.inArray)(config, this.groups);\n\n    if (index > -1) {\n      this.groups.splice(index, 1);\n    }\n\n    return config;\n  },\n  _setDefaultMessage: function (info) {\n    var rule = info.rule,\n        validator = info.validator,\n        name = info.name;\n\n    if (!(0, _type.isDefined)(rule.message)) {\n      if (validator.defaultFormattedMessage && (0, _type.isDefined)(name)) {\n        rule.message = validator.defaultFormattedMessage(name);\n      } else {\n        rule.message = validator.defaultMessage();\n      }\n    }\n  },\n  _addBrokenRule: function (info) {\n    var result = info.result,\n        rule = info.rule;\n\n    if (!result.brokenRule) {\n      result.brokenRule = rule;\n    }\n\n    if (!result.brokenRules) {\n      result.brokenRules = [];\n    }\n\n    result.brokenRules.push(rule);\n  },\n  validate: function (value, rules, name) {\n    var _this13 = this;\n\n    var result = {\n      name: name,\n      value: value,\n      brokenRule: null,\n      brokenRules: null,\n      isValid: true,\n      validationRules: rules,\n      pendingRules: null,\n      status: STATUS.valid,\n      complete: null\n    };\n    var asyncRuleItems = [];\n    (0, _iterator.each)(rules || [], function (_, rule) {\n      var ruleValidator = rulesValidators[rule.type];\n      var ruleValidationResult;\n\n      if (ruleValidator) {\n        if ((0, _type.isDefined)(rule.isValid) && rule.value === value && !rule.reevaluate) {\n          if (!rule.isValid) {\n            result.isValid = false;\n\n            _this13._addBrokenRule({\n              result: result,\n              rule: rule\n            });\n\n            return false;\n          }\n\n          return true;\n        }\n\n        rule.value = value;\n\n        if (\"async\" === rule.type) {\n          asyncRuleItems.push({\n            rule: rule,\n            ruleValidator: ruleValidator\n          });\n          return true;\n        }\n\n        ruleValidationResult = ruleValidator.validate(value, rule);\n        rule.isValid = ruleValidationResult;\n\n        if (!ruleValidationResult) {\n          result.isValid = false;\n\n          _this13._setDefaultMessage({\n            rule: rule,\n            validator: ruleValidator,\n            name: name\n          });\n\n          _this13._addBrokenRule({\n            result: result,\n            rule: rule\n          });\n        }\n\n        if (!rule.isValid) {\n          return false;\n        }\n      } else {\n        throw _errors.default.Error(\"E0100\");\n      }\n    });\n\n    if (result.isValid && !result.brokenRules && asyncRuleItems.length) {\n      result = this._validateAsyncRules({\n        value: value,\n        items: asyncRuleItems,\n        result: result,\n        name: name\n      });\n    }\n\n    result.status = result.pendingRules ? STATUS.pending : result.isValid ? STATUS.valid : STATUS.invalid;\n    return result;\n  },\n  _validateAsyncRules: function (_ref) {\n    var _this14 = this;\n\n    var result = _ref.result,\n        value = _ref.value,\n        items = _ref.items,\n        name = _ref.name;\n    var asyncResults = [];\n    (0, _iterator.each)(items, function (_, item) {\n      var validateResult = item.ruleValidator.validate(value, item.rule);\n\n      if (!(0, _type.isPromise)(validateResult)) {\n        _this14._updateRuleConfig({\n          rule: item.rule,\n          ruleResult: _this14._getPatchedRuleResult(validateResult),\n          validator: item.ruleValidator,\n          name: name\n        });\n      } else {\n        if (!result.pendingRules) {\n          result.pendingRules = [];\n        }\n\n        result.pendingRules.push(item.rule);\n        var asyncResult = validateResult.then(function (res) {\n          var ruleResult = _this14._getPatchedRuleResult(res);\n\n          _this14._updateRuleConfig({\n            rule: item.rule,\n            ruleResult: ruleResult,\n            validator: item.ruleValidator,\n            name: name\n          });\n\n          return ruleResult;\n        });\n        asyncResults.push(asyncResult);\n      }\n    });\n\n    if (asyncResults.length) {\n      result.complete = _promise.default.all(asyncResults).then(function (values) {\n        return _this14._getAsyncRulesResult({\n          result: result,\n          values: values\n        });\n      });\n    }\n\n    return result;\n  },\n  _updateRuleConfig: function (_ref2) {\n    var rule = _ref2.rule,\n        ruleResult = _ref2.ruleResult,\n        validator = _ref2.validator,\n        name = _ref2.name;\n    rule.isValid = ruleResult.isValid;\n\n    if (!ruleResult.isValid) {\n      if ((0, _type.isDefined)(ruleResult.message) && (0, _type.isString)(ruleResult.message) && ruleResult.message.length) {\n        rule.message = ruleResult.message;\n      } else {\n        this._setDefaultMessage({\n          rule: rule,\n          validator: validator,\n          name: name\n        });\n      }\n    }\n  },\n  _getPatchedRuleResult: function (ruleResult) {\n    var result;\n    var isValid = true;\n\n    if ((0, _type.isObject)(ruleResult)) {\n      result = (0, _extend.extend)({}, ruleResult);\n\n      if (!(0, _type.isDefined)(result.isValid)) {\n        result.isValid = isValid;\n      }\n    } else {\n      result = {\n        isValid: (0, _type.isBoolean)(ruleResult) ? ruleResult : isValid\n      };\n    }\n\n    return result;\n  },\n  _getAsyncRulesResult: function (_ref3) {\n    var _this15 = this;\n\n    var values = _ref3.values,\n        result = _ref3.result;\n    (0, _iterator.each)(values, function (index, val) {\n      if (false === val.isValid) {\n        result.isValid = val.isValid;\n        var rule = result.pendingRules[index];\n\n        _this15._addBrokenRule({\n          result: result,\n          rule: rule\n        });\n      }\n    });\n    result.pendingRules = null;\n    result.complete = null;\n    result.status = result.isValid ? STATUS.valid : STATUS.invalid;\n    return result;\n  },\n  registerValidatorInGroup: function (group, validator) {\n    var groupConfig = ValidationEngine.addGroup(group);\n    groupConfig.registerValidator.call(groupConfig, validator);\n  },\n  _shouldRemoveGroup: function (group, validatorsInGroup) {\n    var isDefaultGroup = void 0 === group;\n    var isValidationGroupInstance = group && \"dxValidationGroup\" === group.NAME;\n    return !isDefaultGroup && !isValidationGroupInstance && !validatorsInGroup.length;\n  },\n  removeRegisteredValidator: function (group, validator) {\n    var config = ValidationEngine.getGroupConfig(group);\n\n    if (config) {\n      config.removeRegisteredValidator.call(config, validator);\n      var validatorsInGroup = config.validators;\n\n      if (this._shouldRemoveGroup(group, validatorsInGroup)) {\n        this.removeGroup(group);\n      }\n    }\n  },\n  initValidationOptions: function (options) {\n    var _this16 = this;\n\n    var initedOptions = {};\n\n    if (options) {\n      var syncOptions = [\"isValid\", \"validationStatus\", \"validationError\", \"validationErrors\"];\n      syncOptions.forEach(function (prop) {\n        if (prop in options) {\n          (0, _extend.extend)(initedOptions, _this16.synchronizeValidationOptions({\n            name: prop,\n            value: options[prop]\n          }, options));\n        }\n      });\n    }\n\n    return initedOptions;\n  },\n  synchronizeValidationOptions: function (_ref4, options) {\n    var name = _ref4.name,\n        value = _ref4.value;\n\n    switch (name) {\n      case \"validationStatus\":\n        var isValid = value === STATUS.valid || value === STATUS.pending;\n        return options.isValid !== isValid ? {\n          isValid: isValid\n        } : {};\n\n      case \"isValid\":\n        var validationStatus = options.validationStatus;\n        var newStatus = validationStatus;\n\n        if (value && validationStatus === STATUS.invalid) {\n          newStatus = STATUS.valid;\n        } else {\n          if (!value && validationStatus !== STATUS.invalid) {\n            newStatus = STATUS.invalid;\n          }\n        }\n\n        return newStatus !== validationStatus ? {\n          validationStatus: newStatus\n        } : {};\n\n      case \"validationErrors\":\n        var validationError = !value || !value.length ? null : value[0];\n        return options.validationError !== validationError ? {\n          validationError: validationError\n        } : {};\n\n      case \"validationError\":\n        var validationErrors = options.validationErrors;\n\n        if (!value && validationErrors) {\n          return {\n            validationErrors: null\n          };\n        } else {\n          if (value && !validationErrors) {\n            return {\n              validationErrors: [value]\n            };\n          } else {\n            if (value && validationErrors && value !== validationErrors[0]) {\n              validationErrors[0] = value;\n              return {\n                validationErrors: validationErrors.slice()\n              };\n            }\n          }\n        }\n\n    }\n\n    return {};\n  },\n  validateGroup: function (group) {\n    var groupConfig = ValidationEngine.getGroupConfig(group);\n\n    if (!groupConfig) {\n      throw _errors.default.Error(\"E0110\");\n    }\n\n    return groupConfig.validate();\n  },\n  resetGroup: function (group) {\n    var groupConfig = ValidationEngine.getGroupConfig(group);\n\n    if (!groupConfig) {\n      throw _errors.default.Error(\"E0110\");\n    }\n\n    return groupConfig.reset();\n  }\n};\nValidationEngine.initGroups();\nvar _default = ValidationEngine;\nexports.default = _default;\nmodule.exports = exports.default;\nmodule.exports.default = module.exports;","map":{"version":3,"sources":["C:/Smart-Virtual-Classroom/client/node_modules/devextreme/ui/validation_engine.js"],"names":["exports","default","_class","_interopRequireDefault","require","_extend","_array","_iterator","_events_strategy","_errors","_common","_type","_number","_message","_promise","_deferred","obj","__esModule","_inheritsLoose","subClass","superClass","prototype","Object","create","constructor","_setPrototypeOf","o","p","setPrototypeOf","__proto__","STATUS","valid","invalid","pending","BaseRuleValidator","NAME","_proto","defaultMessage","value","getFormatter","concat","defaultFormattedMessage","_isValueEmpty","rulesValidators","required","validate","rule","_this","valueArray","Array","isArray","result","length","every","itemValue","_validate","RequiredRuleValidator","_BaseRuleValidator","_this2","call","_proto2","isDefined","String","trim","NumericRuleValidator","_BaseRuleValidator2","_this3","_proto3","ignoreEmptyValue","useCultureSettings","isString","isNaN","parse","isNumeric","RangeRuleValidator","_BaseRuleValidator3","_this4","_proto4","validNumber","numeric","validValue","number","parseFloat","valueOf","min","max","isDate","Error","StringLengthRuleValidator","_BaseRuleValidator4","_this5","_proto5","_value","range","extend","CustomRuleValidator","_BaseRuleValidator5","_this6","_proto6","validator","dataGetter","isFunction","option","extraParams","params","validationCallback","AsyncRuleValidator","_CustomRuleValidator","_this7","_proto7","reevaluate","callbackResult","isPromise","_getWrappedPromise","fromPromise","promise","deferred","Deferred","then","res","resolve","err","isValid","message","isObject","CompareRuleValidator","_BaseRuleValidator6","_this8","_proto8","comparisonTarget","otherValue","type","comparisonType","PatternRuleValidator","_BaseRuleValidator7","_this9","_proto9","pattern","RegExp","test","EmailRuleValidator","_BaseRuleValidator8","_this10","_proto10","stringLength","custom","async","compare","email","GroupConfig","inherit","ctor","group","validators","_pendingValidators","_onValidatorStatusChanged","bind","_resetValidationInfo","_eventsStrategy","EventsStrategy","_this11","brokenRules","status","complete","_unsubscribeFromAllChangeEvents","each","_","validatorResult","push","_addPendingValidator","_subscribeToChangeEvents","_raiseValidatedEvent","_updateValidationInfo","_validationInfo","on","_unsubscribeFromChangeEvents","off","_this12","foundValidator","grep","val","_removePendingValidator","index","inArray","splice","_orderBrokenRules","orderedRules","foundRules","_updateBrokenRules","rules","_resolveIfComplete","setTimeout","fireEvent","_synchronizeValidationInfo","removeRegisteredValidator","registerValidator","reset","eventName","eventHandler","ValidationEngine","groups","getGroupConfig","config","findGroup","$element","model","$dxGroup","parents","first","dxValidationGroup","initGroups","addGroup","removeGroup","_setDefaultMessage","info","name","_addBrokenRule","brokenRule","_this13","validationRules","pendingRules","asyncRuleItems","ruleValidator","ruleValidationResult","_validateAsyncRules","items","_ref","_this14","asyncResults","item","validateResult","_updateRuleConfig","ruleResult","_getPatchedRuleResult","asyncResult","all","values","_getAsyncRulesResult","_ref2","isBoolean","_ref3","_this15","registerValidatorInGroup","groupConfig","_shouldRemoveGroup","validatorsInGroup","isDefaultGroup","isValidationGroupInstance","initValidationOptions","options","_this16","initedOptions","syncOptions","forEach","prop","synchronizeValidationOptions","_ref4","validationStatus","newStatus","validationError","validationErrors","slice","validateGroup","resetGroup","_default","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/validation_engine.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _class = _interopRequireDefault(require(\"../core/class\"));\r\nvar _extend = require(\"../core/utils/extend\");\r\nvar _array = require(\"../core/utils/array\");\r\nvar _iterator = require(\"../core/utils/iterator\");\r\nvar _events_strategy = require(\"../core/events_strategy\");\r\nvar _errors = _interopRequireDefault(require(\"../core/errors\"));\r\nvar _common = require(\"../core/utils/common\");\r\nvar _type = require(\"../core/utils/type\");\r\nvar _number = _interopRequireDefault(require(\"../localization/number\"));\r\nvar _message = _interopRequireDefault(require(\"../localization/message\"));\r\nvar _promise = _interopRequireDefault(require(\"../core/polyfills/promise\"));\r\nvar _deferred = require(\"../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _inheritsLoose(subClass, superClass) {\r\n    subClass.prototype = Object.create(superClass.prototype);\r\n    subClass.prototype.constructor = subClass;\r\n    _setPrototypeOf(subClass, superClass)\r\n}\r\n\r\nfunction _setPrototypeOf(o, p) {\r\n    _setPrototypeOf = Object.setPrototypeOf || function(o, p) {\r\n        o.__proto__ = p;\r\n        return o\r\n    };\r\n    return _setPrototypeOf(o, p)\r\n}\r\nvar STATUS = {\r\n    valid: \"valid\",\r\n    invalid: \"invalid\",\r\n    pending: \"pending\"\r\n};\r\nvar BaseRuleValidator = function() {\r\n    function BaseRuleValidator() {\r\n        this.NAME = \"base\"\r\n    }\r\n    var _proto = BaseRuleValidator.prototype;\r\n    _proto.defaultMessage = function(value) {\r\n        return _message.default.getFormatter(\"validation-\".concat(this.NAME))(value)\r\n    };\r\n    _proto.defaultFormattedMessage = function(value) {\r\n        return _message.default.getFormatter(\"validation-\".concat(this.NAME, \"-formatted\"))(value)\r\n    };\r\n    _proto._isValueEmpty = function(value) {\r\n        return !rulesValidators.required.validate(value, {})\r\n    };\r\n    _proto.validate = function(value, rule) {\r\n        var _this = this;\r\n        var valueArray = Array.isArray(value) ? value : [value];\r\n        var result = true;\r\n        if (valueArray.length) {\r\n            valueArray.every(function(itemValue) {\r\n                result = _this._validate(itemValue, rule);\r\n                return result\r\n            })\r\n        } else {\r\n            result = this._validate(null, rule)\r\n        }\r\n        return result\r\n    };\r\n    return BaseRuleValidator\r\n}();\r\nvar RequiredRuleValidator = function(_BaseRuleValidator) {\r\n    _inheritsLoose(RequiredRuleValidator, _BaseRuleValidator);\r\n\r\n    function RequiredRuleValidator() {\r\n        var _this2;\r\n        _this2 = _BaseRuleValidator.call(this) || this;\r\n        _this2.NAME = \"required\";\r\n        return _this2\r\n    }\r\n    var _proto2 = RequiredRuleValidator.prototype;\r\n    _proto2._validate = function(value, rule) {\r\n        if (!(0, _type.isDefined)(value)) {\r\n            return false\r\n        }\r\n        if (false === value) {\r\n            return false\r\n        }\r\n        value = String(value);\r\n        if (rule.trim || !(0, _type.isDefined)(rule.trim)) {\r\n            value = value.trim()\r\n        }\r\n        return \"\" !== value\r\n    };\r\n    return RequiredRuleValidator\r\n}(BaseRuleValidator);\r\nvar NumericRuleValidator = function(_BaseRuleValidator2) {\r\n    _inheritsLoose(NumericRuleValidator, _BaseRuleValidator2);\r\n\r\n    function NumericRuleValidator() {\r\n        var _this3;\r\n        _this3 = _BaseRuleValidator2.call(this) || this;\r\n        _this3.NAME = \"numeric\";\r\n        return _this3\r\n    }\r\n    var _proto3 = NumericRuleValidator.prototype;\r\n    _proto3._validate = function(value, rule) {\r\n        if (false !== rule.ignoreEmptyValue && this._isValueEmpty(value)) {\r\n            return true\r\n        }\r\n        if (rule.useCultureSettings && (0, _type.isString)(value)) {\r\n            return !isNaN(_number.default.parse(value))\r\n        } else {\r\n            return (0, _type.isNumeric)(value)\r\n        }\r\n    };\r\n    return NumericRuleValidator\r\n}(BaseRuleValidator);\r\nvar RangeRuleValidator = function(_BaseRuleValidator3) {\r\n    _inheritsLoose(RangeRuleValidator, _BaseRuleValidator3);\r\n\r\n    function RangeRuleValidator() {\r\n        var _this4;\r\n        _this4 = _BaseRuleValidator3.call(this) || this;\r\n        _this4.NAME = \"range\";\r\n        return _this4\r\n    }\r\n    var _proto4 = RangeRuleValidator.prototype;\r\n    _proto4._validate = function(value, rule) {\r\n        if (false !== rule.ignoreEmptyValue && this._isValueEmpty(value)) {\r\n            return true\r\n        }\r\n        var validNumber = rulesValidators.numeric.validate(value, rule);\r\n        var validValue = (0, _type.isDefined)(value) && \"\" !== value;\r\n        var number = validNumber ? parseFloat(value) : validValue && value.valueOf();\r\n        var min = rule.min;\r\n        var max = rule.max;\r\n        if (!(validNumber || (0, _type.isDate)(value)) && !validValue) {\r\n            return false\r\n        }\r\n        if ((0, _type.isDefined)(min)) {\r\n            if ((0, _type.isDefined)(max)) {\r\n                return number >= min && number <= max\r\n            }\r\n            return number >= min\r\n        } else {\r\n            if ((0, _type.isDefined)(max)) {\r\n                return number <= max\r\n            } else {\r\n                throw _errors.default.Error(\"E0101\")\r\n            }\r\n        }\r\n    };\r\n    return RangeRuleValidator\r\n}(BaseRuleValidator);\r\nvar StringLengthRuleValidator = function(_BaseRuleValidator4) {\r\n    _inheritsLoose(StringLengthRuleValidator, _BaseRuleValidator4);\r\n\r\n    function StringLengthRuleValidator() {\r\n        var _this5;\r\n        _this5 = _BaseRuleValidator4.call(this) || this;\r\n        _this5.NAME = \"stringLength\";\r\n        return _this5\r\n    }\r\n    var _proto5 = StringLengthRuleValidator.prototype;\r\n    _proto5._validate = function(value, rule) {\r\n        var _value;\r\n        value = String(null !== (_value = value) && void 0 !== _value ? _value : \"\");\r\n        if (rule.trim || !(0, _type.isDefined)(rule.trim)) {\r\n            value = value.trim()\r\n        }\r\n        if (rule.ignoreEmptyValue && this._isValueEmpty(value)) {\r\n            return true\r\n        }\r\n        return rulesValidators.range.validate(value.length, (0, _extend.extend)({}, rule))\r\n    };\r\n    return StringLengthRuleValidator\r\n}(BaseRuleValidator);\r\nvar CustomRuleValidator = function(_BaseRuleValidator5) {\r\n    _inheritsLoose(CustomRuleValidator, _BaseRuleValidator5);\r\n\r\n    function CustomRuleValidator() {\r\n        var _this6;\r\n        _this6 = _BaseRuleValidator5.call(this) || this;\r\n        _this6.NAME = \"custom\";\r\n        return _this6\r\n    }\r\n    var _proto6 = CustomRuleValidator.prototype;\r\n    _proto6.validate = function(value, rule) {\r\n        if (rule.ignoreEmptyValue && this._isValueEmpty(value)) {\r\n            return true\r\n        }\r\n        var validator = rule.validator;\r\n        var dataGetter = validator && (0, _type.isFunction)(validator.option) && validator.option(\"dataGetter\");\r\n        var extraParams = (0, _type.isFunction)(dataGetter) && dataGetter();\r\n        var params = {\r\n            value: value,\r\n            validator: validator,\r\n            rule: rule\r\n        };\r\n        if (extraParams) {\r\n            (0, _extend.extend)(params, extraParams)\r\n        }\r\n        return rule.validationCallback(params)\r\n    };\r\n    return CustomRuleValidator\r\n}(BaseRuleValidator);\r\nvar AsyncRuleValidator = function(_CustomRuleValidator) {\r\n    _inheritsLoose(AsyncRuleValidator, _CustomRuleValidator);\r\n\r\n    function AsyncRuleValidator() {\r\n        var _this7;\r\n        _this7 = _CustomRuleValidator.call(this) || this;\r\n        _this7.NAME = \"async\";\r\n        return _this7\r\n    }\r\n    var _proto7 = AsyncRuleValidator.prototype;\r\n    _proto7.validate = function(value, rule) {\r\n        if (!(0, _type.isDefined)(rule.reevaluate)) {\r\n            (0, _extend.extend)(rule, {\r\n                reevaluate: true\r\n            })\r\n        }\r\n        if (rule.ignoreEmptyValue && this._isValueEmpty(value)) {\r\n            return true\r\n        }\r\n        var validator = rule.validator;\r\n        var dataGetter = validator && (0, _type.isFunction)(validator.option) && validator.option(\"dataGetter\");\r\n        var extraParams = (0, _type.isFunction)(dataGetter) && dataGetter();\r\n        var params = {\r\n            value: value,\r\n            validator: validator,\r\n            rule: rule\r\n        };\r\n        if (extraParams) {\r\n            (0, _extend.extend)(params, extraParams)\r\n        }\r\n        var callbackResult = rule.validationCallback(params);\r\n        if (!(0, _type.isPromise)(callbackResult)) {\r\n            throw _errors.default.Error(\"E0103\")\r\n        }\r\n        return this._getWrappedPromise((0, _deferred.fromPromise)(callbackResult).promise())\r\n    };\r\n    _proto7._getWrappedPromise = function(promise) {\r\n        var deferred = new _deferred.Deferred;\r\n        promise.then(function(res) {\r\n            deferred.resolve(res)\r\n        }, function(err) {\r\n            var res = {\r\n                isValid: false\r\n            };\r\n            if ((0, _type.isDefined)(err)) {\r\n                if ((0, _type.isString)(err)) {\r\n                    res.message = err\r\n                } else {\r\n                    if ((0, _type.isObject)(err) && (0, _type.isDefined)(err.message) && (0, _type.isString)(err.message)) {\r\n                        res.message = err.message\r\n                    }\r\n                }\r\n            }\r\n            deferred.resolve(res)\r\n        });\r\n        return deferred.promise()\r\n    };\r\n    return AsyncRuleValidator\r\n}(CustomRuleValidator);\r\nvar CompareRuleValidator = function(_BaseRuleValidator6) {\r\n    _inheritsLoose(CompareRuleValidator, _BaseRuleValidator6);\r\n\r\n    function CompareRuleValidator() {\r\n        var _this8;\r\n        _this8 = _BaseRuleValidator6.call(this) || this;\r\n        _this8.NAME = \"compare\";\r\n        return _this8\r\n    }\r\n    var _proto8 = CompareRuleValidator.prototype;\r\n    _proto8._validate = function(value, rule) {\r\n        if (!rule.comparisonTarget) {\r\n            throw _errors.default.Error(\"E0102\")\r\n        }\r\n        if (rule.ignoreEmptyValue && this._isValueEmpty(value)) {\r\n            return true\r\n        }(0, _extend.extend)(rule, {\r\n            reevaluate: true\r\n        });\r\n        var otherValue = rule.comparisonTarget();\r\n        var type = rule.comparisonType || \"==\";\r\n        switch (type) {\r\n            case \"==\":\r\n                return value == otherValue;\r\n            case \"!=\":\r\n                return value != otherValue;\r\n            case \"===\":\r\n                return value === otherValue;\r\n            case \"!==\":\r\n                return value !== otherValue;\r\n            case \">\":\r\n                return value > otherValue;\r\n            case \">=\":\r\n                return value >= otherValue;\r\n            case \"<\":\r\n                return value < otherValue;\r\n            case \"<=\":\r\n                return value <= otherValue\r\n        }\r\n    };\r\n    return CompareRuleValidator\r\n}(BaseRuleValidator);\r\nvar PatternRuleValidator = function(_BaseRuleValidator7) {\r\n    _inheritsLoose(PatternRuleValidator, _BaseRuleValidator7);\r\n\r\n    function PatternRuleValidator() {\r\n        var _this9;\r\n        _this9 = _BaseRuleValidator7.call(this) || this;\r\n        _this9.NAME = \"pattern\";\r\n        return _this9\r\n    }\r\n    var _proto9 = PatternRuleValidator.prototype;\r\n    _proto9._validate = function(value, rule) {\r\n        if (false !== rule.ignoreEmptyValue && this._isValueEmpty(value)) {\r\n            return true\r\n        }\r\n        var pattern = rule.pattern;\r\n        if ((0, _type.isString)(pattern)) {\r\n            pattern = new RegExp(pattern)\r\n        }\r\n        return pattern.test(value)\r\n    };\r\n    return PatternRuleValidator\r\n}(BaseRuleValidator);\r\nvar EmailRuleValidator = function(_BaseRuleValidator8) {\r\n    _inheritsLoose(EmailRuleValidator, _BaseRuleValidator8);\r\n\r\n    function EmailRuleValidator() {\r\n        var _this10;\r\n        _this10 = _BaseRuleValidator8.call(this) || this;\r\n        _this10.NAME = \"email\";\r\n        return _this10\r\n    }\r\n    var _proto10 = EmailRuleValidator.prototype;\r\n    _proto10._validate = function(value, rule) {\r\n        if (false !== rule.ignoreEmptyValue && this._isValueEmpty(value)) {\r\n            return true\r\n        }\r\n        return rulesValidators.pattern.validate(value, (0, _extend.extend)({}, rule, {\r\n            pattern: /^[\\d\\w._-]+@[\\d\\w._-]+\\.[\\w]+$/i\r\n        }))\r\n    };\r\n    return EmailRuleValidator\r\n}(BaseRuleValidator);\r\nvar rulesValidators = {\r\n    required: new RequiredRuleValidator,\r\n    numeric: new NumericRuleValidator,\r\n    range: new RangeRuleValidator,\r\n    stringLength: new StringLengthRuleValidator,\r\n    custom: new CustomRuleValidator,\r\n    async: new AsyncRuleValidator,\r\n    compare: new CompareRuleValidator,\r\n    pattern: new PatternRuleValidator,\r\n    email: new EmailRuleValidator\r\n};\r\nvar GroupConfig = _class.default.inherit({\r\n    ctor: function(group) {\r\n        this.group = group;\r\n        this.validators = [];\r\n        this._pendingValidators = [];\r\n        this._onValidatorStatusChanged = this._onValidatorStatusChanged.bind(this);\r\n        this._resetValidationInfo();\r\n        this._eventsStrategy = new _events_strategy.EventsStrategy(this)\r\n    },\r\n    validate: function() {\r\n        var _this11 = this;\r\n        var result = {\r\n            isValid: true,\r\n            brokenRules: [],\r\n            validators: [],\r\n            status: STATUS.valid,\r\n            complete: null\r\n        };\r\n        this._unsubscribeFromAllChangeEvents();\r\n        this._pendingValidators = [];\r\n        this._resetValidationInfo();\r\n        (0, _iterator.each)(this.validators, function(_, validator) {\r\n            var validatorResult = validator.validate();\r\n            result.isValid = result.isValid && validatorResult.isValid;\r\n            if (validatorResult.brokenRules) {\r\n                result.brokenRules = result.brokenRules.concat(validatorResult.brokenRules)\r\n            }\r\n            result.validators.push(validator);\r\n            if (validatorResult.status === STATUS.pending) {\r\n                _this11._addPendingValidator(validator)\r\n            }\r\n            _this11._subscribeToChangeEvents(validator)\r\n        });\r\n        if (this._pendingValidators.length) {\r\n            result.status = STATUS.pending\r\n        } else {\r\n            result.status = result.isValid ? STATUS.valid : STATUS.invalid;\r\n            this._unsubscribeFromAllChangeEvents();\r\n            this._raiseValidatedEvent(result)\r\n        }\r\n        this._updateValidationInfo(result);\r\n        return (0, _extend.extend)({}, this._validationInfo.result)\r\n    },\r\n    _subscribeToChangeEvents: function(validator) {\r\n        validator.on(\"validating\", this._onValidatorStatusChanged);\r\n        validator.on(\"validated\", this._onValidatorStatusChanged)\r\n    },\r\n    _unsubscribeFromChangeEvents: function(validator) {\r\n        validator.off(\"validating\", this._onValidatorStatusChanged);\r\n        validator.off(\"validated\", this._onValidatorStatusChanged)\r\n    },\r\n    _unsubscribeFromAllChangeEvents: function() {\r\n        var _this12 = this;\r\n        (0, _iterator.each)(this.validators, function(_, validator) {\r\n            _this12._unsubscribeFromChangeEvents(validator)\r\n        })\r\n    },\r\n    _updateValidationInfo: function(result) {\r\n        this._validationInfo.result = result;\r\n        if (result.status !== STATUS.pending) {\r\n            return\r\n        }\r\n        if (!this._validationInfo.deferred) {\r\n            this._validationInfo.deferred = new _deferred.Deferred;\r\n            this._validationInfo.result.complete = this._validationInfo.deferred.promise()\r\n        }\r\n    },\r\n    _addPendingValidator: function(validator) {\r\n        var foundValidator = (0, _common.grep)(this._pendingValidators, function(val) {\r\n            return val === validator\r\n        })[0];\r\n        if (!foundValidator) {\r\n            this._pendingValidators.push(validator)\r\n        }\r\n    },\r\n    _removePendingValidator: function(validator) {\r\n        var index = (0, _array.inArray)(validator, this._pendingValidators);\r\n        if (index >= 0) {\r\n            this._pendingValidators.splice(index, 1)\r\n        }\r\n    },\r\n    _orderBrokenRules: function(brokenRules) {\r\n        var orderedRules = [];\r\n        (0, _iterator.each)(this.validators, function(_, validator) {\r\n            var foundRules = (0, _common.grep)(brokenRules, function(rule) {\r\n                return rule.validator === validator\r\n            });\r\n            if (foundRules.length) {\r\n                orderedRules = orderedRules.concat(foundRules)\r\n            }\r\n        });\r\n        return orderedRules\r\n    },\r\n    _updateBrokenRules: function(result) {\r\n        if (!this._validationInfo.result) {\r\n            return\r\n        }\r\n        var brokenRules = this._validationInfo.result.brokenRules;\r\n        var rules = (0, _common.grep)(brokenRules, function(rule) {\r\n            return rule.validator !== result.validator\r\n        });\r\n        if (result.brokenRules) {\r\n            brokenRules = rules.concat(result.brokenRules)\r\n        }\r\n        this._validationInfo.result.brokenRules = this._orderBrokenRules(brokenRules)\r\n    },\r\n    _onValidatorStatusChanged: function(result) {\r\n        if (result.status === STATUS.pending) {\r\n            this._addPendingValidator(result.validator);\r\n            return\r\n        }\r\n        this._resolveIfComplete(result)\r\n    },\r\n    _resolveIfComplete: function(result) {\r\n        this._removePendingValidator(result.validator);\r\n        this._updateBrokenRules(result);\r\n        if (!this._pendingValidators.length) {\r\n            this._unsubscribeFromAllChangeEvents();\r\n            if (!this._validationInfo.result) {\r\n                return\r\n            }\r\n            this._validationInfo.result.status = 0 === this._validationInfo.result.brokenRules.length ? STATUS.valid : STATUS.invalid;\r\n            this._validationInfo.result.isValid = this._validationInfo.result.status === STATUS.valid;\r\n            var res = (0, _extend.extend)({}, this._validationInfo.result, {\r\n                complete: null\r\n            });\r\n            var deferred = this._validationInfo.deferred;\r\n            this._resetValidationInfo();\r\n            this._raiseValidatedEvent(res);\r\n            deferred && setTimeout(function() {\r\n                deferred.resolve(res)\r\n            })\r\n        }\r\n    },\r\n    _raiseValidatedEvent: function(result) {\r\n        this._eventsStrategy.fireEvent(\"validated\", [result])\r\n    },\r\n    _resetValidationInfo: function() {\r\n        this._validationInfo = {\r\n            result: null,\r\n            deferred: null\r\n        }\r\n    },\r\n    _synchronizeValidationInfo: function() {\r\n        if (this._validationInfo.result) {\r\n            this._validationInfo.result.validators = this.validators\r\n        }\r\n    },\r\n    removeRegisteredValidator: function(validator) {\r\n        var index = (0, _array.inArray)(validator, this.validators);\r\n        if (index > -1) {\r\n            this.validators.splice(index, 1);\r\n            this._synchronizeValidationInfo();\r\n            this._resolveIfComplete({\r\n                validator: validator\r\n            })\r\n        }\r\n    },\r\n    registerValidator: function(validator) {\r\n        if ((0, _array.inArray)(validator, this.validators) < 0) {\r\n            this.validators.push(validator);\r\n            this._synchronizeValidationInfo()\r\n        }\r\n    },\r\n    reset: function() {\r\n        (0, _iterator.each)(this.validators, function(_, validator) {\r\n            validator.reset()\r\n        });\r\n        this._pendingValidators = [];\r\n        this._resetValidationInfo()\r\n    },\r\n    on: function(eventName, eventHandler) {\r\n        this._eventsStrategy.on(eventName, eventHandler);\r\n        return this\r\n    },\r\n    off: function(eventName, eventHandler) {\r\n        this._eventsStrategy.off(eventName, eventHandler);\r\n        return this\r\n    }\r\n});\r\nvar ValidationEngine = {\r\n    groups: [],\r\n    getGroupConfig: function(group) {\r\n        var result = (0, _common.grep)(this.groups, function(config) {\r\n            return config.group === group\r\n        });\r\n        if (result.length) {\r\n            return result[0]\r\n        }\r\n    },\r\n    findGroup: function($element, model) {\r\n        var $dxGroup = $element.parents(\".dx-validationgroup\").first();\r\n        if ($dxGroup.length) {\r\n            return $dxGroup.dxValidationGroup(\"instance\")\r\n        }\r\n        return model\r\n    },\r\n    initGroups: function() {\r\n        this.groups = [];\r\n        this.addGroup()\r\n    },\r\n    addGroup: function(group) {\r\n        var config = this.getGroupConfig(group);\r\n        if (!config) {\r\n            config = new GroupConfig(group);\r\n            this.groups.push(config)\r\n        }\r\n        return config\r\n    },\r\n    removeGroup: function(group) {\r\n        var config = this.getGroupConfig(group);\r\n        var index = (0, _array.inArray)(config, this.groups);\r\n        if (index > -1) {\r\n            this.groups.splice(index, 1)\r\n        }\r\n        return config\r\n    },\r\n    _setDefaultMessage: function(info) {\r\n        var rule = info.rule,\r\n            validator = info.validator,\r\n            name = info.name;\r\n        if (!(0, _type.isDefined)(rule.message)) {\r\n            if (validator.defaultFormattedMessage && (0, _type.isDefined)(name)) {\r\n                rule.message = validator.defaultFormattedMessage(name)\r\n            } else {\r\n                rule.message = validator.defaultMessage()\r\n            }\r\n        }\r\n    },\r\n    _addBrokenRule: function(info) {\r\n        var result = info.result,\r\n            rule = info.rule;\r\n        if (!result.brokenRule) {\r\n            result.brokenRule = rule\r\n        }\r\n        if (!result.brokenRules) {\r\n            result.brokenRules = []\r\n        }\r\n        result.brokenRules.push(rule)\r\n    },\r\n    validate: function(value, rules, name) {\r\n        var _this13 = this;\r\n        var result = {\r\n            name: name,\r\n            value: value,\r\n            brokenRule: null,\r\n            brokenRules: null,\r\n            isValid: true,\r\n            validationRules: rules,\r\n            pendingRules: null,\r\n            status: STATUS.valid,\r\n            complete: null\r\n        };\r\n        var asyncRuleItems = [];\r\n        (0, _iterator.each)(rules || [], function(_, rule) {\r\n            var ruleValidator = rulesValidators[rule.type];\r\n            var ruleValidationResult;\r\n            if (ruleValidator) {\r\n                if ((0, _type.isDefined)(rule.isValid) && rule.value === value && !rule.reevaluate) {\r\n                    if (!rule.isValid) {\r\n                        result.isValid = false;\r\n                        _this13._addBrokenRule({\r\n                            result: result,\r\n                            rule: rule\r\n                        });\r\n                        return false\r\n                    }\r\n                    return true\r\n                }\r\n                rule.value = value;\r\n                if (\"async\" === rule.type) {\r\n                    asyncRuleItems.push({\r\n                        rule: rule,\r\n                        ruleValidator: ruleValidator\r\n                    });\r\n                    return true\r\n                }\r\n                ruleValidationResult = ruleValidator.validate(value, rule);\r\n                rule.isValid = ruleValidationResult;\r\n                if (!ruleValidationResult) {\r\n                    result.isValid = false;\r\n                    _this13._setDefaultMessage({\r\n                        rule: rule,\r\n                        validator: ruleValidator,\r\n                        name: name\r\n                    });\r\n                    _this13._addBrokenRule({\r\n                        result: result,\r\n                        rule: rule\r\n                    })\r\n                }\r\n                if (!rule.isValid) {\r\n                    return false\r\n                }\r\n            } else {\r\n                throw _errors.default.Error(\"E0100\")\r\n            }\r\n        });\r\n        if (result.isValid && !result.brokenRules && asyncRuleItems.length) {\r\n            result = this._validateAsyncRules({\r\n                value: value,\r\n                items: asyncRuleItems,\r\n                result: result,\r\n                name: name\r\n            })\r\n        }\r\n        result.status = result.pendingRules ? STATUS.pending : result.isValid ? STATUS.valid : STATUS.invalid;\r\n        return result\r\n    },\r\n    _validateAsyncRules: function(_ref) {\r\n        var _this14 = this;\r\n        var result = _ref.result,\r\n            value = _ref.value,\r\n            items = _ref.items,\r\n            name = _ref.name;\r\n        var asyncResults = [];\r\n        (0, _iterator.each)(items, function(_, item) {\r\n            var validateResult = item.ruleValidator.validate(value, item.rule);\r\n            if (!(0, _type.isPromise)(validateResult)) {\r\n                _this14._updateRuleConfig({\r\n                    rule: item.rule,\r\n                    ruleResult: _this14._getPatchedRuleResult(validateResult),\r\n                    validator: item.ruleValidator,\r\n                    name: name\r\n                })\r\n            } else {\r\n                if (!result.pendingRules) {\r\n                    result.pendingRules = []\r\n                }\r\n                result.pendingRules.push(item.rule);\r\n                var asyncResult = validateResult.then(function(res) {\r\n                    var ruleResult = _this14._getPatchedRuleResult(res);\r\n                    _this14._updateRuleConfig({\r\n                        rule: item.rule,\r\n                        ruleResult: ruleResult,\r\n                        validator: item.ruleValidator,\r\n                        name: name\r\n                    });\r\n                    return ruleResult\r\n                });\r\n                asyncResults.push(asyncResult)\r\n            }\r\n        });\r\n        if (asyncResults.length) {\r\n            result.complete = _promise.default.all(asyncResults).then(function(values) {\r\n                return _this14._getAsyncRulesResult({\r\n                    result: result,\r\n                    values: values\r\n                })\r\n            })\r\n        }\r\n        return result\r\n    },\r\n    _updateRuleConfig: function(_ref2) {\r\n        var rule = _ref2.rule,\r\n            ruleResult = _ref2.ruleResult,\r\n            validator = _ref2.validator,\r\n            name = _ref2.name;\r\n        rule.isValid = ruleResult.isValid;\r\n        if (!ruleResult.isValid) {\r\n            if ((0, _type.isDefined)(ruleResult.message) && (0, _type.isString)(ruleResult.message) && ruleResult.message.length) {\r\n                rule.message = ruleResult.message\r\n            } else {\r\n                this._setDefaultMessage({\r\n                    rule: rule,\r\n                    validator: validator,\r\n                    name: name\r\n                })\r\n            }\r\n        }\r\n    },\r\n    _getPatchedRuleResult: function(ruleResult) {\r\n        var result;\r\n        var isValid = true;\r\n        if ((0, _type.isObject)(ruleResult)) {\r\n            result = (0, _extend.extend)({}, ruleResult);\r\n            if (!(0, _type.isDefined)(result.isValid)) {\r\n                result.isValid = isValid\r\n            }\r\n        } else {\r\n            result = {\r\n                isValid: (0, _type.isBoolean)(ruleResult) ? ruleResult : isValid\r\n            }\r\n        }\r\n        return result\r\n    },\r\n    _getAsyncRulesResult: function(_ref3) {\r\n        var _this15 = this;\r\n        var values = _ref3.values,\r\n            result = _ref3.result;\r\n        (0, _iterator.each)(values, function(index, val) {\r\n            if (false === val.isValid) {\r\n                result.isValid = val.isValid;\r\n                var rule = result.pendingRules[index];\r\n                _this15._addBrokenRule({\r\n                    result: result,\r\n                    rule: rule\r\n                })\r\n            }\r\n        });\r\n        result.pendingRules = null;\r\n        result.complete = null;\r\n        result.status = result.isValid ? STATUS.valid : STATUS.invalid;\r\n        return result\r\n    },\r\n    registerValidatorInGroup: function(group, validator) {\r\n        var groupConfig = ValidationEngine.addGroup(group);\r\n        groupConfig.registerValidator.call(groupConfig, validator)\r\n    },\r\n    _shouldRemoveGroup: function(group, validatorsInGroup) {\r\n        var isDefaultGroup = void 0 === group;\r\n        var isValidationGroupInstance = group && \"dxValidationGroup\" === group.NAME;\r\n        return !isDefaultGroup && !isValidationGroupInstance && !validatorsInGroup.length\r\n    },\r\n    removeRegisteredValidator: function(group, validator) {\r\n        var config = ValidationEngine.getGroupConfig(group);\r\n        if (config) {\r\n            config.removeRegisteredValidator.call(config, validator);\r\n            var validatorsInGroup = config.validators;\r\n            if (this._shouldRemoveGroup(group, validatorsInGroup)) {\r\n                this.removeGroup(group)\r\n            }\r\n        }\r\n    },\r\n    initValidationOptions: function(options) {\r\n        var _this16 = this;\r\n        var initedOptions = {};\r\n        if (options) {\r\n            var syncOptions = [\"isValid\", \"validationStatus\", \"validationError\", \"validationErrors\"];\r\n            syncOptions.forEach(function(prop) {\r\n                if (prop in options) {\r\n                    (0, _extend.extend)(initedOptions, _this16.synchronizeValidationOptions({\r\n                        name: prop,\r\n                        value: options[prop]\r\n                    }, options))\r\n                }\r\n            })\r\n        }\r\n        return initedOptions\r\n    },\r\n    synchronizeValidationOptions: function(_ref4, options) {\r\n        var name = _ref4.name,\r\n            value = _ref4.value;\r\n        switch (name) {\r\n            case \"validationStatus\":\r\n                var isValid = value === STATUS.valid || value === STATUS.pending;\r\n                return options.isValid !== isValid ? {\r\n                    isValid: isValid\r\n                } : {};\r\n            case \"isValid\":\r\n                var validationStatus = options.validationStatus;\r\n                var newStatus = validationStatus;\r\n                if (value && validationStatus === STATUS.invalid) {\r\n                    newStatus = STATUS.valid\r\n                } else {\r\n                    if (!value && validationStatus !== STATUS.invalid) {\r\n                        newStatus = STATUS.invalid\r\n                    }\r\n                }\r\n                return newStatus !== validationStatus ? {\r\n                    validationStatus: newStatus\r\n                } : {};\r\n            case \"validationErrors\":\r\n                var validationError = !value || !value.length ? null : value[0];\r\n                return options.validationError !== validationError ? {\r\n                    validationError: validationError\r\n                } : {};\r\n            case \"validationError\":\r\n                var validationErrors = options.validationErrors;\r\n                if (!value && validationErrors) {\r\n                    return {\r\n                        validationErrors: null\r\n                    }\r\n                } else {\r\n                    if (value && !validationErrors) {\r\n                        return {\r\n                            validationErrors: [value]\r\n                        }\r\n                    } else {\r\n                        if (value && validationErrors && value !== validationErrors[0]) {\r\n                            validationErrors[0] = value;\r\n                            return {\r\n                                validationErrors: validationErrors.slice()\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n        }\r\n        return {}\r\n    },\r\n    validateGroup: function(group) {\r\n        var groupConfig = ValidationEngine.getGroupConfig(group);\r\n        if (!groupConfig) {\r\n            throw _errors.default.Error(\"E0110\")\r\n        }\r\n        return groupConfig.validate()\r\n    },\r\n    resetGroup: function(group) {\r\n        var groupConfig = ValidationEngine.getGroupConfig(group);\r\n        if (!groupConfig) {\r\n            throw _errors.default.Error(\"E0110\")\r\n        }\r\n        return groupConfig.reset()\r\n    }\r\n};\r\nValidationEngine.initGroups();\r\nvar _default = ValidationEngine;\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\nmodule.exports.default = module.exports;\r\n"]},"metadata":{},"sourceType":"script"}