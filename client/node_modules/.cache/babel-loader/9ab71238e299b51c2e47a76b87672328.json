{"ast":null,"code":"/**\r\n * DevExtreme (ui/editor/ui.data_expression.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _variable_wrapper = _interopRequireDefault(require(\"../../core/utils/variable_wrapper\"));\n\nvar _data = require(\"../../core/utils/data\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _data_helper = _interopRequireDefault(require(\"../../data_helper\"));\n\nvar _data_source = require(\"../../data/data_source/data_source\");\n\nvar _array_store = _interopRequireDefault(require(\"../../data/array_store\"));\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nvar DataExpressionMixin = (0, _extend.extend)({}, _data_helper.default, {\n  _dataExpressionDefaultOptions: function () {\n    return {\n      items: [],\n      dataSource: null,\n      itemTemplate: \"item\",\n      value: null,\n      valueExpr: \"this\",\n      displayExpr: void 0\n    };\n  },\n  _initDataExpressions: function () {\n    this._compileValueGetter();\n\n    this._compileDisplayGetter();\n\n    this._initDynamicTemplates();\n\n    this._initDataSource();\n\n    this._itemsToDataSource();\n  },\n  _itemsToDataSource: function () {\n    if (!this.option(\"dataSource\")) {\n      this._dataSource = new _data_source.DataSource({\n        store: new _array_store.default(this.option(\"items\")),\n        pageSize: 0\n      });\n    }\n  },\n  _compileDisplayGetter: function () {\n    this._displayGetter = (0, _data.compileGetter)(this._displayGetterExpr());\n  },\n  _displayGetterExpr: function () {\n    return this.option(\"displayExpr\");\n  },\n  _compileValueGetter: function () {\n    this._valueGetter = (0, _data.compileGetter)(this._valueGetterExpr());\n  },\n  _valueGetterExpr: function () {\n    return this.option(\"valueExpr\") || \"this\";\n  },\n  _loadValue: function (value) {\n    var deferred = new _deferred.Deferred();\n    value = this._unwrappedValue(value);\n\n    if (!(0, _type.isDefined)(value)) {\n      return deferred.reject().promise();\n    }\n\n    this._loadSingle(this._valueGetterExpr(), value).done(function (item) {\n      this._isValueEquals(this._valueGetter(item), value) ? deferred.resolve(item) : deferred.reject();\n    }.bind(this)).fail(function () {\n      deferred.reject();\n    });\n\n    return deferred.promise();\n  },\n  _getCurrentValue: function () {\n    return this.option(\"value\");\n  },\n  _unwrappedValue: function (value) {\n    var _value;\n\n    value = null !== (_value = value) && void 0 !== _value ? _value : this._getCurrentValue();\n\n    if (value && this._dataSource && \"this\" === this._valueGetterExpr()) {\n      value = this._getItemKey(value);\n    }\n\n    return _variable_wrapper.default.unwrap(value);\n  },\n  _getItemKey: function (value) {\n    var key = this._dataSource.key();\n\n    if (Array.isArray(key)) {\n      var result = {};\n\n      for (var i = 0, n = key.length; i < n; i++) {\n        result[key[i]] = value[key[i]];\n      }\n\n      return result;\n    }\n\n    if (key && \"object\" === _typeof(value)) {\n      value = value[key];\n    }\n\n    return value;\n  },\n  _isValueEquals: function (value1, value2) {\n    var dataSourceKey = this._dataSource && this._dataSource.key();\n\n    var result = this._compareValues(value1, value2);\n\n    if (!result && dataSourceKey && (0, _type.isDefined)(value1) && (0, _type.isDefined)(value2)) {\n      if (Array.isArray(dataSourceKey)) {\n        result = this._compareByCompositeKey(value1, value2, dataSourceKey);\n      } else {\n        result = this._compareByKey(value1, value2, dataSourceKey);\n      }\n    }\n\n    return result;\n  },\n  _compareByCompositeKey: function (value1, value2, key) {\n    var isObject = _type.isObject;\n\n    if (!isObject(value1) || !isObject(value2)) {\n      return false;\n    }\n\n    for (var i = 0, n = key.length; i < n; i++) {\n      if (value1[key[i]] !== value2[key[i]]) {\n        return false;\n      }\n    }\n\n    return true;\n  },\n  _compareByKey: function (value1, value2, key) {\n    var unwrapObservable = _variable_wrapper.default.unwrap;\n    var valueKey1 = (0, _common.ensureDefined)(unwrapObservable(value1[key]), value1);\n    var valueKey2 = (0, _common.ensureDefined)(unwrapObservable(value2[key]), value2);\n    return this._compareValues(valueKey1, valueKey2);\n  },\n  _compareValues: function (value1, value2) {\n    return (0, _data.toComparable)(value1, true) === (0, _data.toComparable)(value2, true);\n  },\n  _initDynamicTemplates: _common.noop,\n  _setCollectionWidgetItemTemplate: function () {\n    this._initDynamicTemplates();\n\n    this._setCollectionWidgetOption(\"itemTemplate\", this.option(\"itemTemplate\"));\n  },\n  _getCollectionKeyExpr: function () {\n    var valueExpr = this.option(\"valueExpr\");\n    var isValueExprField = (0, _type.isString)(valueExpr) && \"this\" !== valueExpr || (0, _type.isFunction)(valueExpr);\n    return isValueExprField ? valueExpr : null;\n  },\n  _dataExpressionOptionChanged: function (args) {\n    switch (args.name) {\n      case \"items\":\n        this._itemsToDataSource();\n\n        this._setCollectionWidgetOption(\"items\");\n\n        break;\n\n      case \"dataSource\":\n        this._initDataSource();\n\n        break;\n\n      case \"itemTemplate\":\n        this._setCollectionWidgetItemTemplate();\n\n        break;\n\n      case \"valueExpr\":\n        this._compileValueGetter();\n\n        break;\n\n      case \"displayExpr\":\n        this._compileDisplayGetter();\n\n        this._initDynamicTemplates();\n\n        this._setCollectionWidgetOption(\"displayExpr\");\n\n    }\n  }\n});\nvar _default = DataExpressionMixin;\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["C:/Smart-Virtual-Classroom/client/node_modules/devextreme/ui/editor/ui.data_expression.js"],"names":["exports","default","_variable_wrapper","_interopRequireDefault","require","_data","_common","_type","_extend","_data_helper","_data_source","_array_store","_deferred","obj","__esModule","_typeof","Symbol","iterator","constructor","prototype","DataExpressionMixin","extend","_dataExpressionDefaultOptions","items","dataSource","itemTemplate","value","valueExpr","displayExpr","_initDataExpressions","_compileValueGetter","_compileDisplayGetter","_initDynamicTemplates","_initDataSource","_itemsToDataSource","option","_dataSource","DataSource","store","pageSize","_displayGetter","compileGetter","_displayGetterExpr","_valueGetter","_valueGetterExpr","_loadValue","deferred","Deferred","_unwrappedValue","isDefined","reject","promise","_loadSingle","done","item","_isValueEquals","resolve","bind","fail","_getCurrentValue","_value","_getItemKey","unwrap","key","Array","isArray","result","i","n","length","value1","value2","dataSourceKey","_compareValues","_compareByCompositeKey","_compareByKey","isObject","unwrapObservable","valueKey1","ensureDefined","valueKey2","toComparable","noop","_setCollectionWidgetItemTemplate","_setCollectionWidgetOption","_getCollectionKeyExpr","isValueExprField","isString","isFunction","_dataExpressionOptionChanged","args","name","_default","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/editor/ui.data_expression.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _variable_wrapper = _interopRequireDefault(require(\"../../core/utils/variable_wrapper\"));\r\nvar _data = require(\"../../core/utils/data\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _data_helper = _interopRequireDefault(require(\"../../data_helper\"));\r\nvar _data_source = require(\"../../data/data_source/data_source\");\r\nvar _array_store = _interopRequireDefault(require(\"../../data/array_store\"));\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _typeof(obj) {\r\n    \"@babel/helpers - typeof\";\r\n    if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\r\n        _typeof = function(obj) {\r\n            return typeof obj\r\n        }\r\n    } else {\r\n        _typeof = function(obj) {\r\n            return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj\r\n        }\r\n    }\r\n    return _typeof(obj)\r\n}\r\nvar DataExpressionMixin = (0, _extend.extend)({}, _data_helper.default, {\r\n    _dataExpressionDefaultOptions: function() {\r\n        return {\r\n            items: [],\r\n            dataSource: null,\r\n            itemTemplate: \"item\",\r\n            value: null,\r\n            valueExpr: \"this\",\r\n            displayExpr: void 0\r\n        }\r\n    },\r\n    _initDataExpressions: function() {\r\n        this._compileValueGetter();\r\n        this._compileDisplayGetter();\r\n        this._initDynamicTemplates();\r\n        this._initDataSource();\r\n        this._itemsToDataSource()\r\n    },\r\n    _itemsToDataSource: function() {\r\n        if (!this.option(\"dataSource\")) {\r\n            this._dataSource = new _data_source.DataSource({\r\n                store: new _array_store.default(this.option(\"items\")),\r\n                pageSize: 0\r\n            })\r\n        }\r\n    },\r\n    _compileDisplayGetter: function() {\r\n        this._displayGetter = (0, _data.compileGetter)(this._displayGetterExpr())\r\n    },\r\n    _displayGetterExpr: function() {\r\n        return this.option(\"displayExpr\")\r\n    },\r\n    _compileValueGetter: function() {\r\n        this._valueGetter = (0, _data.compileGetter)(this._valueGetterExpr())\r\n    },\r\n    _valueGetterExpr: function() {\r\n        return this.option(\"valueExpr\") || \"this\"\r\n    },\r\n    _loadValue: function(value) {\r\n        var deferred = new _deferred.Deferred;\r\n        value = this._unwrappedValue(value);\r\n        if (!(0, _type.isDefined)(value)) {\r\n            return deferred.reject().promise()\r\n        }\r\n        this._loadSingle(this._valueGetterExpr(), value).done(function(item) {\r\n            this._isValueEquals(this._valueGetter(item), value) ? deferred.resolve(item) : deferred.reject()\r\n        }.bind(this)).fail(function() {\r\n            deferred.reject()\r\n        });\r\n        return deferred.promise()\r\n    },\r\n    _getCurrentValue: function() {\r\n        return this.option(\"value\")\r\n    },\r\n    _unwrappedValue: function(value) {\r\n        var _value;\r\n        value = null !== (_value = value) && void 0 !== _value ? _value : this._getCurrentValue();\r\n        if (value && this._dataSource && \"this\" === this._valueGetterExpr()) {\r\n            value = this._getItemKey(value)\r\n        }\r\n        return _variable_wrapper.default.unwrap(value)\r\n    },\r\n    _getItemKey: function(value) {\r\n        var key = this._dataSource.key();\r\n        if (Array.isArray(key)) {\r\n            var result = {};\r\n            for (var i = 0, n = key.length; i < n; i++) {\r\n                result[key[i]] = value[key[i]]\r\n            }\r\n            return result\r\n        }\r\n        if (key && \"object\" === _typeof(value)) {\r\n            value = value[key]\r\n        }\r\n        return value\r\n    },\r\n    _isValueEquals: function(value1, value2) {\r\n        var dataSourceKey = this._dataSource && this._dataSource.key();\r\n        var result = this._compareValues(value1, value2);\r\n        if (!result && dataSourceKey && (0, _type.isDefined)(value1) && (0, _type.isDefined)(value2)) {\r\n            if (Array.isArray(dataSourceKey)) {\r\n                result = this._compareByCompositeKey(value1, value2, dataSourceKey)\r\n            } else {\r\n                result = this._compareByKey(value1, value2, dataSourceKey)\r\n            }\r\n        }\r\n        return result\r\n    },\r\n    _compareByCompositeKey: function(value1, value2, key) {\r\n        var isObject = _type.isObject;\r\n        if (!isObject(value1) || !isObject(value2)) {\r\n            return false\r\n        }\r\n        for (var i = 0, n = key.length; i < n; i++) {\r\n            if (value1[key[i]] !== value2[key[i]]) {\r\n                return false\r\n            }\r\n        }\r\n        return true\r\n    },\r\n    _compareByKey: function(value1, value2, key) {\r\n        var unwrapObservable = _variable_wrapper.default.unwrap;\r\n        var valueKey1 = (0, _common.ensureDefined)(unwrapObservable(value1[key]), value1);\r\n        var valueKey2 = (0, _common.ensureDefined)(unwrapObservable(value2[key]), value2);\r\n        return this._compareValues(valueKey1, valueKey2)\r\n    },\r\n    _compareValues: function(value1, value2) {\r\n        return (0, _data.toComparable)(value1, true) === (0, _data.toComparable)(value2, true)\r\n    },\r\n    _initDynamicTemplates: _common.noop,\r\n    _setCollectionWidgetItemTemplate: function() {\r\n        this._initDynamicTemplates();\r\n        this._setCollectionWidgetOption(\"itemTemplate\", this.option(\"itemTemplate\"))\r\n    },\r\n    _getCollectionKeyExpr: function() {\r\n        var valueExpr = this.option(\"valueExpr\");\r\n        var isValueExprField = (0, _type.isString)(valueExpr) && \"this\" !== valueExpr || (0, _type.isFunction)(valueExpr);\r\n        return isValueExprField ? valueExpr : null\r\n    },\r\n    _dataExpressionOptionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"items\":\r\n                this._itemsToDataSource();\r\n                this._setCollectionWidgetOption(\"items\");\r\n                break;\r\n            case \"dataSource\":\r\n                this._initDataSource();\r\n                break;\r\n            case \"itemTemplate\":\r\n                this._setCollectionWidgetItemTemplate();\r\n                break;\r\n            case \"valueExpr\":\r\n                this._compileValueGetter();\r\n                break;\r\n            case \"displayExpr\":\r\n                this._compileDisplayGetter();\r\n                this._initDynamicTemplates();\r\n                this._setCollectionWidgetOption(\"displayExpr\")\r\n        }\r\n    }\r\n});\r\nvar _default = DataExpressionMixin;\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}