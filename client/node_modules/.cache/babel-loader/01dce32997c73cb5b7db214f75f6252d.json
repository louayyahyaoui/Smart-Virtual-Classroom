{"ast":null,"code":"/**\r\n * DevExtreme (ui/number_box/number_box.mask.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _events_engine = _interopRequireDefault(require(\"../../events/core/events_engine\"));\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _browser = _interopRequireDefault(require(\"../../core/utils/browser\"));\n\nvar _devices = _interopRequireDefault(require(\"../../core/devices\"));\n\nvar _math = require(\"../../core/utils/math\");\n\nvar _number = _interopRequireDefault(require(\"../../localization/number\"));\n\nvar _number_box = require(\"./number_box.caret\");\n\nvar _number2 = require(\"../../localization/ldml/number\");\n\nvar _number_box2 = _interopRequireDefault(require(\"./number_box.base\"));\n\nvar _index = require(\"../../events/utils/index\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _utils = require(\"./utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar NUMBER_FORMATTER_NAMESPACE = \"dxNumberFormatter\";\nvar MOVE_FORWARD = 1;\nvar MOVE_BACKWARD = -1;\nvar MINUS = \"-\";\nvar MINUS_KEY = \"minus\";\nvar NUMPUD_MINUS_KEY_IE = \"Subtract\";\nvar INPUT_EVENT = \"input\";\nvar CARET_TIMEOUT_DURATION = _browser.default.msie ? 300 : 0;\n\nvar NumberBoxMask = _number_box2.default.inherit({\n  _getDefaultOptions: function () {\n    return (0, _extend.extend)(this.callBase(), {\n      useMaskBehavior: true,\n      format: null\n    });\n  },\n  _isDeleteKey: function (key) {\n    return \"del\" === key;\n  },\n  _supportedKeys: function () {\n    if (!this._useMaskBehavior()) {\n      return this.callBase();\n    }\n\n    var that = this;\n    return (0, _extend.extend)(this.callBase(), {\n      minus: that._revertSign.bind(that),\n      del: that._removeHandler.bind(that),\n      backspace: that._removeHandler.bind(that),\n      leftArrow: that._arrowHandler.bind(that, MOVE_BACKWARD),\n      rightArrow: that._arrowHandler.bind(that, MOVE_FORWARD),\n      home: that._moveCaretToBoundaryEventHandler.bind(that, MOVE_FORWARD),\n      enter: that._updateFormattedValue.bind(that),\n      end: that._moveCaretToBoundaryEventHandler.bind(that, MOVE_BACKWARD)\n    });\n  },\n  _getTextSeparatorIndex: function (text) {\n    var decimalSeparator = _number.default.getDecimalSeparator();\n\n    var realSeparatorOccurrenceIndex = (0, _utils.getRealSeparatorIndex)(this.option(\"format\")).occurrence;\n    return (0, _utils.getNthOccurrence)(text, decimalSeparator, realSeparatorOccurrenceIndex);\n  },\n  _focusInHandler: function (e) {\n    if (!this._preventNestedFocusEvent(e)) {\n      this.clearCaretTimeout();\n      this._caretTimeout = setTimeout(function () {\n        this._caretTimeout = null;\n\n        var caret = this._caret();\n\n        if (caret.start === caret.end && this._useMaskBehavior()) {\n          var text = this._getInputVal();\n\n          var decimalSeparatorIndex = this._getTextSeparatorIndex(text);\n\n          if (decimalSeparatorIndex >= 0) {\n            this._caret({\n              start: decimalSeparatorIndex,\n              end: decimalSeparatorIndex\n            });\n          } else {\n            this._moveCaretToBoundaryEventHandler(MOVE_BACKWARD, e);\n          }\n        }\n      }.bind(this), CARET_TIMEOUT_DURATION);\n    }\n\n    this.callBase(e);\n  },\n  _focusOutHandler: function (e) {\n    var shouldHandleEvent = !this._preventNestedFocusEvent(e);\n\n    if (shouldHandleEvent) {\n      this._focusOutOccurs = true;\n\n      if (this._useMaskBehavior()) {\n        this._updateFormattedValue();\n      }\n    }\n\n    this.callBase(e);\n\n    if (shouldHandleEvent) {\n      this._focusOutOccurs = false;\n    }\n  },\n  _hasValueBeenChanged: function (inputValue) {\n    var format = this._getFormatPattern();\n\n    var value = this.option(\"value\");\n    var formatted = this._format(value, format) || \"\";\n    return formatted !== inputValue;\n  },\n  _updateFormattedValue: function () {\n    var inputValue = this._getInputVal();\n\n    if (this._hasValueBeenChanged(inputValue)) {\n      this._updateParsedValue();\n\n      this._adjustParsedValue();\n\n      this._setTextByParsedValue();\n\n      if (this._parsedValue !== this.option(\"value\")) {\n        _events_engine.default.trigger(this._input(), \"change\");\n      }\n    }\n  },\n  _arrowHandler: function (step, e) {\n    if (!this._useMaskBehavior()) {\n      return;\n    }\n\n    var text = this._getInputVal();\n\n    var format = this._getFormatPattern();\n\n    var nextCaret = (0, _number_box.getCaretWithOffset)(this._caret(), step);\n\n    if (!(0, _number_box.isCaretInBoundaries)(nextCaret, text, format)) {\n      nextCaret = step === MOVE_FORWARD ? nextCaret.end : nextCaret.start;\n      e.preventDefault();\n\n      this._caret((0, _number_box.getCaretInBoundaries)(nextCaret, text, format));\n    }\n  },\n  _moveCaretToBoundary: function (direction) {\n    var boundaries = (0, _number_box.getCaretBoundaries)(this._getInputVal(), this._getFormatPattern());\n    var newCaret = (0, _number_box.getCaretWithOffset)(direction === MOVE_FORWARD ? boundaries.start : boundaries.end, 0);\n\n    this._caret(newCaret);\n  },\n  _moveCaretToBoundaryEventHandler: function (direction, e) {\n    if (!this._useMaskBehavior() || e && e.shiftKey) {\n      return;\n    }\n\n    this._moveCaretToBoundary(direction);\n\n    e && e.preventDefault();\n  },\n  _shouldMoveCaret: function (text, caret) {\n    var decimalSeparator = _number.default.getDecimalSeparator();\n\n    var isDecimalSeparatorNext = text.charAt(caret.end) === decimalSeparator;\n    var isZeroNext = \"0\" === text.charAt(caret.end);\n    var moveToFloat = (this._lastKey === decimalSeparator || \".\" === this._lastKey) && isDecimalSeparatorNext;\n    var zeroToZeroReplace = \"0\" === this._lastKey && isZeroNext;\n    return moveToFloat || zeroToZeroReplace;\n  },\n  _getInputVal: function () {\n    return _number.default.convertDigits(this._input().val(), true);\n  },\n  _keyboardHandler: function (e) {\n    this.clearCaretTimeout();\n    this._lastKey = _number.default.convertDigits((0, _index.getChar)(e), true);\n    this._lastKeyName = (0, _index.normalizeKeyName)(e);\n\n    if (!this._shouldHandleKey(e.originalEvent)) {\n      return this.callBase(e);\n    }\n\n    var normalizedText = this._getInputVal();\n\n    var caret = this._caret();\n\n    var enteredChar = this._lastKeyName === MINUS_KEY ? \"\" : this._lastKey;\n\n    var newValue = this._tryParse(normalizedText, caret, enteredChar);\n\n    if (this._shouldMoveCaret(normalizedText, caret)) {\n      this._moveCaret(1);\n\n      e.originalEvent.preventDefault();\n    }\n\n    if (void 0 === newValue) {\n      if (this._lastKeyName !== MINUS_KEY) {\n        e.originalEvent.preventDefault();\n      }\n    } else {\n      this._parsedValue = newValue;\n    }\n\n    return this.callBase(e);\n  },\n  _keyPressHandler: function (e) {\n    if (!this._useMaskBehavior()) {\n      this.callBase(e);\n    }\n  },\n  _removeHandler: function (e) {\n    var caret = this._caret();\n\n    var text = this._getInputVal();\n\n    var start = caret.start;\n    var end = caret.end;\n    this._lastKey = (0, _index.getChar)(e);\n    this._lastKeyName = (0, _index.normalizeKeyName)(e);\n\n    var isDeleteKey = this._isDeleteKey(this._lastKeyName);\n\n    var isBackspaceKey = !isDeleteKey;\n\n    if (start === end) {\n      var caretPosition = start;\n      var canDelete = isBackspaceKey && caretPosition > 0 || isDeleteKey && caretPosition < text.length;\n\n      if (canDelete) {\n        isDeleteKey && end++;\n        isBackspaceKey && start--;\n      } else {\n        e.preventDefault();\n        return;\n      }\n    }\n\n    var char = text.slice(start, end);\n\n    if (this._isStub(char)) {\n      this._moveCaret(isDeleteKey ? 1 : -1);\n\n      if (this._parsedValue < 0 || 1 / this._parsedValue === -(1 / 0)) {\n        this._revertSign(e);\n\n        this._setTextByParsedValue();\n      }\n\n      e.preventDefault();\n      return;\n    }\n\n    var decimalSeparator = _number.default.getDecimalSeparator();\n\n    if (char === decimalSeparator) {\n      var decimalSeparatorIndex = text.indexOf(decimalSeparator);\n\n      if (this._isNonStubAfter(decimalSeparatorIndex + 1)) {\n        this._moveCaret(isDeleteKey ? 1 : -1);\n\n        e.preventDefault();\n      }\n\n      return;\n    }\n\n    if (end - start < text.length) {\n      var editedText = this._replaceSelectedText(text, {\n        start: start,\n        end: end\n      }, \"\");\n\n      var noDigits = editedText.search(/[0-9]/) < 0;\n\n      if (noDigits && this._isValueInRange(0)) {\n        this._parsedValue = this._parsedValue < 0 || 1 / this._parsedValue === -(1 / 0) ? -0 : 0;\n        return;\n      }\n    }\n\n    var valueAfterRemoving = this._tryParse(text, {\n      start: start,\n      end: end\n    }, \"\");\n\n    if (void 0 === valueAfterRemoving) {\n      e.preventDefault();\n    } else {\n      this._parsedValue = valueAfterRemoving;\n    }\n  },\n  _isPercentFormat: function () {\n    var format = this._getFormatPattern();\n\n    var noEscapedFormat = format.replace(/'[^']+'/g, \"\");\n    return noEscapedFormat.indexOf(\"%\") !== -1;\n  },\n  _parse: function (text, format) {\n    var formatOption = this.option(\"format\");\n    var isCustomParser = (0, _type.isFunction)(formatOption.parser);\n    var parser = isCustomParser ? formatOption.parser : _number.default.parse;\n    var integerPartStartIndex = 0;\n\n    if (!isCustomParser) {\n      var formatPointIndex = (0, _utils.getRealSeparatorIndex)(format).index;\n\n      var textPointIndex = this._getTextSeparatorIndex(text);\n\n      var formatIntegerPartLength = formatPointIndex !== -1 ? formatPointIndex : format.length;\n      var textIntegerPartLength = textPointIndex !== -1 ? textPointIndex : text.length;\n\n      if (textIntegerPartLength > formatIntegerPartLength && format.indexOf(\"#\") === -1) {\n        integerPartStartIndex = textIntegerPartLength - formatIntegerPartLength;\n      }\n    }\n\n    text = this._removeStubs(text, true);\n    text = text.substr(integerPartStartIndex);\n    return parser(text, format);\n  },\n  _format: function (value, format) {\n    var formatOption = this.option(\"format\");\n    var isCustomFormatter = (0, _type.isFunction)(null === formatOption || void 0 === formatOption ? void 0 : formatOption.formatter);\n    var formatter = isCustomFormatter ? formatOption.formatter : _number.default.format;\n    return formatter(value, format);\n  },\n  _getFormatPattern: function () {\n    if (!this._currentFormat) {\n      this._updateFormat();\n    }\n\n    return this._currentFormat;\n  },\n  _updateFormat: function () {\n    var _this = this;\n\n    var format = this.option(\"format\");\n    var isCustomParser = (0, _type.isFunction)(null === format || void 0 === format ? void 0 : format.parser);\n    var isLDMLPattern = (0, _type.isString)(format) && (format.indexOf(\"0\") >= 0 || format.indexOf(\"#\") >= 0);\n    this._currentFormat = isCustomParser || isLDMLPattern ? format : (0, _number2.getFormat)(function (value) {\n      var text = _this._format(value, format);\n\n      return _number.default.convertDigits(text, true);\n    });\n  },\n  _getFormatForSign: function (text) {\n    var format = this._getFormatPattern();\n\n    if ((0, _type.isString)(format)) {\n      var signParts = format.split(\";\");\n\n      var sign = _number.default.getSign(text, format);\n\n      signParts[1] = signParts[1] || \"-\" + signParts[0];\n      return sign < 0 ? signParts[1] : signParts[0];\n    } else {\n      var _sign = _number.default.getSign(text);\n\n      return _sign < 0 ? \"-\" : \"\";\n    }\n  },\n  _removeStubs: function (text, excludeComma) {\n    var format = this._getFormatForSign(text);\n\n    var thousandsSeparator = _number.default.getThousandsSeparator();\n\n    var stubs = this._getStubs(format);\n\n    var result = text;\n\n    if (stubs.length) {\n      var prefixStubs = stubs[0];\n      var postfixRegex = new RegExp(\"(\" + (0, _common.escapeRegExp)(stubs[1] || \"\") + \")$\", \"g\");\n      var decoratorsRegex = new RegExp(\"[-\" + (0, _common.escapeRegExp)(excludeComma ? \"\" : thousandsSeparator) + \"]\", \"g\");\n      result = result.replace(prefixStubs, \"\").replace(postfixRegex, \"\").replace(decoratorsRegex, \"\");\n    }\n\n    return result;\n  },\n  _getStubs: function (format) {\n    var regExpResult = /[^']([#0.,]+)/g.exec(format);\n    var pattern = regExpResult && regExpResult[0].trim();\n    return format.split(pattern).map(function (stub) {\n      return stub.replace(/'/g, \"\");\n    });\n  },\n  _truncateToPrecision: function (value, maxPrecision) {\n    if ((0, _type.isDefined)(value)) {\n      var strValue = value.toString();\n      var decimalSeparatorIndex = strValue.indexOf(\".\");\n\n      if (strValue && decimalSeparatorIndex > -1) {\n        var parsedValue = parseFloat(strValue.substr(0, decimalSeparatorIndex + maxPrecision + 1));\n        return isNaN(parsedValue) ? value : parsedValue;\n      }\n    }\n\n    return value;\n  },\n  _tryParse: function (text, selection, char) {\n    var editedText = this._replaceSelectedText(text, selection, char);\n\n    var format = this._getFormatPattern();\n\n    var isTextSelected = selection.start !== selection.end;\n\n    var parsedValue = this._getParsedValue(editedText, format);\n\n    var maxPrecision = !format.parser && this._getPrecisionLimits(editedText).max;\n\n    var isValueChanged = parsedValue !== this._parsedValue;\n\n    var decimalSeparator = _number.default.getDecimalSeparator();\n\n    var isDecimalPointRestricted = char === decimalSeparator && 0 === maxPrecision;\n\n    var isUselessCharRestricted = !isTextSelected && !isValueChanged && char !== MINUS && !this._isValueIncomplete(editedText) && this._isStub(char);\n\n    if (isDecimalPointRestricted || isUselessCharRestricted) {\n      return;\n    }\n\n    if (\"\" === this._removeStubs(editedText)) {\n      parsedValue = Math.abs(0 * this._parsedValue);\n    }\n\n    if (isNaN(parsedValue)) {\n      return;\n    }\n\n    var value = null === parsedValue ? this._parsedValue : parsedValue;\n    parsedValue = maxPrecision ? this._truncateToPrecision(value, maxPrecision) : parsedValue;\n    return !format.parser && this._isPercentFormat() ? parsedValue && parsedValue / 100 : parsedValue;\n  },\n  _getParsedValue: function (text, format) {\n    var sign = _number.default.getSign(text, (null === format || void 0 === format ? void 0 : format.formatter) || format);\n\n    var parsedValue = this._parse(text, format);\n\n    var parsedValueSign = parsedValue < 0 ? -1 : 1;\n    var parsedValueWithSign = (0, _type.isNumeric)(parsedValue) && sign !== parsedValueSign ? sign * parsedValue : parsedValue;\n    return parsedValueWithSign;\n  },\n  _isValueIncomplete: function (text) {\n    if (!this._useMaskBehavior()) {\n      return this.callBase(text);\n    }\n\n    var caret = this._caret();\n\n    var point = _number.default.getDecimalSeparator();\n\n    var pointIndex = this._getTextSeparatorIndex(text);\n\n    var isCaretOnFloat = pointIndex >= 0 && pointIndex < caret.start;\n\n    var textParts = this._removeStubs(text, true).split(point);\n\n    if (!isCaretOnFloat || 2 !== textParts.length) {\n      return false;\n    }\n\n    var floatLength = textParts[1].length;\n\n    var format = this._getFormatPattern();\n\n    var isCustomParser = !!format.parser;\n\n    var precision = !isCustomParser && this._getPrecisionLimits(this._getFormatPattern(), text);\n\n    var isPrecisionInRange = isCustomParser ? true : (0, _math.inRange)(floatLength, precision.min, precision.max);\n    var endsWithZero = \"0\" === textParts[1].charAt(floatLength - 1);\n    return isPrecisionInRange && (endsWithZero || !floatLength);\n  },\n  _isValueInRange: function (value) {\n    var min = (0, _common.ensureDefined)(this.option(\"min\"), -(1 / 0));\n    var max = (0, _common.ensureDefined)(this.option(\"max\"), 1 / 0);\n    return (0, _math.inRange)(value, min, max);\n  },\n  _setInputText: function (text) {\n    var normalizedText = _number.default.convertDigits(text, true);\n\n    var newCaret = (0, _number_box.getCaretAfterFormat)(this._getInputVal(), normalizedText, this._caret(), this._getFormatPattern());\n\n    this._input().val(text);\n\n    this._toggleEmptinessEventHandler();\n\n    this._formattedValue = text;\n\n    if (!this._focusOutOccurs) {\n      this._caret(newCaret);\n    }\n  },\n  _useMaskBehavior: function () {\n    return !!this.option(\"format\") && this.option(\"useMaskBehavior\");\n  },\n  _renderInputType: function () {\n    var isNumberType = \"number\" === this.option(\"mode\");\n\n    var isDesktop = \"desktop\" === _devices.default.real().deviceType;\n\n    if (this._useMaskBehavior() && isNumberType) {\n      this._setInputType(isDesktop || this._isSupportInputMode() ? \"text\" : \"tel\");\n    } else {\n      this.callBase();\n    }\n  },\n  _isChar: function (str) {\n    return (0, _type.isString)(str) && 1 === str.length;\n  },\n  _moveCaret: function (offset) {\n    if (!offset) {\n      return;\n    }\n\n    var newCaret = (0, _number_box.getCaretWithOffset)(this._caret(), offset);\n    var adjustedCaret = (0, _number_box.getCaretInBoundaries)(newCaret, this._getInputVal(), this._getFormatPattern());\n\n    this._caret(adjustedCaret);\n  },\n  _shouldHandleKey: function (e) {\n    var keyName = (0, _index.normalizeKeyName)(e);\n    var isSpecialChar = e.ctrlKey || e.shiftKey || e.altKey || !this._isChar(keyName);\n    var isMinusKey = keyName === MINUS_KEY;\n\n    var useMaskBehavior = this._useMaskBehavior();\n\n    return useMaskBehavior && !isSpecialChar && !isMinusKey;\n  },\n  _renderInput: function () {\n    this.callBase();\n\n    this._renderFormatter();\n  },\n  _renderFormatter: function () {\n    this._clearCache();\n\n    this._detachFormatterEvents();\n\n    if (this._useMaskBehavior()) {\n      this._attachFormatterEvents();\n    }\n  },\n  _detachFormatterEvents: function () {\n    _events_engine.default.off(this._input(), \".\" + NUMBER_FORMATTER_NAMESPACE);\n  },\n  _isInputFromPaste: function (e) {\n    var inputType = e.originalEvent && e.originalEvent.inputType;\n\n    if ((0, _type.isDefined)(inputType)) {\n      return \"insertFromPaste\" === inputType;\n    } else {\n      return this._isValuePasted;\n    }\n  },\n  _attachFormatterEvents: function () {\n    var $input = this._input();\n\n    _events_engine.default.on($input, (0, _index.addNamespace)(INPUT_EVENT, NUMBER_FORMATTER_NAMESPACE), function (e) {\n      this._formatValue(e);\n\n      this._isValuePasted = false;\n    }.bind(this));\n\n    if (_browser.default.msie && _browser.default.version < 12) {\n      _events_engine.default.on($input, (0, _index.addNamespace)(\"paste\", NUMBER_FORMATTER_NAMESPACE), function () {\n        this._isValuePasted = true;\n      }.bind(this));\n    }\n\n    _events_engine.default.on($input, (0, _index.addNamespace)(\"dxclick\", NUMBER_FORMATTER_NAMESPACE), function () {\n      if (!this._caretTimeout) {\n        this._caretTimeout = setTimeout(function () {\n          this._caret((0, _number_box.getCaretInBoundaries)(this._caret(), this._getInputVal(), this._getFormatPattern()));\n        }.bind(this), CARET_TIMEOUT_DURATION);\n      }\n    }.bind(this));\n\n    _events_engine.default.on($input, \"dxdblclick\", function () {\n      this.clearCaretTimeout();\n    }.bind(this));\n  },\n  clearCaretTimeout: function () {\n    clearTimeout(this._caretTimeout);\n    this._caretTimeout = null;\n  },\n  _forceRefreshInputValue: function () {\n    if (!this._useMaskBehavior()) {\n      return this.callBase();\n    }\n  },\n  _isNonStubAfter: function (index) {\n    var text = this._getInputVal().slice(index);\n\n    return text && !this._isStub(text, true);\n  },\n  _isStub: function (str, isString) {\n    var escapedDecimalSeparator = (0, _common.escapeRegExp)(_number.default.getDecimalSeparator());\n    var regExpString = \"^[^0-9\" + escapedDecimalSeparator + \"]+$\";\n    var stubRegExp = new RegExp(regExpString, \"g\");\n    return stubRegExp.test(str) && (isString || this._isChar(str));\n  },\n  _parseValue: function (text) {\n    if (!this._useMaskBehavior()) {\n      return this.callBase(text);\n    }\n\n    return this._parsedValue;\n  },\n  _getPrecisionLimits: function (text) {\n    var currentFormat = this._getFormatForSign(text);\n\n    var realSeparatorIndex = (0, _utils.getRealSeparatorIndex)(currentFormat).index;\n    var floatPart = ((0, _utils.splitByIndex)(currentFormat, realSeparatorIndex)[1] || \"\").replace(/[^#0]/g, \"\");\n    var minPrecision = floatPart.replace(/^(0*)#*/, \"$1\").length;\n    var maxPrecision = floatPart.length;\n    return {\n      min: minPrecision,\n      max: maxPrecision\n    };\n  },\n  _revertSign: function (e) {\n    if (!this._useMaskBehavior()) {\n      return;\n    }\n\n    var caret = this._caret();\n\n    if (caret.start !== caret.end) {\n      if ((0, _index.normalizeKeyName)(e) === MINUS_KEY) {\n        this._applyRevertedSign(e, caret, true);\n\n        return;\n      } else {\n        this._caret((0, _number_box.getCaretInBoundaries)(0, this._getInputVal(), this._getFormatPattern()));\n      }\n    }\n\n    this._applyRevertedSign(e, caret);\n  },\n  _applyRevertedSign: function (e, caret, preserveSelectedText) {\n    var newValue = -1 * (0, _common.ensureDefined)(this._parsedValue, null);\n\n    if (this._isValueInRange(newValue)) {\n      this._parsedValue = newValue;\n\n      if (preserveSelectedText) {\n        var format = this._getFormatPattern();\n\n        var previousText = this._getInputVal();\n\n        this._setTextByParsedValue();\n\n        e.preventDefault();\n\n        var currentText = this._getInputVal();\n\n        var offset = (0, _number_box.getCaretOffset)(previousText, currentText, format);\n        caret = (0, _number_box.getCaretWithOffset)(caret, offset);\n        var caretInBoundaries = (0, _number_box.getCaretInBoundaries)(caret, currentText, format);\n\n        if (_browser.default.msie) {\n          clearTimeout(this._caretTimeout);\n          this._caretTimeout = setTimeout(this._caret.bind(this, caretInBoundaries));\n        } else {\n          this._caret(caretInBoundaries);\n        }\n      }\n\n      if (e.key === NUMPUD_MINUS_KEY_IE) {\n        _events_engine.default.trigger(this._input(), INPUT_EVENT);\n      }\n    }\n  },\n  _removeMinusFromText: function (text, caret) {\n    var isMinusPressed = this._lastKeyName === MINUS_KEY && text.charAt(caret.start - 1) === MINUS;\n    return isMinusPressed ? this._replaceSelectedText(text, {\n      start: caret.start - 1,\n      end: caret.start\n    }, \"\") : text;\n  },\n  _setTextByParsedValue: function () {\n    var format = this._getFormatPattern();\n\n    var parsed = this._parseValue();\n\n    var formatted = this._format(parsed, format) || \"\";\n\n    this._setInputText(formatted);\n  },\n  _formatValue: function (e) {\n    var normalizedText = this._getInputVal();\n\n    var caret = this._caret();\n\n    var textWithoutMinus = this._removeMinusFromText(normalizedText, caret);\n\n    var wasMinusRemoved = textWithoutMinus !== normalizedText;\n    normalizedText = textWithoutMinus;\n\n    if (!this._isInputFromPaste(e) && this._isValueIncomplete(textWithoutMinus)) {\n      this._formattedValue = normalizedText;\n\n      if (wasMinusRemoved) {\n        this._setTextByParsedValue();\n      }\n\n      return;\n    }\n\n    var textWasChanged = _number.default.convertDigits(this._formattedValue, true) !== normalizedText;\n\n    if (textWasChanged) {\n      var value = this._tryParse(normalizedText, caret, \"\");\n\n      if ((0, _type.isDefined)(value)) {\n        this._parsedValue = value;\n      }\n    }\n\n    this._setTextByParsedValue();\n  },\n  _renderDisplayText: function () {\n    if (this._useMaskBehavior()) {\n      this._toggleEmptinessEventHandler();\n    } else {\n      this.callBase.apply(this, arguments);\n    }\n  },\n  _renderValue: function () {\n    if (this._useMaskBehavior()) {\n      this._parsedValue = this.option(\"value\");\n\n      this._setTextByParsedValue();\n    }\n\n    return this.callBase();\n  },\n  _updateParsedValue: function () {\n    var inputValue = this._getInputVal();\n\n    this._parsedValue = this._tryParse(inputValue, this._caret());\n  },\n  _adjustParsedValue: function () {\n    if (!this._useMaskBehavior()) {\n      return;\n    }\n\n    var clearedText = this._removeStubs(this._getInputVal());\n\n    var parsedValue = clearedText ? this._parseValue() : null;\n\n    if (!(0, _type.isNumeric)(parsedValue)) {\n      this._parsedValue = parsedValue;\n      return;\n    }\n\n    this._parsedValue = (0, _math.fitIntoRange)(parsedValue, this.option(\"min\"), this.option(\"max\"));\n  },\n  _valueChangeEventHandler: function (e) {\n    if (!this._useMaskBehavior()) {\n      return this.callBase(e);\n    }\n\n    var caret = this._caret();\n\n    this._saveValueChangeEvent(e);\n\n    this._lastKey = null;\n    this._lastKeyName = null;\n\n    this._updateParsedValue();\n\n    this._adjustParsedValue();\n\n    this.option(\"value\", this._parsedValue);\n\n    if (caret) {\n      this._caret(caret);\n    }\n  },\n  _optionChanged: function (args) {\n    switch (args.name) {\n      case \"format\":\n      case \"useMaskBehavior\":\n        this._renderInputType();\n\n        this._updateFormat();\n\n        this._renderFormatter();\n\n        this._renderValue();\n\n        this._refreshValueChangeEvent();\n\n        this._refreshEvents();\n\n        break;\n\n      case \"min\":\n      case \"max\":\n        this._adjustParsedValue();\n\n        this.callBase(args);\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _clearCache: function () {\n    delete this._formattedValue;\n    delete this._lastKey;\n    delete this._lastKeyName;\n    delete this._parsedValue;\n    delete this._focusOutOccurs;\n    clearTimeout(this._caretTimeout);\n    delete this._caretTimeout;\n  },\n  _clean: function () {\n    this._clearCache();\n\n    this.callBase();\n  }\n});\n\nvar _default = NumberBoxMask;\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["C:/Smart-Virtual-Classroom/client/node_modules/devextreme/ui/number_box/number_box.mask.js"],"names":["exports","default","_events_engine","_interopRequireDefault","require","_extend","_type","_browser","_devices","_math","_number","_number_box","_number2","_number_box2","_index","_common","_utils","obj","__esModule","NUMBER_FORMATTER_NAMESPACE","MOVE_FORWARD","MOVE_BACKWARD","MINUS","MINUS_KEY","NUMPUD_MINUS_KEY_IE","INPUT_EVENT","CARET_TIMEOUT_DURATION","msie","NumberBoxMask","inherit","_getDefaultOptions","extend","callBase","useMaskBehavior","format","_isDeleteKey","key","_supportedKeys","_useMaskBehavior","that","minus","_revertSign","bind","del","_removeHandler","backspace","leftArrow","_arrowHandler","rightArrow","home","_moveCaretToBoundaryEventHandler","enter","_updateFormattedValue","end","_getTextSeparatorIndex","text","decimalSeparator","getDecimalSeparator","realSeparatorOccurrenceIndex","getRealSeparatorIndex","option","occurrence","getNthOccurrence","_focusInHandler","e","_preventNestedFocusEvent","clearCaretTimeout","_caretTimeout","setTimeout","caret","_caret","start","_getInputVal","decimalSeparatorIndex","_focusOutHandler","shouldHandleEvent","_focusOutOccurs","_hasValueBeenChanged","inputValue","_getFormatPattern","value","formatted","_format","_updateParsedValue","_adjustParsedValue","_setTextByParsedValue","_parsedValue","trigger","_input","step","nextCaret","getCaretWithOffset","isCaretInBoundaries","preventDefault","getCaretInBoundaries","_moveCaretToBoundary","direction","boundaries","getCaretBoundaries","newCaret","shiftKey","_shouldMoveCaret","isDecimalSeparatorNext","charAt","isZeroNext","moveToFloat","_lastKey","zeroToZeroReplace","convertDigits","val","_keyboardHandler","getChar","_lastKeyName","normalizeKeyName","_shouldHandleKey","originalEvent","normalizedText","enteredChar","newValue","_tryParse","_moveCaret","_keyPressHandler","isDeleteKey","isBackspaceKey","caretPosition","canDelete","length","char","slice","_isStub","indexOf","_isNonStubAfter","editedText","_replaceSelectedText","noDigits","search","_isValueInRange","valueAfterRemoving","_isPercentFormat","noEscapedFormat","replace","_parse","formatOption","isCustomParser","isFunction","parser","parse","integerPartStartIndex","formatPointIndex","index","textPointIndex","formatIntegerPartLength","textIntegerPartLength","_removeStubs","substr","isCustomFormatter","formatter","_currentFormat","_updateFormat","_this","isLDMLPattern","isString","getFormat","_getFormatForSign","signParts","split","sign","getSign","_sign","excludeComma","thousandsSeparator","getThousandsSeparator","stubs","_getStubs","result","prefixStubs","postfixRegex","RegExp","escapeRegExp","decoratorsRegex","regExpResult","exec","pattern","trim","map","stub","_truncateToPrecision","maxPrecision","isDefined","strValue","toString","parsedValue","parseFloat","isNaN","selection","isTextSelected","_getParsedValue","_getPrecisionLimits","max","isValueChanged","isDecimalPointRestricted","isUselessCharRestricted","_isValueIncomplete","Math","abs","parsedValueSign","parsedValueWithSign","isNumeric","point","pointIndex","isCaretOnFloat","textParts","floatLength","precision","isPrecisionInRange","inRange","min","endsWithZero","ensureDefined","_setInputText","getCaretAfterFormat","_toggleEmptinessEventHandler","_formattedValue","_renderInputType","isNumberType","isDesktop","real","deviceType","_setInputType","_isSupportInputMode","_isChar","str","offset","adjustedCaret","keyName","isSpecialChar","ctrlKey","altKey","isMinusKey","_renderInput","_renderFormatter","_clearCache","_detachFormatterEvents","_attachFormatterEvents","off","_isInputFromPaste","inputType","_isValuePasted","$input","on","addNamespace","_formatValue","version","clearTimeout","_forceRefreshInputValue","escapedDecimalSeparator","regExpString","stubRegExp","test","_parseValue","currentFormat","realSeparatorIndex","floatPart","splitByIndex","minPrecision","_applyRevertedSign","preserveSelectedText","previousText","currentText","getCaretOffset","caretInBoundaries","_removeMinusFromText","isMinusPressed","parsed","textWithoutMinus","wasMinusRemoved","textWasChanged","_renderDisplayText","apply","arguments","_renderValue","clearedText","fitIntoRange","_valueChangeEventHandler","_saveValueChangeEvent","_optionChanged","args","name","_refreshValueChangeEvent","_refreshEvents","_clean","_default","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/number_box/number_box.mask.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _events_engine = _interopRequireDefault(require(\"../../events/core/events_engine\"));\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _browser = _interopRequireDefault(require(\"../../core/utils/browser\"));\r\nvar _devices = _interopRequireDefault(require(\"../../core/devices\"));\r\nvar _math = require(\"../../core/utils/math\");\r\nvar _number = _interopRequireDefault(require(\"../../localization/number\"));\r\nvar _number_box = require(\"./number_box.caret\");\r\nvar _number2 = require(\"../../localization/ldml/number\");\r\nvar _number_box2 = _interopRequireDefault(require(\"./number_box.base\"));\r\nvar _index = require(\"../../events/utils/index\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _utils = require(\"./utils\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar NUMBER_FORMATTER_NAMESPACE = \"dxNumberFormatter\";\r\nvar MOVE_FORWARD = 1;\r\nvar MOVE_BACKWARD = -1;\r\nvar MINUS = \"-\";\r\nvar MINUS_KEY = \"minus\";\r\nvar NUMPUD_MINUS_KEY_IE = \"Subtract\";\r\nvar INPUT_EVENT = \"input\";\r\nvar CARET_TIMEOUT_DURATION = _browser.default.msie ? 300 : 0;\r\nvar NumberBoxMask = _number_box2.default.inherit({\r\n    _getDefaultOptions: function() {\r\n        return (0, _extend.extend)(this.callBase(), {\r\n            useMaskBehavior: true,\r\n            format: null\r\n        })\r\n    },\r\n    _isDeleteKey: function(key) {\r\n        return \"del\" === key\r\n    },\r\n    _supportedKeys: function() {\r\n        if (!this._useMaskBehavior()) {\r\n            return this.callBase()\r\n        }\r\n        var that = this;\r\n        return (0, _extend.extend)(this.callBase(), {\r\n            minus: that._revertSign.bind(that),\r\n            del: that._removeHandler.bind(that),\r\n            backspace: that._removeHandler.bind(that),\r\n            leftArrow: that._arrowHandler.bind(that, MOVE_BACKWARD),\r\n            rightArrow: that._arrowHandler.bind(that, MOVE_FORWARD),\r\n            home: that._moveCaretToBoundaryEventHandler.bind(that, MOVE_FORWARD),\r\n            enter: that._updateFormattedValue.bind(that),\r\n            end: that._moveCaretToBoundaryEventHandler.bind(that, MOVE_BACKWARD)\r\n        })\r\n    },\r\n    _getTextSeparatorIndex: function(text) {\r\n        var decimalSeparator = _number.default.getDecimalSeparator();\r\n        var realSeparatorOccurrenceIndex = (0, _utils.getRealSeparatorIndex)(this.option(\"format\")).occurrence;\r\n        return (0, _utils.getNthOccurrence)(text, decimalSeparator, realSeparatorOccurrenceIndex)\r\n    },\r\n    _focusInHandler: function(e) {\r\n        if (!this._preventNestedFocusEvent(e)) {\r\n            this.clearCaretTimeout();\r\n            this._caretTimeout = setTimeout(function() {\r\n                this._caretTimeout = null;\r\n                var caret = this._caret();\r\n                if (caret.start === caret.end && this._useMaskBehavior()) {\r\n                    var text = this._getInputVal();\r\n                    var decimalSeparatorIndex = this._getTextSeparatorIndex(text);\r\n                    if (decimalSeparatorIndex >= 0) {\r\n                        this._caret({\r\n                            start: decimalSeparatorIndex,\r\n                            end: decimalSeparatorIndex\r\n                        })\r\n                    } else {\r\n                        this._moveCaretToBoundaryEventHandler(MOVE_BACKWARD, e)\r\n                    }\r\n                }\r\n            }.bind(this), CARET_TIMEOUT_DURATION)\r\n        }\r\n        this.callBase(e)\r\n    },\r\n    _focusOutHandler: function(e) {\r\n        var shouldHandleEvent = !this._preventNestedFocusEvent(e);\r\n        if (shouldHandleEvent) {\r\n            this._focusOutOccurs = true;\r\n            if (this._useMaskBehavior()) {\r\n                this._updateFormattedValue()\r\n            }\r\n        }\r\n        this.callBase(e);\r\n        if (shouldHandleEvent) {\r\n            this._focusOutOccurs = false\r\n        }\r\n    },\r\n    _hasValueBeenChanged: function(inputValue) {\r\n        var format = this._getFormatPattern();\r\n        var value = this.option(\"value\");\r\n        var formatted = this._format(value, format) || \"\";\r\n        return formatted !== inputValue\r\n    },\r\n    _updateFormattedValue: function() {\r\n        var inputValue = this._getInputVal();\r\n        if (this._hasValueBeenChanged(inputValue)) {\r\n            this._updateParsedValue();\r\n            this._adjustParsedValue();\r\n            this._setTextByParsedValue();\r\n            if (this._parsedValue !== this.option(\"value\")) {\r\n                _events_engine.default.trigger(this._input(), \"change\")\r\n            }\r\n        }\r\n    },\r\n    _arrowHandler: function(step, e) {\r\n        if (!this._useMaskBehavior()) {\r\n            return\r\n        }\r\n        var text = this._getInputVal();\r\n        var format = this._getFormatPattern();\r\n        var nextCaret = (0, _number_box.getCaretWithOffset)(this._caret(), step);\r\n        if (!(0, _number_box.isCaretInBoundaries)(nextCaret, text, format)) {\r\n            nextCaret = step === MOVE_FORWARD ? nextCaret.end : nextCaret.start;\r\n            e.preventDefault();\r\n            this._caret((0, _number_box.getCaretInBoundaries)(nextCaret, text, format))\r\n        }\r\n    },\r\n    _moveCaretToBoundary: function(direction) {\r\n        var boundaries = (0, _number_box.getCaretBoundaries)(this._getInputVal(), this._getFormatPattern());\r\n        var newCaret = (0, _number_box.getCaretWithOffset)(direction === MOVE_FORWARD ? boundaries.start : boundaries.end, 0);\r\n        this._caret(newCaret)\r\n    },\r\n    _moveCaretToBoundaryEventHandler: function(direction, e) {\r\n        if (!this._useMaskBehavior() || e && e.shiftKey) {\r\n            return\r\n        }\r\n        this._moveCaretToBoundary(direction);\r\n        e && e.preventDefault()\r\n    },\r\n    _shouldMoveCaret: function(text, caret) {\r\n        var decimalSeparator = _number.default.getDecimalSeparator();\r\n        var isDecimalSeparatorNext = text.charAt(caret.end) === decimalSeparator;\r\n        var isZeroNext = \"0\" === text.charAt(caret.end);\r\n        var moveToFloat = (this._lastKey === decimalSeparator || \".\" === this._lastKey) && isDecimalSeparatorNext;\r\n        var zeroToZeroReplace = \"0\" === this._lastKey && isZeroNext;\r\n        return moveToFloat || zeroToZeroReplace\r\n    },\r\n    _getInputVal: function() {\r\n        return _number.default.convertDigits(this._input().val(), true)\r\n    },\r\n    _keyboardHandler: function(e) {\r\n        this.clearCaretTimeout();\r\n        this._lastKey = _number.default.convertDigits((0, _index.getChar)(e), true);\r\n        this._lastKeyName = (0, _index.normalizeKeyName)(e);\r\n        if (!this._shouldHandleKey(e.originalEvent)) {\r\n            return this.callBase(e)\r\n        }\r\n        var normalizedText = this._getInputVal();\r\n        var caret = this._caret();\r\n        var enteredChar = this._lastKeyName === MINUS_KEY ? \"\" : this._lastKey;\r\n        var newValue = this._tryParse(normalizedText, caret, enteredChar);\r\n        if (this._shouldMoveCaret(normalizedText, caret)) {\r\n            this._moveCaret(1);\r\n            e.originalEvent.preventDefault()\r\n        }\r\n        if (void 0 === newValue) {\r\n            if (this._lastKeyName !== MINUS_KEY) {\r\n                e.originalEvent.preventDefault()\r\n            }\r\n        } else {\r\n            this._parsedValue = newValue\r\n        }\r\n        return this.callBase(e)\r\n    },\r\n    _keyPressHandler: function(e) {\r\n        if (!this._useMaskBehavior()) {\r\n            this.callBase(e)\r\n        }\r\n    },\r\n    _removeHandler: function(e) {\r\n        var caret = this._caret();\r\n        var text = this._getInputVal();\r\n        var start = caret.start;\r\n        var end = caret.end;\r\n        this._lastKey = (0, _index.getChar)(e);\r\n        this._lastKeyName = (0, _index.normalizeKeyName)(e);\r\n        var isDeleteKey = this._isDeleteKey(this._lastKeyName);\r\n        var isBackspaceKey = !isDeleteKey;\r\n        if (start === end) {\r\n            var caretPosition = start;\r\n            var canDelete = isBackspaceKey && caretPosition > 0 || isDeleteKey && caretPosition < text.length;\r\n            if (canDelete) {\r\n                isDeleteKey && end++;\r\n                isBackspaceKey && start--\r\n            } else {\r\n                e.preventDefault();\r\n                return\r\n            }\r\n        }\r\n        var char = text.slice(start, end);\r\n        if (this._isStub(char)) {\r\n            this._moveCaret(isDeleteKey ? 1 : -1);\r\n            if (this._parsedValue < 0 || 1 / this._parsedValue === -(1 / 0)) {\r\n                this._revertSign(e);\r\n                this._setTextByParsedValue()\r\n            }\r\n            e.preventDefault();\r\n            return\r\n        }\r\n        var decimalSeparator = _number.default.getDecimalSeparator();\r\n        if (char === decimalSeparator) {\r\n            var decimalSeparatorIndex = text.indexOf(decimalSeparator);\r\n            if (this._isNonStubAfter(decimalSeparatorIndex + 1)) {\r\n                this._moveCaret(isDeleteKey ? 1 : -1);\r\n                e.preventDefault()\r\n            }\r\n            return\r\n        }\r\n        if (end - start < text.length) {\r\n            var editedText = this._replaceSelectedText(text, {\r\n                start: start,\r\n                end: end\r\n            }, \"\");\r\n            var noDigits = editedText.search(/[0-9]/) < 0;\r\n            if (noDigits && this._isValueInRange(0)) {\r\n                this._parsedValue = this._parsedValue < 0 || 1 / this._parsedValue === -(1 / 0) ? -0 : 0;\r\n                return\r\n            }\r\n        }\r\n        var valueAfterRemoving = this._tryParse(text, {\r\n            start: start,\r\n            end: end\r\n        }, \"\");\r\n        if (void 0 === valueAfterRemoving) {\r\n            e.preventDefault()\r\n        } else {\r\n            this._parsedValue = valueAfterRemoving\r\n        }\r\n    },\r\n    _isPercentFormat: function() {\r\n        var format = this._getFormatPattern();\r\n        var noEscapedFormat = format.replace(/'[^']+'/g, \"\");\r\n        return noEscapedFormat.indexOf(\"%\") !== -1\r\n    },\r\n    _parse: function(text, format) {\r\n        var formatOption = this.option(\"format\");\r\n        var isCustomParser = (0, _type.isFunction)(formatOption.parser);\r\n        var parser = isCustomParser ? formatOption.parser : _number.default.parse;\r\n        var integerPartStartIndex = 0;\r\n        if (!isCustomParser) {\r\n            var formatPointIndex = (0, _utils.getRealSeparatorIndex)(format).index;\r\n            var textPointIndex = this._getTextSeparatorIndex(text);\r\n            var formatIntegerPartLength = formatPointIndex !== -1 ? formatPointIndex : format.length;\r\n            var textIntegerPartLength = textPointIndex !== -1 ? textPointIndex : text.length;\r\n            if (textIntegerPartLength > formatIntegerPartLength && format.indexOf(\"#\") === -1) {\r\n                integerPartStartIndex = textIntegerPartLength - formatIntegerPartLength\r\n            }\r\n        }\r\n        text = this._removeStubs(text, true);\r\n        text = text.substr(integerPartStartIndex);\r\n        return parser(text, format)\r\n    },\r\n    _format: function(value, format) {\r\n        var formatOption = this.option(\"format\");\r\n        var isCustomFormatter = (0, _type.isFunction)(null === formatOption || void 0 === formatOption ? void 0 : formatOption.formatter);\r\n        var formatter = isCustomFormatter ? formatOption.formatter : _number.default.format;\r\n        return formatter(value, format)\r\n    },\r\n    _getFormatPattern: function() {\r\n        if (!this._currentFormat) {\r\n            this._updateFormat()\r\n        }\r\n        return this._currentFormat\r\n    },\r\n    _updateFormat: function() {\r\n        var _this = this;\r\n        var format = this.option(\"format\");\r\n        var isCustomParser = (0, _type.isFunction)(null === format || void 0 === format ? void 0 : format.parser);\r\n        var isLDMLPattern = (0, _type.isString)(format) && (format.indexOf(\"0\") >= 0 || format.indexOf(\"#\") >= 0);\r\n        this._currentFormat = isCustomParser || isLDMLPattern ? format : (0, _number2.getFormat)(function(value) {\r\n            var text = _this._format(value, format);\r\n            return _number.default.convertDigits(text, true)\r\n        })\r\n    },\r\n    _getFormatForSign: function(text) {\r\n        var format = this._getFormatPattern();\r\n        if ((0, _type.isString)(format)) {\r\n            var signParts = format.split(\";\");\r\n            var sign = _number.default.getSign(text, format);\r\n            signParts[1] = signParts[1] || \"-\" + signParts[0];\r\n            return sign < 0 ? signParts[1] : signParts[0]\r\n        } else {\r\n            var _sign = _number.default.getSign(text);\r\n            return _sign < 0 ? \"-\" : \"\"\r\n        }\r\n    },\r\n    _removeStubs: function(text, excludeComma) {\r\n        var format = this._getFormatForSign(text);\r\n        var thousandsSeparator = _number.default.getThousandsSeparator();\r\n        var stubs = this._getStubs(format);\r\n        var result = text;\r\n        if (stubs.length) {\r\n            var prefixStubs = stubs[0];\r\n            var postfixRegex = new RegExp(\"(\" + (0, _common.escapeRegExp)(stubs[1] || \"\") + \")$\", \"g\");\r\n            var decoratorsRegex = new RegExp(\"[-\" + (0, _common.escapeRegExp)(excludeComma ? \"\" : thousandsSeparator) + \"]\", \"g\");\r\n            result = result.replace(prefixStubs, \"\").replace(postfixRegex, \"\").replace(decoratorsRegex, \"\")\r\n        }\r\n        return result\r\n    },\r\n    _getStubs: function(format) {\r\n        var regExpResult = /[^']([#0.,]+)/g.exec(format);\r\n        var pattern = regExpResult && regExpResult[0].trim();\r\n        return format.split(pattern).map(function(stub) {\r\n            return stub.replace(/'/g, \"\")\r\n        })\r\n    },\r\n    _truncateToPrecision: function(value, maxPrecision) {\r\n        if ((0, _type.isDefined)(value)) {\r\n            var strValue = value.toString();\r\n            var decimalSeparatorIndex = strValue.indexOf(\".\");\r\n            if (strValue && decimalSeparatorIndex > -1) {\r\n                var parsedValue = parseFloat(strValue.substr(0, decimalSeparatorIndex + maxPrecision + 1));\r\n                return isNaN(parsedValue) ? value : parsedValue\r\n            }\r\n        }\r\n        return value\r\n    },\r\n    _tryParse: function(text, selection, char) {\r\n        var editedText = this._replaceSelectedText(text, selection, char);\r\n        var format = this._getFormatPattern();\r\n        var isTextSelected = selection.start !== selection.end;\r\n        var parsedValue = this._getParsedValue(editedText, format);\r\n        var maxPrecision = !format.parser && this._getPrecisionLimits(editedText).max;\r\n        var isValueChanged = parsedValue !== this._parsedValue;\r\n        var decimalSeparator = _number.default.getDecimalSeparator();\r\n        var isDecimalPointRestricted = char === decimalSeparator && 0 === maxPrecision;\r\n        var isUselessCharRestricted = !isTextSelected && !isValueChanged && char !== MINUS && !this._isValueIncomplete(editedText) && this._isStub(char);\r\n        if (isDecimalPointRestricted || isUselessCharRestricted) {\r\n            return\r\n        }\r\n        if (\"\" === this._removeStubs(editedText)) {\r\n            parsedValue = Math.abs(0 * this._parsedValue)\r\n        }\r\n        if (isNaN(parsedValue)) {\r\n            return\r\n        }\r\n        var value = null === parsedValue ? this._parsedValue : parsedValue;\r\n        parsedValue = maxPrecision ? this._truncateToPrecision(value, maxPrecision) : parsedValue;\r\n        return !format.parser && this._isPercentFormat() ? parsedValue && parsedValue / 100 : parsedValue\r\n    },\r\n    _getParsedValue: function(text, format) {\r\n        var sign = _number.default.getSign(text, (null === format || void 0 === format ? void 0 : format.formatter) || format);\r\n        var parsedValue = this._parse(text, format);\r\n        var parsedValueSign = parsedValue < 0 ? -1 : 1;\r\n        var parsedValueWithSign = (0, _type.isNumeric)(parsedValue) && sign !== parsedValueSign ? sign * parsedValue : parsedValue;\r\n        return parsedValueWithSign\r\n    },\r\n    _isValueIncomplete: function(text) {\r\n        if (!this._useMaskBehavior()) {\r\n            return this.callBase(text)\r\n        }\r\n        var caret = this._caret();\r\n        var point = _number.default.getDecimalSeparator();\r\n        var pointIndex = this._getTextSeparatorIndex(text);\r\n        var isCaretOnFloat = pointIndex >= 0 && pointIndex < caret.start;\r\n        var textParts = this._removeStubs(text, true).split(point);\r\n        if (!isCaretOnFloat || 2 !== textParts.length) {\r\n            return false\r\n        }\r\n        var floatLength = textParts[1].length;\r\n        var format = this._getFormatPattern();\r\n        var isCustomParser = !!format.parser;\r\n        var precision = !isCustomParser && this._getPrecisionLimits(this._getFormatPattern(), text);\r\n        var isPrecisionInRange = isCustomParser ? true : (0, _math.inRange)(floatLength, precision.min, precision.max);\r\n        var endsWithZero = \"0\" === textParts[1].charAt(floatLength - 1);\r\n        return isPrecisionInRange && (endsWithZero || !floatLength)\r\n    },\r\n    _isValueInRange: function(value) {\r\n        var min = (0, _common.ensureDefined)(this.option(\"min\"), -(1 / 0));\r\n        var max = (0, _common.ensureDefined)(this.option(\"max\"), 1 / 0);\r\n        return (0, _math.inRange)(value, min, max)\r\n    },\r\n    _setInputText: function(text) {\r\n        var normalizedText = _number.default.convertDigits(text, true);\r\n        var newCaret = (0, _number_box.getCaretAfterFormat)(this._getInputVal(), normalizedText, this._caret(), this._getFormatPattern());\r\n        this._input().val(text);\r\n        this._toggleEmptinessEventHandler();\r\n        this._formattedValue = text;\r\n        if (!this._focusOutOccurs) {\r\n            this._caret(newCaret)\r\n        }\r\n    },\r\n    _useMaskBehavior: function() {\r\n        return !!this.option(\"format\") && this.option(\"useMaskBehavior\")\r\n    },\r\n    _renderInputType: function() {\r\n        var isNumberType = \"number\" === this.option(\"mode\");\r\n        var isDesktop = \"desktop\" === _devices.default.real().deviceType;\r\n        if (this._useMaskBehavior() && isNumberType) {\r\n            this._setInputType(isDesktop || this._isSupportInputMode() ? \"text\" : \"tel\")\r\n        } else {\r\n            this.callBase()\r\n        }\r\n    },\r\n    _isChar: function(str) {\r\n        return (0, _type.isString)(str) && 1 === str.length\r\n    },\r\n    _moveCaret: function(offset) {\r\n        if (!offset) {\r\n            return\r\n        }\r\n        var newCaret = (0, _number_box.getCaretWithOffset)(this._caret(), offset);\r\n        var adjustedCaret = (0, _number_box.getCaretInBoundaries)(newCaret, this._getInputVal(), this._getFormatPattern());\r\n        this._caret(adjustedCaret)\r\n    },\r\n    _shouldHandleKey: function(e) {\r\n        var keyName = (0, _index.normalizeKeyName)(e);\r\n        var isSpecialChar = e.ctrlKey || e.shiftKey || e.altKey || !this._isChar(keyName);\r\n        var isMinusKey = keyName === MINUS_KEY;\r\n        var useMaskBehavior = this._useMaskBehavior();\r\n        return useMaskBehavior && !isSpecialChar && !isMinusKey\r\n    },\r\n    _renderInput: function() {\r\n        this.callBase();\r\n        this._renderFormatter()\r\n    },\r\n    _renderFormatter: function() {\r\n        this._clearCache();\r\n        this._detachFormatterEvents();\r\n        if (this._useMaskBehavior()) {\r\n            this._attachFormatterEvents()\r\n        }\r\n    },\r\n    _detachFormatterEvents: function() {\r\n        _events_engine.default.off(this._input(), \".\" + NUMBER_FORMATTER_NAMESPACE)\r\n    },\r\n    _isInputFromPaste: function(e) {\r\n        var inputType = e.originalEvent && e.originalEvent.inputType;\r\n        if ((0, _type.isDefined)(inputType)) {\r\n            return \"insertFromPaste\" === inputType\r\n        } else {\r\n            return this._isValuePasted\r\n        }\r\n    },\r\n    _attachFormatterEvents: function() {\r\n        var $input = this._input();\r\n        _events_engine.default.on($input, (0, _index.addNamespace)(INPUT_EVENT, NUMBER_FORMATTER_NAMESPACE), function(e) {\r\n            this._formatValue(e);\r\n            this._isValuePasted = false\r\n        }.bind(this));\r\n        if (_browser.default.msie && _browser.default.version < 12) {\r\n            _events_engine.default.on($input, (0, _index.addNamespace)(\"paste\", NUMBER_FORMATTER_NAMESPACE), function() {\r\n                this._isValuePasted = true\r\n            }.bind(this))\r\n        }\r\n        _events_engine.default.on($input, (0, _index.addNamespace)(\"dxclick\", NUMBER_FORMATTER_NAMESPACE), function() {\r\n            if (!this._caretTimeout) {\r\n                this._caretTimeout = setTimeout(function() {\r\n                    this._caret((0, _number_box.getCaretInBoundaries)(this._caret(), this._getInputVal(), this._getFormatPattern()))\r\n                }.bind(this), CARET_TIMEOUT_DURATION)\r\n            }\r\n        }.bind(this));\r\n        _events_engine.default.on($input, \"dxdblclick\", function() {\r\n            this.clearCaretTimeout()\r\n        }.bind(this))\r\n    },\r\n    clearCaretTimeout: function() {\r\n        clearTimeout(this._caretTimeout);\r\n        this._caretTimeout = null\r\n    },\r\n    _forceRefreshInputValue: function() {\r\n        if (!this._useMaskBehavior()) {\r\n            return this.callBase()\r\n        }\r\n    },\r\n    _isNonStubAfter: function(index) {\r\n        var text = this._getInputVal().slice(index);\r\n        return text && !this._isStub(text, true)\r\n    },\r\n    _isStub: function(str, isString) {\r\n        var escapedDecimalSeparator = (0, _common.escapeRegExp)(_number.default.getDecimalSeparator());\r\n        var regExpString = \"^[^0-9\" + escapedDecimalSeparator + \"]+$\";\r\n        var stubRegExp = new RegExp(regExpString, \"g\");\r\n        return stubRegExp.test(str) && (isString || this._isChar(str))\r\n    },\r\n    _parseValue: function(text) {\r\n        if (!this._useMaskBehavior()) {\r\n            return this.callBase(text)\r\n        }\r\n        return this._parsedValue\r\n    },\r\n    _getPrecisionLimits: function(text) {\r\n        var currentFormat = this._getFormatForSign(text);\r\n        var realSeparatorIndex = (0, _utils.getRealSeparatorIndex)(currentFormat).index;\r\n        var floatPart = ((0, _utils.splitByIndex)(currentFormat, realSeparatorIndex)[1] || \"\").replace(/[^#0]/g, \"\");\r\n        var minPrecision = floatPart.replace(/^(0*)#*/, \"$1\").length;\r\n        var maxPrecision = floatPart.length;\r\n        return {\r\n            min: minPrecision,\r\n            max: maxPrecision\r\n        }\r\n    },\r\n    _revertSign: function(e) {\r\n        if (!this._useMaskBehavior()) {\r\n            return\r\n        }\r\n        var caret = this._caret();\r\n        if (caret.start !== caret.end) {\r\n            if ((0, _index.normalizeKeyName)(e) === MINUS_KEY) {\r\n                this._applyRevertedSign(e, caret, true);\r\n                return\r\n            } else {\r\n                this._caret((0, _number_box.getCaretInBoundaries)(0, this._getInputVal(), this._getFormatPattern()))\r\n            }\r\n        }\r\n        this._applyRevertedSign(e, caret)\r\n    },\r\n    _applyRevertedSign: function(e, caret, preserveSelectedText) {\r\n        var newValue = -1 * (0, _common.ensureDefined)(this._parsedValue, null);\r\n        if (this._isValueInRange(newValue)) {\r\n            this._parsedValue = newValue;\r\n            if (preserveSelectedText) {\r\n                var format = this._getFormatPattern();\r\n                var previousText = this._getInputVal();\r\n                this._setTextByParsedValue();\r\n                e.preventDefault();\r\n                var currentText = this._getInputVal();\r\n                var offset = (0, _number_box.getCaretOffset)(previousText, currentText, format);\r\n                caret = (0, _number_box.getCaretWithOffset)(caret, offset);\r\n                var caretInBoundaries = (0, _number_box.getCaretInBoundaries)(caret, currentText, format);\r\n                if (_browser.default.msie) {\r\n                    clearTimeout(this._caretTimeout);\r\n                    this._caretTimeout = setTimeout(this._caret.bind(this, caretInBoundaries))\r\n                } else {\r\n                    this._caret(caretInBoundaries)\r\n                }\r\n            }\r\n            if (e.key === NUMPUD_MINUS_KEY_IE) {\r\n                _events_engine.default.trigger(this._input(), INPUT_EVENT)\r\n            }\r\n        }\r\n    },\r\n    _removeMinusFromText: function(text, caret) {\r\n        var isMinusPressed = this._lastKeyName === MINUS_KEY && text.charAt(caret.start - 1) === MINUS;\r\n        return isMinusPressed ? this._replaceSelectedText(text, {\r\n            start: caret.start - 1,\r\n            end: caret.start\r\n        }, \"\") : text\r\n    },\r\n    _setTextByParsedValue: function() {\r\n        var format = this._getFormatPattern();\r\n        var parsed = this._parseValue();\r\n        var formatted = this._format(parsed, format) || \"\";\r\n        this._setInputText(formatted)\r\n    },\r\n    _formatValue: function(e) {\r\n        var normalizedText = this._getInputVal();\r\n        var caret = this._caret();\r\n        var textWithoutMinus = this._removeMinusFromText(normalizedText, caret);\r\n        var wasMinusRemoved = textWithoutMinus !== normalizedText;\r\n        normalizedText = textWithoutMinus;\r\n        if (!this._isInputFromPaste(e) && this._isValueIncomplete(textWithoutMinus)) {\r\n            this._formattedValue = normalizedText;\r\n            if (wasMinusRemoved) {\r\n                this._setTextByParsedValue()\r\n            }\r\n            return\r\n        }\r\n        var textWasChanged = _number.default.convertDigits(this._formattedValue, true) !== normalizedText;\r\n        if (textWasChanged) {\r\n            var value = this._tryParse(normalizedText, caret, \"\");\r\n            if ((0, _type.isDefined)(value)) {\r\n                this._parsedValue = value\r\n            }\r\n        }\r\n        this._setTextByParsedValue()\r\n    },\r\n    _renderDisplayText: function() {\r\n        if (this._useMaskBehavior()) {\r\n            this._toggleEmptinessEventHandler()\r\n        } else {\r\n            this.callBase.apply(this, arguments)\r\n        }\r\n    },\r\n    _renderValue: function() {\r\n        if (this._useMaskBehavior()) {\r\n            this._parsedValue = this.option(\"value\");\r\n            this._setTextByParsedValue()\r\n        }\r\n        return this.callBase()\r\n    },\r\n    _updateParsedValue: function() {\r\n        var inputValue = this._getInputVal();\r\n        this._parsedValue = this._tryParse(inputValue, this._caret())\r\n    },\r\n    _adjustParsedValue: function() {\r\n        if (!this._useMaskBehavior()) {\r\n            return\r\n        }\r\n        var clearedText = this._removeStubs(this._getInputVal());\r\n        var parsedValue = clearedText ? this._parseValue() : null;\r\n        if (!(0, _type.isNumeric)(parsedValue)) {\r\n            this._parsedValue = parsedValue;\r\n            return\r\n        }\r\n        this._parsedValue = (0, _math.fitIntoRange)(parsedValue, this.option(\"min\"), this.option(\"max\"))\r\n    },\r\n    _valueChangeEventHandler: function(e) {\r\n        if (!this._useMaskBehavior()) {\r\n            return this.callBase(e)\r\n        }\r\n        var caret = this._caret();\r\n        this._saveValueChangeEvent(e);\r\n        this._lastKey = null;\r\n        this._lastKeyName = null;\r\n        this._updateParsedValue();\r\n        this._adjustParsedValue();\r\n        this.option(\"value\", this._parsedValue);\r\n        if (caret) {\r\n            this._caret(caret)\r\n        }\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"format\":\r\n            case \"useMaskBehavior\":\r\n                this._renderInputType();\r\n                this._updateFormat();\r\n                this._renderFormatter();\r\n                this._renderValue();\r\n                this._refreshValueChangeEvent();\r\n                this._refreshEvents();\r\n                break;\r\n            case \"min\":\r\n            case \"max\":\r\n                this._adjustParsedValue();\r\n                this.callBase(args);\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    _clearCache: function() {\r\n        delete this._formattedValue;\r\n        delete this._lastKey;\r\n        delete this._lastKeyName;\r\n        delete this._parsedValue;\r\n        delete this._focusOutOccurs;\r\n        clearTimeout(this._caretTimeout);\r\n        delete this._caretTimeout\r\n    },\r\n    _clean: function() {\r\n        this._clearCache();\r\n        this.callBase()\r\n    }\r\n});\r\nvar _default = NumberBoxMask;\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}