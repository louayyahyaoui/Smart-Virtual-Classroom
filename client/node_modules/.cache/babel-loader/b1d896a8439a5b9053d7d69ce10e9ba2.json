{"ast":null,"code":"/**\r\n * DevExtreme (ui/list/ui.list.edit.strategy.grouped.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _store_helper = _interopRequireDefault(require(\"../../data/store_helper\"));\n\nvar _query = _interopRequireDefault(require(\"../../data/query\"));\n\nvar _uiCollection_widgetEditStrategy = _interopRequireDefault(require(\"../collection/ui.collection_widget.edit.strategy.plain\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar LIST_ITEM_CLASS = \"dx-list-item\";\nvar LIST_GROUP_CLASS = \"dx-list-group\";\nvar SELECTION_SHIFT = 20;\nvar SELECTION_MASK = 2303;\n\nvar combineIndex = function (indices) {\n  return (indices.group << SELECTION_SHIFT) + indices.item;\n};\n\nvar splitIndex = function (combinedIndex) {\n  return {\n    group: combinedIndex >> SELECTION_SHIFT,\n    item: combinedIndex & SELECTION_MASK\n  };\n};\n\nvar GroupedEditStrategy = _uiCollection_widgetEditStrategy.default.inherit({\n  _groupElements: function () {\n    return this._collectionWidget._itemContainer().find(\".\" + LIST_GROUP_CLASS);\n  },\n  _groupItemElements: function ($group) {\n    return $group.find(\".\" + LIST_ITEM_CLASS);\n  },\n  getIndexByItemData: function (itemData) {\n    var groups = this._collectionWidget.option(\"items\");\n\n    var index = false;\n\n    if (!itemData) {\n      return false;\n    }\n\n    if (itemData.items && itemData.items.length) {\n      itemData = itemData.items[0];\n    }\n\n    (0, _iterator.each)(groups, function (groupIndex, group) {\n      if (!group.items) {\n        return false;\n      }\n\n      (0, _iterator.each)(group.items, function (itemIndex, item) {\n        if (item !== itemData) {\n          return true;\n        }\n\n        index = {\n          group: groupIndex,\n          item: itemIndex\n        };\n        return false;\n      });\n\n      if (index) {\n        return false;\n      }\n    });\n    return index;\n  },\n  getItemDataByIndex: function (index) {\n    var items = this._collectionWidget.option(\"items\");\n\n    if ((0, _type.isNumeric)(index)) {\n      return this.itemsGetter()[index];\n    }\n\n    return index && items[index.group] && items[index.group].items[index.item] || null;\n  },\n  itemsGetter: function () {\n    var resultItems = [];\n\n    var items = this._collectionWidget.option(\"items\");\n\n    for (var i = 0; i < items.length; i++) {\n      if (items[i] && items[i].items) {\n        resultItems = resultItems.concat(items[i].items);\n      } else {\n        resultItems.push(items[i]);\n      }\n    }\n\n    return resultItems;\n  },\n  deleteItemAtIndex: function (index) {\n    var indices = splitIndex(index);\n\n    var itemGroup = this._collectionWidget.option(\"items\")[indices.group].items;\n\n    itemGroup.splice(indices.item, 1);\n  },\n  getKeysByItems: function (items) {\n    var plainItems = [];\n    var i;\n\n    for (i = 0; i < items.length; i++) {\n      if (items[i] && items[i].items) {\n        plainItems = plainItems.concat(items[i].items);\n      } else {\n        plainItems.push(items[i]);\n      }\n    }\n\n    var result = [];\n\n    for (i = 0; i < plainItems.length; i++) {\n      result.push(this._collectionWidget.keyOf(plainItems[i]));\n    }\n\n    return result;\n  },\n  getIndexByKey: function (key, items) {\n    var groups = items || this._collectionWidget.option(\"items\");\n\n    var index = -1;\n    var that = this;\n    (0, _iterator.each)(groups, function (groupIndex, group) {\n      if (!group.items) {\n        return;\n      }\n\n      var keys = that.getKeysByItems(group.items);\n      (0, _iterator.each)(keys, function (keyIndex, itemKey) {\n        if (that._equalKeys(itemKey, key)) {\n          index = {\n            group: groupIndex,\n            item: keyIndex\n          };\n          return false;\n        }\n      });\n\n      if (index !== -1) {\n        return false;\n      }\n    });\n    return index;\n  },\n  _getGroups: function (items) {\n    var dataSource = this._collectionWidget.getDataSource();\n\n    var group = dataSource && dataSource.group();\n\n    if (group) {\n      return _store_helper.default.queryByOptions((0, _query.default)(items), {\n        group: group\n      }).toArray();\n    }\n\n    return this._collectionWidget.option(\"items\");\n  },\n  getItemsByKeys: function (keys, items) {\n    var result = [];\n    (0, _iterator.each)(keys, function (_, key) {\n      var getItemMeta = function (groups) {\n        var index = this.getIndexByKey(key, groups);\n        var group = index && groups[index.group];\n\n        if (!group) {\n          return;\n        }\n\n        return {\n          groupKey: group.key,\n          item: group.items[index.item]\n        };\n      }.bind(this);\n\n      var itemMeta = getItemMeta(this._getGroups(items));\n\n      if (!itemMeta) {\n        return;\n      }\n\n      var groupKey = itemMeta.groupKey;\n      var item = itemMeta.item;\n      var selectedGroup;\n      (0, _iterator.each)(result, function (_, item) {\n        if (item.key === groupKey) {\n          selectedGroup = item;\n          return false;\n        }\n      });\n\n      if (!selectedGroup) {\n        selectedGroup = {\n          key: groupKey,\n          items: []\n        };\n        result.push(selectedGroup);\n      }\n\n      selectedGroup.items.push(item);\n    }.bind(this));\n    return result;\n  },\n  moveItemAtIndexToIndex: function (movingIndex, destinationIndex) {\n    var items = this._collectionWidget.option(\"items\");\n\n    var movingIndices = splitIndex(movingIndex);\n    var destinationIndices = splitIndex(destinationIndex);\n    var movingItemGroup = items[movingIndices.group].items;\n    var destinationItemGroup = items[destinationIndices.group].items;\n    var movedItemData = movingItemGroup[movingIndices.item];\n    movingItemGroup.splice(movingIndices.item, 1);\n    destinationItemGroup.splice(destinationIndices.item, 0, movedItemData);\n  },\n  _isItemIndex: function (index) {\n    return index && (0, _type.isNumeric)(index.group) && (0, _type.isNumeric)(index.item);\n  },\n  _getNormalizedItemIndex: function (itemElement) {\n    var $item = (0, _renderer.default)(itemElement);\n    var $group = $item.closest(\".\" + LIST_GROUP_CLASS);\n\n    if (!$group.length) {\n      return -1;\n    }\n\n    return combineIndex({\n      group: this._groupElements().index($group),\n      item: this._groupItemElements($group).index($item)\n    });\n  },\n  _normalizeItemIndex: function (index) {\n    return combineIndex(index);\n  },\n  _denormalizeItemIndex: function (index) {\n    return splitIndex(index);\n  },\n  _getItemByNormalizedIndex: function (index) {\n    var indices = splitIndex(index);\n\n    var $group = this._groupElements().eq(indices.group);\n\n    return this._groupItemElements($group).eq(indices.item);\n  },\n  _itemsFromSameParent: function (firstIndex, secondIndex) {\n    return splitIndex(firstIndex).group === splitIndex(secondIndex).group;\n  }\n});\n\nvar _default = GroupedEditStrategy;\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["C:/Smart-Virtual-Classroom/client/node_modules/devextreme/ui/list/ui.list.edit.strategy.grouped.js"],"names":["exports","default","_renderer","_interopRequireDefault","require","_type","_iterator","_store_helper","_query","_uiCollection_widgetEditStrategy","obj","__esModule","LIST_ITEM_CLASS","LIST_GROUP_CLASS","SELECTION_SHIFT","SELECTION_MASK","combineIndex","indices","group","item","splitIndex","combinedIndex","GroupedEditStrategy","inherit","_groupElements","_collectionWidget","_itemContainer","find","_groupItemElements","$group","getIndexByItemData","itemData","groups","option","index","items","length","each","groupIndex","itemIndex","getItemDataByIndex","isNumeric","itemsGetter","resultItems","i","concat","push","deleteItemAtIndex","itemGroup","splice","getKeysByItems","plainItems","result","keyOf","getIndexByKey","key","that","keys","keyIndex","itemKey","_equalKeys","_getGroups","dataSource","getDataSource","queryByOptions","toArray","getItemsByKeys","_","getItemMeta","groupKey","bind","itemMeta","selectedGroup","moveItemAtIndexToIndex","movingIndex","destinationIndex","movingIndices","destinationIndices","movingItemGroup","destinationItemGroup","movedItemData","_isItemIndex","_getNormalizedItemIndex","itemElement","$item","closest","_normalizeItemIndex","_denormalizeItemIndex","_getItemByNormalizedIndex","eq","_itemsFromSameParent","firstIndex","secondIndex","_default","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/list/ui.list.edit.strategy.grouped.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _store_helper = _interopRequireDefault(require(\"../../data/store_helper\"));\r\nvar _query = _interopRequireDefault(require(\"../../data/query\"));\r\nvar _uiCollection_widgetEditStrategy = _interopRequireDefault(require(\"../collection/ui.collection_widget.edit.strategy.plain\"));\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar LIST_ITEM_CLASS = \"dx-list-item\";\r\nvar LIST_GROUP_CLASS = \"dx-list-group\";\r\nvar SELECTION_SHIFT = 20;\r\nvar SELECTION_MASK = 2303;\r\nvar combineIndex = function(indices) {\r\n    return (indices.group << SELECTION_SHIFT) + indices.item\r\n};\r\nvar splitIndex = function(combinedIndex) {\r\n    return {\r\n        group: combinedIndex >> SELECTION_SHIFT,\r\n        item: combinedIndex & SELECTION_MASK\r\n    }\r\n};\r\nvar GroupedEditStrategy = _uiCollection_widgetEditStrategy.default.inherit({\r\n    _groupElements: function() {\r\n        return this._collectionWidget._itemContainer().find(\".\" + LIST_GROUP_CLASS)\r\n    },\r\n    _groupItemElements: function($group) {\r\n        return $group.find(\".\" + LIST_ITEM_CLASS)\r\n    },\r\n    getIndexByItemData: function(itemData) {\r\n        var groups = this._collectionWidget.option(\"items\");\r\n        var index = false;\r\n        if (!itemData) {\r\n            return false\r\n        }\r\n        if (itemData.items && itemData.items.length) {\r\n            itemData = itemData.items[0]\r\n        }(0, _iterator.each)(groups, function(groupIndex, group) {\r\n            if (!group.items) {\r\n                return false\r\n            }(0, _iterator.each)(group.items, function(itemIndex, item) {\r\n                if (item !== itemData) {\r\n                    return true\r\n                }\r\n                index = {\r\n                    group: groupIndex,\r\n                    item: itemIndex\r\n                };\r\n                return false\r\n            });\r\n            if (index) {\r\n                return false\r\n            }\r\n        });\r\n        return index\r\n    },\r\n    getItemDataByIndex: function(index) {\r\n        var items = this._collectionWidget.option(\"items\");\r\n        if ((0, _type.isNumeric)(index)) {\r\n            return this.itemsGetter()[index]\r\n        }\r\n        return index && items[index.group] && items[index.group].items[index.item] || null\r\n    },\r\n    itemsGetter: function() {\r\n        var resultItems = [];\r\n        var items = this._collectionWidget.option(\"items\");\r\n        for (var i = 0; i < items.length; i++) {\r\n            if (items[i] && items[i].items) {\r\n                resultItems = resultItems.concat(items[i].items)\r\n            } else {\r\n                resultItems.push(items[i])\r\n            }\r\n        }\r\n        return resultItems\r\n    },\r\n    deleteItemAtIndex: function(index) {\r\n        var indices = splitIndex(index);\r\n        var itemGroup = this._collectionWidget.option(\"items\")[indices.group].items;\r\n        itemGroup.splice(indices.item, 1)\r\n    },\r\n    getKeysByItems: function(items) {\r\n        var plainItems = [];\r\n        var i;\r\n        for (i = 0; i < items.length; i++) {\r\n            if (items[i] && items[i].items) {\r\n                plainItems = plainItems.concat(items[i].items)\r\n            } else {\r\n                plainItems.push(items[i])\r\n            }\r\n        }\r\n        var result = [];\r\n        for (i = 0; i < plainItems.length; i++) {\r\n            result.push(this._collectionWidget.keyOf(plainItems[i]))\r\n        }\r\n        return result\r\n    },\r\n    getIndexByKey: function(key, items) {\r\n        var groups = items || this._collectionWidget.option(\"items\");\r\n        var index = -1;\r\n        var that = this;\r\n        (0, _iterator.each)(groups, function(groupIndex, group) {\r\n            if (!group.items) {\r\n                return\r\n            }\r\n            var keys = that.getKeysByItems(group.items);\r\n            (0, _iterator.each)(keys, function(keyIndex, itemKey) {\r\n                if (that._equalKeys(itemKey, key)) {\r\n                    index = {\r\n                        group: groupIndex,\r\n                        item: keyIndex\r\n                    };\r\n                    return false\r\n                }\r\n            });\r\n            if (index !== -1) {\r\n                return false\r\n            }\r\n        });\r\n        return index\r\n    },\r\n    _getGroups: function(items) {\r\n        var dataSource = this._collectionWidget.getDataSource();\r\n        var group = dataSource && dataSource.group();\r\n        if (group) {\r\n            return _store_helper.default.queryByOptions((0, _query.default)(items), {\r\n                group: group\r\n            }).toArray()\r\n        }\r\n        return this._collectionWidget.option(\"items\")\r\n    },\r\n    getItemsByKeys: function(keys, items) {\r\n        var result = [];\r\n        (0, _iterator.each)(keys, function(_, key) {\r\n            var getItemMeta = function(groups) {\r\n                var index = this.getIndexByKey(key, groups);\r\n                var group = index && groups[index.group];\r\n                if (!group) {\r\n                    return\r\n                }\r\n                return {\r\n                    groupKey: group.key,\r\n                    item: group.items[index.item]\r\n                }\r\n            }.bind(this);\r\n            var itemMeta = getItemMeta(this._getGroups(items));\r\n            if (!itemMeta) {\r\n                return\r\n            }\r\n            var groupKey = itemMeta.groupKey;\r\n            var item = itemMeta.item;\r\n            var selectedGroup;\r\n            (0, _iterator.each)(result, function(_, item) {\r\n                if (item.key === groupKey) {\r\n                    selectedGroup = item;\r\n                    return false\r\n                }\r\n            });\r\n            if (!selectedGroup) {\r\n                selectedGroup = {\r\n                    key: groupKey,\r\n                    items: []\r\n                };\r\n                result.push(selectedGroup)\r\n            }\r\n            selectedGroup.items.push(item)\r\n        }.bind(this));\r\n        return result\r\n    },\r\n    moveItemAtIndexToIndex: function(movingIndex, destinationIndex) {\r\n        var items = this._collectionWidget.option(\"items\");\r\n        var movingIndices = splitIndex(movingIndex);\r\n        var destinationIndices = splitIndex(destinationIndex);\r\n        var movingItemGroup = items[movingIndices.group].items;\r\n        var destinationItemGroup = items[destinationIndices.group].items;\r\n        var movedItemData = movingItemGroup[movingIndices.item];\r\n        movingItemGroup.splice(movingIndices.item, 1);\r\n        destinationItemGroup.splice(destinationIndices.item, 0, movedItemData)\r\n    },\r\n    _isItemIndex: function(index) {\r\n        return index && (0, _type.isNumeric)(index.group) && (0, _type.isNumeric)(index.item)\r\n    },\r\n    _getNormalizedItemIndex: function(itemElement) {\r\n        var $item = (0, _renderer.default)(itemElement);\r\n        var $group = $item.closest(\".\" + LIST_GROUP_CLASS);\r\n        if (!$group.length) {\r\n            return -1\r\n        }\r\n        return combineIndex({\r\n            group: this._groupElements().index($group),\r\n            item: this._groupItemElements($group).index($item)\r\n        })\r\n    },\r\n    _normalizeItemIndex: function(index) {\r\n        return combineIndex(index)\r\n    },\r\n    _denormalizeItemIndex: function(index) {\r\n        return splitIndex(index)\r\n    },\r\n    _getItemByNormalizedIndex: function(index) {\r\n        var indices = splitIndex(index);\r\n        var $group = this._groupElements().eq(indices.group);\r\n        return this._groupItemElements($group).eq(indices.item)\r\n    },\r\n    _itemsFromSameParent: function(firstIndex, secondIndex) {\r\n        return splitIndex(firstIndex).group === splitIndex(secondIndex).group\r\n    }\r\n});\r\nvar _default = GroupedEditStrategy;\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}