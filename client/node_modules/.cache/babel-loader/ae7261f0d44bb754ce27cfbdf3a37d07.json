{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/ui.scheduler.appointments.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\n\nvar _dom_adapter = _interopRequireDefault(require(\"../../core/dom_adapter\"));\n\nvar _events_engine = _interopRequireDefault(require(\"../../events/core/events_engine\"));\n\nvar _element_data = require(\"../../core/element_data\");\n\nvar _translator = require(\"../../animation/translator\");\n\nvar _date = _interopRequireDefault(require(\"../../core/utils/date\"));\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _object = require(\"../../core/utils/object\");\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _element = require(\"../../core/element\");\n\nvar _recurrence = require(\"./recurrence\");\n\nvar _component_registrator = _interopRequireDefault(require(\"../../core/component_registrator\"));\n\nvar _uiScheduler = _interopRequireDefault(require(\"./ui.scheduler.publisher_mixin\"));\n\nvar _uiScheduler2 = _interopRequireDefault(require(\"./ui.scheduler.appointment\"));\n\nvar _index = require(\"../../events/utils/index\");\n\nvar _double_click = require(\"../../events/double_click\");\n\nvar _message = _interopRequireDefault(require(\"../../localization/message\"));\n\nvar _uiCollection_widget = _interopRequireDefault(require(\"../collection/ui.collection_widget.edit\"));\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _utilsTimeZone = _interopRequireDefault(require(\"./utils.timeZone.js\"));\n\nvar _constants = require(\"./constants\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar COMPONENT_CLASS = \"dx-scheduler-scrollable-appointments\";\nvar APPOINTMENT_ITEM_CLASS = \"dx-scheduler-appointment\";\nvar APPOINTMENT_TITLE_CLASS = \"dx-scheduler-appointment-title\";\nvar APPOINTMENT_CONTENT_DETAILS_CLASS = \"dx-scheduler-appointment-content-details\";\nvar APPOINTMENT_DATE_CLASS = \"dx-scheduler-appointment-content-date\";\nvar RECURRING_ICON_CLASS = \"dx-scheduler-appointment-recurrence-icon\";\nvar ALL_DAY_CONTENT_CLASS = \"dx-scheduler-appointment-content-allday\";\nvar DBLCLICK_EVENT_NAME = (0, _index.addNamespace)(_double_click.name, \"dxSchedulerAppointment\");\nvar toMs = _date.default.dateToMilliseconds;\n\nvar SchedulerAppointments = _uiCollection_widget.default.inherit({\n  ctor: function (element, options) {\n    this.callBase(element, options);\n  },\n  _supportedKeys: function () {\n    var parent = this.callBase();\n\n    var tabHandler = function (e) {\n      var appointments = this._getAccessAppointments();\n\n      var focusedAppointment = appointments.filter(\".dx-state-focused\");\n      var index = focusedAppointment.data(_constants.APPOINTMENT_SETTINGS_KEY).sortedIndex;\n      var lastIndex = appointments.length - 1;\n\n      if (index > 0 && e.shiftKey || index < lastIndex && !e.shiftKey) {\n        e.preventDefault();\n        e.shiftKey ? index-- : index++;\n\n        var $nextAppointment = this._getAppointmentByIndex(index);\n\n        this._resetTabIndex($nextAppointment);\n\n        _events_engine.default.trigger($nextAppointment, \"focus\");\n      }\n    };\n\n    return (0, _extend.extend)(parent, {\n      escape: function () {\n        this.moveAppointmentBack();\n        this._escPressed = true;\n      }.bind(this),\n      del: function (e) {\n        if (this.option(\"allowDelete\")) {\n          e.preventDefault();\n\n          var data = this._getItemData(e.target);\n\n          this.notifyObserver(\"onDeleteButtonPress\", {\n            data: data,\n            target: e.target\n          });\n        }\n      }.bind(this),\n      tab: tabHandler\n    });\n  },\n  _getAppointmentByIndex: function (sortedIndex) {\n    var appointments = this._getAccessAppointments();\n\n    return appointments.filter(function (_, $item) {\n      return (0, _element_data.data)($item, _constants.APPOINTMENT_SETTINGS_KEY).sortedIndex === sortedIndex;\n    }).eq(0);\n  },\n  _getAccessAppointments: function () {\n    return this._itemElements().filter(\":visible\").not(\".dx-state-disabled\");\n  },\n  _resetTabIndex: function ($appointment) {\n    this._focusTarget().attr(\"tabIndex\", -1);\n\n    $appointment.attr(\"tabIndex\", this.option(\"tabIndex\"));\n  },\n  _moveFocus: _common.noop,\n  _focusTarget: function () {\n    return this._itemElements();\n  },\n  _renderFocusTarget: function () {\n    var $appointment = this._getAppointmentByIndex(0);\n\n    this._resetTabIndex($appointment);\n  },\n  _focusInHandler: function (e) {\n    this.callBase.apply(this, arguments);\n    this._$currentAppointment = (0, _renderer.default)(e.target);\n    this.option(\"focusedElement\", (0, _element.getPublicElement)((0, _renderer.default)(e.target)));\n  },\n  _focusOutHandler: function () {\n    var $appointment = this._getAppointmentByIndex(0);\n\n    this.option(\"focusedElement\", (0, _element.getPublicElement)($appointment));\n    this.callBase.apply(this, arguments);\n  },\n  _eventBindingTarget: function () {\n    return this._itemContainer();\n  },\n  _getDefaultOptions: function () {\n    return (0, _extend.extend)(this.callBase(), {\n      noDataText: null,\n      activeStateEnabled: true,\n      hoverStateEnabled: true,\n      tabIndex: 0,\n      fixedContainer: null,\n      allDayContainer: null,\n      allowDrag: true,\n      allowResize: true,\n      allowAllDayResize: true,\n      onAppointmentDblClick: null,\n      _collectorOffset: 0\n    });\n  },\n  _optionChanged: function (args) {\n    switch (args.name) {\n      case \"items\":\n        this._cleanFocusState();\n\n        this._clearDropDownItems();\n\n        this._clearDropDownItemsElements();\n\n        this._repaintAppointments(args.value);\n\n        this._renderDropDownAppointments();\n\n        this._attachAppointmentsEvents();\n\n        break;\n\n      case \"fixedContainer\":\n      case \"allDayContainer\":\n      case \"onAppointmentDblClick\":\n        break;\n\n      case \"allowDrag\":\n      case \"allowResize\":\n      case \"allowAllDayResize\":\n        this._invalidate();\n\n        break;\n\n      case \"focusedElement\":\n        this._resetTabIndex((0, _renderer.default)(args.value));\n\n        this.callBase(args);\n        break;\n\n      case \"allowDelete\":\n        break;\n\n      case \"focusStateEnabled\":\n        this._clearDropDownItemsElements();\n\n        this._renderDropDownAppointments();\n\n        this.callBase(args);\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _isAllDayAppointment: function (appointment) {\n    return appointment.settings.length && appointment.settings[0].allDay || false;\n  },\n  _isRepaintAppointment: function (appointment) {\n    return !(0, _type.isDefined)(appointment.needRepaint) || true === appointment.needRepaint;\n  },\n  _isRepaintAll: function (appointments) {\n    if (this.invoke(\"isVirtualScrolling\")) {\n      return true;\n    }\n\n    if (this.invoke(\"isCurrentViewAgenda\")) {\n      return true;\n    }\n\n    for (var i = 0; i < appointments.length; i++) {\n      var appointment = appointments[i];\n\n      if (!this._isRepaintAppointment(appointment)) {\n        return false;\n      }\n    }\n\n    return true;\n  },\n  _applyFragment: function (fragment, allDay) {\n    if (fragment.children().length > 0) {\n      this._getAppointmentContainer(allDay).append(fragment);\n    }\n  },\n  _onEachAppointment: function (appointment, index, container, isRepaintAll) {\n    var _this = this;\n\n    var repaintAppointment = function () {\n      appointment.needRepaint = false;\n\n      _this._clearItem(appointment);\n\n      _this._renderItem(index, appointment, container);\n    };\n\n    if (true === (null === appointment || void 0 === appointment ? void 0 : appointment.needRemove)) {\n      this._clearItem(appointment);\n    } else {\n      if (isRepaintAll || this._isRepaintAppointment(appointment)) {\n        repaintAppointment();\n      }\n    }\n  },\n  _repaintAppointments: function (appointments) {\n    var _this2 = this;\n\n    this._renderByFragments(function ($commonFragment, $allDayFragment) {\n      var isRepaintAll = _this2._isRepaintAll(appointments);\n\n      if (isRepaintAll) {\n        _this2._getAppointmentContainer(true).html(\"\");\n\n        _this2._getAppointmentContainer(false).html(\"\");\n      }\n\n      !appointments.length && _this2._cleanItemContainer();\n      appointments.forEach(function (appointment, index) {\n        var container = _this2._isAllDayAppointment(appointment) ? $allDayFragment : $commonFragment;\n\n        _this2._onEachAppointment(appointment, index, container, isRepaintAll);\n      });\n    });\n  },\n  _renderByFragments: function (renderFunction) {\n    var isVirtualScrolling = this.invoke(\"isVirtualScrolling\");\n\n    if (isVirtualScrolling) {\n      var $commonFragment = (0, _renderer.default)(_dom_adapter.default.createDocumentFragment());\n      var $allDayFragment = (0, _renderer.default)(_dom_adapter.default.createDocumentFragment());\n      renderFunction($commonFragment, $allDayFragment);\n\n      this._applyFragment($commonFragment, false);\n\n      this._applyFragment($allDayFragment, true);\n    } else {\n      renderFunction(this._getAppointmentContainer(false), this._getAppointmentContainer(true));\n    }\n  },\n  _attachAppointmentsEvents: function () {\n    this._attachClickEvent();\n\n    this._attachHoldEvent();\n\n    this._attachContextMenuEvent();\n\n    this._attachAppointmentDblClick();\n\n    this._renderFocusState();\n\n    this._attachFeedbackEvents();\n\n    this._attachHoverEvents();\n  },\n  _clearItem: function (item) {\n    var $items = this._findItemElementByItem(item.itemData);\n\n    if (!$items.length) {\n      return;\n    }\n\n    (0, _iterator.each)($items, function (_, $item) {\n      $item.detach();\n      $item.remove();\n    });\n  },\n  _clearDropDownItems: function () {\n    this._virtualAppointments = {};\n  },\n  _clearDropDownItemsElements: function () {\n    this.invoke(\"clearCompactAppointments\");\n  },\n  _findItemElementByItem: function (item) {\n    var result = [];\n    var that = this;\n    this.itemElements().each(function () {\n      var $item = (0, _renderer.default)(this);\n\n      if ($item.data(that._itemDataKey()) === item) {\n        result.push($item);\n      }\n    });\n    return result;\n  },\n  _itemClass: function () {\n    return APPOINTMENT_ITEM_CLASS;\n  },\n  _itemContainer: function () {\n    var $container = this.callBase();\n    var $result = $container;\n    var $allDayContainer = this.option(\"allDayContainer\");\n\n    if ($allDayContainer) {\n      $result = $container.add($allDayContainer);\n    }\n\n    return $result;\n  },\n  _cleanItemContainer: function () {\n    this.callBase();\n    var $allDayContainer = this.option(\"allDayContainer\");\n\n    if ($allDayContainer) {\n      $allDayContainer.empty();\n    }\n\n    this._virtualAppointments = {};\n  },\n  _clean: function () {\n    this.callBase();\n    delete this._$currentAppointment;\n    delete this._initialSize;\n    delete this._initialCoordinates;\n  },\n  _init: function () {\n    this.callBase();\n    this.$element().addClass(COMPONENT_CLASS);\n    this._preventSingleAppointmentClick = false;\n  },\n  _renderAppointmentTemplate: function ($container, data, model) {\n    var formatText = this.invoke(\"getTextAndFormatDate\", model.appointmentData, this._currentAppointmentSettings.agendaSettings || model.targetedAppointmentData, \"TIME\");\n    (0, _renderer.default)(\"<div>\").text(formatText.text).addClass(APPOINTMENT_TITLE_CLASS).appendTo($container);\n\n    if ((0, _type.isPlainObject)(data)) {\n      if (data.html) {\n        $container.html(data.html);\n      }\n    }\n\n    var $contentDetails = (0, _renderer.default)(\"<div>\").addClass(APPOINTMENT_CONTENT_DETAILS_CLASS);\n    (0, _renderer.default)(\"<div>\").addClass(APPOINTMENT_DATE_CLASS).text(formatText.formatDate).appendTo($contentDetails);\n    $contentDetails.appendTo($container);\n\n    if (data.recurrenceRule) {\n      (0, _renderer.default)(\"<span>\").addClass(RECURRING_ICON_CLASS + \" dx-icon-repeat\").appendTo($container);\n    }\n\n    if (data.allDay) {\n      (0, _renderer.default)(\"<div>\").text(\" \" + _message.default.format(\"dxScheduler-allDay\") + \": \").addClass(ALL_DAY_CONTENT_CLASS).prependTo($contentDetails);\n    }\n  },\n  _executeItemRenderAction: function (index, itemData, itemElement) {\n    var action = this._getItemRenderAction();\n\n    if (action) {\n      action(this.invoke(\"mapAppointmentFields\", {\n        itemData: itemData,\n        itemElement: itemElement\n      }));\n    }\n\n    delete this._currentAppointmentSettings;\n  },\n  _itemClickHandler: function (e) {\n    this.callBase(e, {}, {\n      afterExecute: function (e) {\n        this._processItemClick(e.args[0].event);\n      }.bind(this)\n    });\n  },\n  _processItemClick: function (e) {\n    var $target = (0, _renderer.default)(e.currentTarget);\n\n    var data = this._getItemData($target);\n\n    if (\"keydown\" === e.type || (0, _index.isFakeClickEvent)(e)) {\n      this.notifyObserver(\"showEditAppointmentPopup\", {\n        data: data,\n        target: $target\n      });\n      return;\n    }\n\n    this._appointmentClickTimeout = setTimeout(function () {\n      if (!this._preventSingleAppointmentClick && _dom_adapter.default.getBody().contains($target[0])) {\n        this.notifyObserver(\"showAppointmentTooltip\", {\n          data: data,\n          target: $target\n        });\n      }\n\n      this._preventSingleAppointmentClick = false;\n    }.bind(this), 300);\n  },\n  _extendActionArgs: function () {\n    var args = this.callBase.apply(this, arguments);\n    return this.invoke(\"mapAppointmentFields\", args);\n  },\n  _render: function () {\n    this.callBase.apply(this, arguments);\n\n    this._attachAppointmentDblClick();\n  },\n  _attachAppointmentDblClick: function () {\n    var that = this;\n\n    var itemSelector = that._itemSelector();\n\n    var itemContainer = this._itemContainer();\n\n    _events_engine.default.off(itemContainer, DBLCLICK_EVENT_NAME, itemSelector);\n\n    _events_engine.default.on(itemContainer, DBLCLICK_EVENT_NAME, itemSelector, function (e) {\n      that._itemDXEventHandler(e, \"onAppointmentDblClick\", {}, {\n        afterExecute: function (e) {\n          that._dblClickHandler(e.args[0].event);\n        }\n      });\n    });\n  },\n  _dblClickHandler: function (e) {\n    var $targetAppointment = (0, _renderer.default)(e.currentTarget);\n\n    var appointmentData = this._getItemData($targetAppointment);\n\n    clearTimeout(this._appointmentClickTimeout);\n    this._preventSingleAppointmentClick = true;\n    this.notifyObserver(\"showEditAppointmentPopup\", {\n      data: appointmentData,\n      target: $targetAppointment\n    });\n  },\n  _renderItem: function (index, item, container) {\n    var itemData = item.itemData;\n    var $items = [];\n\n    for (var i = 0; i < item.settings.length; i++) {\n      var setting = item.settings[i];\n      this._currentAppointmentSettings = setting;\n      var $item = this.callBase(index, itemData, container);\n      $item.data(_constants.APPOINTMENT_SETTINGS_KEY, setting);\n      $items.push($item);\n    }\n\n    return $items;\n  },\n  _getItemContent: function ($itemFrame) {\n    $itemFrame.data(_constants.APPOINTMENT_SETTINGS_KEY, this._currentAppointmentSettings);\n    var $itemContent = this.callBase($itemFrame);\n    return $itemContent;\n  },\n  _createItemByTemplate: function (itemTemplate, renderArgs) {\n    var itemData = renderArgs.itemData,\n        container = renderArgs.container,\n        index = renderArgs.index;\n    return itemTemplate.render({\n      model: {\n        appointmentData: itemData,\n        targetedAppointmentData: this.invoke(\"getTargetedAppointmentData\", itemData, (0, _renderer.default)(container).parent())\n      },\n      container: container,\n      index: index\n    });\n  },\n  _getAppointmentContainer: function (allDay) {\n    var $allDayContainer = this.option(\"allDayContainer\");\n    var $container = this.itemsContainer().not($allDayContainer);\n\n    if (allDay && $allDayContainer) {\n      $container = $allDayContainer;\n    }\n\n    return $container;\n  },\n  _postprocessRenderItem: function (args) {\n    this._renderAppointment(args.itemElement, this._currentAppointmentSettings);\n  },\n  _renderAppointment: function ($appointment, settings) {\n    $appointment.data(_constants.APPOINTMENT_SETTINGS_KEY, settings);\n\n    this._applyResourceDataAttr($appointment);\n\n    var data = this._getItemData($appointment);\n\n    var geometry = this.invoke(\"getAppointmentGeometry\", settings);\n    var allowResize = this.option(\"allowResize\") && (!(0, _type.isDefined)(settings.skipResizing) || (0, _type.isString)(settings.skipResizing));\n    var allowDrag = this.option(\"allowDrag\");\n    var allDay = settings.allDay;\n    this.invoke(\"setCellDataCacheAlias\", this._currentAppointmentSettings, geometry);\n\n    var deferredColor = this._getAppointmentColor($appointment, settings.groupIndex);\n\n    if (settings.virtual) {\n      this._processVirtualAppointment(settings, $appointment, data, deferredColor);\n    } else {\n      var info = settings.info;\n\n      this._createComponent($appointment, _uiScheduler2.default, {\n        observer: this.option(\"observer\"),\n        data: data,\n        geometry: geometry,\n        direction: settings.direction || \"vertical\",\n        allowResize: allowResize,\n        allowDrag: allowDrag,\n        allDay: allDay,\n        reduced: settings.appointmentReduced,\n        isCompact: settings.isCompact,\n        startDate: new Date(null === info || void 0 === info ? void 0 : info.appointment.startDate),\n        cellWidth: this.invoke(\"getCellWidth\"),\n        cellHeight: this.invoke(\"getCellHeight\"),\n        resizableConfig: this._resizableConfig(data, settings)\n      });\n\n      deferredColor.done(function (color) {\n        if (color) {\n          $appointment.css(\"backgroundColor\", color);\n        }\n      });\n    }\n  },\n  _applyResourceDataAttr: function ($appointment) {\n    var resources = this.invoke(\"getResourcesFromItem\", this._getItemData($appointment));\n\n    if (resources) {\n      (0, _iterator.each)(resources, function (name, values) {\n        var attr = \"data-\" + (0, _common.normalizeKey)(name.toLowerCase()) + \"-\";\n\n        for (var i = 0; i < values.length; i++) {\n          $appointment.attr(attr + (0, _common.normalizeKey)(values[i]), true);\n        }\n      });\n    }\n  },\n  _resizableConfig: function (appointmentData, itemSetting) {\n    return {\n      area: this._calculateResizableArea(itemSetting, appointmentData),\n      onResizeStart: function (e) {\n        this._$currentAppointment = (0, _renderer.default)(e.element);\n\n        if (this.invoke(\"needRecalculateResizableArea\")) {\n          var updatedArea = this._calculateResizableArea(this._$currentAppointment.data(_constants.APPOINTMENT_SETTINGS_KEY), this._$currentAppointment.data(\"dxItemData\"));\n\n          e.component.option(\"area\", updatedArea);\n\n          e.component._renderDragOffsets(e.event);\n        }\n\n        this._initialSize = {\n          width: e.width,\n          height: e.height\n        };\n        this._initialCoordinates = (0, _translator.locate)(this._$currentAppointment);\n      }.bind(this),\n      onResizeEnd: function (e) {\n        if (this._escPressed) {\n          e.event.cancel = true;\n          return;\n        }\n\n        this._resizeEndHandler(e);\n      }.bind(this)\n    };\n  },\n  _calculateResizableArea: function (itemSetting, appointmentData) {\n    var area = this.$element().closest(\".dx-scrollable-content\");\n    return this.invoke(\"getResizableAppointmentArea\", {\n      coordinates: {\n        left: itemSetting.left,\n        top: 0,\n        groupIndex: itemSetting.groupIndex\n      },\n      allDay: itemSetting.allDay\n    }) || area;\n  },\n  _resizeEndHandler: function (e) {\n    var scheduler = this.option(\"observer\");\n    var $element = (0, _renderer.default)(e.element);\n\n    var _$element$data = $element.data(\"dxAppointmentSettings\"),\n        info = _$element$data.info;\n\n    var sourceAppointment = this._getItemData($element);\n\n    var modifiedAppointmentAdapter = scheduler.createAppointmentAdapter(sourceAppointment).clone();\n\n    var startDate = this._getEndResizeAppointmentStartDate(e, sourceAppointment, info.appointment);\n\n    var endDate = info.appointment.endDate;\n\n    var dateRange = this._getDateRange(e, startDate, endDate);\n\n    modifiedAppointmentAdapter.startDate = new Date(dateRange[0]);\n    modifiedAppointmentAdapter.endDate = new Date(dateRange[1]);\n    this.notifyObserver(\"updateAppointmentAfterResize\", {\n      target: sourceAppointment,\n      data: modifiedAppointmentAdapter.clone({\n        pathTimeZone: \"fromGrid\"\n      }).source(),\n      $appointment: $element\n    });\n  },\n  _getEndResizeAppointmentStartDate: function (e, rawAppointment, appointmentInfo) {\n    var scheduler = this.option(\"observer\");\n    var appointmentAdapter = scheduler.createAppointmentAdapter(rawAppointment);\n    var startDate = appointmentInfo.startDate;\n    var recurrenceProcessor = (0, _recurrence.getRecurrenceProcessor)();\n    var recurrenceRule = appointmentAdapter.recurrenceRule,\n        startDateTimeZone = appointmentAdapter.startDateTimeZone;\n    var isAllDay = this.invoke(\"isAllDay\", rawAppointment);\n    var isRecurrent = recurrenceProcessor.isValidRecurrenceRule(recurrenceRule);\n\n    if (!e.handles.top && !isRecurrent && !isAllDay) {\n      startDate = scheduler.timeZoneCalculator.createDate(appointmentAdapter.startDate, {\n        appointmentTimeZone: startDateTimeZone,\n        path: \"toGrid\"\n      });\n    }\n\n    return startDate;\n  },\n  _getDateRange: function (e, startDate, endDate) {\n    var itemData = this._getItemData(e.element);\n\n    var deltaTime = this.invoke(\"getDeltaTime\", e, this._initialSize, itemData);\n    var renderingStrategyDirection = this.invoke(\"getRenderingStrategyDirection\");\n    var isStartDateChanged = false;\n    var isAllDay = this.invoke(\"isAllDay\", itemData);\n    var needCorrectDates = this.invoke(\"needCorrectAppointmentDates\") && !isAllDay;\n    var startTime;\n    var endTime;\n\n    if (\"vertical\" !== renderingStrategyDirection || isAllDay) {\n      isStartDateChanged = this.option(\"rtlEnabled\") ? e.handles.right : e.handles.left;\n    } else {\n      isStartDateChanged = e.handles.top;\n    }\n\n    if (isStartDateChanged) {\n      startTime = needCorrectDates ? this._correctStartDateByDelta(startDate, deltaTime) : startDate.getTime() - deltaTime;\n      startTime += _utilsTimeZone.default.getTimezoneOffsetChangeInMs(startDate, endDate, startTime, endDate);\n      endTime = endDate.getTime();\n    } else {\n      startTime = startDate.getTime();\n      endTime = needCorrectDates ? this._correctEndDateByDelta(endDate, deltaTime) : endDate.getTime() + deltaTime;\n      endTime -= _utilsTimeZone.default.getTimezoneOffsetChangeInMs(startDate, endDate, startDate, endTime);\n    }\n\n    return [startTime, endTime];\n  },\n  _correctEndDateByDelta: function (endDate, deltaTime) {\n    var endDayHour = this.invoke(\"getEndDayHour\");\n    var startDayHour = this.invoke(\"getStartDayHour\");\n    var result = endDate.getTime() + deltaTime;\n    var visibleDayDuration = (endDayHour - startDayHour) * toMs(\"hour\");\n    var daysCount = deltaTime > 0 ? Math.ceil(deltaTime / visibleDayDuration) : Math.floor(deltaTime / visibleDayDuration);\n    var maxDate = new Date(endDate);\n    var minDate = new Date(endDate);\n    minDate.setHours(startDayHour, 0, 0, 0);\n    maxDate.setHours(endDayHour, 0, 0, 0);\n\n    if (result > maxDate.getTime() || result <= minDate.getTime()) {\n      var tailOfCurrentDay = maxDate.getTime() - endDate.getTime();\n      var tailOfPrevDays = deltaTime - tailOfCurrentDay;\n      var lastDay = new Date(endDate.setDate(endDate.getDate() + daysCount));\n      lastDay.setHours(startDayHour, 0, 0, 0);\n      result = lastDay.getTime() + tailOfPrevDays - visibleDayDuration * (daysCount - 1);\n    }\n\n    return result;\n  },\n  _correctStartDateByDelta: function (startDate, deltaTime) {\n    var endDayHour = this.invoke(\"getEndDayHour\");\n    var startDayHour = this.invoke(\"getStartDayHour\");\n    var result = startDate.getTime() - deltaTime;\n    var visibleDayDuration = (endDayHour - startDayHour) * toMs(\"hour\");\n    var daysCount = deltaTime > 0 ? Math.ceil(deltaTime / visibleDayDuration) : Math.floor(deltaTime / visibleDayDuration);\n    var maxDate = new Date(startDate);\n    var minDate = new Date(startDate);\n    minDate.setHours(startDayHour, 0, 0, 0);\n    maxDate.setHours(endDayHour, 0, 0, 0);\n\n    if (result < minDate.getTime() || result >= maxDate.getTime()) {\n      var tailOfCurrentDay = startDate.getTime() - minDate.getTime();\n      var tailOfPrevDays = deltaTime - tailOfCurrentDay;\n      var firstDay = new Date(startDate.setDate(startDate.getDate() - daysCount));\n      firstDay.setHours(endDayHour, 0, 0, 0);\n      result = firstDay.getTime() - tailOfPrevDays + visibleDayDuration * (daysCount - 1);\n    }\n\n    return result;\n  },\n  _tryGetAppointmentColor: function (appointment) {\n    var settings = (0, _renderer.default)(appointment).data(_constants.APPOINTMENT_SETTINGS_KEY);\n\n    if (!settings) {\n      return;\n    }\n\n    return this._getAppointmentColor(appointment, settings.groupIndex);\n  },\n  _getAppointmentColor: function ($appointment, groupIndex) {\n    var res = new _deferred.Deferred();\n    var response = this.invoke(\"getAppointmentColor\", {\n      itemData: this._getItemData($appointment),\n      groupIndex: groupIndex\n    });\n    response.done(function (color) {\n      return res.resolve(color);\n    });\n    return res.promise();\n  },\n  _calculateBoundOffset: function () {\n    return this.invoke(\"getBoundOffset\");\n  },\n  _virtualAppointments: {},\n  _processVirtualAppointment: function (appointmentSetting, $appointment, appointmentData, color) {\n    var virtualAppointment = appointmentSetting.virtual;\n    var virtualGroupIndex = virtualAppointment.index;\n\n    if (!(0, _type.isDefined)(this._virtualAppointments[virtualGroupIndex])) {\n      this._virtualAppointments[virtualGroupIndex] = {\n        coordinates: {\n          top: virtualAppointment.top,\n          left: virtualAppointment.left\n        },\n        items: {\n          data: [],\n          colors: [],\n          settings: []\n        },\n        isAllDay: virtualAppointment.isAllDay ? true : false,\n        buttonColor: color\n      };\n    }\n\n    appointmentSetting.targetedAppointmentData = this.invoke(\"getTargetedAppointmentData\", appointmentData, $appointment);\n\n    this._virtualAppointments[virtualGroupIndex].items.settings.push(appointmentSetting);\n\n    this._virtualAppointments[virtualGroupIndex].items.data.push(appointmentData);\n\n    this._virtualAppointments[virtualGroupIndex].items.colors.push(color);\n\n    $appointment.remove();\n  },\n  _renderContentImpl: function () {\n    this.callBase();\n\n    this._renderDropDownAppointments();\n  },\n  _renderDropDownAppointments: function () {\n    var _this3 = this;\n\n    this._renderByFragments(function ($commonFragment, $allDayFragment) {\n      (0, _iterator.each)(_this3._virtualAppointments, function (groupIndex) {\n        var virtualGroup = this._virtualAppointments[groupIndex];\n        var virtualItems = virtualGroup.items;\n        var virtualCoordinates = virtualGroup.coordinates;\n        var $fragment = virtualGroup.isAllDay ? $allDayFragment : $commonFragment;\n        var left = virtualCoordinates.left;\n        var buttonWidth = this.invoke(\"getDropDownAppointmentWidth\", virtualGroup.isAllDay);\n        var buttonHeight = this.invoke(\"getDropDownAppointmentHeight\");\n        var rtlOffset = this.option(\"rtlEnabled\") ? buttonWidth : 0;\n        this.notifyObserver(\"renderCompactAppointments\", {\n          $container: $fragment,\n          coordinates: {\n            top: virtualCoordinates.top,\n            left: left + rtlOffset\n          },\n          items: virtualItems,\n          buttonColor: virtualGroup.buttonColor,\n          width: buttonWidth - this.option(\"_collectorOffset\"),\n          height: buttonHeight,\n          onAppointmentClick: this.option(\"onItemClick\"),\n          allowDrag: this.option(\"allowDrag\"),\n          cellWidth: this.invoke(\"getCellWidth\"),\n          isCompact: this.invoke(\"isAdaptive\") || this._isGroupCompact(virtualGroup),\n          applyOffset: !virtualGroup.isAllDay && this.invoke(\"isApplyCompactAppointmentOffset\")\n        });\n      }.bind(_this3));\n    });\n  },\n  _isGroupCompact: function (virtualGroup) {\n    return !virtualGroup.isAllDay && this.invoke(\"supportCompactDropDownAppointments\");\n  },\n  _sortAppointmentsByStartDate: function (appointments) {\n    appointments.sort(function (a, b) {\n      var result = 0;\n      var firstDate = new Date(this.invoke(\"getField\", \"startDate\", a.settings || a)).getTime();\n      var secondDate = new Date(this.invoke(\"getField\", \"startDate\", b.settings || b)).getTime();\n\n      if (firstDate < secondDate) {\n        result = -1;\n      }\n\n      if (firstDate > secondDate) {\n        result = 1;\n      }\n\n      return result;\n    }.bind(this));\n  },\n  _processRecurrenceAppointment: function (appointment, index, skipLongAppointments) {\n    var recurrenceRule = this.invoke(\"getField\", \"recurrenceRule\", appointment);\n    var result = {\n      parts: [],\n      indexes: []\n    };\n\n    if (recurrenceRule) {\n      var dates = appointment.settings || appointment;\n      var startDate = new Date(this.invoke(\"getField\", \"startDate\", dates));\n      var endDate = new Date(this.invoke(\"getField\", \"endDate\", dates));\n      var appointmentDuration = endDate.getTime() - startDate.getTime();\n      var recurrenceException = this.invoke(\"getField\", \"recurrenceException\", appointment);\n      var startViewDate = this.invoke(\"getStartViewDate\");\n      var endViewDate = this.invoke(\"getEndViewDate\");\n      var recurrentDates = (0, _recurrence.getRecurrenceProcessor)().generateDates({\n        rule: recurrenceRule,\n        exception: recurrenceException,\n        start: startDate,\n        end: endDate,\n        min: startViewDate,\n        max: endViewDate\n      });\n      var recurrentDateCount = appointment.settings ? 1 : recurrentDates.length;\n\n      for (var i = 0; i < recurrentDateCount; i++) {\n        var appointmentPart = (0, _extend.extend)({}, appointment, true);\n\n        if (recurrentDates[i]) {\n          var appointmentSettings = this._applyStartDateToObj(recurrentDates[i], {});\n\n          this._applyEndDateToObj(new Date(recurrentDates[i].getTime() + appointmentDuration), appointmentSettings);\n\n          appointmentPart.settings = appointmentSettings;\n        } else {\n          appointmentPart.settings = dates;\n        }\n\n        result.parts.push(appointmentPart);\n\n        if (!skipLongAppointments) {\n          this._processLongAppointment(appointmentPart, result);\n        }\n      }\n\n      result.indexes.push(index);\n    }\n\n    return result;\n  },\n  _processLongAppointment: function (appointment, result) {\n    var parts = this.splitAppointmentByDay(appointment);\n    var partCount = parts.length;\n    var endViewDate = this.invoke(\"getEndViewDate\").getTime();\n    var startViewDate = this.invoke(\"getStartViewDate\").getTime();\n    var timeZoneCalculator = this.invoke(\"getTimeZoneCalculator\");\n    result = result || {\n      parts: []\n    };\n\n    if (partCount > 1) {\n      (0, _extend.extend)(appointment, parts[0]);\n\n      for (var i = 1; i < partCount; i++) {\n        var startDate = this.invoke(\"getField\", \"startDate\", parts[i].settings).getTime();\n        startDate = timeZoneCalculator.createDate(startDate, {\n          path: \"toGrid\"\n        });\n\n        if (startDate < endViewDate && startDate > startViewDate) {\n          result.parts.push(parts[i]);\n        }\n      }\n    }\n\n    return result;\n  },\n  _reduceRecurrenceAppointments: function (recurrenceIndexes, appointments) {\n    (0, _iterator.each)(recurrenceIndexes, function (i, index) {\n      appointments.splice(index - i, 1);\n    });\n  },\n  _combineAppointments: function (appointments, additionalAppointments) {\n    if (additionalAppointments.length) {\n      (0, _array.merge)(appointments, additionalAppointments);\n    }\n\n    this._sortAppointmentsByStartDate(appointments);\n  },\n  _applyStartDateToObj: function (startDate, obj) {\n    this.invoke(\"setField\", \"startDate\", obj, startDate);\n    return obj;\n  },\n  _applyEndDateToObj: function (endDate, obj) {\n    this.invoke(\"setField\", \"endDate\", obj, endDate);\n    return obj;\n  },\n  moveAppointmentBack: function (dragEvent) {\n    var $appointment = this._$currentAppointment;\n    var size = this._initialSize;\n    var coords = this._initialCoordinates;\n\n    if (dragEvent) {\n      this._removeDragSourceClassFromDraggedAppointment();\n\n      if ((0, _type.isDeferred)(dragEvent.cancel)) {\n        dragEvent.cancel.resolve(true);\n      } else {\n        dragEvent.cancel = true;\n      }\n    }\n\n    if ($appointment && !dragEvent) {\n      if (coords) {\n        (0, _translator.move)($appointment, coords);\n        delete this._initialSize;\n      }\n\n      if (size) {\n        $appointment.outerWidth(size.width);\n        $appointment.outerHeight(size.height);\n        delete this._initialCoordinates;\n      }\n    }\n  },\n  focus: function () {\n    if (this._$currentAppointment) {\n      var focusedElement = (0, _element.getPublicElement)(this._$currentAppointment);\n      this.option(\"focusedElement\", focusedElement);\n\n      _events_engine.default.trigger(focusedElement, \"focus\");\n    }\n  },\n  splitAppointmentByDay: function (appointment) {\n    var dates = appointment.settings || appointment;\n    var originalStartDate = new Date(this.invoke(\"getField\", \"startDate\", dates));\n\n    var startDate = _date.default.makeDate(originalStartDate);\n\n    var endDate = _date.default.makeDate(this.invoke(\"getField\", \"endDate\", dates));\n\n    var maxAllowedDate = this.invoke(\"getEndViewDate\");\n    var startDayHour = this.invoke(\"getStartDayHour\");\n    var endDayHour = this.invoke(\"getEndDayHour\");\n    var appointmentIsLong = this.invoke(\"appointmentTakesSeveralDays\", appointment);\n    var result = [];\n    var timeZoneCalculator = this.invoke(\"getTimeZoneCalculator\");\n    startDate = timeZoneCalculator.createDate(startDate, {\n      path: \"toGrid\"\n    });\n    endDate = timeZoneCalculator.createDate(endDate, {\n      path: \"toGrid\"\n    });\n\n    if (startDate.getHours() <= endDayHour && startDate.getHours() >= startDayHour && !appointmentIsLong) {\n      result.push(this._applyStartDateToObj(new Date(startDate), {\n        appointmentData: appointment\n      }));\n      startDate.setDate(startDate.getDate() + 1);\n    }\n\n    while (appointmentIsLong && startDate.getTime() < endDate.getTime() && startDate < maxAllowedDate) {\n      var currentStartDate = new Date(startDate);\n      var currentEndDate = new Date(startDate);\n\n      this._checkStartDate(currentStartDate, originalStartDate, startDayHour);\n\n      this._checkEndDate(currentEndDate, endDate, endDayHour);\n\n      var appointmentData = (0, _object.deepExtendArraySafe)({}, appointment, true);\n      var appointmentSettings = {};\n\n      this._applyStartDateToObj(currentStartDate, appointmentSettings);\n\n      this._applyEndDateToObj(currentEndDate, appointmentSettings);\n\n      appointmentData.settings = appointmentSettings;\n      result.push(appointmentData);\n      startDate = _date.default.trimTime(startDate);\n      startDate.setDate(startDate.getDate() + 1);\n      startDate.setHours(startDayHour);\n    }\n\n    return result;\n  },\n  _checkStartDate: function (currentDate, originalDate, startDayHour) {\n    if (!_date.default.sameDate(currentDate, originalDate) || currentDate.getHours() <= startDayHour) {\n      currentDate.setHours(startDayHour, 0, 0, 0);\n    } else {\n      currentDate.setHours(originalDate.getHours(), originalDate.getMinutes(), originalDate.getSeconds(), originalDate.getMilliseconds());\n    }\n  },\n  _checkEndDate: function (currentDate, originalDate, endDayHour) {\n    if (!_date.default.sameDate(currentDate, originalDate) || currentDate.getHours() > endDayHour) {\n      currentDate.setHours(endDayHour, 0, 0, 0);\n    } else {\n      currentDate.setHours(originalDate.getHours(), originalDate.getMinutes(), originalDate.getSeconds(), originalDate.getMilliseconds());\n    }\n  },\n  _removeDragSourceClassFromDraggedAppointment: function () {\n    var $appointments = this._itemElements().filter(\".\".concat(_constants.APPOINTMENT_DRAG_SOURCE_CLASS));\n\n    $appointments.each(function (_, element) {\n      var appointmentInstance = (0, _renderer.default)(element).dxSchedulerAppointment(\"instance\");\n      appointmentInstance.option(\"isDragSource\", false);\n    });\n  },\n  _setDragSourceAppointment: function (appointment, settings) {\n    var $appointments = this._findItemElementByItem(appointment);\n\n    var _settings$info$source = settings.info.sourceAppointment,\n        startDate = _settings$info$source.startDate,\n        endDate = _settings$info$source.endDate;\n    var groupIndex = settings.groupIndex;\n    $appointments.forEach(function ($item) {\n      var _$item$data = $item.data(_constants.APPOINTMENT_SETTINGS_KEY),\n          itemInfo = _$item$data.info,\n          itemGroupIndex = _$item$data.groupIndex;\n\n      var _itemInfo$sourceAppoi = itemInfo.sourceAppointment,\n          itemStartDate = _itemInfo$sourceAppoi.startDate,\n          itemEndDate = _itemInfo$sourceAppoi.endDate;\n      var appointmentInstance = $item.dxSchedulerAppointment(\"instance\");\n      var isDragSource = startDate.getTime() === itemStartDate.getTime() && endDate.getTime() === itemEndDate.getTime() && groupIndex === itemGroupIndex;\n      appointmentInstance.option(\"isDragSource\", isDragSource);\n    });\n  }\n}).include(_uiScheduler.default);\n\n(0, _component_registrator.default)(\"dxSchedulerAppointments\", SchedulerAppointments);\nvar _default = SchedulerAppointments;\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["C:/Smart-Virtual-Classroom/client/node_modules/devextreme/ui/scheduler/ui.scheduler.appointments.js"],"names":["exports","default","_renderer","_interopRequireDefault","require","_dom_adapter","_events_engine","_element_data","_translator","_date","_common","_type","_iterator","_object","_array","_extend","_element","_recurrence","_component_registrator","_uiScheduler","_uiScheduler2","_index","_double_click","_message","_uiCollection_widget","_deferred","_utilsTimeZone","_constants","obj","__esModule","COMPONENT_CLASS","APPOINTMENT_ITEM_CLASS","APPOINTMENT_TITLE_CLASS","APPOINTMENT_CONTENT_DETAILS_CLASS","APPOINTMENT_DATE_CLASS","RECURRING_ICON_CLASS","ALL_DAY_CONTENT_CLASS","DBLCLICK_EVENT_NAME","addNamespace","name","toMs","dateToMilliseconds","SchedulerAppointments","inherit","ctor","element","options","callBase","_supportedKeys","parent","tabHandler","e","appointments","_getAccessAppointments","focusedAppointment","filter","index","data","APPOINTMENT_SETTINGS_KEY","sortedIndex","lastIndex","length","shiftKey","preventDefault","$nextAppointment","_getAppointmentByIndex","_resetTabIndex","trigger","extend","escape","moveAppointmentBack","_escPressed","bind","del","option","_getItemData","target","notifyObserver","tab","_","$item","eq","_itemElements","not","$appointment","_focusTarget","attr","_moveFocus","noop","_renderFocusTarget","_focusInHandler","apply","arguments","_$currentAppointment","getPublicElement","_focusOutHandler","_eventBindingTarget","_itemContainer","_getDefaultOptions","noDataText","activeStateEnabled","hoverStateEnabled","tabIndex","fixedContainer","allDayContainer","allowDrag","allowResize","allowAllDayResize","onAppointmentDblClick","_collectorOffset","_optionChanged","args","_cleanFocusState","_clearDropDownItems","_clearDropDownItemsElements","_repaintAppointments","value","_renderDropDownAppointments","_attachAppointmentsEvents","_invalidate","_isAllDayAppointment","appointment","settings","allDay","_isRepaintAppointment","isDefined","needRepaint","_isRepaintAll","invoke","i","_applyFragment","fragment","children","_getAppointmentContainer","append","_onEachAppointment","container","isRepaintAll","_this","repaintAppointment","_clearItem","_renderItem","needRemove","_this2","_renderByFragments","$commonFragment","$allDayFragment","html","_cleanItemContainer","forEach","renderFunction","isVirtualScrolling","createDocumentFragment","_attachClickEvent","_attachHoldEvent","_attachContextMenuEvent","_attachAppointmentDblClick","_renderFocusState","_attachFeedbackEvents","_attachHoverEvents","item","$items","_findItemElementByItem","itemData","each","detach","remove","_virtualAppointments","result","that","itemElements","_itemDataKey","push","_itemClass","$container","$result","$allDayContainer","add","empty","_clean","_initialSize","_initialCoordinates","_init","$element","addClass","_preventSingleAppointmentClick","_renderAppointmentTemplate","model","formatText","appointmentData","_currentAppointmentSettings","agendaSettings","targetedAppointmentData","text","appendTo","isPlainObject","$contentDetails","formatDate","recurrenceRule","format","prependTo","_executeItemRenderAction","itemElement","action","_getItemRenderAction","_itemClickHandler","afterExecute","_processItemClick","event","$target","currentTarget","type","isFakeClickEvent","_appointmentClickTimeout","setTimeout","getBody","contains","_extendActionArgs","_render","itemSelector","_itemSelector","itemContainer","off","on","_itemDXEventHandler","_dblClickHandler","$targetAppointment","clearTimeout","setting","_getItemContent","$itemFrame","$itemContent","_createItemByTemplate","itemTemplate","renderArgs","render","itemsContainer","_postprocessRenderItem","_renderAppointment","_applyResourceDataAttr","geometry","skipResizing","isString","deferredColor","_getAppointmentColor","groupIndex","virtual","_processVirtualAppointment","info","_createComponent","observer","direction","reduced","appointmentReduced","isCompact","startDate","Date","cellWidth","cellHeight","resizableConfig","_resizableConfig","done","color","css","resources","values","normalizeKey","toLowerCase","itemSetting","area","_calculateResizableArea","onResizeStart","updatedArea","component","_renderDragOffsets","width","height","locate","onResizeEnd","cancel","_resizeEndHandler","closest","coordinates","left","top","scheduler","_$element$data","sourceAppointment","modifiedAppointmentAdapter","createAppointmentAdapter","clone","_getEndResizeAppointmentStartDate","endDate","dateRange","_getDateRange","pathTimeZone","source","rawAppointment","appointmentInfo","appointmentAdapter","recurrenceProcessor","getRecurrenceProcessor","startDateTimeZone","isAllDay","isRecurrent","isValidRecurrenceRule","handles","timeZoneCalculator","createDate","appointmentTimeZone","path","deltaTime","renderingStrategyDirection","isStartDateChanged","needCorrectDates","startTime","endTime","right","_correctStartDateByDelta","getTime","getTimezoneOffsetChangeInMs","_correctEndDateByDelta","endDayHour","startDayHour","visibleDayDuration","daysCount","Math","ceil","floor","maxDate","minDate","setHours","tailOfCurrentDay","tailOfPrevDays","lastDay","setDate","getDate","firstDay","_tryGetAppointmentColor","res","Deferred","response","resolve","promise","_calculateBoundOffset","appointmentSetting","virtualAppointment","virtualGroupIndex","items","colors","buttonColor","_renderContentImpl","_this3","virtualGroup","virtualItems","virtualCoordinates","$fragment","buttonWidth","buttonHeight","rtlOffset","onAppointmentClick","_isGroupCompact","applyOffset","_sortAppointmentsByStartDate","sort","a","b","firstDate","secondDate","_processRecurrenceAppointment","skipLongAppointments","parts","indexes","dates","appointmentDuration","recurrenceException","startViewDate","endViewDate","recurrentDates","generateDates","rule","exception","start","end","min","max","recurrentDateCount","appointmentPart","appointmentSettings","_applyStartDateToObj","_applyEndDateToObj","_processLongAppointment","splitAppointmentByDay","partCount","_reduceRecurrenceAppointments","recurrenceIndexes","splice","_combineAppointments","additionalAppointments","merge","dragEvent","size","coords","_removeDragSourceClassFromDraggedAppointment","isDeferred","move","outerWidth","outerHeight","focus","focusedElement","originalStartDate","makeDate","maxAllowedDate","appointmentIsLong","getHours","currentStartDate","currentEndDate","_checkStartDate","_checkEndDate","deepExtendArraySafe","trimTime","currentDate","originalDate","sameDate","getMinutes","getSeconds","getMilliseconds","$appointments","concat","APPOINTMENT_DRAG_SOURCE_CLASS","appointmentInstance","dxSchedulerAppointment","_setDragSourceAppointment","_settings$info$source","_$item$data","itemInfo","itemGroupIndex","_itemInfo$sourceAppoi","itemStartDate","itemEndDate","isDragSource","include","_default","module"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAA,OAAO,CAACC,OAAR,GAAkB,KAAK,CAAvB;;AACA,IAAIC,SAAS,GAAGC,sBAAsB,CAACC,OAAO,CAAC,qBAAD,CAAR,CAAtC;;AACA,IAAIC,YAAY,GAAGF,sBAAsB,CAACC,OAAO,CAAC,wBAAD,CAAR,CAAzC;;AACA,IAAIE,cAAc,GAAGH,sBAAsB,CAACC,OAAO,CAAC,iCAAD,CAAR,CAA3C;;AACA,IAAIG,aAAa,GAAGH,OAAO,CAAC,yBAAD,CAA3B;;AACA,IAAII,WAAW,GAAGJ,OAAO,CAAC,4BAAD,CAAzB;;AACA,IAAIK,KAAK,GAAGN,sBAAsB,CAACC,OAAO,CAAC,uBAAD,CAAR,CAAlC;;AACA,IAAIM,OAAO,GAAGN,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAIO,KAAK,GAAGP,OAAO,CAAC,uBAAD,CAAnB;;AACA,IAAIQ,SAAS,GAAGR,OAAO,CAAC,2BAAD,CAAvB;;AACA,IAAIS,OAAO,GAAGT,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAIU,MAAM,GAAGV,OAAO,CAAC,wBAAD,CAApB;;AACA,IAAIW,OAAO,GAAGX,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAIY,QAAQ,GAAGZ,OAAO,CAAC,oBAAD,CAAtB;;AACA,IAAIa,WAAW,GAAGb,OAAO,CAAC,cAAD,CAAzB;;AACA,IAAIc,sBAAsB,GAAGf,sBAAsB,CAACC,OAAO,CAAC,kCAAD,CAAR,CAAnD;;AACA,IAAIe,YAAY,GAAGhB,sBAAsB,CAACC,OAAO,CAAC,gCAAD,CAAR,CAAzC;;AACA,IAAIgB,aAAa,GAAGjB,sBAAsB,CAACC,OAAO,CAAC,4BAAD,CAAR,CAA1C;;AACA,IAAIiB,MAAM,GAAGjB,OAAO,CAAC,0BAAD,CAApB;;AACA,IAAIkB,aAAa,GAAGlB,OAAO,CAAC,2BAAD,CAA3B;;AACA,IAAImB,QAAQ,GAAGpB,sBAAsB,CAACC,OAAO,CAAC,4BAAD,CAAR,CAArC;;AACA,IAAIoB,oBAAoB,GAAGrB,sBAAsB,CAACC,OAAO,CAAC,yCAAD,CAAR,CAAjD;;AACA,IAAIqB,SAAS,GAAGrB,OAAO,CAAC,2BAAD,CAAvB;;AACA,IAAIsB,cAAc,GAAGvB,sBAAsB,CAACC,OAAO,CAAC,qBAAD,CAAR,CAA3C;;AACA,IAAIuB,UAAU,GAAGvB,OAAO,CAAC,aAAD,CAAxB;;AAEA,SAASD,sBAAT,CAAgCyB,GAAhC,EAAqC;AACjC,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AACD,IAAIE,eAAe,GAAG,sCAAtB;AACA,IAAIC,sBAAsB,GAAG,0BAA7B;AACA,IAAIC,uBAAuB,GAAG,gCAA9B;AACA,IAAIC,iCAAiC,GAAG,0CAAxC;AACA,IAAIC,sBAAsB,GAAG,uCAA7B;AACA,IAAIC,oBAAoB,GAAG,0CAA3B;AACA,IAAIC,qBAAqB,GAAG,yCAA5B;AACA,IAAIC,mBAAmB,GAAG,CAAC,GAAGhB,MAAM,CAACiB,YAAX,EAAyBhB,aAAa,CAACiB,IAAvC,EAA6C,wBAA7C,CAA1B;AACA,IAAIC,IAAI,GAAG/B,KAAK,CAACR,OAAN,CAAcwC,kBAAzB;;AACA,IAAIC,qBAAqB,GAAGlB,oBAAoB,CAACvB,OAArB,CAA6B0C,OAA7B,CAAqC;AAC7DC,EAAAA,IAAI,EAAE,UAASC,OAAT,EAAkBC,OAAlB,EAA2B;AAC7B,SAAKC,QAAL,CAAcF,OAAd,EAAuBC,OAAvB;AACH,GAH4D;AAI7DE,EAAAA,cAAc,EAAE,YAAW;AACvB,QAAIC,MAAM,GAAG,KAAKF,QAAL,EAAb;;AACA,QAAIG,UAAU,GAAG,UAASC,CAAT,EAAY;AACzB,UAAIC,YAAY,GAAG,KAAKC,sBAAL,EAAnB;;AACA,UAAIC,kBAAkB,GAAGF,YAAY,CAACG,MAAb,CAAoB,mBAApB,CAAzB;AACA,UAAIC,KAAK,GAAGF,kBAAkB,CAACG,IAAnB,CAAwB9B,UAAU,CAAC+B,wBAAnC,EAA6DC,WAAzE;AACA,UAAIC,SAAS,GAAGR,YAAY,CAACS,MAAb,GAAsB,CAAtC;;AACA,UAAIL,KAAK,GAAG,CAAR,IAAaL,CAAC,CAACW,QAAf,IAA2BN,KAAK,GAAGI,SAAR,IAAqB,CAACT,CAAC,CAACW,QAAvD,EAAiE;AAC7DX,QAAAA,CAAC,CAACY,cAAF;AACAZ,QAAAA,CAAC,CAACW,QAAF,GAAaN,KAAK,EAAlB,GAAuBA,KAAK,EAA5B;;AACA,YAAIQ,gBAAgB,GAAG,KAAKC,sBAAL,CAA4BT,KAA5B,CAAvB;;AACA,aAAKU,cAAL,CAAoBF,gBAApB;;AACA1D,QAAAA,cAAc,CAACL,OAAf,CAAuBkE,OAAvB,CAA+BH,gBAA/B,EAAiD,OAAjD;AACH;AACJ,KAZD;;AAaA,WAAO,CAAC,GAAGjD,OAAO,CAACqD,MAAZ,EAAoBnB,MAApB,EAA4B;AAC/BoB,MAAAA,MAAM,EAAE,YAAW;AACf,aAAKC,mBAAL;AACA,aAAKC,WAAL,GAAmB,IAAnB;AACH,OAHO,CAGNC,IAHM,CAGD,IAHC,CADuB;AAK/BC,MAAAA,GAAG,EAAE,UAAStB,CAAT,EAAY;AACb,YAAI,KAAKuB,MAAL,CAAY,aAAZ,CAAJ,EAAgC;AAC5BvB,UAAAA,CAAC,CAACY,cAAF;;AACA,cAAIN,IAAI,GAAG,KAAKkB,YAAL,CAAkBxB,CAAC,CAACyB,MAApB,CAAX;;AACA,eAAKC,cAAL,CAAoB,qBAApB,EAA2C;AACvCpB,YAAAA,IAAI,EAAEA,IADiC;AAEvCmB,YAAAA,MAAM,EAAEzB,CAAC,CAACyB;AAF6B,WAA3C;AAIH;AACJ,OATI,CASHJ,IATG,CASE,IATF,CAL0B;AAe/BM,MAAAA,GAAG,EAAE5B;AAf0B,KAA5B,CAAP;AAiBH,GApC4D;AAqC7De,EAAAA,sBAAsB,EAAE,UAASN,WAAT,EAAsB;AAC1C,QAAIP,YAAY,GAAG,KAAKC,sBAAL,EAAnB;;AACA,WAAOD,YAAY,CAACG,MAAb,CAAoB,UAASwB,CAAT,EAAYC,KAAZ,EAAmB;AAC1C,aAAO,CAAC,GAAGzE,aAAa,CAACkD,IAAlB,EAAwBuB,KAAxB,EAA+BrD,UAAU,CAAC+B,wBAA1C,EAAoEC,WAApE,KAAoFA,WAA3F;AACH,KAFM,EAEJsB,EAFI,CAED,CAFC,CAAP;AAGH,GA1C4D;AA2C7D5B,EAAAA,sBAAsB,EAAE,YAAW;AAC/B,WAAO,KAAK6B,aAAL,GAAqB3B,MAArB,CAA4B,UAA5B,EAAwC4B,GAAxC,CAA4C,oBAA5C,CAAP;AACH,GA7C4D;AA8C7DjB,EAAAA,cAAc,EAAE,UAASkB,YAAT,EAAuB;AACnC,SAAKC,YAAL,GAAoBC,IAApB,CAAyB,UAAzB,EAAqC,CAAC,CAAtC;;AACAF,IAAAA,YAAY,CAACE,IAAb,CAAkB,UAAlB,EAA8B,KAAKZ,MAAL,CAAY,UAAZ,CAA9B;AACH,GAjD4D;AAkD7Da,EAAAA,UAAU,EAAE7E,OAAO,CAAC8E,IAlDyC;AAmD7DH,EAAAA,YAAY,EAAE,YAAW;AACrB,WAAO,KAAKH,aAAL,EAAP;AACH,GArD4D;AAsD7DO,EAAAA,kBAAkB,EAAE,YAAW;AAC3B,QAAIL,YAAY,GAAG,KAAKnB,sBAAL,CAA4B,CAA5B,CAAnB;;AACA,SAAKC,cAAL,CAAoBkB,YAApB;AACH,GAzD4D;AA0D7DM,EAAAA,eAAe,EAAE,UAASvC,CAAT,EAAY;AACzB,SAAKJ,QAAL,CAAc4C,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;AACA,SAAKC,oBAAL,GAA4B,CAAC,GAAG3F,SAAS,CAACD,OAAd,EAAuBkD,CAAC,CAACyB,MAAzB,CAA5B;AACA,SAAKF,MAAL,CAAY,gBAAZ,EAA8B,CAAC,GAAG1D,QAAQ,CAAC8E,gBAAb,EAA+B,CAAC,GAAG5F,SAAS,CAACD,OAAd,EAAuBkD,CAAC,CAACyB,MAAzB,CAA/B,CAA9B;AACH,GA9D4D;AA+D7DmB,EAAAA,gBAAgB,EAAE,YAAW;AACzB,QAAIX,YAAY,GAAG,KAAKnB,sBAAL,CAA4B,CAA5B,CAAnB;;AACA,SAAKS,MAAL,CAAY,gBAAZ,EAA8B,CAAC,GAAG1D,QAAQ,CAAC8E,gBAAb,EAA+BV,YAA/B,CAA9B;AACA,SAAKrC,QAAL,CAAc4C,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;AACH,GAnE4D;AAoE7DI,EAAAA,mBAAmB,EAAE,YAAW;AAC5B,WAAO,KAAKC,cAAL,EAAP;AACH,GAtE4D;AAuE7DC,EAAAA,kBAAkB,EAAE,YAAW;AAC3B,WAAO,CAAC,GAAGnF,OAAO,CAACqD,MAAZ,EAAoB,KAAKrB,QAAL,EAApB,EAAqC;AACxCoD,MAAAA,UAAU,EAAE,IAD4B;AAExCC,MAAAA,kBAAkB,EAAE,IAFoB;AAGxCC,MAAAA,iBAAiB,EAAE,IAHqB;AAIxCC,MAAAA,QAAQ,EAAE,CAJ8B;AAKxCC,MAAAA,cAAc,EAAE,IALwB;AAMxCC,MAAAA,eAAe,EAAE,IANuB;AAOxCC,MAAAA,SAAS,EAAE,IAP6B;AAQxCC,MAAAA,WAAW,EAAE,IAR2B;AASxCC,MAAAA,iBAAiB,EAAE,IATqB;AAUxCC,MAAAA,qBAAqB,EAAE,IAViB;AAWxCC,MAAAA,gBAAgB,EAAE;AAXsB,KAArC,CAAP;AAaH,GArF4D;AAsF7DC,EAAAA,cAAc,EAAE,UAASC,IAAT,EAAe;AAC3B,YAAQA,IAAI,CAACxE,IAAb;AACI,WAAK,OAAL;AACI,aAAKyE,gBAAL;;AACA,aAAKC,mBAAL;;AACA,aAAKC,2BAAL;;AACA,aAAKC,oBAAL,CAA0BJ,IAAI,CAACK,KAA/B;;AACA,aAAKC,2BAAL;;AACA,aAAKC,yBAAL;;AACA;;AACJ,WAAK,gBAAL;AACA,WAAK,iBAAL;AACA,WAAK,uBAAL;AACI;;AACJ,WAAK,WAAL;AACA,WAAK,aAAL;AACA,WAAK,mBAAL;AACI,aAAKC,WAAL;;AACA;;AACJ,WAAK,gBAAL;AACI,aAAKrD,cAAL,CAAoB,CAAC,GAAGhE,SAAS,CAACD,OAAd,EAAuB8G,IAAI,CAACK,KAA5B,CAApB;;AACA,aAAKrE,QAAL,CAAcgE,IAAd;AACA;;AACJ,WAAK,aAAL;AACI;;AACJ,WAAK,mBAAL;AACI,aAAKG,2BAAL;;AACA,aAAKG,2BAAL;;AACA,aAAKtE,QAAL,CAAcgE,IAAd;AACA;;AACJ;AACI,aAAKhE,QAAL,CAAcgE,IAAd;AA9BR;AAgCH,GAvH4D;AAwH7DS,EAAAA,oBAAoB,EAAE,UAASC,WAAT,EAAsB;AACxC,WAAOA,WAAW,CAACC,QAAZ,CAAqB7D,MAArB,IAA+B4D,WAAW,CAACC,QAAZ,CAAqB,CAArB,EAAwBC,MAAvD,IAAiE,KAAxE;AACH,GA1H4D;AA2H7DC,EAAAA,qBAAqB,EAAE,UAASH,WAAT,EAAsB;AACzC,WAAO,CAAC,CAAC,GAAG9G,KAAK,CAACkH,SAAV,EAAqBJ,WAAW,CAACK,WAAjC,CAAD,IAAkD,SAASL,WAAW,CAACK,WAA9E;AACH,GA7H4D;AA8H7DC,EAAAA,aAAa,EAAE,UAAS3E,YAAT,EAAuB;AAClC,QAAI,KAAK4E,MAAL,CAAY,oBAAZ,CAAJ,EAAuC;AACnC,aAAO,IAAP;AACH;;AACD,QAAI,KAAKA,MAAL,CAAY,qBAAZ,CAAJ,EAAwC;AACpC,aAAO,IAAP;AACH;;AACD,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG7E,YAAY,CAACS,MAAjC,EAAyCoE,CAAC,EAA1C,EAA8C;AAC1C,UAAIR,WAAW,GAAGrE,YAAY,CAAC6E,CAAD,CAA9B;;AACA,UAAI,CAAC,KAAKL,qBAAL,CAA2BH,WAA3B,CAAL,EAA8C;AAC1C,eAAO,KAAP;AACH;AACJ;;AACD,WAAO,IAAP;AACH,GA5I4D;AA6I7DS,EAAAA,cAAc,EAAE,UAASC,QAAT,EAAmBR,MAAnB,EAA2B;AACvC,QAAIQ,QAAQ,CAACC,QAAT,GAAoBvE,MAApB,GAA6B,CAAjC,EAAoC;AAChC,WAAKwE,wBAAL,CAA8BV,MAA9B,EAAsCW,MAAtC,CAA6CH,QAA7C;AACH;AACJ,GAjJ4D;AAkJ7DI,EAAAA,kBAAkB,EAAE,UAASd,WAAT,EAAsBjE,KAAtB,EAA6BgF,SAA7B,EAAwCC,YAAxC,EAAsD;AACtE,QAAIC,KAAK,GAAG,IAAZ;;AACA,QAAIC,kBAAkB,GAAG,YAAW;AAChClB,MAAAA,WAAW,CAACK,WAAZ,GAA0B,KAA1B;;AACAY,MAAAA,KAAK,CAACE,UAAN,CAAiBnB,WAAjB;;AACAiB,MAAAA,KAAK,CAACG,WAAN,CAAkBrF,KAAlB,EAAyBiE,WAAzB,EAAsCe,SAAtC;AACH,KAJD;;AAKA,QAAI,UAAU,SAASf,WAAT,IAAwB,KAAK,CAAL,KAAWA,WAAnC,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACqB,UAAhF,CAAJ,EAAiG;AAC7F,WAAKF,UAAL,CAAgBnB,WAAhB;AACH,KAFD,MAEO;AACH,UAAIgB,YAAY,IAAI,KAAKb,qBAAL,CAA2BH,WAA3B,CAApB,EAA6D;AACzDkB,QAAAA,kBAAkB;AACrB;AACJ;AACJ,GAhK4D;AAiK7DxB,EAAAA,oBAAoB,EAAE,UAAS/D,YAAT,EAAuB;AACzC,QAAI2F,MAAM,GAAG,IAAb;;AACA,SAAKC,kBAAL,CAAwB,UAASC,eAAT,EAA0BC,eAA1B,EAA2C;AAC/D,UAAIT,YAAY,GAAGM,MAAM,CAAChB,aAAP,CAAqB3E,YAArB,CAAnB;;AACA,UAAIqF,YAAJ,EAAkB;AACdM,QAAAA,MAAM,CAACV,wBAAP,CAAgC,IAAhC,EAAsCc,IAAtC,CAA2C,EAA3C;;AACAJ,QAAAA,MAAM,CAACV,wBAAP,CAAgC,KAAhC,EAAuCc,IAAvC,CAA4C,EAA5C;AACH;;AAAA,OAAC/F,YAAY,CAACS,MAAd,IAAwBkF,MAAM,CAACK,mBAAP,EAAxB;AACDhG,MAAAA,YAAY,CAACiG,OAAb,CAAqB,UAAS5B,WAAT,EAAsBjE,KAAtB,EAA6B;AAC9C,YAAIgF,SAAS,GAAGO,MAAM,CAACvB,oBAAP,CAA4BC,WAA5B,IAA2CyB,eAA3C,GAA6DD,eAA7E;;AACAF,QAAAA,MAAM,CAACR,kBAAP,CAA0Bd,WAA1B,EAAuCjE,KAAvC,EAA8CgF,SAA9C,EAAyDC,YAAzD;AACH,OAHD;AAIH,KAVD;AAWH,GA9K4D;AA+K7DO,EAAAA,kBAAkB,EAAE,UAASM,cAAT,EAAyB;AACzC,QAAIC,kBAAkB,GAAG,KAAKvB,MAAL,CAAY,oBAAZ,CAAzB;;AACA,QAAIuB,kBAAJ,EAAwB;AACpB,UAAIN,eAAe,GAAG,CAAC,GAAG/I,SAAS,CAACD,OAAd,EAAuBI,YAAY,CAACJ,OAAb,CAAqBuJ,sBAArB,EAAvB,CAAtB;AACA,UAAIN,eAAe,GAAG,CAAC,GAAGhJ,SAAS,CAACD,OAAd,EAAuBI,YAAY,CAACJ,OAAb,CAAqBuJ,sBAArB,EAAvB,CAAtB;AACAF,MAAAA,cAAc,CAACL,eAAD,EAAkBC,eAAlB,CAAd;;AACA,WAAKhB,cAAL,CAAoBe,eAApB,EAAqC,KAArC;;AACA,WAAKf,cAAL,CAAoBgB,eAApB,EAAqC,IAArC;AACH,KAND,MAMO;AACHI,MAAAA,cAAc,CAAC,KAAKjB,wBAAL,CAA8B,KAA9B,CAAD,EAAuC,KAAKA,wBAAL,CAA8B,IAA9B,CAAvC,CAAd;AACH;AACJ,GA1L4D;AA2L7Df,EAAAA,yBAAyB,EAAE,YAAW;AAClC,SAAKmC,iBAAL;;AACA,SAAKC,gBAAL;;AACA,SAAKC,uBAAL;;AACA,SAAKC,0BAAL;;AACA,SAAKC,iBAAL;;AACA,SAAKC,qBAAL;;AACA,SAAKC,kBAAL;AACH,GAnM4D;AAoM7DnB,EAAAA,UAAU,EAAE,UAASoB,IAAT,EAAe;AACvB,QAAIC,MAAM,GAAG,KAAKC,sBAAL,CAA4BF,IAAI,CAACG,QAAjC,CAAb;;AACA,QAAI,CAACF,MAAM,CAACpG,MAAZ,EAAoB;AAChB;AACH;;AAAA,KAAC,GAAGjD,SAAS,CAACwJ,IAAd,EAAoBH,MAApB,EAA4B,UAASlF,CAAT,EAAYC,KAAZ,EAAmB;AAC5CA,MAAAA,KAAK,CAACqF,MAAN;AACArF,MAAAA,KAAK,CAACsF,MAAN;AACH,KAHA;AAIJ,GA5M4D;AA6M7DrD,EAAAA,mBAAmB,EAAE,YAAW;AAC5B,SAAKsD,oBAAL,GAA4B,EAA5B;AACH,GA/M4D;AAgN7DrD,EAAAA,2BAA2B,EAAE,YAAW;AACpC,SAAKc,MAAL,CAAY,0BAAZ;AACH,GAlN4D;AAmN7DkC,EAAAA,sBAAsB,EAAE,UAASF,IAAT,EAAe;AACnC,QAAIQ,MAAM,GAAG,EAAb;AACA,QAAIC,IAAI,GAAG,IAAX;AACA,SAAKC,YAAL,GAAoBN,IAApB,CAAyB,YAAW;AAChC,UAAIpF,KAAK,GAAG,CAAC,GAAG9E,SAAS,CAACD,OAAd,EAAuB,IAAvB,CAAZ;;AACA,UAAI+E,KAAK,CAACvB,IAAN,CAAWgH,IAAI,CAACE,YAAL,EAAX,MAAoCX,IAAxC,EAA8C;AAC1CQ,QAAAA,MAAM,CAACI,IAAP,CAAY5F,KAAZ;AACH;AACJ,KALD;AAMA,WAAOwF,MAAP;AACH,GA7N4D;AA8N7DK,EAAAA,UAAU,EAAE,YAAW;AACnB,WAAO9I,sBAAP;AACH,GAhO4D;AAiO7DkE,EAAAA,cAAc,EAAE,YAAW;AACvB,QAAI6E,UAAU,GAAG,KAAK/H,QAAL,EAAjB;AACA,QAAIgI,OAAO,GAAGD,UAAd;AACA,QAAIE,gBAAgB,GAAG,KAAKtG,MAAL,CAAY,iBAAZ,CAAvB;;AACA,QAAIsG,gBAAJ,EAAsB;AAClBD,MAAAA,OAAO,GAAGD,UAAU,CAACG,GAAX,CAAeD,gBAAf,CAAV;AACH;;AACD,WAAOD,OAAP;AACH,GAzO4D;AA0O7D3B,EAAAA,mBAAmB,EAAE,YAAW;AAC5B,SAAKrG,QAAL;AACA,QAAIiI,gBAAgB,GAAG,KAAKtG,MAAL,CAAY,iBAAZ,CAAvB;;AACA,QAAIsG,gBAAJ,EAAsB;AAClBA,MAAAA,gBAAgB,CAACE,KAAjB;AACH;;AACD,SAAKX,oBAAL,GAA4B,EAA5B;AACH,GAjP4D;AAkP7DY,EAAAA,MAAM,EAAE,YAAW;AACf,SAAKpI,QAAL;AACA,WAAO,KAAK8C,oBAAZ;AACA,WAAO,KAAKuF,YAAZ;AACA,WAAO,KAAKC,mBAAZ;AACH,GAvP4D;AAwP7DC,EAAAA,KAAK,EAAE,YAAW;AACd,SAAKvI,QAAL;AACA,SAAKwI,QAAL,GAAgBC,QAAhB,CAAyB1J,eAAzB;AACA,SAAK2J,8BAAL,GAAsC,KAAtC;AACH,GA5P4D;AA6P7DC,EAAAA,0BAA0B,EAAE,UAASZ,UAAT,EAAqBrH,IAArB,EAA2BkI,KAA3B,EAAkC;AAC1D,QAAIC,UAAU,GAAG,KAAK5D,MAAL,CAAY,sBAAZ,EAAoC2D,KAAK,CAACE,eAA1C,EAA2D,KAAKC,2BAAL,CAAiCC,cAAjC,IAAmDJ,KAAK,CAACK,uBAApH,EAA6I,MAA7I,CAAjB;AACA,KAAC,GAAG9L,SAAS,CAACD,OAAd,EAAuB,OAAvB,EAAgCgM,IAAhC,CAAqCL,UAAU,CAACK,IAAhD,EAAsDT,QAAtD,CAA+DxJ,uBAA/D,EAAwFkK,QAAxF,CAAiGpB,UAAjG;;AACA,QAAI,CAAC,GAAGnK,KAAK,CAACwL,aAAV,EAAyB1I,IAAzB,CAAJ,EAAoC;AAChC,UAAIA,IAAI,CAAC0F,IAAT,EAAe;AACX2B,QAAAA,UAAU,CAAC3B,IAAX,CAAgB1F,IAAI,CAAC0F,IAArB;AACH;AACJ;;AACD,QAAIiD,eAAe,GAAG,CAAC,GAAGlM,SAAS,CAACD,OAAd,EAAuB,OAAvB,EAAgCuL,QAAhC,CAAyCvJ,iCAAzC,CAAtB;AACA,KAAC,GAAG/B,SAAS,CAACD,OAAd,EAAuB,OAAvB,EAAgCuL,QAAhC,CAAyCtJ,sBAAzC,EAAiE+J,IAAjE,CAAsEL,UAAU,CAACS,UAAjF,EAA6FH,QAA7F,CAAsGE,eAAtG;AACAA,IAAAA,eAAe,CAACF,QAAhB,CAAyBpB,UAAzB;;AACA,QAAIrH,IAAI,CAAC6I,cAAT,EAAyB;AACrB,OAAC,GAAGpM,SAAS,CAACD,OAAd,EAAuB,QAAvB,EAAiCuL,QAAjC,CAA0CrJ,oBAAoB,GAAG,iBAAjE,EAAoF+J,QAApF,CAA6FpB,UAA7F;AACH;;AACD,QAAIrH,IAAI,CAACkE,MAAT,EAAiB;AACb,OAAC,GAAGzH,SAAS,CAACD,OAAd,EAAuB,OAAvB,EAAgCgM,IAAhC,CAAqC,MAAM1K,QAAQ,CAACtB,OAAT,CAAiBsM,MAAjB,CAAwB,oBAAxB,CAAN,GAAsD,IAA3F,EAAiGf,QAAjG,CAA0GpJ,qBAA1G,EAAiIoK,SAAjI,CAA2IJ,eAA3I;AACH;AACJ,GA9Q4D;AA+Q7DK,EAAAA,wBAAwB,EAAE,UAASjJ,KAAT,EAAgB2G,QAAhB,EAA0BuC,WAA1B,EAAuC;AAC7D,QAAIC,MAAM,GAAG,KAAKC,oBAAL,EAAb;;AACA,QAAID,MAAJ,EAAY;AACRA,MAAAA,MAAM,CAAC,KAAK3E,MAAL,CAAY,sBAAZ,EAAoC;AACvCmC,QAAAA,QAAQ,EAAEA,QAD6B;AAEvCuC,QAAAA,WAAW,EAAEA;AAF0B,OAApC,CAAD,CAAN;AAIH;;AACD,WAAO,KAAKZ,2BAAZ;AACH,GAxR4D;AAyR7De,EAAAA,iBAAiB,EAAE,UAAS1J,CAAT,EAAY;AAC3B,SAAKJ,QAAL,CAAcI,CAAd,EAAiB,EAAjB,EAAqB;AACjB2J,MAAAA,YAAY,EAAE,UAAS3J,CAAT,EAAY;AACtB,aAAK4J,iBAAL,CAAuB5J,CAAC,CAAC4D,IAAF,CAAO,CAAP,EAAUiG,KAAjC;AACH,OAFa,CAEZxI,IAFY,CAEP,IAFO;AADG,KAArB;AAKH,GA/R4D;AAgS7DuI,EAAAA,iBAAiB,EAAE,UAAS5J,CAAT,EAAY;AAC3B,QAAI8J,OAAO,GAAG,CAAC,GAAG/M,SAAS,CAACD,OAAd,EAAuBkD,CAAC,CAAC+J,aAAzB,CAAd;;AACA,QAAIzJ,IAAI,GAAG,KAAKkB,YAAL,CAAkBsI,OAAlB,CAAX;;AACA,QAAI,cAAc9J,CAAC,CAACgK,IAAhB,IAAwB,CAAC,GAAG9L,MAAM,CAAC+L,gBAAX,EAA6BjK,CAA7B,CAA5B,EAA6D;AACzD,WAAK0B,cAAL,CAAoB,0BAApB,EAAgD;AAC5CpB,QAAAA,IAAI,EAAEA,IADsC;AAE5CmB,QAAAA,MAAM,EAAEqI;AAFoC,OAAhD;AAIA;AACH;;AACD,SAAKI,wBAAL,GAAgCC,UAAU,CAAC,YAAW;AAClD,UAAI,CAAC,KAAK7B,8BAAN,IAAwCpL,YAAY,CAACJ,OAAb,CAAqBsN,OAArB,GAA+BC,QAA/B,CAAwCP,OAAO,CAAC,CAAD,CAA/C,CAA5C,EAAiG;AAC7F,aAAKpI,cAAL,CAAoB,wBAApB,EAA8C;AAC1CpB,UAAAA,IAAI,EAAEA,IADoC;AAE1CmB,UAAAA,MAAM,EAAEqI;AAFkC,SAA9C;AAIH;;AACD,WAAKxB,8BAAL,GAAsC,KAAtC;AACH,KAR0C,CAQzCjH,IARyC,CAQpC,IARoC,CAAD,EAQ5B,GAR4B,CAA1C;AASH,GAnT4D;AAoT7DiJ,EAAAA,iBAAiB,EAAE,YAAW;AAC1B,QAAI1G,IAAI,GAAG,KAAKhE,QAAL,CAAc4C,KAAd,CAAoB,IAApB,EAA0BC,SAA1B,CAAX;AACA,WAAO,KAAKoC,MAAL,CAAY,sBAAZ,EAAoCjB,IAApC,CAAP;AACH,GAvT4D;AAwT7D2G,EAAAA,OAAO,EAAE,YAAW;AAChB,SAAK3K,QAAL,CAAc4C,KAAd,CAAoB,IAApB,EAA0BC,SAA1B;;AACA,SAAKgE,0BAAL;AACH,GA3T4D;AA4T7DA,EAAAA,0BAA0B,EAAE,YAAW;AACnC,QAAIa,IAAI,GAAG,IAAX;;AACA,QAAIkD,YAAY,GAAGlD,IAAI,CAACmD,aAAL,EAAnB;;AACA,QAAIC,aAAa,GAAG,KAAK5H,cAAL,EAApB;;AACA3F,IAAAA,cAAc,CAACL,OAAf,CAAuB6N,GAAvB,CAA2BD,aAA3B,EAA0CxL,mBAA1C,EAA+DsL,YAA/D;;AACArN,IAAAA,cAAc,CAACL,OAAf,CAAuB8N,EAAvB,CAA0BF,aAA1B,EAAyCxL,mBAAzC,EAA8DsL,YAA9D,EAA4E,UAASxK,CAAT,EAAY;AACpFsH,MAAAA,IAAI,CAACuD,mBAAL,CAAyB7K,CAAzB,EAA4B,uBAA5B,EAAqD,EAArD,EAAyD;AACrD2J,QAAAA,YAAY,EAAE,UAAS3J,CAAT,EAAY;AACtBsH,UAAAA,IAAI,CAACwD,gBAAL,CAAsB9K,CAAC,CAAC4D,IAAF,CAAO,CAAP,EAAUiG,KAAhC;AACH;AAHoD,OAAzD;AAKH,KAND;AAOH,GAxU4D;AAyU7DiB,EAAAA,gBAAgB,EAAE,UAAS9K,CAAT,EAAY;AAC1B,QAAI+K,kBAAkB,GAAG,CAAC,GAAGhO,SAAS,CAACD,OAAd,EAAuBkD,CAAC,CAAC+J,aAAzB,CAAzB;;AACA,QAAIrB,eAAe,GAAG,KAAKlH,YAAL,CAAkBuJ,kBAAlB,CAAtB;;AACAC,IAAAA,YAAY,CAAC,KAAKd,wBAAN,CAAZ;AACA,SAAK5B,8BAAL,GAAsC,IAAtC;AACA,SAAK5G,cAAL,CAAoB,0BAApB,EAAgD;AAC5CpB,MAAAA,IAAI,EAAEoI,eADsC;AAE5CjH,MAAAA,MAAM,EAAEsJ;AAFoC,KAAhD;AAIH,GAlV4D;AAmV7DrF,EAAAA,WAAW,EAAE,UAASrF,KAAT,EAAgBwG,IAAhB,EAAsBxB,SAAtB,EAAiC;AAC1C,QAAI2B,QAAQ,GAAGH,IAAI,CAACG,QAApB;AACA,QAAIF,MAAM,GAAG,EAAb;;AACA,SAAK,IAAIhC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+B,IAAI,CAACtC,QAAL,CAAc7D,MAAlC,EAA0CoE,CAAC,EAA3C,EAA+C;AAC3C,UAAImG,OAAO,GAAGpE,IAAI,CAACtC,QAAL,CAAcO,CAAd,CAAd;AACA,WAAK6D,2BAAL,GAAmCsC,OAAnC;AACA,UAAIpJ,KAAK,GAAG,KAAKjC,QAAL,CAAcS,KAAd,EAAqB2G,QAArB,EAA+B3B,SAA/B,CAAZ;AACAxD,MAAAA,KAAK,CAACvB,IAAN,CAAW9B,UAAU,CAAC+B,wBAAtB,EAAgD0K,OAAhD;AACAnE,MAAAA,MAAM,CAACW,IAAP,CAAY5F,KAAZ;AACH;;AACD,WAAOiF,MAAP;AACH,GA9V4D;AA+V7DoE,EAAAA,eAAe,EAAE,UAASC,UAAT,EAAqB;AAClCA,IAAAA,UAAU,CAAC7K,IAAX,CAAgB9B,UAAU,CAAC+B,wBAA3B,EAAqD,KAAKoI,2BAA1D;AACA,QAAIyC,YAAY,GAAG,KAAKxL,QAAL,CAAcuL,UAAd,CAAnB;AACA,WAAOC,YAAP;AACH,GAnW4D;AAoW7DC,EAAAA,qBAAqB,EAAE,UAASC,YAAT,EAAuBC,UAAvB,EAAmC;AACtD,QAAIvE,QAAQ,GAAGuE,UAAU,CAACvE,QAA1B;AAAA,QACI3B,SAAS,GAAGkG,UAAU,CAAClG,SAD3B;AAAA,QAEIhF,KAAK,GAAGkL,UAAU,CAAClL,KAFvB;AAGA,WAAOiL,YAAY,CAACE,MAAb,CAAoB;AACvBhD,MAAAA,KAAK,EAAE;AACHE,QAAAA,eAAe,EAAE1B,QADd;AAEH6B,QAAAA,uBAAuB,EAAE,KAAKhE,MAAL,CAAY,4BAAZ,EAA0CmC,QAA1C,EAAoD,CAAC,GAAGjK,SAAS,CAACD,OAAd,EAAuBuI,SAAvB,EAAkCvF,MAAlC,EAApD;AAFtB,OADgB;AAKvBuF,MAAAA,SAAS,EAAEA,SALY;AAMvBhF,MAAAA,KAAK,EAAEA;AANgB,KAApB,CAAP;AAQH,GAhX4D;AAiX7D6E,EAAAA,wBAAwB,EAAE,UAASV,MAAT,EAAiB;AACvC,QAAIqD,gBAAgB,GAAG,KAAKtG,MAAL,CAAY,iBAAZ,CAAvB;AACA,QAAIoG,UAAU,GAAG,KAAK8D,cAAL,GAAsBzJ,GAAtB,CAA0B6F,gBAA1B,CAAjB;;AACA,QAAIrD,MAAM,IAAIqD,gBAAd,EAAgC;AAC5BF,MAAAA,UAAU,GAAGE,gBAAb;AACH;;AACD,WAAOF,UAAP;AACH,GAxX4D;AAyX7D+D,EAAAA,sBAAsB,EAAE,UAAS9H,IAAT,EAAe;AACnC,SAAK+H,kBAAL,CAAwB/H,IAAI,CAAC2F,WAA7B,EAA0C,KAAKZ,2BAA/C;AACH,GA3X4D;AA4X7DgD,EAAAA,kBAAkB,EAAE,UAAS1J,YAAT,EAAuBsC,QAAvB,EAAiC;AACjDtC,IAAAA,YAAY,CAAC3B,IAAb,CAAkB9B,UAAU,CAAC+B,wBAA7B,EAAuDgE,QAAvD;;AACA,SAAKqH,sBAAL,CAA4B3J,YAA5B;;AACA,QAAI3B,IAAI,GAAG,KAAKkB,YAAL,CAAkBS,YAAlB,CAAX;;AACA,QAAI4J,QAAQ,GAAG,KAAKhH,MAAL,CAAY,wBAAZ,EAAsCN,QAAtC,CAAf;AACA,QAAIhB,WAAW,GAAG,KAAKhC,MAAL,CAAY,aAAZ,MAA+B,CAAC,CAAC,GAAG/D,KAAK,CAACkH,SAAV,EAAqBH,QAAQ,CAACuH,YAA9B,CAAD,IAAgD,CAAC,GAAGtO,KAAK,CAACuO,QAAV,EAAoBxH,QAAQ,CAACuH,YAA7B,CAA/E,CAAlB;AACA,QAAIxI,SAAS,GAAG,KAAK/B,MAAL,CAAY,WAAZ,CAAhB;AACA,QAAIiD,MAAM,GAAGD,QAAQ,CAACC,MAAtB;AACA,SAAKK,MAAL,CAAY,uBAAZ,EAAqC,KAAK8D,2BAA1C,EAAuEkD,QAAvE;;AACA,QAAIG,aAAa,GAAG,KAAKC,oBAAL,CAA0BhK,YAA1B,EAAwCsC,QAAQ,CAAC2H,UAAjD,CAApB;;AACA,QAAI3H,QAAQ,CAAC4H,OAAb,EAAsB;AAClB,WAAKC,0BAAL,CAAgC7H,QAAhC,EAA0CtC,YAA1C,EAAwD3B,IAAxD,EAA8D0L,aAA9D;AACH,KAFD,MAEO;AACH,UAAIK,IAAI,GAAG9H,QAAQ,CAAC8H,IAApB;;AACA,WAAKC,gBAAL,CAAsBrK,YAAtB,EAAoChE,aAAa,CAACnB,OAAlD,EAA2D;AACvDyP,QAAAA,QAAQ,EAAE,KAAKhL,MAAL,CAAY,UAAZ,CAD6C;AAEvDjB,QAAAA,IAAI,EAAEA,IAFiD;AAGvDuL,QAAAA,QAAQ,EAAEA,QAH6C;AAIvDW,QAAAA,SAAS,EAAEjI,QAAQ,CAACiI,SAAT,IAAsB,UAJsB;AAKvDjJ,QAAAA,WAAW,EAAEA,WAL0C;AAMvDD,QAAAA,SAAS,EAAEA,SAN4C;AAOvDkB,QAAAA,MAAM,EAAEA,MAP+C;AAQvDiI,QAAAA,OAAO,EAAElI,QAAQ,CAACmI,kBARqC;AASvDC,QAAAA,SAAS,EAAEpI,QAAQ,CAACoI,SATmC;AAUvDC,QAAAA,SAAS,EAAE,IAAIC,IAAJ,CAAS,SAASR,IAAT,IAAiB,KAAK,CAAL,KAAWA,IAA5B,GAAmC,KAAK,CAAxC,GAA4CA,IAAI,CAAC/H,WAAL,CAAiBsI,SAAtE,CAV4C;AAWvDE,QAAAA,SAAS,EAAE,KAAKjI,MAAL,CAAY,cAAZ,CAX4C;AAYvDkI,QAAAA,UAAU,EAAE,KAAKlI,MAAL,CAAY,eAAZ,CAZ2C;AAavDmI,QAAAA,eAAe,EAAE,KAAKC,gBAAL,CAAsB3M,IAAtB,EAA4BiE,QAA5B;AAbsC,OAA3D;;AAeAyH,MAAAA,aAAa,CAACkB,IAAd,CAAmB,UAASC,KAAT,EAAgB;AAC/B,YAAIA,KAAJ,EAAW;AACPlL,UAAAA,YAAY,CAACmL,GAAb,CAAiB,iBAAjB,EAAoCD,KAApC;AACH;AACJ,OAJD;AAKH;AACJ,GA/Z4D;AAga7DvB,EAAAA,sBAAsB,EAAE,UAAS3J,YAAT,EAAuB;AAC3C,QAAIoL,SAAS,GAAG,KAAKxI,MAAL,CAAY,sBAAZ,EAAoC,KAAKrD,YAAL,CAAkBS,YAAlB,CAApC,CAAhB;;AACA,QAAIoL,SAAJ,EAAe;AACX,OAAC,GAAG5P,SAAS,CAACwJ,IAAd,EAAoBoG,SAApB,EAA+B,UAASjO,IAAT,EAAekO,MAAf,EAAuB;AAClD,YAAInL,IAAI,GAAG,UAAU,CAAC,GAAG5E,OAAO,CAACgQ,YAAZ,EAA0BnO,IAAI,CAACoO,WAAL,EAA1B,CAAV,GAA0D,GAArE;;AACA,aAAK,IAAI1I,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwI,MAAM,CAAC5M,MAA3B,EAAmCoE,CAAC,EAApC,EAAwC;AACpC7C,UAAAA,YAAY,CAACE,IAAb,CAAkBA,IAAI,GAAG,CAAC,GAAG5E,OAAO,CAACgQ,YAAZ,EAA0BD,MAAM,CAACxI,CAAD,CAAhC,CAAzB,EAA+D,IAA/D;AACH;AACJ,OALD;AAMH;AACJ,GA1a4D;AA2a7DmI,EAAAA,gBAAgB,EAAE,UAASvE,eAAT,EAA0B+E,WAA1B,EAAuC;AACrD,WAAO;AACHC,MAAAA,IAAI,EAAE,KAAKC,uBAAL,CAA6BF,WAA7B,EAA0C/E,eAA1C,CADH;AAEHkF,MAAAA,aAAa,EAAE,UAAS5N,CAAT,EAAY;AACvB,aAAK0C,oBAAL,GAA4B,CAAC,GAAG3F,SAAS,CAACD,OAAd,EAAuBkD,CAAC,CAACN,OAAzB,CAA5B;;AACA,YAAI,KAAKmF,MAAL,CAAY,8BAAZ,CAAJ,EAAiD;AAC7C,cAAIgJ,WAAW,GAAG,KAAKF,uBAAL,CAA6B,KAAKjL,oBAAL,CAA0BpC,IAA1B,CAA+B9B,UAAU,CAAC+B,wBAA1C,CAA7B,EAAkG,KAAKmC,oBAAL,CAA0BpC,IAA1B,CAA+B,YAA/B,CAAlG,CAAlB;;AACAN,UAAAA,CAAC,CAAC8N,SAAF,CAAYvM,MAAZ,CAAmB,MAAnB,EAA2BsM,WAA3B;;AACA7N,UAAAA,CAAC,CAAC8N,SAAF,CAAYC,kBAAZ,CAA+B/N,CAAC,CAAC6J,KAAjC;AACH;;AACD,aAAK5B,YAAL,GAAoB;AAChB+F,UAAAA,KAAK,EAAEhO,CAAC,CAACgO,KADO;AAEhBC,UAAAA,MAAM,EAAEjO,CAAC,CAACiO;AAFM,SAApB;AAIA,aAAK/F,mBAAL,GAA2B,CAAC,GAAG7K,WAAW,CAAC6Q,MAAhB,EAAwB,KAAKxL,oBAA7B,CAA3B;AACH,OAZc,CAYbrB,IAZa,CAYR,IAZQ,CAFZ;AAeH8M,MAAAA,WAAW,EAAE,UAASnO,CAAT,EAAY;AACrB,YAAI,KAAKoB,WAAT,EAAsB;AAClBpB,UAAAA,CAAC,CAAC6J,KAAF,CAAQuE,MAAR,GAAiB,IAAjB;AACA;AACH;;AACD,aAAKC,iBAAL,CAAuBrO,CAAvB;AACH,OANY,CAMXqB,IANW,CAMN,IANM;AAfV,KAAP;AAuBH,GAnc4D;AAoc7DsM,EAAAA,uBAAuB,EAAE,UAASF,WAAT,EAAsB/E,eAAtB,EAAuC;AAC5D,QAAIgF,IAAI,GAAG,KAAKtF,QAAL,GAAgBkG,OAAhB,CAAwB,wBAAxB,CAAX;AACA,WAAO,KAAKzJ,MAAL,CAAY,6BAAZ,EAA2C;AAC9C0J,MAAAA,WAAW,EAAE;AACTC,QAAAA,IAAI,EAAEf,WAAW,CAACe,IADT;AAETC,QAAAA,GAAG,EAAE,CAFI;AAGTvC,QAAAA,UAAU,EAAEuB,WAAW,CAACvB;AAHf,OADiC;AAM9C1H,MAAAA,MAAM,EAAEiJ,WAAW,CAACjJ;AAN0B,KAA3C,KAODkJ,IAPN;AAQH,GA9c4D;AA+c7DW,EAAAA,iBAAiB,EAAE,UAASrO,CAAT,EAAY;AAC3B,QAAI0O,SAAS,GAAG,KAAKnN,MAAL,CAAY,UAAZ,CAAhB;AACA,QAAI6G,QAAQ,GAAG,CAAC,GAAGrL,SAAS,CAACD,OAAd,EAAuBkD,CAAC,CAACN,OAAzB,CAAf;;AACA,QAAIiP,cAAc,GAAGvG,QAAQ,CAAC9H,IAAT,CAAc,uBAAd,CAArB;AAAA,QACI+L,IAAI,GAAGsC,cAAc,CAACtC,IAD1B;;AAEA,QAAIuC,iBAAiB,GAAG,KAAKpN,YAAL,CAAkB4G,QAAlB,CAAxB;;AACA,QAAIyG,0BAA0B,GAAGH,SAAS,CAACI,wBAAV,CAAmCF,iBAAnC,EAAsDG,KAAtD,EAAjC;;AACA,QAAInC,SAAS,GAAG,KAAKoC,iCAAL,CAAuChP,CAAvC,EAA0C4O,iBAA1C,EAA6DvC,IAAI,CAAC/H,WAAlE,CAAhB;;AACA,QAAI2K,OAAO,GAAG5C,IAAI,CAAC/H,WAAL,CAAiB2K,OAA/B;;AACA,QAAIC,SAAS,GAAG,KAAKC,aAAL,CAAmBnP,CAAnB,EAAsB4M,SAAtB,EAAiCqC,OAAjC,CAAhB;;AACAJ,IAAAA,0BAA0B,CAACjC,SAA3B,GAAuC,IAAIC,IAAJ,CAASqC,SAAS,CAAC,CAAD,CAAlB,CAAvC;AACAL,IAAAA,0BAA0B,CAACI,OAA3B,GAAqC,IAAIpC,IAAJ,CAASqC,SAAS,CAAC,CAAD,CAAlB,CAArC;AACA,SAAKxN,cAAL,CAAoB,8BAApB,EAAoD;AAChDD,MAAAA,MAAM,EAAEmN,iBADwC;AAEhDtO,MAAAA,IAAI,EAAEuO,0BAA0B,CAACE,KAA3B,CAAiC;AACnCK,QAAAA,YAAY,EAAE;AADqB,OAAjC,EAEHC,MAFG,EAF0C;AAKhDpN,MAAAA,YAAY,EAAEmG;AALkC,KAApD;AAOH,GAle4D;AAme7D4G,EAAAA,iCAAiC,EAAE,UAAShP,CAAT,EAAYsP,cAAZ,EAA4BC,eAA5B,EAA6C;AAC5E,QAAIb,SAAS,GAAG,KAAKnN,MAAL,CAAY,UAAZ,CAAhB;AACA,QAAIiO,kBAAkB,GAAGd,SAAS,CAACI,wBAAV,CAAmCQ,cAAnC,CAAzB;AACA,QAAI1C,SAAS,GAAG2C,eAAe,CAAC3C,SAAhC;AACA,QAAI6C,mBAAmB,GAAG,CAAC,GAAG3R,WAAW,CAAC4R,sBAAhB,GAA1B;AACA,QAAIvG,cAAc,GAAGqG,kBAAkB,CAACrG,cAAxC;AAAA,QACIwG,iBAAiB,GAAGH,kBAAkB,CAACG,iBAD3C;AAEA,QAAIC,QAAQ,GAAG,KAAK/K,MAAL,CAAY,UAAZ,EAAwByK,cAAxB,CAAf;AACA,QAAIO,WAAW,GAAGJ,mBAAmB,CAACK,qBAApB,CAA0C3G,cAA1C,CAAlB;;AACA,QAAI,CAACnJ,CAAC,CAAC+P,OAAF,CAAUtB,GAAX,IAAkB,CAACoB,WAAnB,IAAkC,CAACD,QAAvC,EAAiD;AAC7ChD,MAAAA,SAAS,GAAG8B,SAAS,CAACsB,kBAAV,CAA6BC,UAA7B,CAAwCT,kBAAkB,CAAC5C,SAA3D,EAAsE;AAC9EsD,QAAAA,mBAAmB,EAAEP,iBADyD;AAE9EQ,QAAAA,IAAI,EAAE;AAFwE,OAAtE,CAAZ;AAIH;;AACD,WAAOvD,SAAP;AACH,GAnf4D;AAof7DuC,EAAAA,aAAa,EAAE,UAASnP,CAAT,EAAY4M,SAAZ,EAAuBqC,OAAvB,EAAgC;AAC3C,QAAIjI,QAAQ,GAAG,KAAKxF,YAAL,CAAkBxB,CAAC,CAACN,OAApB,CAAf;;AACA,QAAI0Q,SAAS,GAAG,KAAKvL,MAAL,CAAY,cAAZ,EAA4B7E,CAA5B,EAA+B,KAAKiI,YAApC,EAAkDjB,QAAlD,CAAhB;AACA,QAAIqJ,0BAA0B,GAAG,KAAKxL,MAAL,CAAY,+BAAZ,CAAjC;AACA,QAAIyL,kBAAkB,GAAG,KAAzB;AACA,QAAIV,QAAQ,GAAG,KAAK/K,MAAL,CAAY,UAAZ,EAAwBmC,QAAxB,CAAf;AACA,QAAIuJ,gBAAgB,GAAG,KAAK1L,MAAL,CAAY,6BAAZ,KAA8C,CAAC+K,QAAtE;AACA,QAAIY,SAAJ;AACA,QAAIC,OAAJ;;AACA,QAAI,eAAeJ,0BAAf,IAA6CT,QAAjD,EAA2D;AACvDU,MAAAA,kBAAkB,GAAG,KAAK/O,MAAL,CAAY,YAAZ,IAA4BvB,CAAC,CAAC+P,OAAF,CAAUW,KAAtC,GAA8C1Q,CAAC,CAAC+P,OAAF,CAAUvB,IAA7E;AACH,KAFD,MAEO;AACH8B,MAAAA,kBAAkB,GAAGtQ,CAAC,CAAC+P,OAAF,CAAUtB,GAA/B;AACH;;AACD,QAAI6B,kBAAJ,EAAwB;AACpBE,MAAAA,SAAS,GAAGD,gBAAgB,GAAG,KAAKI,wBAAL,CAA8B/D,SAA9B,EAAyCwD,SAAzC,CAAH,GAAyDxD,SAAS,CAACgE,OAAV,KAAsBR,SAA3G;AACAI,MAAAA,SAAS,IAAIjS,cAAc,CAACzB,OAAf,CAAuB+T,2BAAvB,CAAmDjE,SAAnD,EAA8DqC,OAA9D,EAAuEuB,SAAvE,EAAkFvB,OAAlF,CAAb;AACAwB,MAAAA,OAAO,GAAGxB,OAAO,CAAC2B,OAAR,EAAV;AACH,KAJD,MAIO;AACHJ,MAAAA,SAAS,GAAG5D,SAAS,CAACgE,OAAV,EAAZ;AACAH,MAAAA,OAAO,GAAGF,gBAAgB,GAAG,KAAKO,sBAAL,CAA4B7B,OAA5B,EAAqCmB,SAArC,CAAH,GAAqDnB,OAAO,CAAC2B,OAAR,KAAoBR,SAAnG;AACAK,MAAAA,OAAO,IAAIlS,cAAc,CAACzB,OAAf,CAAuB+T,2BAAvB,CAAmDjE,SAAnD,EAA8DqC,OAA9D,EAAuErC,SAAvE,EAAkF6D,OAAlF,CAAX;AACH;;AACD,WAAO,CAACD,SAAD,EAAYC,OAAZ,CAAP;AACH,GA5gB4D;AA6gB7DK,EAAAA,sBAAsB,EAAE,UAAS7B,OAAT,EAAkBmB,SAAlB,EAA6B;AACjD,QAAIW,UAAU,GAAG,KAAKlM,MAAL,CAAY,eAAZ,CAAjB;AACA,QAAImM,YAAY,GAAG,KAAKnM,MAAL,CAAY,iBAAZ,CAAnB;AACA,QAAIwC,MAAM,GAAG4H,OAAO,CAAC2B,OAAR,KAAoBR,SAAjC;AACA,QAAIa,kBAAkB,GAAG,CAACF,UAAU,GAAGC,YAAd,IAA8B3R,IAAI,CAAC,MAAD,CAA3D;AACA,QAAI6R,SAAS,GAAGd,SAAS,GAAG,CAAZ,GAAgBe,IAAI,CAACC,IAAL,CAAUhB,SAAS,GAAGa,kBAAtB,CAAhB,GAA4DE,IAAI,CAACE,KAAL,CAAWjB,SAAS,GAAGa,kBAAvB,CAA5E;AACA,QAAIK,OAAO,GAAG,IAAIzE,IAAJ,CAASoC,OAAT,CAAd;AACA,QAAIsC,OAAO,GAAG,IAAI1E,IAAJ,CAASoC,OAAT,CAAd;AACAsC,IAAAA,OAAO,CAACC,QAAR,CAAiBR,YAAjB,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC;AACAM,IAAAA,OAAO,CAACE,QAAR,CAAiBT,UAAjB,EAA6B,CAA7B,EAAgC,CAAhC,EAAmC,CAAnC;;AACA,QAAI1J,MAAM,GAAGiK,OAAO,CAACV,OAAR,EAAT,IAA8BvJ,MAAM,IAAIkK,OAAO,CAACX,OAAR,EAA5C,EAA+D;AAC3D,UAAIa,gBAAgB,GAAGH,OAAO,CAACV,OAAR,KAAoB3B,OAAO,CAAC2B,OAAR,EAA3C;AACA,UAAIc,cAAc,GAAGtB,SAAS,GAAGqB,gBAAjC;AACA,UAAIE,OAAO,GAAG,IAAI9E,IAAJ,CAASoC,OAAO,CAAC2C,OAAR,CAAgB3C,OAAO,CAAC4C,OAAR,KAAoBX,SAApC,CAAT,CAAd;AACAS,MAAAA,OAAO,CAACH,QAAR,CAAiBR,YAAjB,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC;AACA3J,MAAAA,MAAM,GAAGsK,OAAO,CAACf,OAAR,KAAoBc,cAApB,GAAqCT,kBAAkB,IAAIC,SAAS,GAAG,CAAhB,CAAhE;AACH;;AACD,WAAO7J,MAAP;AACH,GA/hB4D;AAgiB7DsJ,EAAAA,wBAAwB,EAAE,UAAS/D,SAAT,EAAoBwD,SAApB,EAA+B;AACrD,QAAIW,UAAU,GAAG,KAAKlM,MAAL,CAAY,eAAZ,CAAjB;AACA,QAAImM,YAAY,GAAG,KAAKnM,MAAL,CAAY,iBAAZ,CAAnB;AACA,QAAIwC,MAAM,GAAGuF,SAAS,CAACgE,OAAV,KAAsBR,SAAnC;AACA,QAAIa,kBAAkB,GAAG,CAACF,UAAU,GAAGC,YAAd,IAA8B3R,IAAI,CAAC,MAAD,CAA3D;AACA,QAAI6R,SAAS,GAAGd,SAAS,GAAG,CAAZ,GAAgBe,IAAI,CAACC,IAAL,CAAUhB,SAAS,GAAGa,kBAAtB,CAAhB,GAA4DE,IAAI,CAACE,KAAL,CAAWjB,SAAS,GAAGa,kBAAvB,CAA5E;AACA,QAAIK,OAAO,GAAG,IAAIzE,IAAJ,CAASD,SAAT,CAAd;AACA,QAAI2E,OAAO,GAAG,IAAI1E,IAAJ,CAASD,SAAT,CAAd;AACA2E,IAAAA,OAAO,CAACC,QAAR,CAAiBR,YAAjB,EAA+B,CAA/B,EAAkC,CAAlC,EAAqC,CAArC;AACAM,IAAAA,OAAO,CAACE,QAAR,CAAiBT,UAAjB,EAA6B,CAA7B,EAAgC,CAAhC,EAAmC,CAAnC;;AACA,QAAI1J,MAAM,GAAGkK,OAAO,CAACX,OAAR,EAAT,IAA8BvJ,MAAM,IAAIiK,OAAO,CAACV,OAAR,EAA5C,EAA+D;AAC3D,UAAIa,gBAAgB,GAAG7E,SAAS,CAACgE,OAAV,KAAsBW,OAAO,CAACX,OAAR,EAA7C;AACA,UAAIc,cAAc,GAAGtB,SAAS,GAAGqB,gBAAjC;AACA,UAAIK,QAAQ,GAAG,IAAIjF,IAAJ,CAASD,SAAS,CAACgF,OAAV,CAAkBhF,SAAS,CAACiF,OAAV,KAAsBX,SAAxC,CAAT,CAAf;AACAY,MAAAA,QAAQ,CAACN,QAAT,CAAkBT,UAAlB,EAA8B,CAA9B,EAAiC,CAAjC,EAAoC,CAApC;AACA1J,MAAAA,MAAM,GAAGyK,QAAQ,CAAClB,OAAT,KAAqBc,cAArB,GAAsCT,kBAAkB,IAAIC,SAAS,GAAG,CAAhB,CAAjE;AACH;;AACD,WAAO7J,MAAP;AACH,GAljB4D;AAmjB7D0K,EAAAA,uBAAuB,EAAE,UAASzN,WAAT,EAAsB;AAC3C,QAAIC,QAAQ,GAAG,CAAC,GAAGxH,SAAS,CAACD,OAAd,EAAuBwH,WAAvB,EAAoChE,IAApC,CAAyC9B,UAAU,CAAC+B,wBAApD,CAAf;;AACA,QAAI,CAACgE,QAAL,EAAe;AACX;AACH;;AACD,WAAO,KAAK0H,oBAAL,CAA0B3H,WAA1B,EAAuCC,QAAQ,CAAC2H,UAAhD,CAAP;AACH,GAzjB4D;AA0jB7DD,EAAAA,oBAAoB,EAAE,UAAShK,YAAT,EAAuBiK,UAAvB,EAAmC;AACrD,QAAI8F,GAAG,GAAG,IAAI1T,SAAS,CAAC2T,QAAd,EAAV;AACA,QAAIC,QAAQ,GAAG,KAAKrN,MAAL,CAAY,qBAAZ,EAAmC;AAC9CmC,MAAAA,QAAQ,EAAE,KAAKxF,YAAL,CAAkBS,YAAlB,CADoC;AAE9CiK,MAAAA,UAAU,EAAEA;AAFkC,KAAnC,CAAf;AAIAgG,IAAAA,QAAQ,CAAChF,IAAT,CAAc,UAASC,KAAT,EAAgB;AAC1B,aAAO6E,GAAG,CAACG,OAAJ,CAAYhF,KAAZ,CAAP;AACH,KAFD;AAGA,WAAO6E,GAAG,CAACI,OAAJ,EAAP;AACH,GApkB4D;AAqkB7DC,EAAAA,qBAAqB,EAAE,YAAW;AAC9B,WAAO,KAAKxN,MAAL,CAAY,gBAAZ,CAAP;AACH,GAvkB4D;AAwkB7DuC,EAAAA,oBAAoB,EAAE,EAxkBuC;AAykB7DgF,EAAAA,0BAA0B,EAAE,UAASkG,kBAAT,EAA6BrQ,YAA7B,EAA2CyG,eAA3C,EAA4DyE,KAA5D,EAAmE;AAC3F,QAAIoF,kBAAkB,GAAGD,kBAAkB,CAACnG,OAA5C;AACA,QAAIqG,iBAAiB,GAAGD,kBAAkB,CAAClS,KAA3C;;AACA,QAAI,CAAC,CAAC,GAAG7C,KAAK,CAACkH,SAAV,EAAqB,KAAK0C,oBAAL,CAA0BoL,iBAA1B,CAArB,CAAL,EAAyE;AACrE,WAAKpL,oBAAL,CAA0BoL,iBAA1B,IAA+C;AAC3CjE,QAAAA,WAAW,EAAE;AACTE,UAAAA,GAAG,EAAE8D,kBAAkB,CAAC9D,GADf;AAETD,UAAAA,IAAI,EAAE+D,kBAAkB,CAAC/D;AAFhB,SAD8B;AAK3CiE,QAAAA,KAAK,EAAE;AACHnS,UAAAA,IAAI,EAAE,EADH;AAEHoS,UAAAA,MAAM,EAAE,EAFL;AAGHnO,UAAAA,QAAQ,EAAE;AAHP,SALoC;AAU3CqL,QAAAA,QAAQ,EAAE2C,kBAAkB,CAAC3C,QAAnB,GAA8B,IAA9B,GAAqC,KAVJ;AAW3C+C,QAAAA,WAAW,EAAExF;AAX8B,OAA/C;AAaH;;AACDmF,IAAAA,kBAAkB,CAACzJ,uBAAnB,GAA6C,KAAKhE,MAAL,CAAY,4BAAZ,EAA0C6D,eAA1C,EAA2DzG,YAA3D,CAA7C;;AACA,SAAKmF,oBAAL,CAA0BoL,iBAA1B,EAA6CC,KAA7C,CAAmDlO,QAAnD,CAA4DkD,IAA5D,CAAiE6K,kBAAjE;;AACA,SAAKlL,oBAAL,CAA0BoL,iBAA1B,EAA6CC,KAA7C,CAAmDnS,IAAnD,CAAwDmH,IAAxD,CAA6DiB,eAA7D;;AACA,SAAKtB,oBAAL,CAA0BoL,iBAA1B,EAA6CC,KAA7C,CAAmDC,MAAnD,CAA0DjL,IAA1D,CAA+D0F,KAA/D;;AACAlL,IAAAA,YAAY,CAACkF,MAAb;AACH,GAhmB4D;AAimB7DyL,EAAAA,kBAAkB,EAAE,YAAW;AAC3B,SAAKhT,QAAL;;AACA,SAAKsE,2BAAL;AACH,GApmB4D;AAqmB7DA,EAAAA,2BAA2B,EAAE,YAAW;AACpC,QAAI2O,MAAM,GAAG,IAAb;;AACA,SAAKhN,kBAAL,CAAwB,UAASC,eAAT,EAA0BC,eAA1B,EAA2C;AAC/D,OAAC,GAAGtI,SAAS,CAACwJ,IAAd,EAAoB4L,MAAM,CAACzL,oBAA3B,EAAiD,UAAS8E,UAAT,EAAqB;AAClE,YAAI4G,YAAY,GAAG,KAAK1L,oBAAL,CAA0B8E,UAA1B,CAAnB;AACA,YAAI6G,YAAY,GAAGD,YAAY,CAACL,KAAhC;AACA,YAAIO,kBAAkB,GAAGF,YAAY,CAACvE,WAAtC;AACA,YAAI0E,SAAS,GAAGH,YAAY,CAAClD,QAAb,GAAwB7J,eAAxB,GAA0CD,eAA1D;AACA,YAAI0I,IAAI,GAAGwE,kBAAkB,CAACxE,IAA9B;AACA,YAAI0E,WAAW,GAAG,KAAKrO,MAAL,CAAY,6BAAZ,EAA2CiO,YAAY,CAAClD,QAAxD,CAAlB;AACA,YAAIuD,YAAY,GAAG,KAAKtO,MAAL,CAAY,8BAAZ,CAAnB;AACA,YAAIuO,SAAS,GAAG,KAAK7R,MAAL,CAAY,YAAZ,IAA4B2R,WAA5B,GAA0C,CAA1D;AACA,aAAKxR,cAAL,CAAoB,2BAApB,EAAiD;AAC7CiG,UAAAA,UAAU,EAAEsL,SADiC;AAE7C1E,UAAAA,WAAW,EAAE;AACTE,YAAAA,GAAG,EAAEuE,kBAAkB,CAACvE,GADf;AAETD,YAAAA,IAAI,EAAEA,IAAI,GAAG4E;AAFJ,WAFgC;AAM7CX,UAAAA,KAAK,EAAEM,YANsC;AAO7CJ,UAAAA,WAAW,EAAEG,YAAY,CAACH,WAPmB;AAQ7C3E,UAAAA,KAAK,EAAEkF,WAAW,GAAG,KAAK3R,MAAL,CAAY,kBAAZ,CARwB;AAS7C0M,UAAAA,MAAM,EAAEkF,YATqC;AAU7CE,UAAAA,kBAAkB,EAAE,KAAK9R,MAAL,CAAY,aAAZ,CAVyB;AAW7C+B,UAAAA,SAAS,EAAE,KAAK/B,MAAL,CAAY,WAAZ,CAXkC;AAY7CuL,UAAAA,SAAS,EAAE,KAAKjI,MAAL,CAAY,cAAZ,CAZkC;AAa7C8H,UAAAA,SAAS,EAAE,KAAK9H,MAAL,CAAY,YAAZ,KAA6B,KAAKyO,eAAL,CAAqBR,YAArB,CAbK;AAc7CS,UAAAA,WAAW,EAAE,CAACT,YAAY,CAAClD,QAAd,IAA0B,KAAK/K,MAAL,CAAY,iCAAZ;AAdM,SAAjD;AAgBH,OAzBgD,CAyB/CxD,IAzB+C,CAyB1CwR,MAzB0C,CAAjD;AA0BH,KA3BD;AA4BH,GAnoB4D;AAooB7DS,EAAAA,eAAe,EAAE,UAASR,YAAT,EAAuB;AACpC,WAAO,CAACA,YAAY,CAAClD,QAAd,IAA0B,KAAK/K,MAAL,CAAY,oCAAZ,CAAjC;AACH,GAtoB4D;AAuoB7D2O,EAAAA,4BAA4B,EAAE,UAASvT,YAAT,EAAuB;AACjDA,IAAAA,YAAY,CAACwT,IAAb,CAAkB,UAASC,CAAT,EAAYC,CAAZ,EAAe;AAC7B,UAAItM,MAAM,GAAG,CAAb;AACA,UAAIuM,SAAS,GAAG,IAAI/G,IAAJ,CAAS,KAAKhI,MAAL,CAAY,UAAZ,EAAwB,WAAxB,EAAqC6O,CAAC,CAACnP,QAAF,IAAcmP,CAAnD,CAAT,EAAgE9C,OAAhE,EAAhB;AACA,UAAIiD,UAAU,GAAG,IAAIhH,IAAJ,CAAS,KAAKhI,MAAL,CAAY,UAAZ,EAAwB,WAAxB,EAAqC8O,CAAC,CAACpP,QAAF,IAAcoP,CAAnD,CAAT,EAAgE/C,OAAhE,EAAjB;;AACA,UAAIgD,SAAS,GAAGC,UAAhB,EAA4B;AACxBxM,QAAAA,MAAM,GAAG,CAAC,CAAV;AACH;;AACD,UAAIuM,SAAS,GAAGC,UAAhB,EAA4B;AACxBxM,QAAAA,MAAM,GAAG,CAAT;AACH;;AACD,aAAOA,MAAP;AACH,KAXiB,CAWhBhG,IAXgB,CAWX,IAXW,CAAlB;AAYH,GAppB4D;AAqpB7DyS,EAAAA,6BAA6B,EAAE,UAASxP,WAAT,EAAsBjE,KAAtB,EAA6B0T,oBAA7B,EAAmD;AAC9E,QAAI5K,cAAc,GAAG,KAAKtE,MAAL,CAAY,UAAZ,EAAwB,gBAAxB,EAA0CP,WAA1C,CAArB;AACA,QAAI+C,MAAM,GAAG;AACT2M,MAAAA,KAAK,EAAE,EADE;AAETC,MAAAA,OAAO,EAAE;AAFA,KAAb;;AAIA,QAAI9K,cAAJ,EAAoB;AAChB,UAAI+K,KAAK,GAAG5P,WAAW,CAACC,QAAZ,IAAwBD,WAApC;AACA,UAAIsI,SAAS,GAAG,IAAIC,IAAJ,CAAS,KAAKhI,MAAL,CAAY,UAAZ,EAAwB,WAAxB,EAAqCqP,KAArC,CAAT,CAAhB;AACA,UAAIjF,OAAO,GAAG,IAAIpC,IAAJ,CAAS,KAAKhI,MAAL,CAAY,UAAZ,EAAwB,SAAxB,EAAmCqP,KAAnC,CAAT,CAAd;AACA,UAAIC,mBAAmB,GAAGlF,OAAO,CAAC2B,OAAR,KAAoBhE,SAAS,CAACgE,OAAV,EAA9C;AACA,UAAIwD,mBAAmB,GAAG,KAAKvP,MAAL,CAAY,UAAZ,EAAwB,qBAAxB,EAA+CP,WAA/C,CAA1B;AACA,UAAI+P,aAAa,GAAG,KAAKxP,MAAL,CAAY,kBAAZ,CAApB;AACA,UAAIyP,WAAW,GAAG,KAAKzP,MAAL,CAAY,gBAAZ,CAAlB;AACA,UAAI0P,cAAc,GAAG,CAAC,GAAGzW,WAAW,CAAC4R,sBAAhB,IAA0C8E,aAA1C,CAAwD;AACzEC,QAAAA,IAAI,EAAEtL,cADmE;AAEzEuL,QAAAA,SAAS,EAAEN,mBAF8D;AAGzEO,QAAAA,KAAK,EAAE/H,SAHkE;AAIzEgI,QAAAA,GAAG,EAAE3F,OAJoE;AAKzE4F,QAAAA,GAAG,EAAER,aALoE;AAMzES,QAAAA,GAAG,EAAER;AANoE,OAAxD,CAArB;AAQA,UAAIS,kBAAkB,GAAGzQ,WAAW,CAACC,QAAZ,GAAuB,CAAvB,GAA2BgQ,cAAc,CAAC7T,MAAnE;;AACA,WAAK,IAAIoE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGiQ,kBAApB,EAAwCjQ,CAAC,EAAzC,EAA6C;AACzC,YAAIkQ,eAAe,GAAG,CAAC,GAAGpX,OAAO,CAACqD,MAAZ,EAAoB,EAApB,EAAwBqD,WAAxB,EAAqC,IAArC,CAAtB;;AACA,YAAIiQ,cAAc,CAACzP,CAAD,CAAlB,EAAuB;AACnB,cAAImQ,mBAAmB,GAAG,KAAKC,oBAAL,CAA0BX,cAAc,CAACzP,CAAD,CAAxC,EAA6C,EAA7C,CAA1B;;AACA,eAAKqQ,kBAAL,CAAwB,IAAItI,IAAJ,CAAS0H,cAAc,CAACzP,CAAD,CAAd,CAAkB8L,OAAlB,KAA8BuD,mBAAvC,CAAxB,EAAqFc,mBAArF;;AACAD,UAAAA,eAAe,CAACzQ,QAAhB,GAA2B0Q,mBAA3B;AACH,SAJD,MAIO;AACHD,UAAAA,eAAe,CAACzQ,QAAhB,GAA2B2P,KAA3B;AACH;;AACD7M,QAAAA,MAAM,CAAC2M,KAAP,CAAavM,IAAb,CAAkBuN,eAAlB;;AACA,YAAI,CAACjB,oBAAL,EAA2B;AACvB,eAAKqB,uBAAL,CAA6BJ,eAA7B,EAA8C3N,MAA9C;AACH;AACJ;;AACDA,MAAAA,MAAM,CAAC4M,OAAP,CAAexM,IAAf,CAAoBpH,KAApB;AACH;;AACD,WAAOgH,MAAP;AACH,GA7rB4D;AA8rB7D+N,EAAAA,uBAAuB,EAAE,UAAS9Q,WAAT,EAAsB+C,MAAtB,EAA8B;AACnD,QAAI2M,KAAK,GAAG,KAAKqB,qBAAL,CAA2B/Q,WAA3B,CAAZ;AACA,QAAIgR,SAAS,GAAGtB,KAAK,CAACtT,MAAtB;AACA,QAAI4T,WAAW,GAAG,KAAKzP,MAAL,CAAY,gBAAZ,EAA8B+L,OAA9B,EAAlB;AACA,QAAIyD,aAAa,GAAG,KAAKxP,MAAL,CAAY,kBAAZ,EAAgC+L,OAAhC,EAApB;AACA,QAAIZ,kBAAkB,GAAG,KAAKnL,MAAL,CAAY,uBAAZ,CAAzB;AACAwC,IAAAA,MAAM,GAAGA,MAAM,IAAI;AACf2M,MAAAA,KAAK,EAAE;AADQ,KAAnB;;AAGA,QAAIsB,SAAS,GAAG,CAAhB,EAAmB;AACf,OAAC,GAAG1X,OAAO,CAACqD,MAAZ,EAAoBqD,WAApB,EAAiC0P,KAAK,CAAC,CAAD,CAAtC;;AACA,WAAK,IAAIlP,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwQ,SAApB,EAA+BxQ,CAAC,EAAhC,EAAoC;AAChC,YAAI8H,SAAS,GAAG,KAAK/H,MAAL,CAAY,UAAZ,EAAwB,WAAxB,EAAqCmP,KAAK,CAAClP,CAAD,CAAL,CAASP,QAA9C,EAAwDqM,OAAxD,EAAhB;AACAhE,QAAAA,SAAS,GAAGoD,kBAAkB,CAACC,UAAnB,CAA8BrD,SAA9B,EAAyC;AACjDuD,UAAAA,IAAI,EAAE;AAD2C,SAAzC,CAAZ;;AAGA,YAAIvD,SAAS,GAAG0H,WAAZ,IAA2B1H,SAAS,GAAGyH,aAA3C,EAA0D;AACtDhN,UAAAA,MAAM,CAAC2M,KAAP,CAAavM,IAAb,CAAkBuM,KAAK,CAAClP,CAAD,CAAvB;AACH;AACJ;AACJ;;AACD,WAAOuC,MAAP;AACH,GAptB4D;AAqtB7DkO,EAAAA,6BAA6B,EAAE,UAASC,iBAAT,EAA4BvV,YAA5B,EAA0C;AACrE,KAAC,GAAGxC,SAAS,CAACwJ,IAAd,EAAoBuO,iBAApB,EAAuC,UAAS1Q,CAAT,EAAYzE,KAAZ,EAAmB;AACtDJ,MAAAA,YAAY,CAACwV,MAAb,CAAoBpV,KAAK,GAAGyE,CAA5B,EAA+B,CAA/B;AACH,KAFD;AAGH,GAztB4D;AA0tB7D4Q,EAAAA,oBAAoB,EAAE,UAASzV,YAAT,EAAuB0V,sBAAvB,EAA+C;AACjE,QAAIA,sBAAsB,CAACjV,MAA3B,EAAmC;AAC/B,OAAC,GAAG/C,MAAM,CAACiY,KAAX,EAAkB3V,YAAlB,EAAgC0V,sBAAhC;AACH;;AACD,SAAKnC,4BAAL,CAAkCvT,YAAlC;AACH,GA/tB4D;AAguB7DiV,EAAAA,oBAAoB,EAAE,UAAStI,SAAT,EAAoBnO,GAApB,EAAyB;AAC3C,SAAKoG,MAAL,CAAY,UAAZ,EAAwB,WAAxB,EAAqCpG,GAArC,EAA0CmO,SAA1C;AACA,WAAOnO,GAAP;AACH,GAnuB4D;AAouB7D0W,EAAAA,kBAAkB,EAAE,UAASlG,OAAT,EAAkBxQ,GAAlB,EAAuB;AACvC,SAAKoG,MAAL,CAAY,UAAZ,EAAwB,SAAxB,EAAmCpG,GAAnC,EAAwCwQ,OAAxC;AACA,WAAOxQ,GAAP;AACH,GAvuB4D;AAwuB7D0C,EAAAA,mBAAmB,EAAE,UAAS0U,SAAT,EAAoB;AACrC,QAAI5T,YAAY,GAAG,KAAKS,oBAAxB;AACA,QAAIoT,IAAI,GAAG,KAAK7N,YAAhB;AACA,QAAI8N,MAAM,GAAG,KAAK7N,mBAAlB;;AACA,QAAI2N,SAAJ,EAAe;AACX,WAAKG,4CAAL;;AACA,UAAI,CAAC,GAAGxY,KAAK,CAACyY,UAAV,EAAsBJ,SAAS,CAACzH,MAAhC,CAAJ,EAA6C;AACzCyH,QAAAA,SAAS,CAACzH,MAAV,CAAiB+D,OAAjB,CAAyB,IAAzB;AACH,OAFD,MAEO;AACH0D,QAAAA,SAAS,CAACzH,MAAV,GAAmB,IAAnB;AACH;AACJ;;AACD,QAAInM,YAAY,IAAI,CAAC4T,SAArB,EAAgC;AAC5B,UAAIE,MAAJ,EAAY;AACR,SAAC,GAAG1Y,WAAW,CAAC6Y,IAAhB,EAAsBjU,YAAtB,EAAoC8T,MAApC;AACA,eAAO,KAAK9N,YAAZ;AACH;;AACD,UAAI6N,IAAJ,EAAU;AACN7T,QAAAA,YAAY,CAACkU,UAAb,CAAwBL,IAAI,CAAC9H,KAA7B;AACA/L,QAAAA,YAAY,CAACmU,WAAb,CAAyBN,IAAI,CAAC7H,MAA9B;AACA,eAAO,KAAK/F,mBAAZ;AACH;AACJ;AACJ,GA/vB4D;AAgwB7DmO,EAAAA,KAAK,EAAE,YAAW;AACd,QAAI,KAAK3T,oBAAT,EAA+B;AAC3B,UAAI4T,cAAc,GAAG,CAAC,GAAGzY,QAAQ,CAAC8E,gBAAb,EAA+B,KAAKD,oBAApC,CAArB;AACA,WAAKnB,MAAL,CAAY,gBAAZ,EAA8B+U,cAA9B;;AACAnZ,MAAAA,cAAc,CAACL,OAAf,CAAuBkE,OAAvB,CAA+BsV,cAA/B,EAA+C,OAA/C;AACH;AACJ,GAtwB4D;AAuwB7DjB,EAAAA,qBAAqB,EAAE,UAAS/Q,WAAT,EAAsB;AACzC,QAAI4P,KAAK,GAAG5P,WAAW,CAACC,QAAZ,IAAwBD,WAApC;AACA,QAAIiS,iBAAiB,GAAG,IAAI1J,IAAJ,CAAS,KAAKhI,MAAL,CAAY,UAAZ,EAAwB,WAAxB,EAAqCqP,KAArC,CAAT,CAAxB;;AACA,QAAItH,SAAS,GAAGtP,KAAK,CAACR,OAAN,CAAc0Z,QAAd,CAAuBD,iBAAvB,CAAhB;;AACA,QAAItH,OAAO,GAAG3R,KAAK,CAACR,OAAN,CAAc0Z,QAAd,CAAuB,KAAK3R,MAAL,CAAY,UAAZ,EAAwB,SAAxB,EAAmCqP,KAAnC,CAAvB,CAAd;;AACA,QAAIuC,cAAc,GAAG,KAAK5R,MAAL,CAAY,gBAAZ,CAArB;AACA,QAAImM,YAAY,GAAG,KAAKnM,MAAL,CAAY,iBAAZ,CAAnB;AACA,QAAIkM,UAAU,GAAG,KAAKlM,MAAL,CAAY,eAAZ,CAAjB;AACA,QAAI6R,iBAAiB,GAAG,KAAK7R,MAAL,CAAY,6BAAZ,EAA2CP,WAA3C,CAAxB;AACA,QAAI+C,MAAM,GAAG,EAAb;AACA,QAAI2I,kBAAkB,GAAG,KAAKnL,MAAL,CAAY,uBAAZ,CAAzB;AACA+H,IAAAA,SAAS,GAAGoD,kBAAkB,CAACC,UAAnB,CAA8BrD,SAA9B,EAAyC;AACjDuD,MAAAA,IAAI,EAAE;AAD2C,KAAzC,CAAZ;AAGAlB,IAAAA,OAAO,GAAGe,kBAAkB,CAACC,UAAnB,CAA8BhB,OAA9B,EAAuC;AAC7CkB,MAAAA,IAAI,EAAE;AADuC,KAAvC,CAAV;;AAGA,QAAIvD,SAAS,CAAC+J,QAAV,MAAwB5F,UAAxB,IAAsCnE,SAAS,CAAC+J,QAAV,MAAwB3F,YAA9D,IAA8E,CAAC0F,iBAAnF,EAAsG;AAClGrP,MAAAA,MAAM,CAACI,IAAP,CAAY,KAAKyN,oBAAL,CAA0B,IAAIrI,IAAJ,CAASD,SAAT,CAA1B,EAA+C;AACvDlE,QAAAA,eAAe,EAAEpE;AADsC,OAA/C,CAAZ;AAGAsI,MAAAA,SAAS,CAACgF,OAAV,CAAkBhF,SAAS,CAACiF,OAAV,KAAsB,CAAxC;AACH;;AACD,WAAO6E,iBAAiB,IAAI9J,SAAS,CAACgE,OAAV,KAAsB3B,OAAO,CAAC2B,OAAR,EAA3C,IAAgEhE,SAAS,GAAG6J,cAAnF,EAAmG;AAC/F,UAAIG,gBAAgB,GAAG,IAAI/J,IAAJ,CAASD,SAAT,CAAvB;AACA,UAAIiK,cAAc,GAAG,IAAIhK,IAAJ,CAASD,SAAT,CAArB;;AACA,WAAKkK,eAAL,CAAqBF,gBAArB,EAAuCL,iBAAvC,EAA0DvF,YAA1D;;AACA,WAAK+F,aAAL,CAAmBF,cAAnB,EAAmC5H,OAAnC,EAA4C8B,UAA5C;;AACA,UAAIrI,eAAe,GAAG,CAAC,GAAGhL,OAAO,CAACsZ,mBAAZ,EAAiC,EAAjC,EAAqC1S,WAArC,EAAkD,IAAlD,CAAtB;AACA,UAAI2Q,mBAAmB,GAAG,EAA1B;;AACA,WAAKC,oBAAL,CAA0B0B,gBAA1B,EAA4C3B,mBAA5C;;AACA,WAAKE,kBAAL,CAAwB0B,cAAxB,EAAwC5B,mBAAxC;;AACAvM,MAAAA,eAAe,CAACnE,QAAhB,GAA2B0Q,mBAA3B;AACA5N,MAAAA,MAAM,CAACI,IAAP,CAAYiB,eAAZ;AACAkE,MAAAA,SAAS,GAAGtP,KAAK,CAACR,OAAN,CAAcma,QAAd,CAAuBrK,SAAvB,CAAZ;AACAA,MAAAA,SAAS,CAACgF,OAAV,CAAkBhF,SAAS,CAACiF,OAAV,KAAsB,CAAxC;AACAjF,MAAAA,SAAS,CAAC4E,QAAV,CAAmBR,YAAnB;AACH;;AACD,WAAO3J,MAAP;AACH,GA9yB4D;AA+yB7DyP,EAAAA,eAAe,EAAE,UAASI,WAAT,EAAsBC,YAAtB,EAAoCnG,YAApC,EAAkD;AAC/D,QAAI,CAAC1T,KAAK,CAACR,OAAN,CAAcsa,QAAd,CAAuBF,WAAvB,EAAoCC,YAApC,CAAD,IAAsDD,WAAW,CAACP,QAAZ,MAA0B3F,YAApF,EAAkG;AAC9FkG,MAAAA,WAAW,CAAC1F,QAAZ,CAAqBR,YAArB,EAAmC,CAAnC,EAAsC,CAAtC,EAAyC,CAAzC;AACH,KAFD,MAEO;AACHkG,MAAAA,WAAW,CAAC1F,QAAZ,CAAqB2F,YAAY,CAACR,QAAb,EAArB,EAA8CQ,YAAY,CAACE,UAAb,EAA9C,EAAyEF,YAAY,CAACG,UAAb,EAAzE,EAAoGH,YAAY,CAACI,eAAb,EAApG;AACH;AACJ,GArzB4D;AAszB7DR,EAAAA,aAAa,EAAE,UAASG,WAAT,EAAsBC,YAAtB,EAAoCpG,UAApC,EAAgD;AAC3D,QAAI,CAACzT,KAAK,CAACR,OAAN,CAAcsa,QAAd,CAAuBF,WAAvB,EAAoCC,YAApC,CAAD,IAAsDD,WAAW,CAACP,QAAZ,KAAyB5F,UAAnF,EAA+F;AAC3FmG,MAAAA,WAAW,CAAC1F,QAAZ,CAAqBT,UAArB,EAAiC,CAAjC,EAAoC,CAApC,EAAuC,CAAvC;AACH,KAFD,MAEO;AACHmG,MAAAA,WAAW,CAAC1F,QAAZ,CAAqB2F,YAAY,CAACR,QAAb,EAArB,EAA8CQ,YAAY,CAACE,UAAb,EAA9C,EAAyEF,YAAY,CAACG,UAAb,EAAzE,EAAoGH,YAAY,CAACI,eAAb,EAApG;AACH;AACJ,GA5zB4D;AA6zB7DvB,EAAAA,4CAA4C,EAAE,YAAW;AACrD,QAAIwB,aAAa,GAAG,KAAKzV,aAAL,GAAqB3B,MAArB,CAA4B,IAAIqX,MAAJ,CAAWjZ,UAAU,CAACkZ,6BAAtB,CAA5B,CAApB;;AACAF,IAAAA,aAAa,CAACvQ,IAAd,CAAmB,UAASrF,CAAT,EAAYlC,OAAZ,EAAqB;AACpC,UAAIiY,mBAAmB,GAAG,CAAC,GAAG5a,SAAS,CAACD,OAAd,EAAuB4C,OAAvB,EAAgCkY,sBAAhC,CAAuD,UAAvD,CAA1B;AACAD,MAAAA,mBAAmB,CAACpW,MAApB,CAA2B,cAA3B,EAA2C,KAA3C;AACH,KAHD;AAIH,GAn0B4D;AAo0B7DsW,EAAAA,yBAAyB,EAAE,UAASvT,WAAT,EAAsBC,QAAtB,EAAgC;AACvD,QAAIiT,aAAa,GAAG,KAAKzQ,sBAAL,CAA4BzC,WAA5B,CAApB;;AACA,QAAIwT,qBAAqB,GAAGvT,QAAQ,CAAC8H,IAAT,CAAcuC,iBAA1C;AAAA,QACIhC,SAAS,GAAGkL,qBAAqB,CAAClL,SADtC;AAAA,QAEIqC,OAAO,GAAG6I,qBAAqB,CAAC7I,OAFpC;AAGA,QAAI/C,UAAU,GAAG3H,QAAQ,CAAC2H,UAA1B;AACAsL,IAAAA,aAAa,CAACtR,OAAd,CAAsB,UAASrE,KAAT,EAAgB;AAClC,UAAIkW,WAAW,GAAGlW,KAAK,CAACvB,IAAN,CAAW9B,UAAU,CAAC+B,wBAAtB,CAAlB;AAAA,UACIyX,QAAQ,GAAGD,WAAW,CAAC1L,IAD3B;AAAA,UAEI4L,cAAc,GAAGF,WAAW,CAAC7L,UAFjC;;AAGA,UAAIgM,qBAAqB,GAAGF,QAAQ,CAACpJ,iBAArC;AAAA,UACIuJ,aAAa,GAAGD,qBAAqB,CAACtL,SAD1C;AAAA,UAEIwL,WAAW,GAAGF,qBAAqB,CAACjJ,OAFxC;AAGA,UAAI0I,mBAAmB,GAAG9V,KAAK,CAAC+V,sBAAN,CAA6B,UAA7B,CAA1B;AACA,UAAIS,YAAY,GAAGzL,SAAS,CAACgE,OAAV,OAAwBuH,aAAa,CAACvH,OAAd,EAAxB,IAAmD3B,OAAO,CAAC2B,OAAR,OAAsBwH,WAAW,CAACxH,OAAZ,EAAzE,IAAkG1E,UAAU,KAAK+L,cAApI;AACAN,MAAAA,mBAAmB,CAACpW,MAApB,CAA2B,cAA3B,EAA2C8W,YAA3C;AACH,KAVD;AAWH;AAr1B4D,CAArC,EAs1BzBC,OAt1ByB,CAs1BjBta,YAAY,CAAClB,OAt1BI,CAA5B;;AAu1BA,CAAC,GAAGiB,sBAAsB,CAACjB,OAA3B,EAAoC,yBAApC,EAA+DyC,qBAA/D;AACA,IAAIgZ,QAAQ,GAAGhZ,qBAAf;AACA1C,OAAO,CAACC,OAAR,GAAkByb,QAAlB;AACAC,MAAM,CAAC3b,OAAP,GAAiBA,OAAO,CAACC,OAAzB","sourcesContent":["/**\r\n * DevExtreme (ui/scheduler/ui.scheduler.appointments.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\r\nvar _dom_adapter = _interopRequireDefault(require(\"../../core/dom_adapter\"));\r\nvar _events_engine = _interopRequireDefault(require(\"../../events/core/events_engine\"));\r\nvar _element_data = require(\"../../core/element_data\");\r\nvar _translator = require(\"../../animation/translator\");\r\nvar _date = _interopRequireDefault(require(\"../../core/utils/date\"));\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _object = require(\"../../core/utils/object\");\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _element = require(\"../../core/element\");\r\nvar _recurrence = require(\"./recurrence\");\r\nvar _component_registrator = _interopRequireDefault(require(\"../../core/component_registrator\"));\r\nvar _uiScheduler = _interopRequireDefault(require(\"./ui.scheduler.publisher_mixin\"));\r\nvar _uiScheduler2 = _interopRequireDefault(require(\"./ui.scheduler.appointment\"));\r\nvar _index = require(\"../../events/utils/index\");\r\nvar _double_click = require(\"../../events/double_click\");\r\nvar _message = _interopRequireDefault(require(\"../../localization/message\"));\r\nvar _uiCollection_widget = _interopRequireDefault(require(\"../collection/ui.collection_widget.edit\"));\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _utilsTimeZone = _interopRequireDefault(require(\"./utils.timeZone.js\"));\r\nvar _constants = require(\"./constants\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar COMPONENT_CLASS = \"dx-scheduler-scrollable-appointments\";\r\nvar APPOINTMENT_ITEM_CLASS = \"dx-scheduler-appointment\";\r\nvar APPOINTMENT_TITLE_CLASS = \"dx-scheduler-appointment-title\";\r\nvar APPOINTMENT_CONTENT_DETAILS_CLASS = \"dx-scheduler-appointment-content-details\";\r\nvar APPOINTMENT_DATE_CLASS = \"dx-scheduler-appointment-content-date\";\r\nvar RECURRING_ICON_CLASS = \"dx-scheduler-appointment-recurrence-icon\";\r\nvar ALL_DAY_CONTENT_CLASS = \"dx-scheduler-appointment-content-allday\";\r\nvar DBLCLICK_EVENT_NAME = (0, _index.addNamespace)(_double_click.name, \"dxSchedulerAppointment\");\r\nvar toMs = _date.default.dateToMilliseconds;\r\nvar SchedulerAppointments = _uiCollection_widget.default.inherit({\r\n    ctor: function(element, options) {\r\n        this.callBase(element, options)\r\n    },\r\n    _supportedKeys: function() {\r\n        var parent = this.callBase();\r\n        var tabHandler = function(e) {\r\n            var appointments = this._getAccessAppointments();\r\n            var focusedAppointment = appointments.filter(\".dx-state-focused\");\r\n            var index = focusedAppointment.data(_constants.APPOINTMENT_SETTINGS_KEY).sortedIndex;\r\n            var lastIndex = appointments.length - 1;\r\n            if (index > 0 && e.shiftKey || index < lastIndex && !e.shiftKey) {\r\n                e.preventDefault();\r\n                e.shiftKey ? index-- : index++;\r\n                var $nextAppointment = this._getAppointmentByIndex(index);\r\n                this._resetTabIndex($nextAppointment);\r\n                _events_engine.default.trigger($nextAppointment, \"focus\")\r\n            }\r\n        };\r\n        return (0, _extend.extend)(parent, {\r\n            escape: function() {\r\n                this.moveAppointmentBack();\r\n                this._escPressed = true\r\n            }.bind(this),\r\n            del: function(e) {\r\n                if (this.option(\"allowDelete\")) {\r\n                    e.preventDefault();\r\n                    var data = this._getItemData(e.target);\r\n                    this.notifyObserver(\"onDeleteButtonPress\", {\r\n                        data: data,\r\n                        target: e.target\r\n                    })\r\n                }\r\n            }.bind(this),\r\n            tab: tabHandler\r\n        })\r\n    },\r\n    _getAppointmentByIndex: function(sortedIndex) {\r\n        var appointments = this._getAccessAppointments();\r\n        return appointments.filter(function(_, $item) {\r\n            return (0, _element_data.data)($item, _constants.APPOINTMENT_SETTINGS_KEY).sortedIndex === sortedIndex\r\n        }).eq(0)\r\n    },\r\n    _getAccessAppointments: function() {\r\n        return this._itemElements().filter(\":visible\").not(\".dx-state-disabled\")\r\n    },\r\n    _resetTabIndex: function($appointment) {\r\n        this._focusTarget().attr(\"tabIndex\", -1);\r\n        $appointment.attr(\"tabIndex\", this.option(\"tabIndex\"))\r\n    },\r\n    _moveFocus: _common.noop,\r\n    _focusTarget: function() {\r\n        return this._itemElements()\r\n    },\r\n    _renderFocusTarget: function() {\r\n        var $appointment = this._getAppointmentByIndex(0);\r\n        this._resetTabIndex($appointment)\r\n    },\r\n    _focusInHandler: function(e) {\r\n        this.callBase.apply(this, arguments);\r\n        this._$currentAppointment = (0, _renderer.default)(e.target);\r\n        this.option(\"focusedElement\", (0, _element.getPublicElement)((0, _renderer.default)(e.target)))\r\n    },\r\n    _focusOutHandler: function() {\r\n        var $appointment = this._getAppointmentByIndex(0);\r\n        this.option(\"focusedElement\", (0, _element.getPublicElement)($appointment));\r\n        this.callBase.apply(this, arguments)\r\n    },\r\n    _eventBindingTarget: function() {\r\n        return this._itemContainer()\r\n    },\r\n    _getDefaultOptions: function() {\r\n        return (0, _extend.extend)(this.callBase(), {\r\n            noDataText: null,\r\n            activeStateEnabled: true,\r\n            hoverStateEnabled: true,\r\n            tabIndex: 0,\r\n            fixedContainer: null,\r\n            allDayContainer: null,\r\n            allowDrag: true,\r\n            allowResize: true,\r\n            allowAllDayResize: true,\r\n            onAppointmentDblClick: null,\r\n            _collectorOffset: 0\r\n        })\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"items\":\r\n                this._cleanFocusState();\r\n                this._clearDropDownItems();\r\n                this._clearDropDownItemsElements();\r\n                this._repaintAppointments(args.value);\r\n                this._renderDropDownAppointments();\r\n                this._attachAppointmentsEvents();\r\n                break;\r\n            case \"fixedContainer\":\r\n            case \"allDayContainer\":\r\n            case \"onAppointmentDblClick\":\r\n                break;\r\n            case \"allowDrag\":\r\n            case \"allowResize\":\r\n            case \"allowAllDayResize\":\r\n                this._invalidate();\r\n                break;\r\n            case \"focusedElement\":\r\n                this._resetTabIndex((0, _renderer.default)(args.value));\r\n                this.callBase(args);\r\n                break;\r\n            case \"allowDelete\":\r\n                break;\r\n            case \"focusStateEnabled\":\r\n                this._clearDropDownItemsElements();\r\n                this._renderDropDownAppointments();\r\n                this.callBase(args);\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    _isAllDayAppointment: function(appointment) {\r\n        return appointment.settings.length && appointment.settings[0].allDay || false\r\n    },\r\n    _isRepaintAppointment: function(appointment) {\r\n        return !(0, _type.isDefined)(appointment.needRepaint) || true === appointment.needRepaint\r\n    },\r\n    _isRepaintAll: function(appointments) {\r\n        if (this.invoke(\"isVirtualScrolling\")) {\r\n            return true\r\n        }\r\n        if (this.invoke(\"isCurrentViewAgenda\")) {\r\n            return true\r\n        }\r\n        for (var i = 0; i < appointments.length; i++) {\r\n            var appointment = appointments[i];\r\n            if (!this._isRepaintAppointment(appointment)) {\r\n                return false\r\n            }\r\n        }\r\n        return true\r\n    },\r\n    _applyFragment: function(fragment, allDay) {\r\n        if (fragment.children().length > 0) {\r\n            this._getAppointmentContainer(allDay).append(fragment)\r\n        }\r\n    },\r\n    _onEachAppointment: function(appointment, index, container, isRepaintAll) {\r\n        var _this = this;\r\n        var repaintAppointment = function() {\r\n            appointment.needRepaint = false;\r\n            _this._clearItem(appointment);\r\n            _this._renderItem(index, appointment, container)\r\n        };\r\n        if (true === (null === appointment || void 0 === appointment ? void 0 : appointment.needRemove)) {\r\n            this._clearItem(appointment)\r\n        } else {\r\n            if (isRepaintAll || this._isRepaintAppointment(appointment)) {\r\n                repaintAppointment()\r\n            }\r\n        }\r\n    },\r\n    _repaintAppointments: function(appointments) {\r\n        var _this2 = this;\r\n        this._renderByFragments(function($commonFragment, $allDayFragment) {\r\n            var isRepaintAll = _this2._isRepaintAll(appointments);\r\n            if (isRepaintAll) {\r\n                _this2._getAppointmentContainer(true).html(\"\");\r\n                _this2._getAppointmentContainer(false).html(\"\")\r\n            }!appointments.length && _this2._cleanItemContainer();\r\n            appointments.forEach(function(appointment, index) {\r\n                var container = _this2._isAllDayAppointment(appointment) ? $allDayFragment : $commonFragment;\r\n                _this2._onEachAppointment(appointment, index, container, isRepaintAll)\r\n            })\r\n        })\r\n    },\r\n    _renderByFragments: function(renderFunction) {\r\n        var isVirtualScrolling = this.invoke(\"isVirtualScrolling\");\r\n        if (isVirtualScrolling) {\r\n            var $commonFragment = (0, _renderer.default)(_dom_adapter.default.createDocumentFragment());\r\n            var $allDayFragment = (0, _renderer.default)(_dom_adapter.default.createDocumentFragment());\r\n            renderFunction($commonFragment, $allDayFragment);\r\n            this._applyFragment($commonFragment, false);\r\n            this._applyFragment($allDayFragment, true)\r\n        } else {\r\n            renderFunction(this._getAppointmentContainer(false), this._getAppointmentContainer(true))\r\n        }\r\n    },\r\n    _attachAppointmentsEvents: function() {\r\n        this._attachClickEvent();\r\n        this._attachHoldEvent();\r\n        this._attachContextMenuEvent();\r\n        this._attachAppointmentDblClick();\r\n        this._renderFocusState();\r\n        this._attachFeedbackEvents();\r\n        this._attachHoverEvents()\r\n    },\r\n    _clearItem: function(item) {\r\n        var $items = this._findItemElementByItem(item.itemData);\r\n        if (!$items.length) {\r\n            return\r\n        }(0, _iterator.each)($items, function(_, $item) {\r\n            $item.detach();\r\n            $item.remove()\r\n        })\r\n    },\r\n    _clearDropDownItems: function() {\r\n        this._virtualAppointments = {}\r\n    },\r\n    _clearDropDownItemsElements: function() {\r\n        this.invoke(\"clearCompactAppointments\")\r\n    },\r\n    _findItemElementByItem: function(item) {\r\n        var result = [];\r\n        var that = this;\r\n        this.itemElements().each(function() {\r\n            var $item = (0, _renderer.default)(this);\r\n            if ($item.data(that._itemDataKey()) === item) {\r\n                result.push($item)\r\n            }\r\n        });\r\n        return result\r\n    },\r\n    _itemClass: function() {\r\n        return APPOINTMENT_ITEM_CLASS\r\n    },\r\n    _itemContainer: function() {\r\n        var $container = this.callBase();\r\n        var $result = $container;\r\n        var $allDayContainer = this.option(\"allDayContainer\");\r\n        if ($allDayContainer) {\r\n            $result = $container.add($allDayContainer)\r\n        }\r\n        return $result\r\n    },\r\n    _cleanItemContainer: function() {\r\n        this.callBase();\r\n        var $allDayContainer = this.option(\"allDayContainer\");\r\n        if ($allDayContainer) {\r\n            $allDayContainer.empty()\r\n        }\r\n        this._virtualAppointments = {}\r\n    },\r\n    _clean: function() {\r\n        this.callBase();\r\n        delete this._$currentAppointment;\r\n        delete this._initialSize;\r\n        delete this._initialCoordinates\r\n    },\r\n    _init: function() {\r\n        this.callBase();\r\n        this.$element().addClass(COMPONENT_CLASS);\r\n        this._preventSingleAppointmentClick = false\r\n    },\r\n    _renderAppointmentTemplate: function($container, data, model) {\r\n        var formatText = this.invoke(\"getTextAndFormatDate\", model.appointmentData, this._currentAppointmentSettings.agendaSettings || model.targetedAppointmentData, \"TIME\");\r\n        (0, _renderer.default)(\"<div>\").text(formatText.text).addClass(APPOINTMENT_TITLE_CLASS).appendTo($container);\r\n        if ((0, _type.isPlainObject)(data)) {\r\n            if (data.html) {\r\n                $container.html(data.html)\r\n            }\r\n        }\r\n        var $contentDetails = (0, _renderer.default)(\"<div>\").addClass(APPOINTMENT_CONTENT_DETAILS_CLASS);\r\n        (0, _renderer.default)(\"<div>\").addClass(APPOINTMENT_DATE_CLASS).text(formatText.formatDate).appendTo($contentDetails);\r\n        $contentDetails.appendTo($container);\r\n        if (data.recurrenceRule) {\r\n            (0, _renderer.default)(\"<span>\").addClass(RECURRING_ICON_CLASS + \" dx-icon-repeat\").appendTo($container)\r\n        }\r\n        if (data.allDay) {\r\n            (0, _renderer.default)(\"<div>\").text(\" \" + _message.default.format(\"dxScheduler-allDay\") + \": \").addClass(ALL_DAY_CONTENT_CLASS).prependTo($contentDetails)\r\n        }\r\n    },\r\n    _executeItemRenderAction: function(index, itemData, itemElement) {\r\n        var action = this._getItemRenderAction();\r\n        if (action) {\r\n            action(this.invoke(\"mapAppointmentFields\", {\r\n                itemData: itemData,\r\n                itemElement: itemElement\r\n            }))\r\n        }\r\n        delete this._currentAppointmentSettings\r\n    },\r\n    _itemClickHandler: function(e) {\r\n        this.callBase(e, {}, {\r\n            afterExecute: function(e) {\r\n                this._processItemClick(e.args[0].event)\r\n            }.bind(this)\r\n        })\r\n    },\r\n    _processItemClick: function(e) {\r\n        var $target = (0, _renderer.default)(e.currentTarget);\r\n        var data = this._getItemData($target);\r\n        if (\"keydown\" === e.type || (0, _index.isFakeClickEvent)(e)) {\r\n            this.notifyObserver(\"showEditAppointmentPopup\", {\r\n                data: data,\r\n                target: $target\r\n            });\r\n            return\r\n        }\r\n        this._appointmentClickTimeout = setTimeout(function() {\r\n            if (!this._preventSingleAppointmentClick && _dom_adapter.default.getBody().contains($target[0])) {\r\n                this.notifyObserver(\"showAppointmentTooltip\", {\r\n                    data: data,\r\n                    target: $target\r\n                })\r\n            }\r\n            this._preventSingleAppointmentClick = false\r\n        }.bind(this), 300)\r\n    },\r\n    _extendActionArgs: function() {\r\n        var args = this.callBase.apply(this, arguments);\r\n        return this.invoke(\"mapAppointmentFields\", args)\r\n    },\r\n    _render: function() {\r\n        this.callBase.apply(this, arguments);\r\n        this._attachAppointmentDblClick()\r\n    },\r\n    _attachAppointmentDblClick: function() {\r\n        var that = this;\r\n        var itemSelector = that._itemSelector();\r\n        var itemContainer = this._itemContainer();\r\n        _events_engine.default.off(itemContainer, DBLCLICK_EVENT_NAME, itemSelector);\r\n        _events_engine.default.on(itemContainer, DBLCLICK_EVENT_NAME, itemSelector, function(e) {\r\n            that._itemDXEventHandler(e, \"onAppointmentDblClick\", {}, {\r\n                afterExecute: function(e) {\r\n                    that._dblClickHandler(e.args[0].event)\r\n                }\r\n            })\r\n        })\r\n    },\r\n    _dblClickHandler: function(e) {\r\n        var $targetAppointment = (0, _renderer.default)(e.currentTarget);\r\n        var appointmentData = this._getItemData($targetAppointment);\r\n        clearTimeout(this._appointmentClickTimeout);\r\n        this._preventSingleAppointmentClick = true;\r\n        this.notifyObserver(\"showEditAppointmentPopup\", {\r\n            data: appointmentData,\r\n            target: $targetAppointment\r\n        })\r\n    },\r\n    _renderItem: function(index, item, container) {\r\n        var itemData = item.itemData;\r\n        var $items = [];\r\n        for (var i = 0; i < item.settings.length; i++) {\r\n            var setting = item.settings[i];\r\n            this._currentAppointmentSettings = setting;\r\n            var $item = this.callBase(index, itemData, container);\r\n            $item.data(_constants.APPOINTMENT_SETTINGS_KEY, setting);\r\n            $items.push($item)\r\n        }\r\n        return $items\r\n    },\r\n    _getItemContent: function($itemFrame) {\r\n        $itemFrame.data(_constants.APPOINTMENT_SETTINGS_KEY, this._currentAppointmentSettings);\r\n        var $itemContent = this.callBase($itemFrame);\r\n        return $itemContent\r\n    },\r\n    _createItemByTemplate: function(itemTemplate, renderArgs) {\r\n        var itemData = renderArgs.itemData,\r\n            container = renderArgs.container,\r\n            index = renderArgs.index;\r\n        return itemTemplate.render({\r\n            model: {\r\n                appointmentData: itemData,\r\n                targetedAppointmentData: this.invoke(\"getTargetedAppointmentData\", itemData, (0, _renderer.default)(container).parent())\r\n            },\r\n            container: container,\r\n            index: index\r\n        })\r\n    },\r\n    _getAppointmentContainer: function(allDay) {\r\n        var $allDayContainer = this.option(\"allDayContainer\");\r\n        var $container = this.itemsContainer().not($allDayContainer);\r\n        if (allDay && $allDayContainer) {\r\n            $container = $allDayContainer\r\n        }\r\n        return $container\r\n    },\r\n    _postprocessRenderItem: function(args) {\r\n        this._renderAppointment(args.itemElement, this._currentAppointmentSettings)\r\n    },\r\n    _renderAppointment: function($appointment, settings) {\r\n        $appointment.data(_constants.APPOINTMENT_SETTINGS_KEY, settings);\r\n        this._applyResourceDataAttr($appointment);\r\n        var data = this._getItemData($appointment);\r\n        var geometry = this.invoke(\"getAppointmentGeometry\", settings);\r\n        var allowResize = this.option(\"allowResize\") && (!(0, _type.isDefined)(settings.skipResizing) || (0, _type.isString)(settings.skipResizing));\r\n        var allowDrag = this.option(\"allowDrag\");\r\n        var allDay = settings.allDay;\r\n        this.invoke(\"setCellDataCacheAlias\", this._currentAppointmentSettings, geometry);\r\n        var deferredColor = this._getAppointmentColor($appointment, settings.groupIndex);\r\n        if (settings.virtual) {\r\n            this._processVirtualAppointment(settings, $appointment, data, deferredColor)\r\n        } else {\r\n            var info = settings.info;\r\n            this._createComponent($appointment, _uiScheduler2.default, {\r\n                observer: this.option(\"observer\"),\r\n                data: data,\r\n                geometry: geometry,\r\n                direction: settings.direction || \"vertical\",\r\n                allowResize: allowResize,\r\n                allowDrag: allowDrag,\r\n                allDay: allDay,\r\n                reduced: settings.appointmentReduced,\r\n                isCompact: settings.isCompact,\r\n                startDate: new Date(null === info || void 0 === info ? void 0 : info.appointment.startDate),\r\n                cellWidth: this.invoke(\"getCellWidth\"),\r\n                cellHeight: this.invoke(\"getCellHeight\"),\r\n                resizableConfig: this._resizableConfig(data, settings)\r\n            });\r\n            deferredColor.done(function(color) {\r\n                if (color) {\r\n                    $appointment.css(\"backgroundColor\", color)\r\n                }\r\n            })\r\n        }\r\n    },\r\n    _applyResourceDataAttr: function($appointment) {\r\n        var resources = this.invoke(\"getResourcesFromItem\", this._getItemData($appointment));\r\n        if (resources) {\r\n            (0, _iterator.each)(resources, function(name, values) {\r\n                var attr = \"data-\" + (0, _common.normalizeKey)(name.toLowerCase()) + \"-\";\r\n                for (var i = 0; i < values.length; i++) {\r\n                    $appointment.attr(attr + (0, _common.normalizeKey)(values[i]), true)\r\n                }\r\n            })\r\n        }\r\n    },\r\n    _resizableConfig: function(appointmentData, itemSetting) {\r\n        return {\r\n            area: this._calculateResizableArea(itemSetting, appointmentData),\r\n            onResizeStart: function(e) {\r\n                this._$currentAppointment = (0, _renderer.default)(e.element);\r\n                if (this.invoke(\"needRecalculateResizableArea\")) {\r\n                    var updatedArea = this._calculateResizableArea(this._$currentAppointment.data(_constants.APPOINTMENT_SETTINGS_KEY), this._$currentAppointment.data(\"dxItemData\"));\r\n                    e.component.option(\"area\", updatedArea);\r\n                    e.component._renderDragOffsets(e.event)\r\n                }\r\n                this._initialSize = {\r\n                    width: e.width,\r\n                    height: e.height\r\n                };\r\n                this._initialCoordinates = (0, _translator.locate)(this._$currentAppointment)\r\n            }.bind(this),\r\n            onResizeEnd: function(e) {\r\n                if (this._escPressed) {\r\n                    e.event.cancel = true;\r\n                    return\r\n                }\r\n                this._resizeEndHandler(e)\r\n            }.bind(this)\r\n        }\r\n    },\r\n    _calculateResizableArea: function(itemSetting, appointmentData) {\r\n        var area = this.$element().closest(\".dx-scrollable-content\");\r\n        return this.invoke(\"getResizableAppointmentArea\", {\r\n            coordinates: {\r\n                left: itemSetting.left,\r\n                top: 0,\r\n                groupIndex: itemSetting.groupIndex\r\n            },\r\n            allDay: itemSetting.allDay\r\n        }) || area\r\n    },\r\n    _resizeEndHandler: function(e) {\r\n        var scheduler = this.option(\"observer\");\r\n        var $element = (0, _renderer.default)(e.element);\r\n        var _$element$data = $element.data(\"dxAppointmentSettings\"),\r\n            info = _$element$data.info;\r\n        var sourceAppointment = this._getItemData($element);\r\n        var modifiedAppointmentAdapter = scheduler.createAppointmentAdapter(sourceAppointment).clone();\r\n        var startDate = this._getEndResizeAppointmentStartDate(e, sourceAppointment, info.appointment);\r\n        var endDate = info.appointment.endDate;\r\n        var dateRange = this._getDateRange(e, startDate, endDate);\r\n        modifiedAppointmentAdapter.startDate = new Date(dateRange[0]);\r\n        modifiedAppointmentAdapter.endDate = new Date(dateRange[1]);\r\n        this.notifyObserver(\"updateAppointmentAfterResize\", {\r\n            target: sourceAppointment,\r\n            data: modifiedAppointmentAdapter.clone({\r\n                pathTimeZone: \"fromGrid\"\r\n            }).source(),\r\n            $appointment: $element\r\n        })\r\n    },\r\n    _getEndResizeAppointmentStartDate: function(e, rawAppointment, appointmentInfo) {\r\n        var scheduler = this.option(\"observer\");\r\n        var appointmentAdapter = scheduler.createAppointmentAdapter(rawAppointment);\r\n        var startDate = appointmentInfo.startDate;\r\n        var recurrenceProcessor = (0, _recurrence.getRecurrenceProcessor)();\r\n        var recurrenceRule = appointmentAdapter.recurrenceRule,\r\n            startDateTimeZone = appointmentAdapter.startDateTimeZone;\r\n        var isAllDay = this.invoke(\"isAllDay\", rawAppointment);\r\n        var isRecurrent = recurrenceProcessor.isValidRecurrenceRule(recurrenceRule);\r\n        if (!e.handles.top && !isRecurrent && !isAllDay) {\r\n            startDate = scheduler.timeZoneCalculator.createDate(appointmentAdapter.startDate, {\r\n                appointmentTimeZone: startDateTimeZone,\r\n                path: \"toGrid\"\r\n            })\r\n        }\r\n        return startDate\r\n    },\r\n    _getDateRange: function(e, startDate, endDate) {\r\n        var itemData = this._getItemData(e.element);\r\n        var deltaTime = this.invoke(\"getDeltaTime\", e, this._initialSize, itemData);\r\n        var renderingStrategyDirection = this.invoke(\"getRenderingStrategyDirection\");\r\n        var isStartDateChanged = false;\r\n        var isAllDay = this.invoke(\"isAllDay\", itemData);\r\n        var needCorrectDates = this.invoke(\"needCorrectAppointmentDates\") && !isAllDay;\r\n        var startTime;\r\n        var endTime;\r\n        if (\"vertical\" !== renderingStrategyDirection || isAllDay) {\r\n            isStartDateChanged = this.option(\"rtlEnabled\") ? e.handles.right : e.handles.left\r\n        } else {\r\n            isStartDateChanged = e.handles.top\r\n        }\r\n        if (isStartDateChanged) {\r\n            startTime = needCorrectDates ? this._correctStartDateByDelta(startDate, deltaTime) : startDate.getTime() - deltaTime;\r\n            startTime += _utilsTimeZone.default.getTimezoneOffsetChangeInMs(startDate, endDate, startTime, endDate);\r\n            endTime = endDate.getTime()\r\n        } else {\r\n            startTime = startDate.getTime();\r\n            endTime = needCorrectDates ? this._correctEndDateByDelta(endDate, deltaTime) : endDate.getTime() + deltaTime;\r\n            endTime -= _utilsTimeZone.default.getTimezoneOffsetChangeInMs(startDate, endDate, startDate, endTime)\r\n        }\r\n        return [startTime, endTime]\r\n    },\r\n    _correctEndDateByDelta: function(endDate, deltaTime) {\r\n        var endDayHour = this.invoke(\"getEndDayHour\");\r\n        var startDayHour = this.invoke(\"getStartDayHour\");\r\n        var result = endDate.getTime() + deltaTime;\r\n        var visibleDayDuration = (endDayHour - startDayHour) * toMs(\"hour\");\r\n        var daysCount = deltaTime > 0 ? Math.ceil(deltaTime / visibleDayDuration) : Math.floor(deltaTime / visibleDayDuration);\r\n        var maxDate = new Date(endDate);\r\n        var minDate = new Date(endDate);\r\n        minDate.setHours(startDayHour, 0, 0, 0);\r\n        maxDate.setHours(endDayHour, 0, 0, 0);\r\n        if (result > maxDate.getTime() || result <= minDate.getTime()) {\r\n            var tailOfCurrentDay = maxDate.getTime() - endDate.getTime();\r\n            var tailOfPrevDays = deltaTime - tailOfCurrentDay;\r\n            var lastDay = new Date(endDate.setDate(endDate.getDate() + daysCount));\r\n            lastDay.setHours(startDayHour, 0, 0, 0);\r\n            result = lastDay.getTime() + tailOfPrevDays - visibleDayDuration * (daysCount - 1)\r\n        }\r\n        return result\r\n    },\r\n    _correctStartDateByDelta: function(startDate, deltaTime) {\r\n        var endDayHour = this.invoke(\"getEndDayHour\");\r\n        var startDayHour = this.invoke(\"getStartDayHour\");\r\n        var result = startDate.getTime() - deltaTime;\r\n        var visibleDayDuration = (endDayHour - startDayHour) * toMs(\"hour\");\r\n        var daysCount = deltaTime > 0 ? Math.ceil(deltaTime / visibleDayDuration) : Math.floor(deltaTime / visibleDayDuration);\r\n        var maxDate = new Date(startDate);\r\n        var minDate = new Date(startDate);\r\n        minDate.setHours(startDayHour, 0, 0, 0);\r\n        maxDate.setHours(endDayHour, 0, 0, 0);\r\n        if (result < minDate.getTime() || result >= maxDate.getTime()) {\r\n            var tailOfCurrentDay = startDate.getTime() - minDate.getTime();\r\n            var tailOfPrevDays = deltaTime - tailOfCurrentDay;\r\n            var firstDay = new Date(startDate.setDate(startDate.getDate() - daysCount));\r\n            firstDay.setHours(endDayHour, 0, 0, 0);\r\n            result = firstDay.getTime() - tailOfPrevDays + visibleDayDuration * (daysCount - 1)\r\n        }\r\n        return result\r\n    },\r\n    _tryGetAppointmentColor: function(appointment) {\r\n        var settings = (0, _renderer.default)(appointment).data(_constants.APPOINTMENT_SETTINGS_KEY);\r\n        if (!settings) {\r\n            return\r\n        }\r\n        return this._getAppointmentColor(appointment, settings.groupIndex)\r\n    },\r\n    _getAppointmentColor: function($appointment, groupIndex) {\r\n        var res = new _deferred.Deferred;\r\n        var response = this.invoke(\"getAppointmentColor\", {\r\n            itemData: this._getItemData($appointment),\r\n            groupIndex: groupIndex\r\n        });\r\n        response.done(function(color) {\r\n            return res.resolve(color)\r\n        });\r\n        return res.promise()\r\n    },\r\n    _calculateBoundOffset: function() {\r\n        return this.invoke(\"getBoundOffset\")\r\n    },\r\n    _virtualAppointments: {},\r\n    _processVirtualAppointment: function(appointmentSetting, $appointment, appointmentData, color) {\r\n        var virtualAppointment = appointmentSetting.virtual;\r\n        var virtualGroupIndex = virtualAppointment.index;\r\n        if (!(0, _type.isDefined)(this._virtualAppointments[virtualGroupIndex])) {\r\n            this._virtualAppointments[virtualGroupIndex] = {\r\n                coordinates: {\r\n                    top: virtualAppointment.top,\r\n                    left: virtualAppointment.left\r\n                },\r\n                items: {\r\n                    data: [],\r\n                    colors: [],\r\n                    settings: []\r\n                },\r\n                isAllDay: virtualAppointment.isAllDay ? true : false,\r\n                buttonColor: color\r\n            }\r\n        }\r\n        appointmentSetting.targetedAppointmentData = this.invoke(\"getTargetedAppointmentData\", appointmentData, $appointment);\r\n        this._virtualAppointments[virtualGroupIndex].items.settings.push(appointmentSetting);\r\n        this._virtualAppointments[virtualGroupIndex].items.data.push(appointmentData);\r\n        this._virtualAppointments[virtualGroupIndex].items.colors.push(color);\r\n        $appointment.remove()\r\n    },\r\n    _renderContentImpl: function() {\r\n        this.callBase();\r\n        this._renderDropDownAppointments()\r\n    },\r\n    _renderDropDownAppointments: function() {\r\n        var _this3 = this;\r\n        this._renderByFragments(function($commonFragment, $allDayFragment) {\r\n            (0, _iterator.each)(_this3._virtualAppointments, function(groupIndex) {\r\n                var virtualGroup = this._virtualAppointments[groupIndex];\r\n                var virtualItems = virtualGroup.items;\r\n                var virtualCoordinates = virtualGroup.coordinates;\r\n                var $fragment = virtualGroup.isAllDay ? $allDayFragment : $commonFragment;\r\n                var left = virtualCoordinates.left;\r\n                var buttonWidth = this.invoke(\"getDropDownAppointmentWidth\", virtualGroup.isAllDay);\r\n                var buttonHeight = this.invoke(\"getDropDownAppointmentHeight\");\r\n                var rtlOffset = this.option(\"rtlEnabled\") ? buttonWidth : 0;\r\n                this.notifyObserver(\"renderCompactAppointments\", {\r\n                    $container: $fragment,\r\n                    coordinates: {\r\n                        top: virtualCoordinates.top,\r\n                        left: left + rtlOffset\r\n                    },\r\n                    items: virtualItems,\r\n                    buttonColor: virtualGroup.buttonColor,\r\n                    width: buttonWidth - this.option(\"_collectorOffset\"),\r\n                    height: buttonHeight,\r\n                    onAppointmentClick: this.option(\"onItemClick\"),\r\n                    allowDrag: this.option(\"allowDrag\"),\r\n                    cellWidth: this.invoke(\"getCellWidth\"),\r\n                    isCompact: this.invoke(\"isAdaptive\") || this._isGroupCompact(virtualGroup),\r\n                    applyOffset: !virtualGroup.isAllDay && this.invoke(\"isApplyCompactAppointmentOffset\")\r\n                })\r\n            }.bind(_this3))\r\n        })\r\n    },\r\n    _isGroupCompact: function(virtualGroup) {\r\n        return !virtualGroup.isAllDay && this.invoke(\"supportCompactDropDownAppointments\")\r\n    },\r\n    _sortAppointmentsByStartDate: function(appointments) {\r\n        appointments.sort(function(a, b) {\r\n            var result = 0;\r\n            var firstDate = new Date(this.invoke(\"getField\", \"startDate\", a.settings || a)).getTime();\r\n            var secondDate = new Date(this.invoke(\"getField\", \"startDate\", b.settings || b)).getTime();\r\n            if (firstDate < secondDate) {\r\n                result = -1\r\n            }\r\n            if (firstDate > secondDate) {\r\n                result = 1\r\n            }\r\n            return result\r\n        }.bind(this))\r\n    },\r\n    _processRecurrenceAppointment: function(appointment, index, skipLongAppointments) {\r\n        var recurrenceRule = this.invoke(\"getField\", \"recurrenceRule\", appointment);\r\n        var result = {\r\n            parts: [],\r\n            indexes: []\r\n        };\r\n        if (recurrenceRule) {\r\n            var dates = appointment.settings || appointment;\r\n            var startDate = new Date(this.invoke(\"getField\", \"startDate\", dates));\r\n            var endDate = new Date(this.invoke(\"getField\", \"endDate\", dates));\r\n            var appointmentDuration = endDate.getTime() - startDate.getTime();\r\n            var recurrenceException = this.invoke(\"getField\", \"recurrenceException\", appointment);\r\n            var startViewDate = this.invoke(\"getStartViewDate\");\r\n            var endViewDate = this.invoke(\"getEndViewDate\");\r\n            var recurrentDates = (0, _recurrence.getRecurrenceProcessor)().generateDates({\r\n                rule: recurrenceRule,\r\n                exception: recurrenceException,\r\n                start: startDate,\r\n                end: endDate,\r\n                min: startViewDate,\r\n                max: endViewDate\r\n            });\r\n            var recurrentDateCount = appointment.settings ? 1 : recurrentDates.length;\r\n            for (var i = 0; i < recurrentDateCount; i++) {\r\n                var appointmentPart = (0, _extend.extend)({}, appointment, true);\r\n                if (recurrentDates[i]) {\r\n                    var appointmentSettings = this._applyStartDateToObj(recurrentDates[i], {});\r\n                    this._applyEndDateToObj(new Date(recurrentDates[i].getTime() + appointmentDuration), appointmentSettings);\r\n                    appointmentPart.settings = appointmentSettings\r\n                } else {\r\n                    appointmentPart.settings = dates\r\n                }\r\n                result.parts.push(appointmentPart);\r\n                if (!skipLongAppointments) {\r\n                    this._processLongAppointment(appointmentPart, result)\r\n                }\r\n            }\r\n            result.indexes.push(index)\r\n        }\r\n        return result\r\n    },\r\n    _processLongAppointment: function(appointment, result) {\r\n        var parts = this.splitAppointmentByDay(appointment);\r\n        var partCount = parts.length;\r\n        var endViewDate = this.invoke(\"getEndViewDate\").getTime();\r\n        var startViewDate = this.invoke(\"getStartViewDate\").getTime();\r\n        var timeZoneCalculator = this.invoke(\"getTimeZoneCalculator\");\r\n        result = result || {\r\n            parts: []\r\n        };\r\n        if (partCount > 1) {\r\n            (0, _extend.extend)(appointment, parts[0]);\r\n            for (var i = 1; i < partCount; i++) {\r\n                var startDate = this.invoke(\"getField\", \"startDate\", parts[i].settings).getTime();\r\n                startDate = timeZoneCalculator.createDate(startDate, {\r\n                    path: \"toGrid\"\r\n                });\r\n                if (startDate < endViewDate && startDate > startViewDate) {\r\n                    result.parts.push(parts[i])\r\n                }\r\n            }\r\n        }\r\n        return result\r\n    },\r\n    _reduceRecurrenceAppointments: function(recurrenceIndexes, appointments) {\r\n        (0, _iterator.each)(recurrenceIndexes, function(i, index) {\r\n            appointments.splice(index - i, 1)\r\n        })\r\n    },\r\n    _combineAppointments: function(appointments, additionalAppointments) {\r\n        if (additionalAppointments.length) {\r\n            (0, _array.merge)(appointments, additionalAppointments)\r\n        }\r\n        this._sortAppointmentsByStartDate(appointments)\r\n    },\r\n    _applyStartDateToObj: function(startDate, obj) {\r\n        this.invoke(\"setField\", \"startDate\", obj, startDate);\r\n        return obj\r\n    },\r\n    _applyEndDateToObj: function(endDate, obj) {\r\n        this.invoke(\"setField\", \"endDate\", obj, endDate);\r\n        return obj\r\n    },\r\n    moveAppointmentBack: function(dragEvent) {\r\n        var $appointment = this._$currentAppointment;\r\n        var size = this._initialSize;\r\n        var coords = this._initialCoordinates;\r\n        if (dragEvent) {\r\n            this._removeDragSourceClassFromDraggedAppointment();\r\n            if ((0, _type.isDeferred)(dragEvent.cancel)) {\r\n                dragEvent.cancel.resolve(true)\r\n            } else {\r\n                dragEvent.cancel = true\r\n            }\r\n        }\r\n        if ($appointment && !dragEvent) {\r\n            if (coords) {\r\n                (0, _translator.move)($appointment, coords);\r\n                delete this._initialSize\r\n            }\r\n            if (size) {\r\n                $appointment.outerWidth(size.width);\r\n                $appointment.outerHeight(size.height);\r\n                delete this._initialCoordinates\r\n            }\r\n        }\r\n    },\r\n    focus: function() {\r\n        if (this._$currentAppointment) {\r\n            var focusedElement = (0, _element.getPublicElement)(this._$currentAppointment);\r\n            this.option(\"focusedElement\", focusedElement);\r\n            _events_engine.default.trigger(focusedElement, \"focus\")\r\n        }\r\n    },\r\n    splitAppointmentByDay: function(appointment) {\r\n        var dates = appointment.settings || appointment;\r\n        var originalStartDate = new Date(this.invoke(\"getField\", \"startDate\", dates));\r\n        var startDate = _date.default.makeDate(originalStartDate);\r\n        var endDate = _date.default.makeDate(this.invoke(\"getField\", \"endDate\", dates));\r\n        var maxAllowedDate = this.invoke(\"getEndViewDate\");\r\n        var startDayHour = this.invoke(\"getStartDayHour\");\r\n        var endDayHour = this.invoke(\"getEndDayHour\");\r\n        var appointmentIsLong = this.invoke(\"appointmentTakesSeveralDays\", appointment);\r\n        var result = [];\r\n        var timeZoneCalculator = this.invoke(\"getTimeZoneCalculator\");\r\n        startDate = timeZoneCalculator.createDate(startDate, {\r\n            path: \"toGrid\"\r\n        });\r\n        endDate = timeZoneCalculator.createDate(endDate, {\r\n            path: \"toGrid\"\r\n        });\r\n        if (startDate.getHours() <= endDayHour && startDate.getHours() >= startDayHour && !appointmentIsLong) {\r\n            result.push(this._applyStartDateToObj(new Date(startDate), {\r\n                appointmentData: appointment\r\n            }));\r\n            startDate.setDate(startDate.getDate() + 1)\r\n        }\r\n        while (appointmentIsLong && startDate.getTime() < endDate.getTime() && startDate < maxAllowedDate) {\r\n            var currentStartDate = new Date(startDate);\r\n            var currentEndDate = new Date(startDate);\r\n            this._checkStartDate(currentStartDate, originalStartDate, startDayHour);\r\n            this._checkEndDate(currentEndDate, endDate, endDayHour);\r\n            var appointmentData = (0, _object.deepExtendArraySafe)({}, appointment, true);\r\n            var appointmentSettings = {};\r\n            this._applyStartDateToObj(currentStartDate, appointmentSettings);\r\n            this._applyEndDateToObj(currentEndDate, appointmentSettings);\r\n            appointmentData.settings = appointmentSettings;\r\n            result.push(appointmentData);\r\n            startDate = _date.default.trimTime(startDate);\r\n            startDate.setDate(startDate.getDate() + 1);\r\n            startDate.setHours(startDayHour)\r\n        }\r\n        return result\r\n    },\r\n    _checkStartDate: function(currentDate, originalDate, startDayHour) {\r\n        if (!_date.default.sameDate(currentDate, originalDate) || currentDate.getHours() <= startDayHour) {\r\n            currentDate.setHours(startDayHour, 0, 0, 0)\r\n        } else {\r\n            currentDate.setHours(originalDate.getHours(), originalDate.getMinutes(), originalDate.getSeconds(), originalDate.getMilliseconds())\r\n        }\r\n    },\r\n    _checkEndDate: function(currentDate, originalDate, endDayHour) {\r\n        if (!_date.default.sameDate(currentDate, originalDate) || currentDate.getHours() > endDayHour) {\r\n            currentDate.setHours(endDayHour, 0, 0, 0)\r\n        } else {\r\n            currentDate.setHours(originalDate.getHours(), originalDate.getMinutes(), originalDate.getSeconds(), originalDate.getMilliseconds())\r\n        }\r\n    },\r\n    _removeDragSourceClassFromDraggedAppointment: function() {\r\n        var $appointments = this._itemElements().filter(\".\".concat(_constants.APPOINTMENT_DRAG_SOURCE_CLASS));\r\n        $appointments.each(function(_, element) {\r\n            var appointmentInstance = (0, _renderer.default)(element).dxSchedulerAppointment(\"instance\");\r\n            appointmentInstance.option(\"isDragSource\", false)\r\n        })\r\n    },\r\n    _setDragSourceAppointment: function(appointment, settings) {\r\n        var $appointments = this._findItemElementByItem(appointment);\r\n        var _settings$info$source = settings.info.sourceAppointment,\r\n            startDate = _settings$info$source.startDate,\r\n            endDate = _settings$info$source.endDate;\r\n        var groupIndex = settings.groupIndex;\r\n        $appointments.forEach(function($item) {\r\n            var _$item$data = $item.data(_constants.APPOINTMENT_SETTINGS_KEY),\r\n                itemInfo = _$item$data.info,\r\n                itemGroupIndex = _$item$data.groupIndex;\r\n            var _itemInfo$sourceAppoi = itemInfo.sourceAppointment,\r\n                itemStartDate = _itemInfo$sourceAppoi.startDate,\r\n                itemEndDate = _itemInfo$sourceAppoi.endDate;\r\n            var appointmentInstance = $item.dxSchedulerAppointment(\"instance\");\r\n            var isDragSource = startDate.getTime() === itemStartDate.getTime() && endDate.getTime() === itemEndDate.getTime() && groupIndex === itemGroupIndex;\r\n            appointmentInstance.option(\"isDragSource\", isDragSource)\r\n        })\r\n    }\r\n}).include(_uiScheduler.default);\r\n(0, _component_registrator.default)(\"dxSchedulerAppointments\", SchedulerAppointments);\r\nvar _default = SchedulerAppointments;\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}