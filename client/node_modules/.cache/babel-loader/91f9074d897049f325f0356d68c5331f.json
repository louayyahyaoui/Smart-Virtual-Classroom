{"ast":null,"code":"/**\r\n * DevExtreme (ui/tag_box.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _renderer = _interopRequireDefault(require(\"../core/renderer\"));\n\nvar _devices = _interopRequireDefault(require(\"../core/devices\"));\n\nvar _element_data = require(\"../core/element_data\");\n\nvar _events_engine = _interopRequireDefault(require(\"../events/core/events_engine\"));\n\nvar _component_registrator = _interopRequireDefault(require(\"../core/component_registrator\"));\n\nvar _common = require(\"../core/utils/common\");\n\nvar _selection_filter = require(\"../core/utils/selection_filter\");\n\nvar _deferred = require(\"../core/utils/deferred\");\n\nvar _dom = require(\"../core/utils/dom\");\n\nvar _element = require(\"../core/element\");\n\nvar _type = require(\"../core/utils/type\");\n\nvar _window = require(\"../core/utils/window\");\n\nvar _extend = require(\"../core/utils/extend\");\n\nvar _array = require(\"../core/utils/array\");\n\nvar _iterator = require(\"../core/utils/iterator\");\n\nvar _message = _interopRequireDefault(require(\"../localization/message\"));\n\nvar _index = require(\"../events/utils/index\");\n\nvar _click = require(\"../events/click\");\n\nvar _utils = _interopRequireDefault(require(\"./text_box/utils.caret\"));\n\nvar _utils2 = require(\"../data/data_source/utils\");\n\nvar _scroll_rtl_behavior = _interopRequireDefault(require(\"../core/utils/scroll_rtl_behavior\"));\n\nvar _select_box = _interopRequireDefault(require(\"./select_box\"));\n\nvar _bindable_template = require(\"../core/templates/bindable_template\");\n\nvar _utils3 = require(\"./text_box/utils.scroll\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nvar TAGBOX_TAG_DATA_KEY = \"dxTagData\";\nvar TAGBOX_CLASS = \"dx-tagbox\";\nvar TAGBOX_TAG_CONTAINER_CLASS = \"dx-tag-container\";\nvar TAGBOX_TAG_CLASS = \"dx-tag\";\nvar TAGBOX_MULTI_TAG_CLASS = \"dx-tagbox-multi-tag\";\nvar TAGBOX_CUSTOM_TAG_CLASS = \"dx-tag-custom\";\nvar TAGBOX_TAG_REMOVE_BUTTON_CLASS = \"dx-tag-remove-button\";\nvar TAGBOX_ONLY_SELECT_CLASS = \"dx-tagbox-only-select\";\nvar TAGBOX_SINGLE_LINE_CLASS = \"dx-tagbox-single-line\";\nvar TAGBOX_POPUP_WRAPPER_CLASS = \"dx-tagbox-popup-wrapper\";\nvar TAGBOX_TAG_CONTENT_CLASS = \"dx-tag-content\";\nvar TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS = \"dx-tagbox-default-template\";\nvar TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS = \"dx-tagbox-custom-template\";\nvar NATIVE_CLICK_CLASS = \"dx-native-click\";\nvar TEXTEDITOR_INPUT_CONTAINER_CLASS = \"dx-texteditor-input-container\";\nvar TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER = -.3;\n\nvar TagBox = _select_box.default.inherit({\n  _supportedKeys: function () {\n    var _this = this;\n\n    var parent = this.callBase();\n\n    var sendToList = function (options) {\n      return _this._list._keyboardHandler(options);\n    };\n\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    return (0, _extend.extend)({}, parent, {\n      backspace: function (e) {\n        if (!this._isCaretAtTheStart()) {\n          return;\n        }\n\n        this._processKeyboardEvent(e);\n\n        this._isTagRemoved = true;\n\n        var $tagToDelete = this._$focusedTag || this._tagElements().last();\n\n        if (this._$focusedTag) {\n          this._moveTagFocus(\"prev\", true);\n        }\n\n        if (0 === $tagToDelete.length) {\n          return;\n        }\n\n        this._preserveFocusedTag = true;\n\n        this._removeTagElement($tagToDelete);\n\n        delete this._preserveFocusedTag;\n      },\n      upArrow: function (e, opts) {\n        return e.altKey || !_this._list ? parent.upArrow.call(_this, e) : sendToList(opts);\n      },\n      downArrow: function (e, opts) {\n        return e.altKey || !_this._list ? parent.downArrow.call(_this, e) : sendToList(opts);\n      },\n      del: function (e) {\n        if (!this._$focusedTag || !this._isCaretAtTheStart()) {\n          return;\n        }\n\n        this._processKeyboardEvent(e);\n\n        this._isTagRemoved = true;\n        var $tagToDelete = this._$focusedTag;\n\n        this._moveTagFocus(\"next\", true);\n\n        this._preserveFocusedTag = true;\n\n        this._removeTagElement($tagToDelete);\n\n        delete this._preserveFocusedTag;\n      },\n      enter: function (e, options) {\n        var isListItemFocused = this._list && null !== this._list.option(\"focusedElement\");\n\n        var isCustomItem = this.option(\"acceptCustomValue\") && !isListItemFocused;\n\n        if (isCustomItem) {\n          e.preventDefault();\n          \"\" !== this._searchValue() && this._customItemAddedHandler(e);\n          return;\n        }\n\n        if (this.option(\"opened\")) {\n          this._saveValueChangeEvent(e);\n\n          sendToList(options);\n          e.preventDefault();\n        }\n      },\n      space: function (e, options) {\n        var isOpened = this.option(\"opened\");\n\n        var isInputActive = this._shouldRenderSearchEvent();\n\n        if (isOpened && !isInputActive) {\n          this._saveValueChangeEvent(e);\n\n          sendToList(options);\n          e.preventDefault();\n        }\n      },\n      leftArrow: function (e) {\n        if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && rtlEnabled && !this._$focusedTag) {\n          return;\n        }\n\n        e.preventDefault();\n        var direction = rtlEnabled ? \"next\" : \"prev\";\n\n        this._moveTagFocus(direction);\n\n        !this.option(\"multiline\") && this._scrollContainer(direction);\n      },\n      rightArrow: function (e) {\n        if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && !rtlEnabled && !this._$focusedTag) {\n          return;\n        }\n\n        e.preventDefault();\n        var direction = rtlEnabled ? \"prev\" : \"next\";\n\n        this._moveTagFocus(direction);\n\n        !this.option(\"multiline\") && this._scrollContainer(direction);\n      }\n    });\n  },\n  _processKeyboardEvent: function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    this._saveValueChangeEvent(e);\n  },\n  _isEmpty: function () {\n    return 0 === this._getValue().length;\n  },\n  _updateTagsContainer: function ($element) {\n    this._$tagsContainer = $element.addClass(TAGBOX_TAG_CONTAINER_CLASS).addClass(NATIVE_CLICK_CLASS);\n\n    this._$tagsContainer.parent().addClass(NATIVE_CLICK_CLASS);\n  },\n  _allowSelectItemByTab: function () {\n    return false;\n  },\n  _isCaretAtTheStart: function () {\n    var position = (0, _utils.default)(this._input());\n    return 0 === position.start && 0 === position.end;\n  },\n  _moveTagFocus: function (direction, clearOnBoundary) {\n    if (!this._$focusedTag) {\n      var tagElements = this._tagElements();\n\n      this._$focusedTag = \"next\" === direction ? tagElements.first() : tagElements.last();\n\n      this._toggleFocusClass(true, this._$focusedTag);\n\n      return;\n    }\n\n    var $nextFocusedTag = this._$focusedTag[direction](\".\".concat(TAGBOX_TAG_CLASS));\n\n    if ($nextFocusedTag.length > 0) {\n      this._replaceFocusedTag($nextFocusedTag);\n    } else {\n      if (clearOnBoundary || \"next\" === direction && this._isEditable()) {\n        this._clearTagFocus();\n      }\n    }\n  },\n  _replaceFocusedTag: function ($nextFocusedTag) {\n    this._toggleFocusClass(false, this._$focusedTag);\n\n    this._$focusedTag = $nextFocusedTag;\n\n    this._toggleFocusClass(true, this._$focusedTag);\n  },\n  _clearTagFocus: function () {\n    if (!this._$focusedTag) {\n      return;\n    }\n\n    this._toggleFocusClass(false, this._$focusedTag);\n\n    delete this._$focusedTag;\n  },\n  _focusClassTarget: function ($element) {\n    if ($element && $element.length && $element[0] !== this._focusTarget()[0]) {\n      return $element;\n    }\n\n    return this.callBase();\n  },\n  _scrollContainer: function (direction) {\n    if (this.option(\"multiline\") || !(0, _window.hasWindow)()) {\n      return;\n    }\n\n    if (!this._$tagsContainer) {\n      return;\n    }\n\n    var scrollPosition = this._getScrollPosition(direction);\n\n    this._$tagsContainer.scrollLeft(scrollPosition);\n  },\n  _getScrollPosition: function (direction) {\n    if (\"start\" === direction || \"end\" === direction) {\n      return this._getBorderPosition(direction);\n    }\n\n    return this._$focusedTag ? this._getFocusedTagPosition(direction) : this._getBorderPosition(\"end\");\n  },\n  _getBorderPosition: function (direction) {\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    var isScrollLeft = \"end\" === direction ^ rtlEnabled;\n    var scrollBehavior = (0, _scroll_rtl_behavior.default)();\n    var isScrollInverted = rtlEnabled && scrollBehavior.decreasing ^ scrollBehavior.positive;\n    var scrollSign = !rtlEnabled || scrollBehavior.positive ? 1 : -1;\n    return isScrollLeft ^ !isScrollInverted ? 0 : scrollSign * (this._$tagsContainer.get(0).scrollWidth - this._$tagsContainer.outerWidth());\n  },\n  _getFocusedTagPosition: function (direction) {\n    var rtlEnabled = this.option(\"rtlEnabled\");\n    var isScrollLeft = \"next\" === direction ^ rtlEnabled;\n\n    var _this$_$focusedTag$po = this._$focusedTag.position(),\n        scrollOffset = _this$_$focusedTag$po.left;\n\n    var scrollLeft = this._$tagsContainer.scrollLeft();\n\n    if (isScrollLeft) {\n      scrollOffset += this._$focusedTag.outerWidth(true) - this._$tagsContainer.outerWidth();\n    }\n\n    if (isScrollLeft ^ scrollOffset < 0) {\n      var scrollBehavior = (0, _scroll_rtl_behavior.default)();\n      var scrollCorrection = rtlEnabled && !scrollBehavior.decreasing && scrollBehavior.positive ? -1 : 1;\n      scrollLeft += scrollOffset * scrollCorrection;\n    }\n\n    return scrollLeft;\n  },\n  _setNextValue: _common.noop,\n  _getDefaultOptions: function () {\n    return (0, _extend.extend)(this.callBase(), {\n      value: [],\n      showDropDownButton: false,\n      maxFilterLength: 1500,\n      tagTemplate: \"tag\",\n      selectAllText: _message.default.format(\"dxList-selectAll\"),\n      hideSelectedItems: false,\n      selectedItems: [],\n      selectAllMode: \"page\",\n      onSelectAllValueChanged: null,\n      maxDisplayedTags: void 0,\n      showMultiTagOnly: true,\n      onMultiTagPreparing: null,\n      multiline: true,\n      useSubmitBehavior: true\n    });\n  },\n  _init: function () {\n    this.callBase();\n    this._selectedItems = [];\n\n    this._initSelectAllValueChangedAction();\n  },\n  _initActions: function () {\n    this.callBase();\n\n    this._initMultiTagPreparingAction();\n  },\n  _initMultiTagPreparingAction: function () {\n    this._multiTagPreparingAction = this._createActionByOption(\"onMultiTagPreparing\", {\n      beforeExecute: function (e) {\n        this._multiTagPreparingHandler(e.args[0]);\n      }.bind(this),\n      excludeValidators: [\"disabled\", \"readOnly\"]\n    });\n  },\n  _multiTagPreparingHandler: function (args) {\n    var _this$_getValue = this._getValue(),\n        selectedCount = _this$_getValue.length;\n\n    if (!this.option(\"showMultiTagOnly\")) {\n      args.text = _message.default.getFormatter(\"dxTagBox-moreSelected\")(selectedCount - this.option(\"maxDisplayedTags\") + 1);\n    } else {\n      args.text = _message.default.getFormatter(\"dxTagBox-selected\")(selectedCount);\n    }\n  },\n  _initDynamicTemplates: function () {\n    this.callBase();\n\n    this._templateManager.addDefaultTemplates({\n      tag: new _bindable_template.BindableTemplate(function ($container, data) {\n        var _data$text;\n\n        var $tagContent = (0, _renderer.default)(\"<div>\").addClass(TAGBOX_TAG_CONTENT_CLASS);\n        (0, _renderer.default)(\"<span>\").text(null !== (_data$text = data.text) && void 0 !== _data$text ? _data$text : data).appendTo($tagContent);\n        (0, _renderer.default)(\"<div>\").addClass(TAGBOX_TAG_REMOVE_BUTTON_CLASS).appendTo($tagContent);\n        $container.append($tagContent);\n      }, [\"text\"], this.option(\"integrationOptions.watchMethod\"), {\n        text: this._displayGetter\n      })\n    });\n  },\n  _toggleSubmitElement: function (enabled) {\n    if (enabled) {\n      this._renderSubmitElement();\n\n      this._setSubmitValue();\n    } else {\n      this._$submitElement && this._$submitElement.remove();\n      delete this._$submitElement;\n    }\n  },\n  _renderSubmitElement: function () {\n    if (!this.option(\"useSubmitBehavior\")) {\n      return;\n    }\n\n    this._$submitElement = (0, _renderer.default)(\"<select>\").attr(\"multiple\", \"multiple\").css(\"display\", \"none\").appendTo(this.$element());\n  },\n  _setSubmitValue: function () {\n    if (!this.option(\"useSubmitBehavior\")) {\n      return;\n    }\n\n    var value = this._getValue();\n\n    var $options = [];\n\n    for (var i = 0, n = value.length; i < n; i++) {\n      var useDisplayText = this._shouldUseDisplayValue(value[i]);\n\n      $options.push((0, _renderer.default)(\"<option>\").val(useDisplayText ? this._displayGetter(value[i]) : value[i]).attr(\"selected\", \"selected\"));\n    }\n\n    this._getSubmitElement().empty().append($options);\n  },\n  _initMarkup: function () {\n    this._tagElementsCache = (0, _renderer.default)();\n    var isSingleLineMode = !this.option(\"multiline\");\n    this.$element().addClass(TAGBOX_CLASS).toggleClass(TAGBOX_ONLY_SELECT_CLASS, !(this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\"))).toggleClass(TAGBOX_SINGLE_LINE_CLASS, isSingleLineMode);\n\n    this._initTagTemplate();\n\n    this.callBase();\n  },\n  _render: function () {\n    this.callBase();\n\n    this._renderTagRemoveAction();\n\n    this._renderSingleLineScroll();\n\n    this._scrollContainer(\"start\");\n  },\n  _initTagTemplate: function () {\n    this._tagTemplate = this._getTemplateByOption(\"tagTemplate\");\n  },\n  _renderField: function () {\n    var isDefaultFieldTemplate = !(0, _type.isDefined)(this.option(\"fieldTemplate\"));\n    this.$element().toggleClass(TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS, isDefaultFieldTemplate).toggleClass(TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS, !isDefaultFieldTemplate);\n    this.callBase();\n  },\n  _renderTagRemoveAction: function () {\n    var tagRemoveAction = this._createAction(this._removeTagHandler.bind(this));\n\n    var eventName = (0, _index.addNamespace)(_click.name, \"dxTagBoxTagRemove\");\n\n    _events_engine.default.off(this._$tagsContainer, eventName);\n\n    _events_engine.default.on(this._$tagsContainer, eventName, \".\".concat(TAGBOX_TAG_REMOVE_BUTTON_CLASS), function (event) {\n      tagRemoveAction({\n        event: event\n      });\n    });\n\n    this._renderTypingEvent();\n  },\n  _renderSingleLineScroll: function () {\n    var mouseWheelEvent = (0, _index.addNamespace)(\"dxmousewheel\", this.NAME);\n    var $element = this.$element();\n    var isMultiline = this.option(\"multiline\");\n\n    _events_engine.default.off($element, mouseWheelEvent);\n\n    if (\"desktop\" !== _devices.default.real().deviceType) {\n      this._$tagsContainer && this._$tagsContainer.css(\"overflowX\", isMultiline ? \"\" : \"auto\");\n      return;\n    }\n\n    if (isMultiline) {\n      return;\n    }\n\n    _events_engine.default.on($element, mouseWheelEvent, this._tagContainerMouseWheelHandler.bind(this));\n  },\n  _tagContainerMouseWheelHandler: function (e) {\n    var scrollLeft = this._$tagsContainer.scrollLeft();\n\n    var delta = e.delta * TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER;\n\n    if (!(0, _index.isCommandKeyPressed)(e) && (0, _utils3.allowScroll)(this._$tagsContainer, delta, true)) {\n      this._$tagsContainer.scrollLeft(scrollLeft + delta);\n\n      return false;\n    }\n  },\n  _renderTypingEvent: function () {\n    var _this2 = this;\n\n    var input = this._input();\n\n    var namespace = (0, _index.addNamespace)(\"keydown\", this.NAME);\n\n    _events_engine.default.off(input, namespace);\n\n    _events_engine.default.on(input, namespace, function (e) {\n      var keyName = (0, _index.normalizeKeyName)(e);\n\n      if (!_this2._isControlKey(keyName) && _this2._isEditable()) {\n        _this2._clearTagFocus();\n      }\n    });\n  },\n  _popupWrapperClass: function () {\n    return this.callBase() + \" \" + TAGBOX_POPUP_WRAPPER_CLASS;\n  },\n  _renderInput: function () {\n    this.callBase();\n\n    this._renderPreventBlur(this._inputWrapper());\n  },\n  _renderInputValueImpl: function () {\n    return this._renderMultiSelect();\n  },\n  _loadInputValue: function () {\n    return (0, _deferred.when)();\n  },\n  _clearTextValue: function () {\n    this._input().val(\"\");\n\n    this._toggleEmptinessEventHandler();\n\n    this.option(\"text\", \"\");\n  },\n  _focusInHandler: function (e) {\n    if (!this._preventNestedFocusEvent(e)) {\n      this._scrollContainer(\"end\");\n    }\n\n    this.callBase(e);\n  },\n  _renderInputValue: function () {\n    this.option(\"displayValue\", this._searchValue());\n    return this.callBase();\n  },\n  _restoreInputText: function (saveEditingValue) {\n    if (!saveEditingValue) {\n      this._clearTextValue();\n    }\n  },\n  _focusOutHandler: function (e) {\n    if (!this._preventNestedFocusEvent(e)) {\n      this._clearTagFocus();\n\n      this._scrollContainer(\"start\");\n    }\n\n    this.callBase(e);\n  },\n  _getFirstPopupElement: function () {\n    return this.option(\"showSelectionControls\") ? this._list.$element() : this.callBase();\n  },\n  _initSelectAllValueChangedAction: function () {\n    this._selectAllValueChangeAction = this._createActionByOption(\"onSelectAllValueChanged\");\n  },\n  _renderList: function () {\n    var _this3 = this;\n\n    this.callBase();\n\n    this._setListDataSourceFilter();\n\n    if (this.option(\"showSelectionControls\")) {\n      this._list.registerKeyHandler(\"tab\", function (e) {\n        return _this3._popupElementTabHandler(e);\n      });\n\n      this._list.registerKeyHandler(\"escape\", function (e) {\n        return _this3._popupElementEscHandler(e);\n      });\n    }\n  },\n  _canListHaveFocus: function () {\n    return \"useButtons\" === this.option(\"applyValueMode\");\n  },\n  _listConfig: function () {\n    var _this4 = this;\n\n    var selectionMode = this.option(\"showSelectionControls\") ? \"all\" : \"multiple\";\n    return (0, _extend.extend)(this.callBase(), {\n      selectionMode: selectionMode,\n      selectAllText: this.option(\"selectAllText\"),\n      onSelectAllValueChanged: function (_ref) {\n        var value = _ref.value;\n\n        _this4._selectAllValueChangeAction({\n          value: value\n        });\n      },\n      selectAllMode: this.option(\"selectAllMode\"),\n      selectedItems: this._selectedItems,\n      onFocusedItemChanged: null\n    });\n  },\n  _renderMultiSelect: function () {\n    var _this5 = this;\n\n    var d = new _deferred.Deferred();\n\n    this._updateTagsContainer(this._$textEditorInputContainer);\n\n    this._renderInputSize();\n\n    this._renderTags().done(function () {\n      _this5._popup && _this5._popup.refreshPosition();\n      d.resolve();\n    }).fail(d.reject);\n\n    return d.promise();\n  },\n  _listItemClickHandler: function (e) {\n    !this.option(\"showSelectionControls\") && this._clearTextValue();\n\n    if (\"useButtons\" === this.option(\"applyValueMode\")) {\n      return;\n    }\n\n    this.callBase(e);\n\n    this._saveValueChangeEvent(void 0);\n  },\n  _shouldClearFilter: function () {\n    var shouldClearFilter = this.callBase();\n    var showSelectionControls = this.option(\"showSelectionControls\");\n    return !showSelectionControls && shouldClearFilter;\n  },\n  _renderInputSize: function () {\n    var $input = this._input();\n\n    var value = $input.val();\n    var isEmptyInput = (0, _type.isString)(value) && value;\n    var cursorWidth = 5;\n    var width = \"\";\n    var size = \"\";\n    var canTypeText = this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\");\n\n    if (isEmptyInput && canTypeText) {\n      var $calculationElement = (0, _dom.createTextElementHiddenCopy)($input, value, {\n        includePaddings: true\n      });\n      $calculationElement.insertAfter($input);\n      width = $calculationElement.outerWidth() + cursorWidth;\n      $calculationElement.remove();\n    } else {\n      if (!value) {\n        size = 1;\n      }\n    }\n\n    $input.css(\"width\", width);\n    $input.attr(\"size\", size);\n  },\n  _renderInputSubstitution: function () {\n    this.callBase();\n\n    this._updateWidgetHeight();\n  },\n  _getValue: function () {\n    return this.option(\"value\") || [];\n  },\n  _multiTagRequired: function () {\n    var values = this._getValue();\n\n    var maxDisplayedTags = this.option(\"maxDisplayedTags\");\n    return (0, _type.isDefined)(maxDisplayedTags) && values.length > maxDisplayedTags;\n  },\n  _renderMultiTag: function ($input) {\n    var $tag = (0, _renderer.default)(\"<div>\").addClass(TAGBOX_TAG_CLASS).addClass(TAGBOX_MULTI_TAG_CLASS);\n    var args = {\n      multiTagElement: (0, _element.getPublicElement)($tag),\n      selectedItems: this.option(\"selectedItems\")\n    };\n\n    this._multiTagPreparingAction(args);\n\n    if (args.cancel) {\n      return false;\n    }\n\n    $tag.data(TAGBOX_TAG_DATA_KEY, args.text);\n    $tag.insertBefore($input);\n\n    this._tagTemplate.render({\n      model: args.text,\n      container: (0, _element.getPublicElement)($tag)\n    });\n\n    return $tag;\n  },\n  _getFilteredItems: function (values) {\n    var _this$_list,\n        _this6 = this;\n\n    var creator = new _selection_filter.SelectionFilterCreator(values);\n    var listSelectedItems = null === (_this$_list = this._list) || void 0 === _this$_list ? void 0 : _this$_list.option(\"selectedItems\");\n\n    var isListItemsLoaded = !!listSelectedItems && this._list.getDataSource().isLoaded();\n\n    var selectedItems = listSelectedItems || this.option(\"selectedItems\");\n    var clientFilterFunction = creator.getLocalFilter(this._valueGetter);\n    var filteredItems = selectedItems.filter(clientFilterFunction);\n    var selectedItemsAlreadyLoaded = filteredItems.length === values.length;\n    var d = new _deferred.Deferred();\n\n    if ((!this._isDataSourceChanged || isListItemsLoaded) && selectedItemsAlreadyLoaded) {\n      return d.resolve(filteredItems).promise();\n    } else {\n      var dataSource = this._dataSource;\n      var dataSourceFilter = dataSource.filter();\n      var filterExpr = creator.getCombinedFilter(this.option(\"valueExpr\"), dataSourceFilter);\n      var filterLength = encodeURI(JSON.stringify(filterExpr)).length;\n      var filter = filterLength > this.option(\"maxFilterLength\") ? void 0 : filterExpr;\n\n      var _dataSource$loadOptio = dataSource.loadOptions(),\n          customQueryParams = _dataSource$loadOptio.customQueryParams,\n          expand = _dataSource$loadOptio.expand,\n          select = _dataSource$loadOptio.select;\n\n      dataSource.store().load({\n        filter: filter,\n        customQueryParams: customQueryParams,\n        expand: expand,\n        select: select\n      }).done(function (data, extra) {\n        _this6._isDataSourceChanged = false;\n\n        if (_this6._disposed) {\n          d.reject();\n          return;\n        }\n\n        var _normalizeLoadResult = (0, _utils2.normalizeLoadResult)(data, extra),\n            items = _normalizeLoadResult.data;\n\n        var mappedItems = dataSource._applyMapFunction(items);\n\n        d.resolve(mappedItems.filter(clientFilterFunction));\n      }).fail(d.reject);\n      return d.promise();\n    }\n  },\n  _createTagsData: function (values, filteredItems) {\n    var _this7 = this;\n\n    var items = [];\n    var cache = {};\n\n    var isValueExprSpecified = \"this\" === this._valueGetterExpr();\n\n    var filteredValues = {};\n    filteredItems.forEach(function (filteredItem) {\n      var filteredItemValue = isValueExprSpecified ? JSON.stringify(filteredItem) : _this7._valueGetter(filteredItem);\n      filteredValues[filteredItemValue] = filteredItem;\n    });\n    var loadItemPromises = [];\n    values.forEach(function (value, index) {\n      var currentItem = filteredValues[isValueExprSpecified ? JSON.stringify(value) : value];\n\n      if (isValueExprSpecified && !(0, _type.isDefined)(currentItem)) {\n        loadItemPromises.push(_this7._loadItem(value, cache).always(function (item) {\n          var newItem = _this7._createTagData(items, item, value, index);\n\n          items.splice(index, 0, newItem);\n        }));\n      } else {\n        var newItem = _this7._createTagData(items, currentItem, value, index);\n\n        items.splice(index, 0, newItem);\n      }\n    });\n    var d = new _deferred.Deferred();\n\n    _deferred.when.apply(this, loadItemPromises).always(function () {\n      d.resolve(items);\n    });\n\n    return d.promise();\n  },\n  _createTagData: function (items, item, value, valueIndex) {\n    if ((0, _type.isDefined)(item)) {\n      this._selectedItems.push(item);\n\n      return item;\n    } else {\n      var selectedItem = this.option(\"selectedItem\");\n      var customItem = this._valueGetter(selectedItem) === value ? selectedItem : value;\n      return customItem;\n    }\n  },\n  _isGroupedData: function () {\n    return this.option(\"grouped\") && !this._dataSource.group();\n  },\n  _getItemsByValues: function (values) {\n    var resultItems = [];\n    values.forEach(function (value) {\n      var item = this._getItemFromPlain(value);\n\n      if ((0, _type.isDefined)(item)) {\n        resultItems.push(item);\n      }\n    }.bind(this));\n    return resultItems;\n  },\n  _getFilteredGroupedItems: function (values) {\n    var selectedItems = new _deferred.Deferred();\n\n    if (!this._dataSource.items().length) {\n      this._dataSource.load().done(function () {\n        selectedItems.resolve(this._getItemsByValues(values));\n      }.bind(this)).fail(selectedItems.resolve([]));\n    } else {\n      selectedItems.resolve(this._getItemsByValues(values));\n    }\n\n    return selectedItems.promise();\n  },\n  _loadTagsData: function () {\n    var _this8 = this;\n\n    var values = this._getValue();\n\n    var tagData = new _deferred.Deferred();\n    this._selectedItems = [];\n    var filteredItemsPromise = this._isGroupedData() ? this._getFilteredGroupedItems(values) : this._getFilteredItems(values);\n    filteredItemsPromise.done(function (filteredItems) {\n      var items = _this8._createTagsData(values, filteredItems);\n\n      items.always(function (data) {\n        tagData.resolve(data);\n      });\n    }).fail(tagData.reject.bind(this));\n    return tagData.promise();\n  },\n  _renderTags: function () {\n    var _this9 = this;\n\n    var d = new _deferred.Deferred();\n    var isPlainDataUsed = false;\n\n    if (this._shouldGetItemsFromPlain(this._valuesToUpdate)) {\n      this._selectedItems = this._getItemsFromPlain(this._valuesToUpdate);\n\n      if (this._selectedItems.length === this._valuesToUpdate.length) {\n        this._renderTagsImpl(this._selectedItems);\n\n        isPlainDataUsed = true;\n        d.resolve();\n      }\n    }\n\n    if (!isPlainDataUsed) {\n      this._loadTagsData().done(function (items) {\n        if (_this9._disposed) {\n          d.reject();\n          return;\n        }\n\n        _this9._renderTagsImpl(items);\n\n        d.resolve();\n      }).fail(d.reject);\n    }\n\n    return d.promise();\n  },\n  _renderTagsImpl: function (items) {\n    this._renderTagsCore(items);\n\n    this._renderEmptyState();\n\n    if (!this._preserveFocusedTag) {\n      this._clearTagFocus();\n    }\n  },\n  _shouldGetItemsFromPlain: function (values) {\n    return values && this._dataSource.isLoaded() && values.length <= this._getPlainItems().length;\n  },\n  _getItemsFromPlain: function (values) {\n    var selectedItems = this._getSelectedItemsFromList(values);\n\n    var needFilterPlainItems = 0 === selectedItems.length && values.length > 0 || selectedItems.length < values.length;\n\n    if (needFilterPlainItems) {\n      var plainItems = this._getPlainItems();\n\n      selectedItems = this._filterSelectedItems(plainItems, values);\n    }\n\n    return selectedItems;\n  },\n  _getSelectedItemsFromList: function (values) {\n    var _this$_list2;\n\n    var listSelectedItems = null === (_this$_list2 = this._list) || void 0 === _this$_list2 ? void 0 : _this$_list2.option(\"selectedItems\");\n    var selectedItems = [];\n\n    if (values.length === (null === listSelectedItems || void 0 === listSelectedItems ? void 0 : listSelectedItems.length)) {\n      selectedItems = this._filterSelectedItems(listSelectedItems, values);\n    }\n\n    return selectedItems;\n  },\n  _filterSelectedItems: function (plainItems, values) {\n    var _this10 = this;\n\n    var selectedItems = plainItems.filter(function (dataItem) {\n      var currentValue;\n\n      for (var i = 0; i < values.length; i++) {\n        currentValue = values[i];\n\n        if ((0, _type.isObject)(currentValue)) {\n          if (_this10._isValueEquals(dataItem, currentValue)) {\n            return true;\n          }\n        } else {\n          if (_this10._isValueEquals(_this10._valueGetter(dataItem), currentValue)) {\n            return true;\n          }\n        }\n      }\n\n      return false;\n    }, this);\n    return selectedItems;\n  },\n  _integrateInput: function () {\n    this.callBase();\n\n    this._updateTagsContainer((0, _renderer.default)(\".\".concat(TEXTEDITOR_INPUT_CONTAINER_CLASS)));\n\n    this._renderTagRemoveAction();\n  },\n  _renderTagsCore: function (items) {\n    var _this11 = this;\n\n    this._renderField();\n\n    this.option(\"selectedItems\", this._selectedItems.slice());\n\n    this._cleanTags();\n\n    var $multiTag = this._multiTagRequired() && this._renderMultiTag(this._input());\n\n    var showMultiTagOnly = this.option(\"showMultiTagOnly\");\n    var maxDisplayedTags = this.option(\"maxDisplayedTags\");\n    items.forEach(function (item, index) {\n      if ($multiTag && showMultiTagOnly || $multiTag && !showMultiTagOnly && index - maxDisplayedTags >= -1) {\n        return false;\n      }\n\n      _this11._renderTag(item, $multiTag || _this11._input());\n    });\n\n    if (this._isFocused()) {\n      this._scrollContainer(\"end\");\n    }\n\n    this._refreshTagElements();\n  },\n  _cleanTags: function () {\n    if (this._multiTagRequired()) {\n      this._tagElements().remove();\n    } else {\n      var $tags = this._tagElements();\n\n      var values = this._getValue();\n\n      (0, _iterator.each)($tags, function (_, tag) {\n        var $tag = (0, _renderer.default)(tag);\n        var index = (0, _array.inArray)($tag.data(TAGBOX_TAG_DATA_KEY), values);\n\n        if (index < 0) {\n          $tag.remove();\n        }\n      });\n    }\n  },\n  _renderEmptyState: function () {\n    var isEmpty = !(this._getValue().length || this._selectedItems.length || this._searchValue());\n\n    this._toggleEmptiness(isEmpty);\n\n    this._renderDisplayText();\n  },\n  _renderDisplayText: function () {\n    this._renderInputSize();\n  },\n  _refreshTagElements: function () {\n    this._tagElementsCache = this.$element().find(\".\".concat(TAGBOX_TAG_CLASS));\n  },\n  _tagElements: function () {\n    return this._tagElementsCache;\n  },\n  _applyTagTemplate: function (item, $tag) {\n    this._tagTemplate.render({\n      model: item,\n      container: (0, _element.getPublicElement)($tag)\n    });\n  },\n  _renderTag: function (item, $input) {\n    var value = this._valueGetter(item);\n\n    if (!(0, _type.isDefined)(value)) {\n      return;\n    }\n\n    var $tag = this._getTag(value);\n\n    var displayValue = this._displayGetter(item);\n\n    var itemModel = this._getItemModel(item, displayValue);\n\n    if ($tag) {\n      if ((0, _type.isDefined)(displayValue)) {\n        $tag.empty();\n\n        this._applyTagTemplate(itemModel, $tag);\n      }\n\n      $tag.removeClass(TAGBOX_CUSTOM_TAG_CLASS);\n    } else {\n      $tag = this._createTag(value, $input);\n\n      if ((0, _type.isDefined)(item)) {\n        this._applyTagTemplate(itemModel, $tag);\n      } else {\n        $tag.addClass(TAGBOX_CUSTOM_TAG_CLASS);\n\n        this._applyTagTemplate(value, $tag);\n      }\n    }\n  },\n  _getItemModel: function (item, displayValue) {\n    if ((0, _type.isObject)(item) && (0, _type.isDefined)(displayValue)) {\n      return item;\n    } else {\n      return (0, _common.ensureDefined)(displayValue, \"\");\n    }\n  },\n  _getTag: function (value) {\n    var $tags = this._tagElements();\n\n    var tagsLength = $tags.length;\n    var result = false;\n\n    for (var i = 0; i < tagsLength; i++) {\n      var $tag = $tags[i];\n      var tagData = (0, _element_data.data)($tag, TAGBOX_TAG_DATA_KEY);\n\n      if (value === tagData || (0, _common.equalByValue)(value, tagData)) {\n        result = (0, _renderer.default)($tag);\n        break;\n      }\n    }\n\n    return result;\n  },\n  _createTag: function (value, $input) {\n    return (0, _renderer.default)(\"<div>\").addClass(TAGBOX_TAG_CLASS).data(TAGBOX_TAG_DATA_KEY, value).insertBefore($input);\n  },\n  _toggleEmptinessEventHandler: function () {\n    this._toggleEmptiness(!this._getValue().length && !this._searchValue().length);\n  },\n  _customItemAddedHandler: function (e) {\n    this.callBase(e);\n\n    this._clearTextValue();\n  },\n  _removeTagHandler: function (args) {\n    var e = args.event;\n    e.stopPropagation();\n\n    this._saveValueChangeEvent(e);\n\n    var $tag = (0, _renderer.default)(e.target).closest(\".\".concat(TAGBOX_TAG_CLASS));\n\n    this._removeTagElement($tag);\n  },\n  _removeTagElement: function ($tag) {\n    if ($tag.hasClass(TAGBOX_MULTI_TAG_CLASS)) {\n      if (!this.option(\"showMultiTagOnly\")) {\n        this.option(\"value\", this._getValue().slice(0, this.option(\"maxDisplayedTags\")));\n      } else {\n        this.reset();\n      }\n\n      return;\n    }\n\n    var itemValue = $tag.data(TAGBOX_TAG_DATA_KEY);\n\n    this._removeTagWithUpdate(itemValue);\n\n    this._refreshTagElements();\n  },\n  _updateField: _common.noop,\n  _removeTagWithUpdate: function (itemValue) {\n    var value = this._getValue().slice();\n\n    this._removeTag(value, itemValue);\n\n    this.option(\"value\", value);\n\n    if (0 === value.length) {\n      this._clearTagFocus();\n    }\n  },\n  _getCurrentValue: function () {\n    return this._lastValue();\n  },\n  _selectionChangeHandler: function (e) {\n    var _this12 = this;\n\n    if (\"useButtons\" === this.option(\"applyValueMode\")) {\n      return;\n    }\n\n    var value = this._getValue().slice();\n\n    (0, _iterator.each)(e.removedItems || [], function (_, removedItem) {\n      _this12._removeTag(value, _this12._valueGetter(removedItem));\n    });\n    (0, _iterator.each)(e.addedItems || [], function (_, addedItem) {\n      _this12._addTag(value, _this12._valueGetter(addedItem));\n    });\n\n    this._updateWidgetHeight();\n\n    if (!(0, _common.equalByValue)(this._list.option(\"selectedItemKeys\"), this.option(\"value\"))) {\n      var listSelectionChangeEvent = this._list._getSelectionChangeEvent();\n\n      listSelectionChangeEvent && this._saveValueChangeEvent(listSelectionChangeEvent);\n      this.option(\"value\", value);\n    }\n\n    this._list._saveSelectionChangeEvent(void 0);\n  },\n  _removeTag: function (value, item) {\n    var index = this._valueIndex(item, value);\n\n    if (index >= 0) {\n      value.splice(index, 1);\n    }\n  },\n  _addTag: function (value, item) {\n    var index = this._valueIndex(item);\n\n    if (index < 0) {\n      value.push(item);\n    }\n  },\n  _fieldRenderData: function () {\n    return this._selectedItems.slice();\n  },\n  _completeSelection: function (value) {\n    if (!this.option(\"showSelectionControls\")) {\n      this._setValue(value);\n    }\n  },\n  _setValue: function (value) {\n    if (null === value) {\n      return;\n    }\n\n    var useButtons = \"useButtons\" === this.option(\"applyValueMode\");\n\n    var valueIndex = this._valueIndex(value);\n\n    var values = (useButtons ? this._list.option(\"selectedItemKeys\") : this._getValue()).slice();\n\n    if (valueIndex >= 0) {\n      values.splice(valueIndex, 1);\n    } else {\n      values.push(value);\n    }\n\n    if (\"useButtons\" === this.option(\"applyValueMode\")) {\n      this._list.option(\"selectedItemKeys\", values);\n    } else {\n      this.option(\"value\", values);\n    }\n  },\n  _isSelectedValue: function (value, cache) {\n    return this._valueIndex(value, null, cache) > -1;\n  },\n  _valueIndex: function (value, values, cache) {\n    var _this13 = this;\n\n    var result = -1;\n\n    if (cache && \"object\" !== _typeof(value)) {\n      if (!cache.indexByValues) {\n        cache.indexByValues = {};\n        values = values || this._getValue();\n        values.forEach(function (value, index) {\n          cache.indexByValues[value] = index;\n        });\n      }\n\n      if (value in cache.indexByValues) {\n        return cache.indexByValues[value];\n      }\n    }\n\n    values = values || this._getValue();\n    (0, _iterator.each)(values, function (index, selectedValue) {\n      if (_this13._isValueEquals(value, selectedValue)) {\n        result = index;\n        return false;\n      }\n    });\n    return result;\n  },\n  _lastValue: function () {\n    var values = this._getValue();\n\n    var lastValue = values[values.length - 1];\n    return null !== lastValue && void 0 !== lastValue ? lastValue : null;\n  },\n  _valueChangeEventHandler: _common.noop,\n  _shouldRenderSearchEvent: function () {\n    return this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\");\n  },\n  _searchHandler: function (e) {\n    if (this.option(\"searchEnabled\") && !!e && !this._isTagRemoved) {\n      this.callBase(e);\n\n      this._setListDataSourceFilter();\n    }\n\n    this._updateWidgetHeight();\n\n    delete this._isTagRemoved;\n  },\n  _updateWidgetHeight: function () {\n    var element = this.$element();\n    var originalHeight = element.height();\n\n    this._renderInputSize();\n\n    var currentHeight = element.height();\n\n    if (this._popup && this.option(\"opened\") && this._isEditable() && currentHeight !== originalHeight) {\n      this._popup.repaint();\n    }\n  },\n  _refreshSelected: function () {\n    var _this$_list3;\n\n    (null === (_this$_list3 = this._list) || void 0 === _this$_list3 ? void 0 : _this$_list3.getDataSource()) && this._list.option(\"selectedItems\", this._selectedItems);\n  },\n  _resetListDataSourceFilter: function () {\n    var dataSource = this._getDataSource();\n\n    if (!dataSource) {\n      return;\n    }\n\n    delete this._userFilter;\n    dataSource.filter(null);\n    dataSource.reload();\n  },\n  _setListDataSourceFilter: function () {\n    if (!this.option(\"hideSelectedItems\") || !this._list) {\n      return;\n    }\n\n    var dataSource = this._getDataSource();\n\n    if (!dataSource) {\n      return;\n    }\n\n    var valueGetterExpr = this._valueGetterExpr();\n\n    if ((0, _type.isString)(valueGetterExpr) && \"this\" !== valueGetterExpr) {\n      var filter = this._dataSourceFilterExpr();\n\n      if (void 0 === this._userFilter) {\n        this._userFilter = dataSource.filter() || null;\n      }\n\n      this._userFilter && filter.push(this._userFilter);\n      filter.length ? dataSource.filter(filter) : dataSource.filter(null);\n    } else {\n      dataSource.filter(this._dataSourceFilterFunction.bind(this));\n    }\n\n    dataSource.load();\n  },\n  _dataSourceFilterExpr: function () {\n    var _this14 = this;\n\n    var filter = [];\n    (0, _iterator.each)(this._getValue(), function (index, value) {\n      filter.push([\"!\", [_this14._valueGetterExpr(), value]]);\n    });\n    return filter;\n  },\n  _dataSourceFilterFunction: function (itemData) {\n    var _this15 = this;\n\n    var itemValue = this._valueGetter(itemData);\n\n    var result = true;\n    (0, _iterator.each)(this._getValue(), function (index, value) {\n      if (_this15._isValueEquals(value, itemValue)) {\n        result = false;\n        return false;\n      }\n    });\n    return result;\n  },\n  _dataSourceChangedHandler: function () {\n    this._isDataSourceChanged = true;\n    this.callBase.apply(this, arguments);\n  },\n  _applyButtonHandler: function (args) {\n    this._saveValueChangeEvent(args.event);\n\n    this.option(\"value\", this._getSortedListValues());\n\n    this._clearTextValue();\n\n    this.callBase();\n\n    this._cancelSearchIfNeed();\n  },\n  _getSortedListValues: function () {\n    var listValues = this._getListValues();\n\n    var currentValue = this.option(\"value\") || [];\n    var existedItems = listValues.length ? currentValue.filter(function (item) {\n      return listValues.indexOf(item) !== -1;\n    }) : [];\n    var newItems = existedItems.length ? listValues.filter(function (item) {\n      return currentValue.indexOf(item) === -1;\n    }) : listValues;\n    return existedItems.concat(newItems);\n  },\n  _getListValues: function () {\n    var _this16 = this;\n\n    if (!this._list) {\n      return [];\n    }\n\n    var selectedItems = this._getPlainItems(this._list.option(\"selectedItems\"));\n\n    var result = [];\n    (0, _iterator.each)(selectedItems, function (index, item) {\n      result[index] = _this16._valueGetter(item);\n    });\n    return result;\n  },\n  _setListDataSource: function () {\n    var currentValue = this._getValue();\n\n    this.callBase();\n\n    if (currentValue !== this.option(\"value\")) {\n      this.option(\"value\", currentValue);\n    }\n\n    this._refreshSelected();\n  },\n  _renderOpenedState: function () {\n    this.callBase();\n\n    if (\"useButtons\" === this.option(\"applyValueMode\") && !this.option(\"opened\")) {\n      this._refreshSelected();\n    }\n  },\n  reset: function () {\n    this._restoreInputText();\n\n    var defaultValue = this._getDefaultOptions().value;\n\n    var currentValue = this.option(\"value\");\n\n    if (defaultValue && 0 === defaultValue.length && currentValue && defaultValue.length === currentValue.length) {\n      return;\n    }\n\n    this.callBase();\n  },\n  _clean: function () {\n    this.callBase();\n    delete this._defaultTagTemplate;\n    delete this._valuesToUpdate;\n    delete this._tagTemplate;\n  },\n  _removeDuplicates: function (from, what) {\n    var _this17 = this;\n\n    var result = [];\n    (0, _iterator.each)(from, function (_, value) {\n      var filteredItems = what.filter(function (item) {\n        return _this17._valueGetter(value) === _this17._valueGetter(item);\n      });\n\n      if (!filteredItems.length) {\n        result.push(value);\n      }\n    });\n    return result;\n  },\n  _optionChanged: function (args) {\n    switch (args.name) {\n      case \"onSelectAllValueChanged\":\n        this._initSelectAllValueChangedAction();\n\n        break;\n\n      case \"onMultiTagPreparing\":\n        this._initMultiTagPreparingAction();\n\n        this._renderTags();\n\n        break;\n\n      case \"hideSelectedItems\":\n        if (args.value) {\n          this._setListDataSourceFilter();\n        } else {\n          this._resetListDataSourceFilter();\n        }\n\n        break;\n\n      case \"useSubmitBehavior\":\n        this._toggleSubmitElement(args.value);\n\n        break;\n\n      case \"displayExpr\":\n        this.callBase(args);\n\n        this._initTemplates();\n\n        this._invalidate();\n\n        break;\n\n      case \"tagTemplate\":\n        this._initTagTemplate();\n\n        this._invalidate();\n\n        break;\n\n      case \"selectAllText\":\n        this._setListOption(\"selectAllText\", this.option(\"selectAllText\"));\n\n        break;\n\n      case \"readOnly\":\n      case \"disabled\":\n        this.callBase(args);\n        !args.value && this._renderTypingEvent();\n        break;\n\n      case \"value\":\n        this._valuesToUpdate = null === args || void 0 === args ? void 0 : args.value;\n        this.callBase(args);\n        this._valuesToUpdate = void 0;\n\n        this._setListDataSourceFilter();\n\n        break;\n\n      case \"maxDisplayedTags\":\n      case \"showMultiTagOnly\":\n        this._renderTags();\n\n        break;\n\n      case \"selectAllMode\":\n        this._setListOption(args.name, args.value);\n\n        break;\n\n      case \"selectedItem\":\n        break;\n\n      case \"selectedItems\":\n        this._selectionChangedAction({\n          addedItems: this._removeDuplicates(args.value, args.previousValue),\n          removedItems: this._removeDuplicates(args.previousValue, args.value)\n        });\n\n        break;\n\n      case \"multiline\":\n        this.$element().toggleClass(TAGBOX_SINGLE_LINE_CLASS, !args.value);\n\n        this._renderSingleLineScroll();\n\n        break;\n\n      case \"maxFilterLength\":\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  },\n  _getActualSearchValue: function () {\n    return this.callBase() || this._searchValue();\n  },\n  _popupHidingHandler: function () {\n    this.callBase();\n\n    this._clearFilter();\n  }\n});\n\n(0, _component_registrator.default)(\"dxTagBox\", TagBox);\nvar _default = TagBox;\nexports.default = _default;\nmodule.exports = exports.default;\nmodule.exports.default = module.exports;","map":{"version":3,"sources":["C:/Smart-Virtual-Classroom/client/node_modules/devextreme/ui/tag_box.js"],"names":["exports","default","_renderer","_interopRequireDefault","require","_devices","_element_data","_events_engine","_component_registrator","_common","_selection_filter","_deferred","_dom","_element","_type","_window","_extend","_array","_iterator","_message","_index","_click","_utils","_utils2","_scroll_rtl_behavior","_select_box","_bindable_template","_utils3","obj","__esModule","_typeof","Symbol","iterator","constructor","prototype","TAGBOX_TAG_DATA_KEY","TAGBOX_CLASS","TAGBOX_TAG_CONTAINER_CLASS","TAGBOX_TAG_CLASS","TAGBOX_MULTI_TAG_CLASS","TAGBOX_CUSTOM_TAG_CLASS","TAGBOX_TAG_REMOVE_BUTTON_CLASS","TAGBOX_ONLY_SELECT_CLASS","TAGBOX_SINGLE_LINE_CLASS","TAGBOX_POPUP_WRAPPER_CLASS","TAGBOX_TAG_CONTENT_CLASS","TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS","TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS","NATIVE_CLICK_CLASS","TEXTEDITOR_INPUT_CONTAINER_CLASS","TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER","TagBox","inherit","_supportedKeys","_this","parent","callBase","sendToList","options","_list","_keyboardHandler","rtlEnabled","option","extend","backspace","e","_isCaretAtTheStart","_processKeyboardEvent","_isTagRemoved","$tagToDelete","_$focusedTag","_tagElements","last","_moveTagFocus","length","_preserveFocusedTag","_removeTagElement","upArrow","opts","altKey","call","downArrow","del","enter","isListItemFocused","isCustomItem","preventDefault","_searchValue","_customItemAddedHandler","_saveValueChangeEvent","space","isOpened","isInputActive","_shouldRenderSearchEvent","leftArrow","_isEmpty","_isEditable","direction","_scrollContainer","rightArrow","stopPropagation","_getValue","_updateTagsContainer","$element","_$tagsContainer","addClass","_allowSelectItemByTab","position","_input","start","end","clearOnBoundary","tagElements","first","_toggleFocusClass","$nextFocusedTag","concat","_replaceFocusedTag","_clearTagFocus","_focusClassTarget","_focusTarget","hasWindow","scrollPosition","_getScrollPosition","scrollLeft","_getBorderPosition","_getFocusedTagPosition","isScrollLeft","scrollBehavior","isScrollInverted","decreasing","positive","scrollSign","get","scrollWidth","outerWidth","_this$_$focusedTag$po","scrollOffset","left","scrollCorrection","_setNextValue","noop","_getDefaultOptions","value","showDropDownButton","maxFilterLength","tagTemplate","selectAllText","format","hideSelectedItems","selectedItems","selectAllMode","onSelectAllValueChanged","maxDisplayedTags","showMultiTagOnly","onMultiTagPreparing","multiline","useSubmitBehavior","_init","_selectedItems","_initSelectAllValueChangedAction","_initActions","_initMultiTagPreparingAction","_multiTagPreparingAction","_createActionByOption","beforeExecute","_multiTagPreparingHandler","args","bind","excludeValidators","_this$_getValue","selectedCount","text","getFormatter","_initDynamicTemplates","_templateManager","addDefaultTemplates","tag","BindableTemplate","$container","data","_data$text","$tagContent","appendTo","append","_displayGetter","_toggleSubmitElement","enabled","_renderSubmitElement","_setSubmitValue","_$submitElement","remove","attr","css","$options","i","n","useDisplayText","_shouldUseDisplayValue","push","val","_getSubmitElement","empty","_initMarkup","_tagElementsCache","isSingleLineMode","toggleClass","_initTagTemplate","_render","_renderTagRemoveAction","_renderSingleLineScroll","_tagTemplate","_getTemplateByOption","_renderField","isDefaultFieldTemplate","isDefined","tagRemoveAction","_createAction","_removeTagHandler","eventName","addNamespace","name","off","on","event","_renderTypingEvent","mouseWheelEvent","NAME","isMultiline","real","deviceType","_tagContainerMouseWheelHandler","delta","isCommandKeyPressed","allowScroll","_this2","input","namespace","keyName","normalizeKeyName","_isControlKey","_popupWrapperClass","_renderInput","_renderPreventBlur","_inputWrapper","_renderInputValueImpl","_renderMultiSelect","_loadInputValue","when","_clearTextValue","_toggleEmptinessEventHandler","_focusInHandler","_preventNestedFocusEvent","_renderInputValue","_restoreInputText","saveEditingValue","_focusOutHandler","_getFirstPopupElement","_selectAllValueChangeAction","_renderList","_this3","_setListDataSourceFilter","registerKeyHandler","_popupElementTabHandler","_popupElementEscHandler","_canListHaveFocus","_listConfig","_this4","selectionMode","_ref","onFocusedItemChanged","_this5","d","Deferred","_$textEditorInputContainer","_renderInputSize","_renderTags","done","_popup","refreshPosition","resolve","fail","reject","promise","_listItemClickHandler","_shouldClearFilter","shouldClearFilter","showSelectionControls","$input","isEmptyInput","isString","cursorWidth","width","size","canTypeText","$calculationElement","createTextElementHiddenCopy","includePaddings","insertAfter","_renderInputSubstitution","_updateWidgetHeight","_multiTagRequired","values","_renderMultiTag","$tag","multiTagElement","getPublicElement","cancel","insertBefore","render","model","container","_getFilteredItems","_this$_list","_this6","creator","SelectionFilterCreator","listSelectedItems","isListItemsLoaded","getDataSource","isLoaded","clientFilterFunction","getLocalFilter","_valueGetter","filteredItems","filter","selectedItemsAlreadyLoaded","_isDataSourceChanged","dataSource","_dataSource","dataSourceFilter","filterExpr","getCombinedFilter","filterLength","encodeURI","JSON","stringify","_dataSource$loadOptio","loadOptions","customQueryParams","expand","select","store","load","extra","_disposed","_normalizeLoadResult","normalizeLoadResult","items","mappedItems","_applyMapFunction","_createTagsData","_this7","cache","isValueExprSpecified","_valueGetterExpr","filteredValues","forEach","filteredItem","filteredItemValue","loadItemPromises","index","currentItem","_loadItem","always","item","newItem","_createTagData","splice","apply","valueIndex","selectedItem","customItem","_isGroupedData","group","_getItemsByValues","resultItems","_getItemFromPlain","_getFilteredGroupedItems","_loadTagsData","_this8","tagData","filteredItemsPromise","_this9","isPlainDataUsed","_shouldGetItemsFromPlain","_valuesToUpdate","_getItemsFromPlain","_renderTagsImpl","_renderTagsCore","_renderEmptyState","_getPlainItems","_getSelectedItemsFromList","needFilterPlainItems","plainItems","_filterSelectedItems","_this$_list2","_this10","dataItem","currentValue","isObject","_isValueEquals","_integrateInput","_this11","slice","_cleanTags","$multiTag","_renderTag","_isFocused","_refreshTagElements","$tags","each","_","inArray","isEmpty","_toggleEmptiness","_renderDisplayText","find","_applyTagTemplate","_getTag","displayValue","itemModel","_getItemModel","removeClass","_createTag","ensureDefined","tagsLength","result","equalByValue","target","closest","hasClass","reset","itemValue","_removeTagWithUpdate","_updateField","_removeTag","_getCurrentValue","_lastValue","_selectionChangeHandler","_this12","removedItems","removedItem","addedItems","addedItem","_addTag","listSelectionChangeEvent","_getSelectionChangeEvent","_saveSelectionChangeEvent","_valueIndex","_fieldRenderData","_completeSelection","_setValue","useButtons","_isSelectedValue","_this13","indexByValues","selectedValue","lastValue","_valueChangeEventHandler","_searchHandler","element","originalHeight","height","currentHeight","repaint","_refreshSelected","_this$_list3","_resetListDataSourceFilter","_getDataSource","_userFilter","reload","valueGetterExpr","_dataSourceFilterExpr","_dataSourceFilterFunction","_this14","itemData","_this15","_dataSourceChangedHandler","arguments","_applyButtonHandler","_getSortedListValues","_cancelSearchIfNeed","listValues","_getListValues","existedItems","indexOf","newItems","_this16","_setListDataSource","_renderOpenedState","defaultValue","_clean","_defaultTagTemplate","_removeDuplicates","from","what","_this17","_optionChanged","_initTemplates","_invalidate","_setListOption","_selectionChangedAction","previousValue","_getActualSearchValue","_popupHidingHandler","_clearFilter","_default","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/tag_box.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _renderer = _interopRequireDefault(require(\"../core/renderer\"));\r\nvar _devices = _interopRequireDefault(require(\"../core/devices\"));\r\nvar _element_data = require(\"../core/element_data\");\r\nvar _events_engine = _interopRequireDefault(require(\"../events/core/events_engine\"));\r\nvar _component_registrator = _interopRequireDefault(require(\"../core/component_registrator\"));\r\nvar _common = require(\"../core/utils/common\");\r\nvar _selection_filter = require(\"../core/utils/selection_filter\");\r\nvar _deferred = require(\"../core/utils/deferred\");\r\nvar _dom = require(\"../core/utils/dom\");\r\nvar _element = require(\"../core/element\");\r\nvar _type = require(\"../core/utils/type\");\r\nvar _window = require(\"../core/utils/window\");\r\nvar _extend = require(\"../core/utils/extend\");\r\nvar _array = require(\"../core/utils/array\");\r\nvar _iterator = require(\"../core/utils/iterator\");\r\nvar _message = _interopRequireDefault(require(\"../localization/message\"));\r\nvar _index = require(\"../events/utils/index\");\r\nvar _click = require(\"../events/click\");\r\nvar _utils = _interopRequireDefault(require(\"./text_box/utils.caret\"));\r\nvar _utils2 = require(\"../data/data_source/utils\");\r\nvar _scroll_rtl_behavior = _interopRequireDefault(require(\"../core/utils/scroll_rtl_behavior\"));\r\nvar _select_box = _interopRequireDefault(require(\"./select_box\"));\r\nvar _bindable_template = require(\"../core/templates/bindable_template\");\r\nvar _utils3 = require(\"./text_box/utils.scroll\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _typeof(obj) {\r\n    \"@babel/helpers - typeof\";\r\n    if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\r\n        _typeof = function(obj) {\r\n            return typeof obj\r\n        }\r\n    } else {\r\n        _typeof = function(obj) {\r\n            return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj\r\n        }\r\n    }\r\n    return _typeof(obj)\r\n}\r\nvar TAGBOX_TAG_DATA_KEY = \"dxTagData\";\r\nvar TAGBOX_CLASS = \"dx-tagbox\";\r\nvar TAGBOX_TAG_CONTAINER_CLASS = \"dx-tag-container\";\r\nvar TAGBOX_TAG_CLASS = \"dx-tag\";\r\nvar TAGBOX_MULTI_TAG_CLASS = \"dx-tagbox-multi-tag\";\r\nvar TAGBOX_CUSTOM_TAG_CLASS = \"dx-tag-custom\";\r\nvar TAGBOX_TAG_REMOVE_BUTTON_CLASS = \"dx-tag-remove-button\";\r\nvar TAGBOX_ONLY_SELECT_CLASS = \"dx-tagbox-only-select\";\r\nvar TAGBOX_SINGLE_LINE_CLASS = \"dx-tagbox-single-line\";\r\nvar TAGBOX_POPUP_WRAPPER_CLASS = \"dx-tagbox-popup-wrapper\";\r\nvar TAGBOX_TAG_CONTENT_CLASS = \"dx-tag-content\";\r\nvar TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS = \"dx-tagbox-default-template\";\r\nvar TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS = \"dx-tagbox-custom-template\";\r\nvar NATIVE_CLICK_CLASS = \"dx-native-click\";\r\nvar TEXTEDITOR_INPUT_CONTAINER_CLASS = \"dx-texteditor-input-container\";\r\nvar TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER = -.3;\r\nvar TagBox = _select_box.default.inherit({\r\n    _supportedKeys: function() {\r\n        var _this = this;\r\n        var parent = this.callBase();\r\n        var sendToList = function(options) {\r\n            return _this._list._keyboardHandler(options)\r\n        };\r\n        var rtlEnabled = this.option(\"rtlEnabled\");\r\n        return (0, _extend.extend)({}, parent, {\r\n            backspace: function(e) {\r\n                if (!this._isCaretAtTheStart()) {\r\n                    return\r\n                }\r\n                this._processKeyboardEvent(e);\r\n                this._isTagRemoved = true;\r\n                var $tagToDelete = this._$focusedTag || this._tagElements().last();\r\n                if (this._$focusedTag) {\r\n                    this._moveTagFocus(\"prev\", true)\r\n                }\r\n                if (0 === $tagToDelete.length) {\r\n                    return\r\n                }\r\n                this._preserveFocusedTag = true;\r\n                this._removeTagElement($tagToDelete);\r\n                delete this._preserveFocusedTag\r\n            },\r\n            upArrow: function(e, opts) {\r\n                return e.altKey || !_this._list ? parent.upArrow.call(_this, e) : sendToList(opts)\r\n            },\r\n            downArrow: function(e, opts) {\r\n                return e.altKey || !_this._list ? parent.downArrow.call(_this, e) : sendToList(opts)\r\n            },\r\n            del: function(e) {\r\n                if (!this._$focusedTag || !this._isCaretAtTheStart()) {\r\n                    return\r\n                }\r\n                this._processKeyboardEvent(e);\r\n                this._isTagRemoved = true;\r\n                var $tagToDelete = this._$focusedTag;\r\n                this._moveTagFocus(\"next\", true);\r\n                this._preserveFocusedTag = true;\r\n                this._removeTagElement($tagToDelete);\r\n                delete this._preserveFocusedTag\r\n            },\r\n            enter: function(e, options) {\r\n                var isListItemFocused = this._list && null !== this._list.option(\"focusedElement\");\r\n                var isCustomItem = this.option(\"acceptCustomValue\") && !isListItemFocused;\r\n                if (isCustomItem) {\r\n                    e.preventDefault();\r\n                    \"\" !== this._searchValue() && this._customItemAddedHandler(e);\r\n                    return\r\n                }\r\n                if (this.option(\"opened\")) {\r\n                    this._saveValueChangeEvent(e);\r\n                    sendToList(options);\r\n                    e.preventDefault()\r\n                }\r\n            },\r\n            space: function(e, options) {\r\n                var isOpened = this.option(\"opened\");\r\n                var isInputActive = this._shouldRenderSearchEvent();\r\n                if (isOpened && !isInputActive) {\r\n                    this._saveValueChangeEvent(e);\r\n                    sendToList(options);\r\n                    e.preventDefault()\r\n                }\r\n            },\r\n            leftArrow: function(e) {\r\n                if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && rtlEnabled && !this._$focusedTag) {\r\n                    return\r\n                }\r\n                e.preventDefault();\r\n                var direction = rtlEnabled ? \"next\" : \"prev\";\r\n                this._moveTagFocus(direction);\r\n                !this.option(\"multiline\") && this._scrollContainer(direction)\r\n            },\r\n            rightArrow: function(e) {\r\n                if (!this._isCaretAtTheStart() || this._isEmpty() || this._isEditable() && !rtlEnabled && !this._$focusedTag) {\r\n                    return\r\n                }\r\n                e.preventDefault();\r\n                var direction = rtlEnabled ? \"prev\" : \"next\";\r\n                this._moveTagFocus(direction);\r\n                !this.option(\"multiline\") && this._scrollContainer(direction)\r\n            }\r\n        })\r\n    },\r\n    _processKeyboardEvent: function(e) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        this._saveValueChangeEvent(e)\r\n    },\r\n    _isEmpty: function() {\r\n        return 0 === this._getValue().length\r\n    },\r\n    _updateTagsContainer: function($element) {\r\n        this._$tagsContainer = $element.addClass(TAGBOX_TAG_CONTAINER_CLASS).addClass(NATIVE_CLICK_CLASS);\r\n        this._$tagsContainer.parent().addClass(NATIVE_CLICK_CLASS)\r\n    },\r\n    _allowSelectItemByTab: function() {\r\n        return false\r\n    },\r\n    _isCaretAtTheStart: function() {\r\n        var position = (0, _utils.default)(this._input());\r\n        return 0 === position.start && 0 === position.end\r\n    },\r\n    _moveTagFocus: function(direction, clearOnBoundary) {\r\n        if (!this._$focusedTag) {\r\n            var tagElements = this._tagElements();\r\n            this._$focusedTag = \"next\" === direction ? tagElements.first() : tagElements.last();\r\n            this._toggleFocusClass(true, this._$focusedTag);\r\n            return\r\n        }\r\n        var $nextFocusedTag = this._$focusedTag[direction](\".\".concat(TAGBOX_TAG_CLASS));\r\n        if ($nextFocusedTag.length > 0) {\r\n            this._replaceFocusedTag($nextFocusedTag)\r\n        } else {\r\n            if (clearOnBoundary || \"next\" === direction && this._isEditable()) {\r\n                this._clearTagFocus()\r\n            }\r\n        }\r\n    },\r\n    _replaceFocusedTag: function($nextFocusedTag) {\r\n        this._toggleFocusClass(false, this._$focusedTag);\r\n        this._$focusedTag = $nextFocusedTag;\r\n        this._toggleFocusClass(true, this._$focusedTag)\r\n    },\r\n    _clearTagFocus: function() {\r\n        if (!this._$focusedTag) {\r\n            return\r\n        }\r\n        this._toggleFocusClass(false, this._$focusedTag);\r\n        delete this._$focusedTag\r\n    },\r\n    _focusClassTarget: function($element) {\r\n        if ($element && $element.length && $element[0] !== this._focusTarget()[0]) {\r\n            return $element\r\n        }\r\n        return this.callBase()\r\n    },\r\n    _scrollContainer: function(direction) {\r\n        if (this.option(\"multiline\") || !(0, _window.hasWindow)()) {\r\n            return\r\n        }\r\n        if (!this._$tagsContainer) {\r\n            return\r\n        }\r\n        var scrollPosition = this._getScrollPosition(direction);\r\n        this._$tagsContainer.scrollLeft(scrollPosition)\r\n    },\r\n    _getScrollPosition: function(direction) {\r\n        if (\"start\" === direction || \"end\" === direction) {\r\n            return this._getBorderPosition(direction)\r\n        }\r\n        return this._$focusedTag ? this._getFocusedTagPosition(direction) : this._getBorderPosition(\"end\")\r\n    },\r\n    _getBorderPosition: function(direction) {\r\n        var rtlEnabled = this.option(\"rtlEnabled\");\r\n        var isScrollLeft = \"end\" === direction ^ rtlEnabled;\r\n        var scrollBehavior = (0, _scroll_rtl_behavior.default)();\r\n        var isScrollInverted = rtlEnabled && scrollBehavior.decreasing ^ scrollBehavior.positive;\r\n        var scrollSign = !rtlEnabled || scrollBehavior.positive ? 1 : -1;\r\n        return isScrollLeft ^ !isScrollInverted ? 0 : scrollSign * (this._$tagsContainer.get(0).scrollWidth - this._$tagsContainer.outerWidth())\r\n    },\r\n    _getFocusedTagPosition: function(direction) {\r\n        var rtlEnabled = this.option(\"rtlEnabled\");\r\n        var isScrollLeft = \"next\" === direction ^ rtlEnabled;\r\n        var _this$_$focusedTag$po = this._$focusedTag.position(),\r\n            scrollOffset = _this$_$focusedTag$po.left;\r\n        var scrollLeft = this._$tagsContainer.scrollLeft();\r\n        if (isScrollLeft) {\r\n            scrollOffset += this._$focusedTag.outerWidth(true) - this._$tagsContainer.outerWidth()\r\n        }\r\n        if (isScrollLeft ^ scrollOffset < 0) {\r\n            var scrollBehavior = (0, _scroll_rtl_behavior.default)();\r\n            var scrollCorrection = rtlEnabled && !scrollBehavior.decreasing && scrollBehavior.positive ? -1 : 1;\r\n            scrollLeft += scrollOffset * scrollCorrection\r\n        }\r\n        return scrollLeft\r\n    },\r\n    _setNextValue: _common.noop,\r\n    _getDefaultOptions: function() {\r\n        return (0, _extend.extend)(this.callBase(), {\r\n            value: [],\r\n            showDropDownButton: false,\r\n            maxFilterLength: 1500,\r\n            tagTemplate: \"tag\",\r\n            selectAllText: _message.default.format(\"dxList-selectAll\"),\r\n            hideSelectedItems: false,\r\n            selectedItems: [],\r\n            selectAllMode: \"page\",\r\n            onSelectAllValueChanged: null,\r\n            maxDisplayedTags: void 0,\r\n            showMultiTagOnly: true,\r\n            onMultiTagPreparing: null,\r\n            multiline: true,\r\n            useSubmitBehavior: true\r\n        })\r\n    },\r\n    _init: function() {\r\n        this.callBase();\r\n        this._selectedItems = [];\r\n        this._initSelectAllValueChangedAction()\r\n    },\r\n    _initActions: function() {\r\n        this.callBase();\r\n        this._initMultiTagPreparingAction()\r\n    },\r\n    _initMultiTagPreparingAction: function() {\r\n        this._multiTagPreparingAction = this._createActionByOption(\"onMultiTagPreparing\", {\r\n            beforeExecute: function(e) {\r\n                this._multiTagPreparingHandler(e.args[0])\r\n            }.bind(this),\r\n            excludeValidators: [\"disabled\", \"readOnly\"]\r\n        })\r\n    },\r\n    _multiTagPreparingHandler: function(args) {\r\n        var _this$_getValue = this._getValue(),\r\n            selectedCount = _this$_getValue.length;\r\n        if (!this.option(\"showMultiTagOnly\")) {\r\n            args.text = _message.default.getFormatter(\"dxTagBox-moreSelected\")(selectedCount - this.option(\"maxDisplayedTags\") + 1)\r\n        } else {\r\n            args.text = _message.default.getFormatter(\"dxTagBox-selected\")(selectedCount)\r\n        }\r\n    },\r\n    _initDynamicTemplates: function() {\r\n        this.callBase();\r\n        this._templateManager.addDefaultTemplates({\r\n            tag: new _bindable_template.BindableTemplate(function($container, data) {\r\n                var _data$text;\r\n                var $tagContent = (0, _renderer.default)(\"<div>\").addClass(TAGBOX_TAG_CONTENT_CLASS);\r\n                (0, _renderer.default)(\"<span>\").text(null !== (_data$text = data.text) && void 0 !== _data$text ? _data$text : data).appendTo($tagContent);\r\n                (0, _renderer.default)(\"<div>\").addClass(TAGBOX_TAG_REMOVE_BUTTON_CLASS).appendTo($tagContent);\r\n                $container.append($tagContent)\r\n            }, [\"text\"], this.option(\"integrationOptions.watchMethod\"), {\r\n                text: this._displayGetter\r\n            })\r\n        })\r\n    },\r\n    _toggleSubmitElement: function(enabled) {\r\n        if (enabled) {\r\n            this._renderSubmitElement();\r\n            this._setSubmitValue()\r\n        } else {\r\n            this._$submitElement && this._$submitElement.remove();\r\n            delete this._$submitElement\r\n        }\r\n    },\r\n    _renderSubmitElement: function() {\r\n        if (!this.option(\"useSubmitBehavior\")) {\r\n            return\r\n        }\r\n        this._$submitElement = (0, _renderer.default)(\"<select>\").attr(\"multiple\", \"multiple\").css(\"display\", \"none\").appendTo(this.$element())\r\n    },\r\n    _setSubmitValue: function() {\r\n        if (!this.option(\"useSubmitBehavior\")) {\r\n            return\r\n        }\r\n        var value = this._getValue();\r\n        var $options = [];\r\n        for (var i = 0, n = value.length; i < n; i++) {\r\n            var useDisplayText = this._shouldUseDisplayValue(value[i]);\r\n            $options.push((0, _renderer.default)(\"<option>\").val(useDisplayText ? this._displayGetter(value[i]) : value[i]).attr(\"selected\", \"selected\"))\r\n        }\r\n        this._getSubmitElement().empty().append($options)\r\n    },\r\n    _initMarkup: function() {\r\n        this._tagElementsCache = (0, _renderer.default)();\r\n        var isSingleLineMode = !this.option(\"multiline\");\r\n        this.$element().addClass(TAGBOX_CLASS).toggleClass(TAGBOX_ONLY_SELECT_CLASS, !(this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\"))).toggleClass(TAGBOX_SINGLE_LINE_CLASS, isSingleLineMode);\r\n        this._initTagTemplate();\r\n        this.callBase()\r\n    },\r\n    _render: function() {\r\n        this.callBase();\r\n        this._renderTagRemoveAction();\r\n        this._renderSingleLineScroll();\r\n        this._scrollContainer(\"start\")\r\n    },\r\n    _initTagTemplate: function() {\r\n        this._tagTemplate = this._getTemplateByOption(\"tagTemplate\")\r\n    },\r\n    _renderField: function() {\r\n        var isDefaultFieldTemplate = !(0, _type.isDefined)(this.option(\"fieldTemplate\"));\r\n        this.$element().toggleClass(TAGBOX_DEFAULT_FIELD_TEMPLATE_CLASS, isDefaultFieldTemplate).toggleClass(TAGBOX_CUSTOM_FIELD_TEMPLATE_CLASS, !isDefaultFieldTemplate);\r\n        this.callBase()\r\n    },\r\n    _renderTagRemoveAction: function() {\r\n        var tagRemoveAction = this._createAction(this._removeTagHandler.bind(this));\r\n        var eventName = (0, _index.addNamespace)(_click.name, \"dxTagBoxTagRemove\");\r\n        _events_engine.default.off(this._$tagsContainer, eventName);\r\n        _events_engine.default.on(this._$tagsContainer, eventName, \".\".concat(TAGBOX_TAG_REMOVE_BUTTON_CLASS), function(event) {\r\n            tagRemoveAction({\r\n                event: event\r\n            })\r\n        });\r\n        this._renderTypingEvent()\r\n    },\r\n    _renderSingleLineScroll: function() {\r\n        var mouseWheelEvent = (0, _index.addNamespace)(\"dxmousewheel\", this.NAME);\r\n        var $element = this.$element();\r\n        var isMultiline = this.option(\"multiline\");\r\n        _events_engine.default.off($element, mouseWheelEvent);\r\n        if (\"desktop\" !== _devices.default.real().deviceType) {\r\n            this._$tagsContainer && this._$tagsContainer.css(\"overflowX\", isMultiline ? \"\" : \"auto\");\r\n            return\r\n        }\r\n        if (isMultiline) {\r\n            return\r\n        }\r\n        _events_engine.default.on($element, mouseWheelEvent, this._tagContainerMouseWheelHandler.bind(this))\r\n    },\r\n    _tagContainerMouseWheelHandler: function(e) {\r\n        var scrollLeft = this._$tagsContainer.scrollLeft();\r\n        var delta = e.delta * TAGBOX_MOUSE_WHEEL_DELTA_MULTIPLIER;\r\n        if (!(0, _index.isCommandKeyPressed)(e) && (0, _utils3.allowScroll)(this._$tagsContainer, delta, true)) {\r\n            this._$tagsContainer.scrollLeft(scrollLeft + delta);\r\n            return false\r\n        }\r\n    },\r\n    _renderTypingEvent: function() {\r\n        var _this2 = this;\r\n        var input = this._input();\r\n        var namespace = (0, _index.addNamespace)(\"keydown\", this.NAME);\r\n        _events_engine.default.off(input, namespace);\r\n        _events_engine.default.on(input, namespace, function(e) {\r\n            var keyName = (0, _index.normalizeKeyName)(e);\r\n            if (!_this2._isControlKey(keyName) && _this2._isEditable()) {\r\n                _this2._clearTagFocus()\r\n            }\r\n        })\r\n    },\r\n    _popupWrapperClass: function() {\r\n        return this.callBase() + \" \" + TAGBOX_POPUP_WRAPPER_CLASS\r\n    },\r\n    _renderInput: function() {\r\n        this.callBase();\r\n        this._renderPreventBlur(this._inputWrapper())\r\n    },\r\n    _renderInputValueImpl: function() {\r\n        return this._renderMultiSelect()\r\n    },\r\n    _loadInputValue: function() {\r\n        return (0, _deferred.when)()\r\n    },\r\n    _clearTextValue: function() {\r\n        this._input().val(\"\");\r\n        this._toggleEmptinessEventHandler();\r\n        this.option(\"text\", \"\")\r\n    },\r\n    _focusInHandler: function(e) {\r\n        if (!this._preventNestedFocusEvent(e)) {\r\n            this._scrollContainer(\"end\")\r\n        }\r\n        this.callBase(e)\r\n    },\r\n    _renderInputValue: function() {\r\n        this.option(\"displayValue\", this._searchValue());\r\n        return this.callBase()\r\n    },\r\n    _restoreInputText: function(saveEditingValue) {\r\n        if (!saveEditingValue) {\r\n            this._clearTextValue()\r\n        }\r\n    },\r\n    _focusOutHandler: function(e) {\r\n        if (!this._preventNestedFocusEvent(e)) {\r\n            this._clearTagFocus();\r\n            this._scrollContainer(\"start\")\r\n        }\r\n        this.callBase(e)\r\n    },\r\n    _getFirstPopupElement: function() {\r\n        return this.option(\"showSelectionControls\") ? this._list.$element() : this.callBase()\r\n    },\r\n    _initSelectAllValueChangedAction: function() {\r\n        this._selectAllValueChangeAction = this._createActionByOption(\"onSelectAllValueChanged\")\r\n    },\r\n    _renderList: function() {\r\n        var _this3 = this;\r\n        this.callBase();\r\n        this._setListDataSourceFilter();\r\n        if (this.option(\"showSelectionControls\")) {\r\n            this._list.registerKeyHandler(\"tab\", function(e) {\r\n                return _this3._popupElementTabHandler(e)\r\n            });\r\n            this._list.registerKeyHandler(\"escape\", function(e) {\r\n                return _this3._popupElementEscHandler(e)\r\n            })\r\n        }\r\n    },\r\n    _canListHaveFocus: function() {\r\n        return \"useButtons\" === this.option(\"applyValueMode\")\r\n    },\r\n    _listConfig: function() {\r\n        var _this4 = this;\r\n        var selectionMode = this.option(\"showSelectionControls\") ? \"all\" : \"multiple\";\r\n        return (0, _extend.extend)(this.callBase(), {\r\n            selectionMode: selectionMode,\r\n            selectAllText: this.option(\"selectAllText\"),\r\n            onSelectAllValueChanged: function(_ref) {\r\n                var value = _ref.value;\r\n                _this4._selectAllValueChangeAction({\r\n                    value: value\r\n                })\r\n            },\r\n            selectAllMode: this.option(\"selectAllMode\"),\r\n            selectedItems: this._selectedItems,\r\n            onFocusedItemChanged: null\r\n        })\r\n    },\r\n    _renderMultiSelect: function() {\r\n        var _this5 = this;\r\n        var d = new _deferred.Deferred;\r\n        this._updateTagsContainer(this._$textEditorInputContainer);\r\n        this._renderInputSize();\r\n        this._renderTags().done(function() {\r\n            _this5._popup && _this5._popup.refreshPosition();\r\n            d.resolve()\r\n        }).fail(d.reject);\r\n        return d.promise()\r\n    },\r\n    _listItemClickHandler: function(e) {\r\n        !this.option(\"showSelectionControls\") && this._clearTextValue();\r\n        if (\"useButtons\" === this.option(\"applyValueMode\")) {\r\n            return\r\n        }\r\n        this.callBase(e);\r\n        this._saveValueChangeEvent(void 0)\r\n    },\r\n    _shouldClearFilter: function() {\r\n        var shouldClearFilter = this.callBase();\r\n        var showSelectionControls = this.option(\"showSelectionControls\");\r\n        return !showSelectionControls && shouldClearFilter\r\n    },\r\n    _renderInputSize: function() {\r\n        var $input = this._input();\r\n        var value = $input.val();\r\n        var isEmptyInput = (0, _type.isString)(value) && value;\r\n        var cursorWidth = 5;\r\n        var width = \"\";\r\n        var size = \"\";\r\n        var canTypeText = this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\");\r\n        if (isEmptyInput && canTypeText) {\r\n            var $calculationElement = (0, _dom.createTextElementHiddenCopy)($input, value, {\r\n                includePaddings: true\r\n            });\r\n            $calculationElement.insertAfter($input);\r\n            width = $calculationElement.outerWidth() + cursorWidth;\r\n            $calculationElement.remove()\r\n        } else {\r\n            if (!value) {\r\n                size = 1\r\n            }\r\n        }\r\n        $input.css(\"width\", width);\r\n        $input.attr(\"size\", size)\r\n    },\r\n    _renderInputSubstitution: function() {\r\n        this.callBase();\r\n        this._updateWidgetHeight()\r\n    },\r\n    _getValue: function() {\r\n        return this.option(\"value\") || []\r\n    },\r\n    _multiTagRequired: function() {\r\n        var values = this._getValue();\r\n        var maxDisplayedTags = this.option(\"maxDisplayedTags\");\r\n        return (0, _type.isDefined)(maxDisplayedTags) && values.length > maxDisplayedTags\r\n    },\r\n    _renderMultiTag: function($input) {\r\n        var $tag = (0, _renderer.default)(\"<div>\").addClass(TAGBOX_TAG_CLASS).addClass(TAGBOX_MULTI_TAG_CLASS);\r\n        var args = {\r\n            multiTagElement: (0, _element.getPublicElement)($tag),\r\n            selectedItems: this.option(\"selectedItems\")\r\n        };\r\n        this._multiTagPreparingAction(args);\r\n        if (args.cancel) {\r\n            return false\r\n        }\r\n        $tag.data(TAGBOX_TAG_DATA_KEY, args.text);\r\n        $tag.insertBefore($input);\r\n        this._tagTemplate.render({\r\n            model: args.text,\r\n            container: (0, _element.getPublicElement)($tag)\r\n        });\r\n        return $tag\r\n    },\r\n    _getFilteredItems: function(values) {\r\n        var _this$_list, _this6 = this;\r\n        var creator = new _selection_filter.SelectionFilterCreator(values);\r\n        var listSelectedItems = null === (_this$_list = this._list) || void 0 === _this$_list ? void 0 : _this$_list.option(\"selectedItems\");\r\n        var isListItemsLoaded = !!listSelectedItems && this._list.getDataSource().isLoaded();\r\n        var selectedItems = listSelectedItems || this.option(\"selectedItems\");\r\n        var clientFilterFunction = creator.getLocalFilter(this._valueGetter);\r\n        var filteredItems = selectedItems.filter(clientFilterFunction);\r\n        var selectedItemsAlreadyLoaded = filteredItems.length === values.length;\r\n        var d = new _deferred.Deferred;\r\n        if ((!this._isDataSourceChanged || isListItemsLoaded) && selectedItemsAlreadyLoaded) {\r\n            return d.resolve(filteredItems).promise()\r\n        } else {\r\n            var dataSource = this._dataSource;\r\n            var dataSourceFilter = dataSource.filter();\r\n            var filterExpr = creator.getCombinedFilter(this.option(\"valueExpr\"), dataSourceFilter);\r\n            var filterLength = encodeURI(JSON.stringify(filterExpr)).length;\r\n            var filter = filterLength > this.option(\"maxFilterLength\") ? void 0 : filterExpr;\r\n            var _dataSource$loadOptio = dataSource.loadOptions(),\r\n                customQueryParams = _dataSource$loadOptio.customQueryParams,\r\n                expand = _dataSource$loadOptio.expand,\r\n                select = _dataSource$loadOptio.select;\r\n            dataSource.store().load({\r\n                filter: filter,\r\n                customQueryParams: customQueryParams,\r\n                expand: expand,\r\n                select: select\r\n            }).done(function(data, extra) {\r\n                _this6._isDataSourceChanged = false;\r\n                if (_this6._disposed) {\r\n                    d.reject();\r\n                    return\r\n                }\r\n                var _normalizeLoadResult = (0, _utils2.normalizeLoadResult)(data, extra),\r\n                    items = _normalizeLoadResult.data;\r\n                var mappedItems = dataSource._applyMapFunction(items);\r\n                d.resolve(mappedItems.filter(clientFilterFunction))\r\n            }).fail(d.reject);\r\n            return d.promise()\r\n        }\r\n    },\r\n    _createTagsData: function(values, filteredItems) {\r\n        var _this7 = this;\r\n        var items = [];\r\n        var cache = {};\r\n        var isValueExprSpecified = \"this\" === this._valueGetterExpr();\r\n        var filteredValues = {};\r\n        filteredItems.forEach(function(filteredItem) {\r\n            var filteredItemValue = isValueExprSpecified ? JSON.stringify(filteredItem) : _this7._valueGetter(filteredItem);\r\n            filteredValues[filteredItemValue] = filteredItem\r\n        });\r\n        var loadItemPromises = [];\r\n        values.forEach(function(value, index) {\r\n            var currentItem = filteredValues[isValueExprSpecified ? JSON.stringify(value) : value];\r\n            if (isValueExprSpecified && !(0, _type.isDefined)(currentItem)) {\r\n                loadItemPromises.push(_this7._loadItem(value, cache).always(function(item) {\r\n                    var newItem = _this7._createTagData(items, item, value, index);\r\n                    items.splice(index, 0, newItem)\r\n                }))\r\n            } else {\r\n                var newItem = _this7._createTagData(items, currentItem, value, index);\r\n                items.splice(index, 0, newItem)\r\n            }\r\n        });\r\n        var d = new _deferred.Deferred;\r\n        _deferred.when.apply(this, loadItemPromises).always(function() {\r\n            d.resolve(items)\r\n        });\r\n        return d.promise()\r\n    },\r\n    _createTagData: function(items, item, value, valueIndex) {\r\n        if ((0, _type.isDefined)(item)) {\r\n            this._selectedItems.push(item);\r\n            return item\r\n        } else {\r\n            var selectedItem = this.option(\"selectedItem\");\r\n            var customItem = this._valueGetter(selectedItem) === value ? selectedItem : value;\r\n            return customItem\r\n        }\r\n    },\r\n    _isGroupedData: function() {\r\n        return this.option(\"grouped\") && !this._dataSource.group()\r\n    },\r\n    _getItemsByValues: function(values) {\r\n        var resultItems = [];\r\n        values.forEach(function(value) {\r\n            var item = this._getItemFromPlain(value);\r\n            if ((0, _type.isDefined)(item)) {\r\n                resultItems.push(item)\r\n            }\r\n        }.bind(this));\r\n        return resultItems\r\n    },\r\n    _getFilteredGroupedItems: function(values) {\r\n        var selectedItems = new _deferred.Deferred;\r\n        if (!this._dataSource.items().length) {\r\n            this._dataSource.load().done(function() {\r\n                selectedItems.resolve(this._getItemsByValues(values))\r\n            }.bind(this)).fail(selectedItems.resolve([]))\r\n        } else {\r\n            selectedItems.resolve(this._getItemsByValues(values))\r\n        }\r\n        return selectedItems.promise()\r\n    },\r\n    _loadTagsData: function() {\r\n        var _this8 = this;\r\n        var values = this._getValue();\r\n        var tagData = new _deferred.Deferred;\r\n        this._selectedItems = [];\r\n        var filteredItemsPromise = this._isGroupedData() ? this._getFilteredGroupedItems(values) : this._getFilteredItems(values);\r\n        filteredItemsPromise.done(function(filteredItems) {\r\n            var items = _this8._createTagsData(values, filteredItems);\r\n            items.always(function(data) {\r\n                tagData.resolve(data)\r\n            })\r\n        }).fail(tagData.reject.bind(this));\r\n        return tagData.promise()\r\n    },\r\n    _renderTags: function() {\r\n        var _this9 = this;\r\n        var d = new _deferred.Deferred;\r\n        var isPlainDataUsed = false;\r\n        if (this._shouldGetItemsFromPlain(this._valuesToUpdate)) {\r\n            this._selectedItems = this._getItemsFromPlain(this._valuesToUpdate);\r\n            if (this._selectedItems.length === this._valuesToUpdate.length) {\r\n                this._renderTagsImpl(this._selectedItems);\r\n                isPlainDataUsed = true;\r\n                d.resolve()\r\n            }\r\n        }\r\n        if (!isPlainDataUsed) {\r\n            this._loadTagsData().done(function(items) {\r\n                if (_this9._disposed) {\r\n                    d.reject();\r\n                    return\r\n                }\r\n                _this9._renderTagsImpl(items);\r\n                d.resolve()\r\n            }).fail(d.reject)\r\n        }\r\n        return d.promise()\r\n    },\r\n    _renderTagsImpl: function(items) {\r\n        this._renderTagsCore(items);\r\n        this._renderEmptyState();\r\n        if (!this._preserveFocusedTag) {\r\n            this._clearTagFocus()\r\n        }\r\n    },\r\n    _shouldGetItemsFromPlain: function(values) {\r\n        return values && this._dataSource.isLoaded() && values.length <= this._getPlainItems().length\r\n    },\r\n    _getItemsFromPlain: function(values) {\r\n        var selectedItems = this._getSelectedItemsFromList(values);\r\n        var needFilterPlainItems = 0 === selectedItems.length && values.length > 0 || selectedItems.length < values.length;\r\n        if (needFilterPlainItems) {\r\n            var plainItems = this._getPlainItems();\r\n            selectedItems = this._filterSelectedItems(plainItems, values)\r\n        }\r\n        return selectedItems\r\n    },\r\n    _getSelectedItemsFromList: function(values) {\r\n        var _this$_list2;\r\n        var listSelectedItems = null === (_this$_list2 = this._list) || void 0 === _this$_list2 ? void 0 : _this$_list2.option(\"selectedItems\");\r\n        var selectedItems = [];\r\n        if (values.length === (null === listSelectedItems || void 0 === listSelectedItems ? void 0 : listSelectedItems.length)) {\r\n            selectedItems = this._filterSelectedItems(listSelectedItems, values)\r\n        }\r\n        return selectedItems\r\n    },\r\n    _filterSelectedItems: function(plainItems, values) {\r\n        var _this10 = this;\r\n        var selectedItems = plainItems.filter(function(dataItem) {\r\n            var currentValue;\r\n            for (var i = 0; i < values.length; i++) {\r\n                currentValue = values[i];\r\n                if ((0, _type.isObject)(currentValue)) {\r\n                    if (_this10._isValueEquals(dataItem, currentValue)) {\r\n                        return true\r\n                    }\r\n                } else {\r\n                    if (_this10._isValueEquals(_this10._valueGetter(dataItem), currentValue)) {\r\n                        return true\r\n                    }\r\n                }\r\n            }\r\n            return false\r\n        }, this);\r\n        return selectedItems\r\n    },\r\n    _integrateInput: function() {\r\n        this.callBase();\r\n        this._updateTagsContainer((0, _renderer.default)(\".\".concat(TEXTEDITOR_INPUT_CONTAINER_CLASS)));\r\n        this._renderTagRemoveAction()\r\n    },\r\n    _renderTagsCore: function(items) {\r\n        var _this11 = this;\r\n        this._renderField();\r\n        this.option(\"selectedItems\", this._selectedItems.slice());\r\n        this._cleanTags();\r\n        var $multiTag = this._multiTagRequired() && this._renderMultiTag(this._input());\r\n        var showMultiTagOnly = this.option(\"showMultiTagOnly\");\r\n        var maxDisplayedTags = this.option(\"maxDisplayedTags\");\r\n        items.forEach(function(item, index) {\r\n            if ($multiTag && showMultiTagOnly || $multiTag && !showMultiTagOnly && index - maxDisplayedTags >= -1) {\r\n                return false\r\n            }\r\n            _this11._renderTag(item, $multiTag || _this11._input())\r\n        });\r\n        if (this._isFocused()) {\r\n            this._scrollContainer(\"end\")\r\n        }\r\n        this._refreshTagElements()\r\n    },\r\n    _cleanTags: function() {\r\n        if (this._multiTagRequired()) {\r\n            this._tagElements().remove()\r\n        } else {\r\n            var $tags = this._tagElements();\r\n            var values = this._getValue();\r\n            (0, _iterator.each)($tags, function(_, tag) {\r\n                var $tag = (0, _renderer.default)(tag);\r\n                var index = (0, _array.inArray)($tag.data(TAGBOX_TAG_DATA_KEY), values);\r\n                if (index < 0) {\r\n                    $tag.remove()\r\n                }\r\n            })\r\n        }\r\n    },\r\n    _renderEmptyState: function() {\r\n        var isEmpty = !(this._getValue().length || this._selectedItems.length || this._searchValue());\r\n        this._toggleEmptiness(isEmpty);\r\n        this._renderDisplayText()\r\n    },\r\n    _renderDisplayText: function() {\r\n        this._renderInputSize()\r\n    },\r\n    _refreshTagElements: function() {\r\n        this._tagElementsCache = this.$element().find(\".\".concat(TAGBOX_TAG_CLASS))\r\n    },\r\n    _tagElements: function() {\r\n        return this._tagElementsCache\r\n    },\r\n    _applyTagTemplate: function(item, $tag) {\r\n        this._tagTemplate.render({\r\n            model: item,\r\n            container: (0, _element.getPublicElement)($tag)\r\n        })\r\n    },\r\n    _renderTag: function(item, $input) {\r\n        var value = this._valueGetter(item);\r\n        if (!(0, _type.isDefined)(value)) {\r\n            return\r\n        }\r\n        var $tag = this._getTag(value);\r\n        var displayValue = this._displayGetter(item);\r\n        var itemModel = this._getItemModel(item, displayValue);\r\n        if ($tag) {\r\n            if ((0, _type.isDefined)(displayValue)) {\r\n                $tag.empty();\r\n                this._applyTagTemplate(itemModel, $tag)\r\n            }\r\n            $tag.removeClass(TAGBOX_CUSTOM_TAG_CLASS)\r\n        } else {\r\n            $tag = this._createTag(value, $input);\r\n            if ((0, _type.isDefined)(item)) {\r\n                this._applyTagTemplate(itemModel, $tag)\r\n            } else {\r\n                $tag.addClass(TAGBOX_CUSTOM_TAG_CLASS);\r\n                this._applyTagTemplate(value, $tag)\r\n            }\r\n        }\r\n    },\r\n    _getItemModel: function(item, displayValue) {\r\n        if ((0, _type.isObject)(item) && (0, _type.isDefined)(displayValue)) {\r\n            return item\r\n        } else {\r\n            return (0, _common.ensureDefined)(displayValue, \"\")\r\n        }\r\n    },\r\n    _getTag: function(value) {\r\n        var $tags = this._tagElements();\r\n        var tagsLength = $tags.length;\r\n        var result = false;\r\n        for (var i = 0; i < tagsLength; i++) {\r\n            var $tag = $tags[i];\r\n            var tagData = (0, _element_data.data)($tag, TAGBOX_TAG_DATA_KEY);\r\n            if (value === tagData || (0, _common.equalByValue)(value, tagData)) {\r\n                result = (0, _renderer.default)($tag);\r\n                break\r\n            }\r\n        }\r\n        return result\r\n    },\r\n    _createTag: function(value, $input) {\r\n        return (0, _renderer.default)(\"<div>\").addClass(TAGBOX_TAG_CLASS).data(TAGBOX_TAG_DATA_KEY, value).insertBefore($input)\r\n    },\r\n    _toggleEmptinessEventHandler: function() {\r\n        this._toggleEmptiness(!this._getValue().length && !this._searchValue().length)\r\n    },\r\n    _customItemAddedHandler: function(e) {\r\n        this.callBase(e);\r\n        this._clearTextValue()\r\n    },\r\n    _removeTagHandler: function(args) {\r\n        var e = args.event;\r\n        e.stopPropagation();\r\n        this._saveValueChangeEvent(e);\r\n        var $tag = (0, _renderer.default)(e.target).closest(\".\".concat(TAGBOX_TAG_CLASS));\r\n        this._removeTagElement($tag)\r\n    },\r\n    _removeTagElement: function($tag) {\r\n        if ($tag.hasClass(TAGBOX_MULTI_TAG_CLASS)) {\r\n            if (!this.option(\"showMultiTagOnly\")) {\r\n                this.option(\"value\", this._getValue().slice(0, this.option(\"maxDisplayedTags\")))\r\n            } else {\r\n                this.reset()\r\n            }\r\n            return\r\n        }\r\n        var itemValue = $tag.data(TAGBOX_TAG_DATA_KEY);\r\n        this._removeTagWithUpdate(itemValue);\r\n        this._refreshTagElements()\r\n    },\r\n    _updateField: _common.noop,\r\n    _removeTagWithUpdate: function(itemValue) {\r\n        var value = this._getValue().slice();\r\n        this._removeTag(value, itemValue);\r\n        this.option(\"value\", value);\r\n        if (0 === value.length) {\r\n            this._clearTagFocus()\r\n        }\r\n    },\r\n    _getCurrentValue: function() {\r\n        return this._lastValue()\r\n    },\r\n    _selectionChangeHandler: function(e) {\r\n        var _this12 = this;\r\n        if (\"useButtons\" === this.option(\"applyValueMode\")) {\r\n            return\r\n        }\r\n        var value = this._getValue().slice();\r\n        (0, _iterator.each)(e.removedItems || [], function(_, removedItem) {\r\n            _this12._removeTag(value, _this12._valueGetter(removedItem))\r\n        });\r\n        (0, _iterator.each)(e.addedItems || [], function(_, addedItem) {\r\n            _this12._addTag(value, _this12._valueGetter(addedItem))\r\n        });\r\n        this._updateWidgetHeight();\r\n        if (!(0, _common.equalByValue)(this._list.option(\"selectedItemKeys\"), this.option(\"value\"))) {\r\n            var listSelectionChangeEvent = this._list._getSelectionChangeEvent();\r\n            listSelectionChangeEvent && this._saveValueChangeEvent(listSelectionChangeEvent);\r\n            this.option(\"value\", value)\r\n        }\r\n        this._list._saveSelectionChangeEvent(void 0)\r\n    },\r\n    _removeTag: function(value, item) {\r\n        var index = this._valueIndex(item, value);\r\n        if (index >= 0) {\r\n            value.splice(index, 1)\r\n        }\r\n    },\r\n    _addTag: function(value, item) {\r\n        var index = this._valueIndex(item);\r\n        if (index < 0) {\r\n            value.push(item)\r\n        }\r\n    },\r\n    _fieldRenderData: function() {\r\n        return this._selectedItems.slice()\r\n    },\r\n    _completeSelection: function(value) {\r\n        if (!this.option(\"showSelectionControls\")) {\r\n            this._setValue(value)\r\n        }\r\n    },\r\n    _setValue: function(value) {\r\n        if (null === value) {\r\n            return\r\n        }\r\n        var useButtons = \"useButtons\" === this.option(\"applyValueMode\");\r\n        var valueIndex = this._valueIndex(value);\r\n        var values = (useButtons ? this._list.option(\"selectedItemKeys\") : this._getValue()).slice();\r\n        if (valueIndex >= 0) {\r\n            values.splice(valueIndex, 1)\r\n        } else {\r\n            values.push(value)\r\n        }\r\n        if (\"useButtons\" === this.option(\"applyValueMode\")) {\r\n            this._list.option(\"selectedItemKeys\", values)\r\n        } else {\r\n            this.option(\"value\", values)\r\n        }\r\n    },\r\n    _isSelectedValue: function(value, cache) {\r\n        return this._valueIndex(value, null, cache) > -1\r\n    },\r\n    _valueIndex: function(value, values, cache) {\r\n        var _this13 = this;\r\n        var result = -1;\r\n        if (cache && \"object\" !== _typeof(value)) {\r\n            if (!cache.indexByValues) {\r\n                cache.indexByValues = {};\r\n                values = values || this._getValue();\r\n                values.forEach(function(value, index) {\r\n                    cache.indexByValues[value] = index\r\n                })\r\n            }\r\n            if (value in cache.indexByValues) {\r\n                return cache.indexByValues[value]\r\n            }\r\n        }\r\n        values = values || this._getValue();\r\n        (0, _iterator.each)(values, function(index, selectedValue) {\r\n            if (_this13._isValueEquals(value, selectedValue)) {\r\n                result = index;\r\n                return false\r\n            }\r\n        });\r\n        return result\r\n    },\r\n    _lastValue: function() {\r\n        var values = this._getValue();\r\n        var lastValue = values[values.length - 1];\r\n        return null !== lastValue && void 0 !== lastValue ? lastValue : null\r\n    },\r\n    _valueChangeEventHandler: _common.noop,\r\n    _shouldRenderSearchEvent: function() {\r\n        return this.option(\"searchEnabled\") || this.option(\"acceptCustomValue\")\r\n    },\r\n    _searchHandler: function(e) {\r\n        if (this.option(\"searchEnabled\") && !!e && !this._isTagRemoved) {\r\n            this.callBase(e);\r\n            this._setListDataSourceFilter()\r\n        }\r\n        this._updateWidgetHeight();\r\n        delete this._isTagRemoved\r\n    },\r\n    _updateWidgetHeight: function() {\r\n        var element = this.$element();\r\n        var originalHeight = element.height();\r\n        this._renderInputSize();\r\n        var currentHeight = element.height();\r\n        if (this._popup && this.option(\"opened\") && this._isEditable() && currentHeight !== originalHeight) {\r\n            this._popup.repaint()\r\n        }\r\n    },\r\n    _refreshSelected: function() {\r\n        var _this$_list3;\r\n        (null === (_this$_list3 = this._list) || void 0 === _this$_list3 ? void 0 : _this$_list3.getDataSource()) && this._list.option(\"selectedItems\", this._selectedItems)\r\n    },\r\n    _resetListDataSourceFilter: function() {\r\n        var dataSource = this._getDataSource();\r\n        if (!dataSource) {\r\n            return\r\n        }\r\n        delete this._userFilter;\r\n        dataSource.filter(null);\r\n        dataSource.reload()\r\n    },\r\n    _setListDataSourceFilter: function() {\r\n        if (!this.option(\"hideSelectedItems\") || !this._list) {\r\n            return\r\n        }\r\n        var dataSource = this._getDataSource();\r\n        if (!dataSource) {\r\n            return\r\n        }\r\n        var valueGetterExpr = this._valueGetterExpr();\r\n        if ((0, _type.isString)(valueGetterExpr) && \"this\" !== valueGetterExpr) {\r\n            var filter = this._dataSourceFilterExpr();\r\n            if (void 0 === this._userFilter) {\r\n                this._userFilter = dataSource.filter() || null\r\n            }\r\n            this._userFilter && filter.push(this._userFilter);\r\n            filter.length ? dataSource.filter(filter) : dataSource.filter(null)\r\n        } else {\r\n            dataSource.filter(this._dataSourceFilterFunction.bind(this))\r\n        }\r\n        dataSource.load()\r\n    },\r\n    _dataSourceFilterExpr: function() {\r\n        var _this14 = this;\r\n        var filter = [];\r\n        (0, _iterator.each)(this._getValue(), function(index, value) {\r\n            filter.push([\"!\", [_this14._valueGetterExpr(), value]])\r\n        });\r\n        return filter\r\n    },\r\n    _dataSourceFilterFunction: function(itemData) {\r\n        var _this15 = this;\r\n        var itemValue = this._valueGetter(itemData);\r\n        var result = true;\r\n        (0, _iterator.each)(this._getValue(), function(index, value) {\r\n            if (_this15._isValueEquals(value, itemValue)) {\r\n                result = false;\r\n                return false\r\n            }\r\n        });\r\n        return result\r\n    },\r\n    _dataSourceChangedHandler: function() {\r\n        this._isDataSourceChanged = true;\r\n        this.callBase.apply(this, arguments)\r\n    },\r\n    _applyButtonHandler: function(args) {\r\n        this._saveValueChangeEvent(args.event);\r\n        this.option(\"value\", this._getSortedListValues());\r\n        this._clearTextValue();\r\n        this.callBase();\r\n        this._cancelSearchIfNeed()\r\n    },\r\n    _getSortedListValues: function() {\r\n        var listValues = this._getListValues();\r\n        var currentValue = this.option(\"value\") || [];\r\n        var existedItems = listValues.length ? currentValue.filter(function(item) {\r\n            return listValues.indexOf(item) !== -1\r\n        }) : [];\r\n        var newItems = existedItems.length ? listValues.filter(function(item) {\r\n            return currentValue.indexOf(item) === -1\r\n        }) : listValues;\r\n        return existedItems.concat(newItems)\r\n    },\r\n    _getListValues: function() {\r\n        var _this16 = this;\r\n        if (!this._list) {\r\n            return []\r\n        }\r\n        var selectedItems = this._getPlainItems(this._list.option(\"selectedItems\"));\r\n        var result = [];\r\n        (0, _iterator.each)(selectedItems, function(index, item) {\r\n            result[index] = _this16._valueGetter(item)\r\n        });\r\n        return result\r\n    },\r\n    _setListDataSource: function() {\r\n        var currentValue = this._getValue();\r\n        this.callBase();\r\n        if (currentValue !== this.option(\"value\")) {\r\n            this.option(\"value\", currentValue)\r\n        }\r\n        this._refreshSelected()\r\n    },\r\n    _renderOpenedState: function() {\r\n        this.callBase();\r\n        if (\"useButtons\" === this.option(\"applyValueMode\") && !this.option(\"opened\")) {\r\n            this._refreshSelected()\r\n        }\r\n    },\r\n    reset: function() {\r\n        this._restoreInputText();\r\n        var defaultValue = this._getDefaultOptions().value;\r\n        var currentValue = this.option(\"value\");\r\n        if (defaultValue && 0 === defaultValue.length && currentValue && defaultValue.length === currentValue.length) {\r\n            return\r\n        }\r\n        this.callBase()\r\n    },\r\n    _clean: function() {\r\n        this.callBase();\r\n        delete this._defaultTagTemplate;\r\n        delete this._valuesToUpdate;\r\n        delete this._tagTemplate\r\n    },\r\n    _removeDuplicates: function(from, what) {\r\n        var _this17 = this;\r\n        var result = [];\r\n        (0, _iterator.each)(from, function(_, value) {\r\n            var filteredItems = what.filter(function(item) {\r\n                return _this17._valueGetter(value) === _this17._valueGetter(item)\r\n            });\r\n            if (!filteredItems.length) {\r\n                result.push(value)\r\n            }\r\n        });\r\n        return result\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"onSelectAllValueChanged\":\r\n                this._initSelectAllValueChangedAction();\r\n                break;\r\n            case \"onMultiTagPreparing\":\r\n                this._initMultiTagPreparingAction();\r\n                this._renderTags();\r\n                break;\r\n            case \"hideSelectedItems\":\r\n                if (args.value) {\r\n                    this._setListDataSourceFilter()\r\n                } else {\r\n                    this._resetListDataSourceFilter()\r\n                }\r\n                break;\r\n            case \"useSubmitBehavior\":\r\n                this._toggleSubmitElement(args.value);\r\n                break;\r\n            case \"displayExpr\":\r\n                this.callBase(args);\r\n                this._initTemplates();\r\n                this._invalidate();\r\n                break;\r\n            case \"tagTemplate\":\r\n                this._initTagTemplate();\r\n                this._invalidate();\r\n                break;\r\n            case \"selectAllText\":\r\n                this._setListOption(\"selectAllText\", this.option(\"selectAllText\"));\r\n                break;\r\n            case \"readOnly\":\r\n            case \"disabled\":\r\n                this.callBase(args);\r\n                !args.value && this._renderTypingEvent();\r\n                break;\r\n            case \"value\":\r\n                this._valuesToUpdate = null === args || void 0 === args ? void 0 : args.value;\r\n                this.callBase(args);\r\n                this._valuesToUpdate = void 0;\r\n                this._setListDataSourceFilter();\r\n                break;\r\n            case \"maxDisplayedTags\":\r\n            case \"showMultiTagOnly\":\r\n                this._renderTags();\r\n                break;\r\n            case \"selectAllMode\":\r\n                this._setListOption(args.name, args.value);\r\n                break;\r\n            case \"selectedItem\":\r\n                break;\r\n            case \"selectedItems\":\r\n                this._selectionChangedAction({\r\n                    addedItems: this._removeDuplicates(args.value, args.previousValue),\r\n                    removedItems: this._removeDuplicates(args.previousValue, args.value)\r\n                });\r\n                break;\r\n            case \"multiline\":\r\n                this.$element().toggleClass(TAGBOX_SINGLE_LINE_CLASS, !args.value);\r\n                this._renderSingleLineScroll();\r\n                break;\r\n            case \"maxFilterLength\":\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    },\r\n    _getActualSearchValue: function() {\r\n        return this.callBase() || this._searchValue()\r\n    },\r\n    _popupHidingHandler: function() {\r\n        this.callBase();\r\n        this._clearFilter()\r\n    }\r\n});\r\n(0, _component_registrator.default)(\"dxTagBox\", TagBox);\r\nvar _default = TagBox;\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\nmodule.exports.default = module.exports;\r\n"]},"metadata":{},"sourceType":"script"}