{"ast":null,"code":"/*global module*/\nvar Buffer = require('safe-buffer').Buffer;\n\nvar DataStream = require('./data-stream');\n\nvar jwa = require('jwa');\n\nvar Stream = require('stream');\n\nvar toString = require('./tostring');\n\nvar util = require('util');\n\nfunction base64url(string, encoding) {\n  return Buffer.from(string, encoding).toString('base64').replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n\nfunction jwsSecuredInput(header, payload, encoding) {\n  encoding = encoding || 'utf8';\n  var encodedHeader = base64url(toString(header), 'binary');\n  var encodedPayload = base64url(toString(payload), encoding);\n  return util.format('%s.%s', encodedHeader, encodedPayload);\n}\n\nfunction jwsSign(opts) {\n  var header = opts.header;\n  var payload = opts.payload;\n  var secretOrKey = opts.secret || opts.privateKey;\n  var encoding = opts.encoding;\n  var algo = jwa(header.alg);\n  var securedInput = jwsSecuredInput(header, payload, encoding);\n  var signature = algo.sign(securedInput, secretOrKey);\n  return util.format('%s.%s', securedInput, signature);\n}\n\nfunction SignStream(opts) {\n  var secret = opts.secret || opts.privateKey || opts.key;\n  var secretStream = new DataStream(secret);\n  this.readable = true;\n  this.header = opts.header;\n  this.encoding = opts.encoding;\n  this.secret = this.privateKey = this.key = secretStream;\n  this.payload = new DataStream(opts.payload);\n  this.secret.once('close', function () {\n    if (!this.payload.writable && this.readable) this.sign();\n  }.bind(this));\n  this.payload.once('close', function () {\n    if (!this.secret.writable && this.readable) this.sign();\n  }.bind(this));\n}\n\nutil.inherits(SignStream, Stream);\n\nSignStream.prototype.sign = function sign() {\n  try {\n    var signature = jwsSign({\n      header: this.header,\n      payload: this.payload.buffer,\n      secret: this.secret.buffer,\n      encoding: this.encoding\n    });\n    this.emit('done', signature);\n    this.emit('data', signature);\n    this.emit('end');\n    this.readable = false;\n    return signature;\n  } catch (e) {\n    this.readable = false;\n    this.emit('error', e);\n    this.emit('close');\n  }\n};\n\nSignStream.sign = jwsSign;\nmodule.exports = SignStream;","map":{"version":3,"sources":["C:/Smart-Virtual-Classroom/client/node_modules/jws/lib/sign-stream.js"],"names":["Buffer","require","DataStream","jwa","Stream","toString","util","base64url","string","encoding","from","replace","jwsSecuredInput","header","payload","encodedHeader","encodedPayload","format","jwsSign","opts","secretOrKey","secret","privateKey","algo","alg","securedInput","signature","sign","SignStream","key","secretStream","readable","once","writable","bind","inherits","prototype","buffer","emit","e","module","exports"],"mappings":"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","sourcesContent":["/*global module*/\nvar Buffer = require('safe-buffer').Buffer;\nvar DataStream = require('./data-stream');\nvar jwa = require('jwa');\nvar Stream = require('stream');\nvar toString = require('./tostring');\nvar util = require('util');\n\nfunction base64url(string, encoding) {\n  return Buffer\n    .from(string, encoding)\n    .toString('base64')\n    .replace(/=/g, '')\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_');\n}\n\nfunction jwsSecuredInput(header, payload, encoding) {\n  encoding = encoding || 'utf8';\n  var encodedHeader = base64url(toString(header), 'binary');\n  var encodedPayload = base64url(toString(payload), encoding);\n  return util.format('%s.%s', encodedHeader, encodedPayload);\n}\n\nfunction jwsSign(opts) {\n  var header = opts.header;\n  var payload = opts.payload;\n  var secretOrKey = opts.secret || opts.privateKey;\n  var encoding = opts.encoding;\n  var algo = jwa(header.alg);\n  var securedInput = jwsSecuredInput(header, payload, encoding);\n  var signature = algo.sign(securedInput, secretOrKey);\n  return util.format('%s.%s', securedInput, signature);\n}\n\nfunction SignStream(opts) {\n  var secret = opts.secret||opts.privateKey||opts.key;\n  var secretStream = new DataStream(secret);\n  this.readable = true;\n  this.header = opts.header;\n  this.encoding = opts.encoding;\n  this.secret = this.privateKey = this.key = secretStream;\n  this.payload = new DataStream(opts.payload);\n  this.secret.once('close', function () {\n    if (!this.payload.writable && this.readable)\n      this.sign();\n  }.bind(this));\n\n  this.payload.once('close', function () {\n    if (!this.secret.writable && this.readable)\n      this.sign();\n  }.bind(this));\n}\nutil.inherits(SignStream, Stream);\n\nSignStream.prototype.sign = function sign() {\n  try {\n    var signature = jwsSign({\n      header: this.header,\n      payload: this.payload.buffer,\n      secret: this.secret.buffer,\n      encoding: this.encoding\n    });\n    this.emit('done', signature);\n    this.emit('data', signature);\n    this.emit('end');\n    this.readable = false;\n    return signature;\n  } catch (e) {\n    this.readable = false;\n    this.emit('error', e);\n    this.emit('close');\n  }\n};\n\nSignStream.sign = jwsSign;\n\nmodule.exports = SignStream;\n"]},"metadata":{},"sourceType":"script"}