{"ast":null,"code":"/**\r\n * DevExtreme (ui/scheduler/appointmentPopup.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _devices = _interopRequireDefault(require(\"../../core/devices\"));\n\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\n\nvar _date = _interopRequireDefault(require(\"../../core/utils/date\"));\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _window = require(\"../../core/utils/window\");\n\nvar _visibility_change = require(\"../../events/visibility_change\");\n\nvar _message = _interopRequireDefault(require(\"../../localization/message\"));\n\nvar _popup = _interopRequireDefault(require(\"../popup\"));\n\nvar _uiScheduler = require(\"./ui.scheduler.appointment_form\");\n\nvar _ui = require(\"./ui.loading\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar toMs = _date.default.dateToMilliseconds;\nvar WIDGET_CLASS = \"dx-scheduler\";\nvar APPOINTMENT_POPUP_CLASS = \"\".concat(WIDGET_CLASS, \"-appointment-popup\");\nvar APPOINTMENT_POPUP_WIDTH = 485;\nvar APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE = 970;\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH = 1e3;\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE = 500;\nvar APPOINTMENT_POPUP_WIDTH_MOBILE = 350;\nvar TOOLBAR_ITEM_AFTER_LOCATION = \"after\";\nvar TOOLBAR_ITEM_BEFORE_LOCATION = \"before\";\nvar DAY_IN_MS = toMs(\"day\");\n\nvar AppointmentPopup = function () {\n  function AppointmentPopup(scheduler) {\n    this.scheduler = scheduler;\n    this._popup = null;\n    this._appointmentForm = null;\n    this.state = {\n      lastEditData: null,\n      saveChangesLocker: false,\n      appointment: {\n        data: null,\n        isEmptyText: false,\n        isEmptyDescription: false\n      }\n    };\n  }\n\n  var _proto = AppointmentPopup.prototype;\n\n  _proto.show = function () {\n    var data = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};\n    var isDoneButtonVisible = arguments.length > 1 ? arguments[1] : void 0;\n\n    if ((0, _type.isEmptyObject)(data)) {\n      var startDate = this.scheduler.option(\"currentDate\");\n      var endDate = new Date(startDate.getTime() + this.scheduler.option(\"cellDuration\") * toMs(\"minute\"));\n      this.scheduler.fire(\"setField\", \"startDate\", data, startDate);\n      this.scheduler.fire(\"setField\", \"endDate\", data, endDate);\n    }\n\n    this.state.appointment.data = data;\n\n    if (!this._popup) {\n      var popupConfig = this._createPopupConfig();\n\n      this._popup = this._createPopup(popupConfig);\n    }\n\n    this._popup.option(\"toolbarItems\", this._createPopupToolbarItems(isDoneButtonVisible));\n\n    this._popup.show();\n  };\n\n  _proto.hide = function () {\n    this._popup.hide();\n  };\n\n  _proto.isVisible = function () {\n    return this._popup ? this._popup.option(\"visible\") : false;\n  };\n\n  _proto.dispose = function () {\n    if (this._$popup) {\n      this._popup.$element().remove();\n\n      this._$popup = null;\n    }\n  };\n\n  _proto._createPopup = function (options) {\n    var popupElement = (0, _renderer.default)(\"<div>\").addClass(APPOINTMENT_POPUP_CLASS).appendTo(this.scheduler.$element());\n    return this.scheduler._createComponent(popupElement, _popup.default, options);\n  };\n\n  _proto._createPopupConfig = function () {\n    var _this = this;\n\n    return {\n      height: \"auto\",\n      maxHeight: \"100%\",\n      showCloseButton: false,\n      showTitle: false,\n      onHiding: function () {\n        _this.scheduler.focus();\n      },\n      contentTemplate: function () {\n        return _this._createPopupContent();\n      },\n      onShowing: function (e) {\n        return _this._onShowing(e);\n      },\n      defaultOptionsRules: [{\n        device: function () {\n          return _devices.default.current().android;\n        },\n        options: {\n          showTitle: false\n        }\n      }]\n    };\n  };\n\n  _proto._onShowing = function (e) {\n    var _this2 = this;\n\n    this._updateForm();\n\n    var arg = {\n      form: this._appointmentForm,\n      popup: this._popup,\n      appointmentData: this.state.appointment.data,\n      cancel: false\n    };\n\n    this.scheduler._actions.onAppointmentFormOpening(arg);\n\n    this.scheduler._processActionResult(arg, function (canceled) {\n      if (canceled) {\n        e.cancel = true;\n      } else {\n        _this2.updatePopupFullScreenMode();\n      }\n    });\n  };\n\n  _proto._createPopupContent = function () {\n    var formElement = (0, _renderer.default)(\"<div>\");\n    this._appointmentForm = this._createForm(formElement);\n    return formElement;\n  };\n\n  _proto._createAppointmentFormData = function (rawAppointment) {\n    var appointment = this._createAppointmentAdapter(rawAppointment);\n\n    var result = (0, _extend.extend)(true, {\n      repeat: !!appointment.recurrenceRule\n    }, rawAppointment);\n    (0, _iterator.each)(this.scheduler._resourcesManager.getResourcesFromItem(result, true) || {}, function (name, value) {\n      return result[name] = value;\n    });\n    return result;\n  };\n\n  _proto._createForm = function (element) {\n    var expr = this.scheduler._dataAccessors.expr;\n    var resources = this.scheduler.option(\"resources\");\n\n    var allowTimeZoneEditing = this._getAllowTimeZoneEditing();\n\n    var rawAppointment = this.state.appointment.data;\n\n    var formData = this._createAppointmentFormData(rawAppointment);\n\n    var readOnly = this._isReadOnly(rawAppointment);\n\n    _uiScheduler.AppointmentForm.prepareAppointmentFormEditors(expr, this.scheduler, this.triggerResize.bind(this), this.changeSize.bind(this), formData, allowTimeZoneEditing, readOnly);\n\n    if (resources && resources.length) {\n      _uiScheduler.AppointmentForm.concatResources(this.scheduler._resourcesManager.getEditors());\n    }\n\n    return _uiScheduler.AppointmentForm.create(this.scheduler._createComponent.bind(this.scheduler), element, readOnly, formData);\n  };\n\n  _proto._getAllowTimeZoneEditing = function () {\n    var scheduler = this.scheduler;\n    return scheduler.option(\"editing.allowTimeZoneEditing\") || scheduler.option(\"editing.allowEditingTimeZones\");\n  };\n\n  _proto._isReadOnly = function (rawAppointment) {\n    var adapter = this.scheduler.createAppointmentAdapter(rawAppointment);\n\n    if (rawAppointment && adapter.disabled) {\n      return true;\n    }\n\n    return this.scheduler._editAppointmentData ? !this.scheduler._editing.allowUpdating : false;\n  };\n\n  _proto._createAppointmentAdapter = function (rawAppointment) {\n    return this.scheduler.createAppointmentAdapter(rawAppointment);\n  };\n\n  _proto._updateForm = function () {\n    var data = this.state.appointment.data;\n\n    var adapter = this._createAppointmentAdapter(data);\n\n    var allDay = adapter.allDay;\n    var startDate = adapter.startDate && adapter.calculateStartDate(\"toAppointment\");\n    var endDate = adapter.endDate && adapter.calculateEndDate(\"toAppointment\");\n    this.state.appointment.isEmptyText = void 0 === data || void 0 === adapter.text;\n    this.state.appointment.isEmptyDescription = void 0 === data || void 0 === adapter.description;\n\n    var appointment = this._createAppointmentAdapter(this._createAppointmentFormData(data));\n\n    if (void 0 === appointment.text) {\n      appointment.text = \"\";\n    }\n\n    if (void 0 === appointment.description) {\n      appointment.description = \"\";\n    }\n\n    if (void 0 === appointment.recurrenceRule) {\n      appointment.recurrenceRule = \"\";\n    }\n\n    var formData = appointment.source();\n\n    if (startDate) {\n      this.scheduler.fire(\"setField\", \"startDate\", formData, startDate);\n    }\n\n    if (endDate) {\n      this.scheduler.fire(\"setField\", \"endDate\", formData, endDate);\n    }\n\n    var _this$scheduler$_data = this.scheduler._dataAccessors.expr,\n        startDateExpr = _this$scheduler$_data.startDateExpr,\n        endDateExpr = _this$scheduler$_data.endDateExpr;\n\n    this._appointmentForm.option(\"readOnly\", this._isReadOnly(data));\n\n    _uiScheduler.AppointmentForm.updateFormData(this._appointmentForm, formData, this.scheduler._dataAccessors.expr);\n\n    _uiScheduler.AppointmentForm.setEditorsType(this._appointmentForm, startDateExpr, endDateExpr, allDay);\n  };\n\n  _proto._isDeviceMobile = function () {\n    return \"desktop\" !== _devices.default.current().deviceType;\n  };\n\n  _proto._isPopupFullScreenNeeded = function () {\n    var width = this._tryGetWindowWidth();\n\n    if (width) {\n      return this._isDeviceMobile() ? width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE : width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH;\n    }\n\n    return false;\n  };\n\n  _proto._tryGetWindowWidth = function () {\n    if ((0, _window.hasWindow)()) {\n      var window = (0, _window.getWindow)();\n      return (0, _renderer.default)(window).width();\n    }\n  };\n\n  _proto.triggerResize = function () {\n    this._popup && (0, _visibility_change.triggerResizeEvent)(this._popup.$element());\n  };\n\n  _proto._getMaxWidth = function (isRecurrence) {\n    if (this._isDeviceMobile()) {\n      return APPOINTMENT_POPUP_WIDTH_MOBILE;\n    }\n\n    return isRecurrence ? APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE : APPOINTMENT_POPUP_WIDTH;\n  };\n\n  _proto.changeSize = function (isRecurrence) {\n    var isFullScreen = this._isPopupFullScreenNeeded();\n\n    this._popup.option({\n      maxWidth: isFullScreen ? \"100%\" : this._getMaxWidth(isRecurrence),\n      fullScreen: isFullScreen\n    });\n  };\n\n  _proto.updatePopupFullScreenMode = function () {\n    if (!this._appointmentForm) {\n      return;\n    }\n\n    var isRecurrence = _uiScheduler.AppointmentForm.getRecurrenceRule(this._appointmentForm.option(\"formData\"), this.scheduler._dataAccessors.expr);\n\n    if (this.isVisible()) {\n      this.changeSize(isRecurrence);\n    }\n  };\n\n  _proto._createPopupToolbarItems = function (isDoneButtonVisible) {\n    var _this3 = this;\n\n    var result = [];\n\n    var isIOs = \"ios\" === _devices.default.current().platform;\n\n    if (isDoneButtonVisible) {\n      result.push({\n        shortcut: \"done\",\n        options: {\n          text: _message.default.format(\"Done\")\n        },\n        location: TOOLBAR_ITEM_AFTER_LOCATION,\n        onClick: function (e) {\n          return _this3._doneButtonClickHandler(e);\n        }\n      });\n    }\n\n    result.push({\n      shortcut: \"cancel\",\n      location: isIOs ? TOOLBAR_ITEM_BEFORE_LOCATION : TOOLBAR_ITEM_AFTER_LOCATION\n    });\n    return result;\n  };\n\n  _proto.saveChanges = function (showLoadPanel) {\n    var _this4 = this;\n\n    var deferred = new _deferred.Deferred();\n\n    var validation = this._appointmentForm.validate();\n\n    var state = this.state.appointment;\n    showLoadPanel && this._showLoadPanel();\n    (0, _deferred.when)(validation && validation.complete || validation).done(function (validation) {\n      if (validation && !validation.isValid) {\n        _this4._hideLoadPanel();\n\n        deferred.resolve(false);\n        return;\n      }\n\n      var formData = _this4._appointmentForm.option(\"formData\");\n\n      var adapter = _this4.scheduler.createAppointmentAdapter(formData);\n\n      var appointment = adapter.clone({\n        pathTimeZone: \"fromAppointment\"\n      }).source();\n      var oldData = _this4.scheduler._editAppointmentData;\n      var recData = _this4.scheduler._updatedRecAppointment;\n\n      if (state.isEmptyText && \"\" === adapter.text) {\n        delete appointment.text;\n      }\n\n      if (state.isEmptyDescription && \"\" === adapter.description) {\n        delete appointment.description;\n      }\n\n      if (void 0 === state.data.recurrenceRule && \"\" === adapter.recurrenceRule) {\n        delete appointment.recurrenceRule;\n      }\n\n      if ((0, _type.isDefined)(appointment.repeat)) {\n        delete appointment.repeat;\n      }\n\n      if (oldData && !recData) {\n        _this4.scheduler.updateAppointment(oldData, appointment).done(deferred.resolve);\n      } else {\n        if (recData) {\n          _this4.scheduler.updateAppointment(oldData, recData);\n\n          delete _this4.scheduler._updatedRecAppointment;\n        }\n\n        _this4.scheduler.addAppointment(appointment).done(deferred.resolve);\n      }\n\n      deferred.done(function () {\n        _this4._hideLoadPanel();\n\n        _this4.state.lastEditData = appointment;\n      });\n    });\n    return deferred.promise();\n  };\n\n  _proto._doneButtonClickHandler = function (e) {\n    e.cancel = true;\n    this.saveEditData();\n  };\n\n  _proto.saveEditData = function () {\n    var _this5 = this;\n\n    var deferred = new _deferred.Deferred();\n\n    if (this._tryLockSaveChanges()) {\n      (0, _deferred.when)(this.saveChanges(true)).done(function () {\n        if (_this5.state.lastEditData) {\n          var adapter = _this5.scheduler.createAppointmentAdapter(_this5.state.lastEditData);\n\n          var startDate = adapter.startDate,\n              endDate = adapter.endDate,\n              allDay = adapter.allDay;\n          var startTime = startDate.getTime();\n          var endTime = endDate.getTime();\n          var inAllDayRow = allDay || endTime - startTime >= DAY_IN_MS;\n\n          _this5.scheduler._workSpace.updateScrollPosition(startDate, _this5.scheduler._resourcesManager.getResourcesFromItem(_this5.state.lastEditData, true), inAllDayRow);\n\n          _this5.state.lastEditData = null;\n        }\n\n        _this5._unlockSaveChanges();\n\n        deferred.resolve();\n      });\n    }\n\n    return deferred.promise();\n  };\n\n  _proto._hideLoadPanel = function () {\n    (0, _ui.hide)();\n  };\n\n  _proto._showLoadPanel = function () {\n    var $overlayContent = this._popup.overlayContent();\n\n    (0, _ui.show)({\n      container: $overlayContent,\n      position: {\n        of: $overlayContent\n      }\n    });\n  };\n\n  _proto._tryLockSaveChanges = function () {\n    if (false === this.state.saveChangesLocker) {\n      this.state.saveChangesLocker = true;\n      return true;\n    }\n\n    return false;\n  };\n\n  _proto._unlockSaveChanges = function () {\n    this.state.saveChangesLocker = false;\n  };\n\n  return AppointmentPopup;\n}();\n\nexports.default = AppointmentPopup;\nmodule.exports = exports.default;","map":{"version":3,"sources":["C:/Smart-Virtual-Classroom/client/node_modules/devextreme/ui/scheduler/appointmentPopup.js"],"names":["exports","default","_devices","_interopRequireDefault","require","_renderer","_date","_deferred","_extend","_iterator","_type","_window","_visibility_change","_message","_popup","_uiScheduler","_ui","obj","__esModule","toMs","dateToMilliseconds","WIDGET_CLASS","APPOINTMENT_POPUP_CLASS","concat","APPOINTMENT_POPUP_WIDTH","APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE","APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH","APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE","APPOINTMENT_POPUP_WIDTH_MOBILE","TOOLBAR_ITEM_AFTER_LOCATION","TOOLBAR_ITEM_BEFORE_LOCATION","DAY_IN_MS","AppointmentPopup","scheduler","_appointmentForm","state","lastEditData","saveChangesLocker","appointment","data","isEmptyText","isEmptyDescription","_proto","prototype","show","arguments","length","isDoneButtonVisible","isEmptyObject","startDate","option","endDate","Date","getTime","fire","popupConfig","_createPopupConfig","_createPopup","_createPopupToolbarItems","hide","isVisible","dispose","_$popup","$element","remove","options","popupElement","addClass","appendTo","_createComponent","_this","height","maxHeight","showCloseButton","showTitle","onHiding","focus","contentTemplate","_createPopupContent","onShowing","e","_onShowing","defaultOptionsRules","device","current","android","_this2","_updateForm","arg","form","popup","appointmentData","cancel","_actions","onAppointmentFormOpening","_processActionResult","canceled","updatePopupFullScreenMode","formElement","_createForm","_createAppointmentFormData","rawAppointment","_createAppointmentAdapter","result","extend","repeat","recurrenceRule","each","_resourcesManager","getResourcesFromItem","name","value","element","expr","_dataAccessors","resources","allowTimeZoneEditing","_getAllowTimeZoneEditing","formData","readOnly","_isReadOnly","AppointmentForm","prepareAppointmentFormEditors","triggerResize","bind","changeSize","concatResources","getEditors","create","adapter","createAppointmentAdapter","disabled","_editAppointmentData","_editing","allowUpdating","allDay","calculateStartDate","calculateEndDate","text","description","source","_this$scheduler$_data","startDateExpr","endDateExpr","updateFormData","setEditorsType","_isDeviceMobile","deviceType","_isPopupFullScreenNeeded","width","_tryGetWindowWidth","hasWindow","window","getWindow","triggerResizeEvent","_getMaxWidth","isRecurrence","isFullScreen","maxWidth","fullScreen","getRecurrenceRule","_this3","isIOs","platform","push","shortcut","format","location","onClick","_doneButtonClickHandler","saveChanges","showLoadPanel","_this4","deferred","Deferred","validation","validate","_showLoadPanel","when","complete","done","isValid","_hideLoadPanel","resolve","clone","pathTimeZone","oldData","recData","_updatedRecAppointment","isDefined","updateAppointment","addAppointment","promise","saveEditData","_this5","_tryLockSaveChanges","startTime","endTime","inAllDayRow","_workSpace","updateScrollPosition","_unlockSaveChanges","$overlayContent","overlayContent","container","position","of","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/scheduler/appointmentPopup.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _devices = _interopRequireDefault(require(\"../../core/devices\"));\r\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\r\nvar _date = _interopRequireDefault(require(\"../../core/utils/date\"));\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _window = require(\"../../core/utils/window\");\r\nvar _visibility_change = require(\"../../events/visibility_change\");\r\nvar _message = _interopRequireDefault(require(\"../../localization/message\"));\r\nvar _popup = _interopRequireDefault(require(\"../popup\"));\r\nvar _uiScheduler = require(\"./ui.scheduler.appointment_form\");\r\nvar _ui = require(\"./ui.loading\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar toMs = _date.default.dateToMilliseconds;\r\nvar WIDGET_CLASS = \"dx-scheduler\";\r\nvar APPOINTMENT_POPUP_CLASS = \"\".concat(WIDGET_CLASS, \"-appointment-popup\");\r\nvar APPOINTMENT_POPUP_WIDTH = 485;\r\nvar APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE = 970;\r\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH = 1e3;\r\nvar APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE = 500;\r\nvar APPOINTMENT_POPUP_WIDTH_MOBILE = 350;\r\nvar TOOLBAR_ITEM_AFTER_LOCATION = \"after\";\r\nvar TOOLBAR_ITEM_BEFORE_LOCATION = \"before\";\r\nvar DAY_IN_MS = toMs(\"day\");\r\nvar AppointmentPopup = function() {\r\n    function AppointmentPopup(scheduler) {\r\n        this.scheduler = scheduler;\r\n        this._popup = null;\r\n        this._appointmentForm = null;\r\n        this.state = {\r\n            lastEditData: null,\r\n            saveChangesLocker: false,\r\n            appointment: {\r\n                data: null,\r\n                isEmptyText: false,\r\n                isEmptyDescription: false\r\n            }\r\n        }\r\n    }\r\n    var _proto = AppointmentPopup.prototype;\r\n    _proto.show = function() {\r\n        var data = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : {};\r\n        var isDoneButtonVisible = arguments.length > 1 ? arguments[1] : void 0;\r\n        if ((0, _type.isEmptyObject)(data)) {\r\n            var startDate = this.scheduler.option(\"currentDate\");\r\n            var endDate = new Date(startDate.getTime() + this.scheduler.option(\"cellDuration\") * toMs(\"minute\"));\r\n            this.scheduler.fire(\"setField\", \"startDate\", data, startDate);\r\n            this.scheduler.fire(\"setField\", \"endDate\", data, endDate)\r\n        }\r\n        this.state.appointment.data = data;\r\n        if (!this._popup) {\r\n            var popupConfig = this._createPopupConfig();\r\n            this._popup = this._createPopup(popupConfig)\r\n        }\r\n        this._popup.option(\"toolbarItems\", this._createPopupToolbarItems(isDoneButtonVisible));\r\n        this._popup.show()\r\n    };\r\n    _proto.hide = function() {\r\n        this._popup.hide()\r\n    };\r\n    _proto.isVisible = function() {\r\n        return this._popup ? this._popup.option(\"visible\") : false\r\n    };\r\n    _proto.dispose = function() {\r\n        if (this._$popup) {\r\n            this._popup.$element().remove();\r\n            this._$popup = null\r\n        }\r\n    };\r\n    _proto._createPopup = function(options) {\r\n        var popupElement = (0, _renderer.default)(\"<div>\").addClass(APPOINTMENT_POPUP_CLASS).appendTo(this.scheduler.$element());\r\n        return this.scheduler._createComponent(popupElement, _popup.default, options)\r\n    };\r\n    _proto._createPopupConfig = function() {\r\n        var _this = this;\r\n        return {\r\n            height: \"auto\",\r\n            maxHeight: \"100%\",\r\n            showCloseButton: false,\r\n            showTitle: false,\r\n            onHiding: function() {\r\n                _this.scheduler.focus()\r\n            },\r\n            contentTemplate: function() {\r\n                return _this._createPopupContent()\r\n            },\r\n            onShowing: function(e) {\r\n                return _this._onShowing(e)\r\n            },\r\n            defaultOptionsRules: [{\r\n                device: function() {\r\n                    return _devices.default.current().android\r\n                },\r\n                options: {\r\n                    showTitle: false\r\n                }\r\n            }]\r\n        }\r\n    };\r\n    _proto._onShowing = function(e) {\r\n        var _this2 = this;\r\n        this._updateForm();\r\n        var arg = {\r\n            form: this._appointmentForm,\r\n            popup: this._popup,\r\n            appointmentData: this.state.appointment.data,\r\n            cancel: false\r\n        };\r\n        this.scheduler._actions.onAppointmentFormOpening(arg);\r\n        this.scheduler._processActionResult(arg, function(canceled) {\r\n            if (canceled) {\r\n                e.cancel = true\r\n            } else {\r\n                _this2.updatePopupFullScreenMode()\r\n            }\r\n        })\r\n    };\r\n    _proto._createPopupContent = function() {\r\n        var formElement = (0, _renderer.default)(\"<div>\");\r\n        this._appointmentForm = this._createForm(formElement);\r\n        return formElement\r\n    };\r\n    _proto._createAppointmentFormData = function(rawAppointment) {\r\n        var appointment = this._createAppointmentAdapter(rawAppointment);\r\n        var result = (0, _extend.extend)(true, {\r\n            repeat: !!appointment.recurrenceRule\r\n        }, rawAppointment);\r\n        (0, _iterator.each)(this.scheduler._resourcesManager.getResourcesFromItem(result, true) || {}, function(name, value) {\r\n            return result[name] = value\r\n        });\r\n        return result\r\n    };\r\n    _proto._createForm = function(element) {\r\n        var expr = this.scheduler._dataAccessors.expr;\r\n        var resources = this.scheduler.option(\"resources\");\r\n        var allowTimeZoneEditing = this._getAllowTimeZoneEditing();\r\n        var rawAppointment = this.state.appointment.data;\r\n        var formData = this._createAppointmentFormData(rawAppointment);\r\n        var readOnly = this._isReadOnly(rawAppointment);\r\n        _uiScheduler.AppointmentForm.prepareAppointmentFormEditors(expr, this.scheduler, this.triggerResize.bind(this), this.changeSize.bind(this), formData, allowTimeZoneEditing, readOnly);\r\n        if (resources && resources.length) {\r\n            _uiScheduler.AppointmentForm.concatResources(this.scheduler._resourcesManager.getEditors())\r\n        }\r\n        return _uiScheduler.AppointmentForm.create(this.scheduler._createComponent.bind(this.scheduler), element, readOnly, formData)\r\n    };\r\n    _proto._getAllowTimeZoneEditing = function() {\r\n        var scheduler = this.scheduler;\r\n        return scheduler.option(\"editing.allowTimeZoneEditing\") || scheduler.option(\"editing.allowEditingTimeZones\")\r\n    };\r\n    _proto._isReadOnly = function(rawAppointment) {\r\n        var adapter = this.scheduler.createAppointmentAdapter(rawAppointment);\r\n        if (rawAppointment && adapter.disabled) {\r\n            return true\r\n        }\r\n        return this.scheduler._editAppointmentData ? !this.scheduler._editing.allowUpdating : false\r\n    };\r\n    _proto._createAppointmentAdapter = function(rawAppointment) {\r\n        return this.scheduler.createAppointmentAdapter(rawAppointment)\r\n    };\r\n    _proto._updateForm = function() {\r\n        var data = this.state.appointment.data;\r\n        var adapter = this._createAppointmentAdapter(data);\r\n        var allDay = adapter.allDay;\r\n        var startDate = adapter.startDate && adapter.calculateStartDate(\"toAppointment\");\r\n        var endDate = adapter.endDate && adapter.calculateEndDate(\"toAppointment\");\r\n        this.state.appointment.isEmptyText = void 0 === data || void 0 === adapter.text;\r\n        this.state.appointment.isEmptyDescription = void 0 === data || void 0 === adapter.description;\r\n        var appointment = this._createAppointmentAdapter(this._createAppointmentFormData(data));\r\n        if (void 0 === appointment.text) {\r\n            appointment.text = \"\"\r\n        }\r\n        if (void 0 === appointment.description) {\r\n            appointment.description = \"\"\r\n        }\r\n        if (void 0 === appointment.recurrenceRule) {\r\n            appointment.recurrenceRule = \"\"\r\n        }\r\n        var formData = appointment.source();\r\n        if (startDate) {\r\n            this.scheduler.fire(\"setField\", \"startDate\", formData, startDate)\r\n        }\r\n        if (endDate) {\r\n            this.scheduler.fire(\"setField\", \"endDate\", formData, endDate)\r\n        }\r\n        var _this$scheduler$_data = this.scheduler._dataAccessors.expr,\r\n            startDateExpr = _this$scheduler$_data.startDateExpr,\r\n            endDateExpr = _this$scheduler$_data.endDateExpr;\r\n        this._appointmentForm.option(\"readOnly\", this._isReadOnly(data));\r\n        _uiScheduler.AppointmentForm.updateFormData(this._appointmentForm, formData, this.scheduler._dataAccessors.expr);\r\n        _uiScheduler.AppointmentForm.setEditorsType(this._appointmentForm, startDateExpr, endDateExpr, allDay)\r\n    };\r\n    _proto._isDeviceMobile = function() {\r\n        return \"desktop\" !== _devices.default.current().deviceType\r\n    };\r\n    _proto._isPopupFullScreenNeeded = function() {\r\n        var width = this._tryGetWindowWidth();\r\n        if (width) {\r\n            return this._isDeviceMobile() ? width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH_MOBILE : width < APPOINTMENT_POPUP_FULLSCREEN_WINDOW_WIDTH\r\n        }\r\n        return false\r\n    };\r\n    _proto._tryGetWindowWidth = function() {\r\n        if ((0, _window.hasWindow)()) {\r\n            var window = (0, _window.getWindow)();\r\n            return (0, _renderer.default)(window).width()\r\n        }\r\n    };\r\n    _proto.triggerResize = function() {\r\n        this._popup && (0, _visibility_change.triggerResizeEvent)(this._popup.$element())\r\n    };\r\n    _proto._getMaxWidth = function(isRecurrence) {\r\n        if (this._isDeviceMobile()) {\r\n            return APPOINTMENT_POPUP_WIDTH_MOBILE\r\n        }\r\n        return isRecurrence ? APPOINTMENT_POPUP_WIDTH_WITH_RECURRENCE : APPOINTMENT_POPUP_WIDTH\r\n    };\r\n    _proto.changeSize = function(isRecurrence) {\r\n        var isFullScreen = this._isPopupFullScreenNeeded();\r\n        this._popup.option({\r\n            maxWidth: isFullScreen ? \"100%\" : this._getMaxWidth(isRecurrence),\r\n            fullScreen: isFullScreen\r\n        })\r\n    };\r\n    _proto.updatePopupFullScreenMode = function() {\r\n        if (!this._appointmentForm) {\r\n            return\r\n        }\r\n        var isRecurrence = _uiScheduler.AppointmentForm.getRecurrenceRule(this._appointmentForm.option(\"formData\"), this.scheduler._dataAccessors.expr);\r\n        if (this.isVisible()) {\r\n            this.changeSize(isRecurrence)\r\n        }\r\n    };\r\n    _proto._createPopupToolbarItems = function(isDoneButtonVisible) {\r\n        var _this3 = this;\r\n        var result = [];\r\n        var isIOs = \"ios\" === _devices.default.current().platform;\r\n        if (isDoneButtonVisible) {\r\n            result.push({\r\n                shortcut: \"done\",\r\n                options: {\r\n                    text: _message.default.format(\"Done\")\r\n                },\r\n                location: TOOLBAR_ITEM_AFTER_LOCATION,\r\n                onClick: function(e) {\r\n                    return _this3._doneButtonClickHandler(e)\r\n                }\r\n            })\r\n        }\r\n        result.push({\r\n            shortcut: \"cancel\",\r\n            location: isIOs ? TOOLBAR_ITEM_BEFORE_LOCATION : TOOLBAR_ITEM_AFTER_LOCATION\r\n        });\r\n        return result\r\n    };\r\n    _proto.saveChanges = function(showLoadPanel) {\r\n        var _this4 = this;\r\n        var deferred = new _deferred.Deferred;\r\n        var validation = this._appointmentForm.validate();\r\n        var state = this.state.appointment;\r\n        showLoadPanel && this._showLoadPanel();\r\n        (0, _deferred.when)(validation && validation.complete || validation).done(function(validation) {\r\n            if (validation && !validation.isValid) {\r\n                _this4._hideLoadPanel();\r\n                deferred.resolve(false);\r\n                return\r\n            }\r\n            var formData = _this4._appointmentForm.option(\"formData\");\r\n            var adapter = _this4.scheduler.createAppointmentAdapter(formData);\r\n            var appointment = adapter.clone({\r\n                pathTimeZone: \"fromAppointment\"\r\n            }).source();\r\n            var oldData = _this4.scheduler._editAppointmentData;\r\n            var recData = _this4.scheduler._updatedRecAppointment;\r\n            if (state.isEmptyText && \"\" === adapter.text) {\r\n                delete appointment.text\r\n            }\r\n            if (state.isEmptyDescription && \"\" === adapter.description) {\r\n                delete appointment.description\r\n            }\r\n            if (void 0 === state.data.recurrenceRule && \"\" === adapter.recurrenceRule) {\r\n                delete appointment.recurrenceRule\r\n            }\r\n            if ((0, _type.isDefined)(appointment.repeat)) {\r\n                delete appointment.repeat\r\n            }\r\n            if (oldData && !recData) {\r\n                _this4.scheduler.updateAppointment(oldData, appointment).done(deferred.resolve)\r\n            } else {\r\n                if (recData) {\r\n                    _this4.scheduler.updateAppointment(oldData, recData);\r\n                    delete _this4.scheduler._updatedRecAppointment\r\n                }\r\n                _this4.scheduler.addAppointment(appointment).done(deferred.resolve)\r\n            }\r\n            deferred.done(function() {\r\n                _this4._hideLoadPanel();\r\n                _this4.state.lastEditData = appointment\r\n            })\r\n        });\r\n        return deferred.promise()\r\n    };\r\n    _proto._doneButtonClickHandler = function(e) {\r\n        e.cancel = true;\r\n        this.saveEditData()\r\n    };\r\n    _proto.saveEditData = function() {\r\n        var _this5 = this;\r\n        var deferred = new _deferred.Deferred;\r\n        if (this._tryLockSaveChanges()) {\r\n            (0, _deferred.when)(this.saveChanges(true)).done(function() {\r\n                if (_this5.state.lastEditData) {\r\n                    var adapter = _this5.scheduler.createAppointmentAdapter(_this5.state.lastEditData);\r\n                    var startDate = adapter.startDate,\r\n                        endDate = adapter.endDate,\r\n                        allDay = adapter.allDay;\r\n                    var startTime = startDate.getTime();\r\n                    var endTime = endDate.getTime();\r\n                    var inAllDayRow = allDay || endTime - startTime >= DAY_IN_MS;\r\n                    _this5.scheduler._workSpace.updateScrollPosition(startDate, _this5.scheduler._resourcesManager.getResourcesFromItem(_this5.state.lastEditData, true), inAllDayRow);\r\n                    _this5.state.lastEditData = null\r\n                }\r\n                _this5._unlockSaveChanges();\r\n                deferred.resolve()\r\n            })\r\n        }\r\n        return deferred.promise()\r\n    };\r\n    _proto._hideLoadPanel = function() {\r\n        (0, _ui.hide)()\r\n    };\r\n    _proto._showLoadPanel = function() {\r\n        var $overlayContent = this._popup.overlayContent();\r\n        (0, _ui.show)({\r\n            container: $overlayContent,\r\n            position: {\r\n                of: $overlayContent\r\n            }\r\n        })\r\n    };\r\n    _proto._tryLockSaveChanges = function() {\r\n        if (false === this.state.saveChangesLocker) {\r\n            this.state.saveChangesLocker = true;\r\n            return true\r\n        }\r\n        return false\r\n    };\r\n    _proto._unlockSaveChanges = function() {\r\n        this.state.saveChangesLocker = false\r\n    };\r\n    return AppointmentPopup\r\n}();\r\nexports.default = AppointmentPopup;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}