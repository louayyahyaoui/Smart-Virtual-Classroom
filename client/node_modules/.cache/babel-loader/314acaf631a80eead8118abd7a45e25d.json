{"ast":null,"code":"/**\r\n * DevExtreme (data/data_source/data_source.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.DataSource = void 0;\n\nvar _class = _interopRequireDefault(require(\"../../core/class\"));\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _common = require(\"../../core/utils/common\");\n\nvar _iterator = require(\"../../core/utils/iterator\");\n\nvar _type = require(\"../../core/utils/type\");\n\nvar _utils = _interopRequireDefault(require(\"../utils\"));\n\nvar _array_utils = require(\"../array_utils\");\n\nvar _custom_store = _interopRequireDefault(require(\"../custom_store\"));\n\nvar _events_strategy = require(\"../../core/events_strategy\");\n\nvar _errors = _interopRequireDefault(require(\"../errors\"));\n\nvar _array = require(\"../../core/utils/array\");\n\nvar _queue = require(\"../../core/utils/queue\");\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _operation_manager = _interopRequireDefault(require(\"./operation_manager\"));\n\nvar _utils2 = require(\"./utils\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nvar DataSource = _class.default.inherit({\n  ctor: function (options) {\n    var _options$reshapeOnPus,\n        _this = this;\n\n    options = (0, _utils2.normalizeDataSourceOptions)(options);\n    this._eventsStrategy = new _events_strategy.EventsStrategy(this, {\n      syncStrategy: true\n    });\n    this._store = options.store;\n    this._changedTime = 0;\n    var needThrottling = 0 !== options.pushAggregationTimeout;\n\n    if (needThrottling) {\n      var throttlingTimeout = void 0 === options.pushAggregationTimeout ? function () {\n        return 5 * _this._changedTime;\n      } : options.pushAggregationTimeout;\n      var pushDeferred;\n\n      var throttlingPushHandler = _utils.default.throttleChanges(function (changes) {\n        pushDeferred.resolve();\n        pushDeferred.done(function () {\n          return _this._onPush(changes);\n        });\n        pushDeferred = void 0;\n      }, throttlingTimeout);\n\n      this._onPushHandler = function (args) {\n        _this._aggregationTimeoutId = throttlingPushHandler(args.changes);\n\n        if (!pushDeferred) {\n          pushDeferred = new _deferred.Deferred();\n        }\n\n        args.waitFor.push(pushDeferred.promise());\n      };\n\n      this._store.on(\"beforePush\", this._onPushHandler);\n    } else {\n      this._onPushHandler = function (changes) {\n        return _this._onPush(changes);\n      };\n\n      this._store.on(\"push\", this._onPushHandler);\n    }\n\n    this._storeLoadOptions = this._extractLoadOptions(options);\n    this._mapFunc = options.map;\n    this._postProcessFunc = options.postProcess;\n    this._pageIndex = void 0 !== options.pageIndex ? options.pageIndex : 0;\n    this._pageSize = void 0 !== options.pageSize ? options.pageSize : 20;\n    this._loadingCount = 0;\n    this._loadQueue = this._createLoadQueue();\n    this._searchValue = \"searchValue\" in options ? options.searchValue : null;\n    this._searchOperation = options.searchOperation || \"contains\";\n    this._searchExpr = options.searchExpr;\n    this._paginate = options.paginate;\n    this._reshapeOnPush = null !== (_options$reshapeOnPus = options.reshapeOnPush) && void 0 !== _options$reshapeOnPus ? _options$reshapeOnPus : false;\n    (0, _iterator.each)([\"onChanged\", \"onLoadError\", \"onLoadingChanged\", \"onCustomizeLoadResult\", \"onCustomizeStoreLoadOptions\"], function (_, optionName) {\n      if (optionName in options) {\n        _this.on(optionName.substr(2, 1).toLowerCase() + optionName.substr(3), options[optionName]);\n      }\n    });\n    this._operationManager = new _operation_manager.default();\n\n    this._init();\n  },\n  _init: function () {\n    this._items = [];\n    this._userData = {};\n    this._totalCount = -1;\n    this._isLoaded = false;\n\n    if (!(0, _type.isDefined)(this._paginate)) {\n      this._paginate = !this.group();\n    }\n\n    this._isLastPage = !this._paginate;\n  },\n  dispose: function () {\n    var _this$_delayedLoadTas;\n\n    this._store.off(\"beforePush\", this._onPushHandler);\n\n    this._store.off(\"push\", this._onPushHandler);\n\n    this._eventsStrategy.dispose();\n\n    clearTimeout(this._aggregationTimeoutId);\n    delete this._store;\n    null === (_this$_delayedLoadTas = this._delayedLoadTask) || void 0 === _this$_delayedLoadTas ? void 0 : _this$_delayedLoadTas.abort();\n\n    this._operationManager.cancelAll();\n\n    this._disposed = true;\n  },\n  _extractLoadOptions: function (options) {\n    var result = {};\n    var names = [\"sort\", \"filter\", \"select\", \"group\", \"requireTotalCount\"];\n\n    var customNames = this._store._customLoadOptions();\n\n    if (customNames) {\n      names = names.concat(customNames);\n    }\n\n    (0, _iterator.each)(names, function () {\n      result[this] = options[this];\n    });\n    return result;\n  },\n  loadOptions: function () {\n    return this._storeLoadOptions;\n  },\n  items: function () {\n    return this._items;\n  },\n  pageIndex: function (newIndex) {\n    if (!(0, _type.isNumeric)(newIndex)) {\n      return this._pageIndex;\n    }\n\n    this._pageIndex = newIndex;\n    this._isLastPage = !this._paginate;\n  },\n  paginate: function (value) {\n    if (!(0, _type.isBoolean)(value)) {\n      return this._paginate;\n    }\n\n    if (this._paginate !== value) {\n      this._paginate = value;\n      this.pageIndex(0);\n    }\n  },\n  pageSize: function (value) {\n    if (!(0, _type.isNumeric)(value)) {\n      return this._pageSize;\n    }\n\n    this._pageSize = value;\n  },\n  isLastPage: function () {\n    return this._isLastPage;\n  },\n  generateStoreLoadOptionAccessor: function (optionName) {\n    var _this2 = this;\n\n    return function (args) {\n      var normalizedArgs = (0, _utils2.normalizeStoreLoadOptionAccessorArguments)(args);\n\n      if (void 0 === normalizedArgs) {\n        return _this2._storeLoadOptions[optionName];\n      }\n\n      _this2._storeLoadOptions[optionName] = normalizedArgs;\n    };\n  },\n  sort: function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return this.generateStoreLoadOptionAccessor(\"sort\")(args);\n  },\n  filter: function () {\n    var newFilter = (0, _utils2.normalizeStoreLoadOptionAccessorArguments)(arguments);\n\n    if (void 0 === newFilter) {\n      return this._storeLoadOptions.filter;\n    }\n\n    this._storeLoadOptions.filter = newFilter;\n    this.pageIndex(0);\n  },\n  group: function () {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    return this.generateStoreLoadOptionAccessor(\"group\")(args);\n  },\n  select: function () {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    return this.generateStoreLoadOptionAccessor(\"select\")(args);\n  },\n  requireTotalCount: function (value) {\n    if (!(0, _type.isBoolean)(value)) {\n      return this._storeLoadOptions.requireTotalCount;\n    }\n\n    this._storeLoadOptions.requireTotalCount = value;\n  },\n  searchValue: function (value) {\n    if (arguments.length < 1) {\n      return this._searchValue;\n    }\n\n    this._searchValue = value;\n    this.pageIndex(0);\n  },\n  searchOperation: function (op) {\n    if (!(0, _type.isString)(op)) {\n      return this._searchOperation;\n    }\n\n    this._searchOperation = op;\n    this.pageIndex(0);\n  },\n  searchExpr: function (expr) {\n    var argc = arguments.length;\n\n    if (0 === argc) {\n      return this._searchExpr;\n    }\n\n    if (argc > 1) {\n      expr = [].slice.call(arguments);\n    }\n\n    this._searchExpr = expr;\n    this.pageIndex(0);\n  },\n  store: function () {\n    return this._store;\n  },\n  key: function () {\n    var _this$_store;\n\n    return null === (_this$_store = this._store) || void 0 === _this$_store ? void 0 : _this$_store.key();\n  },\n  totalCount: function () {\n    return this._totalCount;\n  },\n  isLoaded: function () {\n    return this._isLoaded;\n  },\n  isLoading: function () {\n    return this._loadingCount > 0;\n  },\n  beginLoading: function () {\n    this._changeLoadingCount(1);\n  },\n  endLoading: function () {\n    this._changeLoadingCount(-1);\n  },\n  _createLoadQueue: function () {\n    return (0, _queue.create)();\n  },\n  _changeLoadingCount: function (increment) {\n    var oldLoading = this.isLoading();\n    this._loadingCount += increment;\n    var newLoading = this.isLoading();\n\n    if (oldLoading ^ newLoading) {\n      this._eventsStrategy.fireEvent(\"loadingChanged\", [newLoading]);\n    }\n  },\n  _scheduleLoadCallbacks: function (deferred) {\n    var _this3 = this;\n\n    this.beginLoading();\n    deferred.always(function () {\n      _this3.endLoading();\n    });\n  },\n  _scheduleFailCallbacks: function (deferred) {\n    var _this4 = this;\n\n    deferred.fail(function () {\n      for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        args[_key4] = arguments[_key4];\n      }\n\n      if (args[0] === _utils2.CANCELED_TOKEN) {\n        return;\n      }\n\n      _this4._eventsStrategy.fireEvent(\"loadError\", args);\n    });\n  },\n  _fireChanged: function (args) {\n    var date = new Date();\n\n    this._eventsStrategy.fireEvent(\"changed\", args);\n\n    this._changedTime = new Date() - date;\n  },\n  _scheduleChangedCallbacks: function (deferred) {\n    var _this5 = this;\n\n    deferred.done(function () {\n      return _this5._fireChanged();\n    });\n  },\n  loadSingle: function (propName, propValue) {\n    var _this6 = this;\n\n    var d = new _deferred.Deferred();\n    var key = this.key();\n    var store = this._store;\n\n    var options = this._createStoreLoadOptions();\n\n    var handleDone = function (data) {\n      if (!(0, _type.isDefined)(data) || (0, _array.isEmpty)(data)) {\n        d.reject(new _errors.default.errors.Error(\"E4009\"));\n      } else {\n        if (!Array.isArray(data)) {\n          data = [data];\n        }\n\n        d.resolve(_this6._applyMapFunction(data)[0]);\n      }\n    };\n\n    this._scheduleFailCallbacks(d);\n\n    if (arguments.length < 2) {\n      propValue = propName;\n      propName = key;\n    }\n\n    delete options.skip;\n    delete options.group;\n    delete options.refresh;\n    delete options.pageIndex;\n    delete options.searchString;\n\n    var shouldForceByKey = function () {\n      return store instanceof _custom_store.default && !store._byKeyViaLoad();\n    };\n\n    (function () {\n      if (propName === key || shouldForceByKey()) {\n        return store.byKey(propValue, options);\n      }\n\n      options.take = 1;\n      options.filter = options.filter ? [options.filter, [propName, propValue]] : [propName, propValue];\n      return store.load(options);\n    })().fail(d.reject).done(handleDone);\n    return d.promise();\n  },\n  load: function () {\n    var _this7 = this;\n\n    var d = new _deferred.Deferred();\n\n    var loadTask = function () {\n      if (_this7._disposed) {\n        return;\n      }\n\n      if (!(0, _utils2.isPending)(d)) {\n        return;\n      }\n\n      return _this7._loadFromStore(loadOperation, d);\n    };\n\n    this._scheduleLoadCallbacks(d);\n\n    this._scheduleFailCallbacks(d);\n\n    this._scheduleChangedCallbacks(d);\n\n    var loadOperation = this._createLoadOperation(d);\n\n    this._eventsStrategy.fireEvent(\"customizeStoreLoadOptions\", [loadOperation]);\n\n    this._loadQueue.add(function () {\n      if (\"number\" === typeof loadOperation.delay) {\n        _this7._delayedLoadTask = (0, _common.executeAsync)(loadTask, loadOperation.delay);\n      } else {\n        loadTask();\n      }\n\n      return d.promise();\n    });\n\n    return d.promise({\n      operationId: loadOperation.operationId\n    });\n  },\n  _onPush: function (changes) {\n    var _this8 = this;\n\n    if (this._reshapeOnPush) {\n      this.load();\n    } else {\n      this._eventsStrategy.fireEvent(\"changing\", [{\n        changes: changes\n      }]);\n\n      var group = this.group();\n      var items = this.items();\n      var groupLevel = 0;\n      var dataSourceChanges = this.paginate() || group ? changes.filter(function (item) {\n        return \"update\" === item.type;\n      }) : changes;\n\n      if (group) {\n        groupLevel = Array.isArray(group) ? group.length : 1;\n      }\n\n      if (this._mapFunc) {\n        dataSourceChanges.forEach(function (item) {\n          if (\"insert\" === item.type) {\n            item.data = _this8._mapFunc(item.data);\n          }\n        });\n      }\n\n      (0, _array_utils.applyBatch)({\n        keyInfo: this.store(),\n        data: items,\n        changes: dataSourceChanges,\n        groupCount: groupLevel,\n        useInsertIndex: true\n      });\n\n      this._fireChanged([{\n        changes: changes\n      }]);\n    }\n  },\n  _createLoadOperation: function (deferred) {\n    var _this9 = this;\n\n    var operationId = this._operationManager.add(deferred);\n\n    var storeLoadOptions = this._createStoreLoadOptions();\n\n    deferred.always(function () {\n      return _this9._operationManager.remove(operationId);\n    });\n    return {\n      operationId: operationId,\n      storeLoadOptions: storeLoadOptions\n    };\n  },\n  reload: function () {\n    var store = this.store();\n\n    if (store instanceof _custom_store.default) {\n      store.clearRawDataCache();\n    }\n\n    this._init();\n\n    return this.load();\n  },\n  cancel: function (operationId) {\n    return this._operationManager.cancel(operationId);\n  },\n  cancelAll: function () {\n    return this._operationManager.cancelAll();\n  },\n  _addSearchOptions: function (storeLoadOptions) {\n    if (this._disposed) {\n      return;\n    }\n\n    if (this.store()._useDefaultSearch) {\n      this._addSearchFilter(storeLoadOptions);\n    } else {\n      storeLoadOptions.searchOperation = this._searchOperation;\n      storeLoadOptions.searchValue = this._searchValue;\n      storeLoadOptions.searchExpr = this._searchExpr;\n    }\n  },\n  _createStoreLoadOptions: function () {\n    var result = (0, _extend.extend)({}, this._storeLoadOptions);\n\n    this._addSearchOptions(result);\n\n    if (this._paginate) {\n      if (this._pageSize) {\n        result.skip = this._pageIndex * this._pageSize;\n        result.take = this._pageSize;\n      }\n    }\n\n    result.userData = this._userData;\n    return result;\n  },\n  _addSearchFilter: function (storeLoadOptions) {\n    var value = this._searchValue;\n    var op = this._searchOperation;\n    var selector = this._searchExpr;\n    var searchFilter = [];\n\n    if (!value) {\n      return;\n    }\n\n    if (!selector) {\n      selector = \"this\";\n    }\n\n    if (!Array.isArray(selector)) {\n      selector = [selector];\n    }\n\n    (0, _iterator.each)(selector, function (i, item) {\n      if (searchFilter.length) {\n        searchFilter.push(\"or\");\n      }\n\n      searchFilter.push([item, op, value]);\n    });\n\n    if (storeLoadOptions.filter) {\n      storeLoadOptions.filter = [searchFilter, storeLoadOptions.filter];\n    } else {\n      storeLoadOptions.filter = searchFilter;\n    }\n  },\n  _loadFromStore: function (loadOptions, pendingDeferred) {\n    var _this10 = this;\n\n    var handleSuccess = function (data, extra) {\n      if (_this10._disposed) {\n        return;\n      }\n\n      if (!(0, _utils2.isPending)(pendingDeferred)) {\n        return;\n      }\n\n      var loadResult = (0, _extend.extend)((0, _utils2.normalizeLoadResult)(data, extra), loadOptions);\n\n      _this10._eventsStrategy.fireEvent(\"customizeLoadResult\", [loadResult]);\n\n      (0, _deferred.when)(loadResult.data).done(function (data) {\n        loadResult.data = data;\n\n        _this10._processStoreLoadResult(loadResult, pendingDeferred);\n      }).fail(pendingDeferred.reject);\n    };\n\n    if (loadOptions.data) {\n      return new _deferred.Deferred().resolve(loadOptions.data).done(handleSuccess);\n    }\n\n    return this.store().load(loadOptions.storeLoadOptions).done(handleSuccess).fail(pendingDeferred.reject);\n  },\n  _processStoreLoadResult: function (loadResult, pendingDeferred) {\n    var _this11 = this;\n\n    var data = loadResult.data;\n    var extra = loadResult.extra;\n    var storeLoadOptions = loadResult.storeLoadOptions;\n\n    var resolvePendingDeferred = function () {\n      _this11._isLoaded = true;\n      _this11._totalCount = isFinite(extra.totalCount) ? extra.totalCount : -1;\n      return pendingDeferred.resolve(data, extra);\n    };\n\n    var proceedLoadingTotalCount = function () {\n      _this11.store().totalCount(storeLoadOptions).done(function (count) {\n        extra.totalCount = count;\n        resolvePendingDeferred();\n      }).fail(pendingDeferred.reject);\n    };\n\n    if (this._disposed) {\n      return;\n    }\n\n    data = this._applyPostProcessFunction(this._applyMapFunction(data));\n\n    if (!(0, _type.isPlainObject)(extra)) {\n      extra = {};\n    }\n\n    this._items = data;\n\n    if (!data.length || !this._paginate || this._pageSize && data.length < this._pageSize) {\n      this._isLastPage = true;\n    }\n\n    if (storeLoadOptions.requireTotalCount && !isFinite(extra.totalCount)) {\n      proceedLoadingTotalCount();\n    } else {\n      resolvePendingDeferred();\n    }\n  },\n  _applyMapFunction: function (data) {\n    if (this._mapFunc) {\n      return (0, _utils2.mapDataRespectingGrouping)(data, this._mapFunc, this.group());\n    }\n\n    return data;\n  },\n  _applyPostProcessFunction: function (data) {\n    if (this._postProcessFunc) {\n      return this._postProcessFunc(data);\n    }\n\n    return data;\n  },\n  on: function (eventName, eventHandler) {\n    this._eventsStrategy.on(eventName, eventHandler);\n\n    return this;\n  },\n  off: function (eventName, eventHandler) {\n    this._eventsStrategy.off(eventName, eventHandler);\n\n    return this;\n  }\n});\n\nexports.DataSource = DataSource;","map":{"version":3,"sources":["C:/Smart-Virtual-Classroom/client/node_modules/devextreme/data/data_source/data_source.js"],"names":["exports","DataSource","_class","_interopRequireDefault","require","_extend","_common","_iterator","_type","_utils","_array_utils","_custom_store","_events_strategy","_errors","_array","_queue","_deferred","_operation_manager","_utils2","obj","__esModule","default","inherit","ctor","options","_options$reshapeOnPus","_this","normalizeDataSourceOptions","_eventsStrategy","EventsStrategy","syncStrategy","_store","store","_changedTime","needThrottling","pushAggregationTimeout","throttlingTimeout","pushDeferred","throttlingPushHandler","throttleChanges","changes","resolve","done","_onPush","_onPushHandler","args","_aggregationTimeoutId","Deferred","waitFor","push","promise","on","_storeLoadOptions","_extractLoadOptions","_mapFunc","map","_postProcessFunc","postProcess","_pageIndex","pageIndex","_pageSize","pageSize","_loadingCount","_loadQueue","_createLoadQueue","_searchValue","searchValue","_searchOperation","searchOperation","_searchExpr","searchExpr","_paginate","paginate","_reshapeOnPush","reshapeOnPush","each","_","optionName","substr","toLowerCase","_operationManager","_init","_items","_userData","_totalCount","_isLoaded","isDefined","group","_isLastPage","dispose","_this$_delayedLoadTas","off","clearTimeout","_delayedLoadTask","abort","cancelAll","_disposed","result","names","customNames","_customLoadOptions","concat","loadOptions","items","newIndex","isNumeric","value","isBoolean","isLastPage","generateStoreLoadOptionAccessor","_this2","normalizedArgs","normalizeStoreLoadOptionAccessorArguments","sort","_len","arguments","length","Array","_key","filter","newFilter","_len2","_key2","select","_len3","_key3","requireTotalCount","op","isString","expr","argc","slice","call","key","_this$_store","totalCount","isLoaded","isLoading","beginLoading","_changeLoadingCount","endLoading","create","increment","oldLoading","newLoading","fireEvent","_scheduleLoadCallbacks","deferred","_this3","always","_scheduleFailCallbacks","_this4","fail","_len4","_key4","CANCELED_TOKEN","_fireChanged","date","Date","_scheduleChangedCallbacks","_this5","loadSingle","propName","propValue","_this6","d","_createStoreLoadOptions","handleDone","data","isEmpty","reject","errors","Error","isArray","_applyMapFunction","skip","refresh","searchString","shouldForceByKey","_byKeyViaLoad","byKey","take","load","_this7","loadTask","isPending","_loadFromStore","loadOperation","_createLoadOperation","add","delay","executeAsync","operationId","_this8","groupLevel","dataSourceChanges","item","type","forEach","applyBatch","keyInfo","groupCount","useInsertIndex","_this9","storeLoadOptions","remove","reload","clearRawDataCache","cancel","_addSearchOptions","_useDefaultSearch","_addSearchFilter","extend","userData","selector","searchFilter","i","pendingDeferred","_this10","handleSuccess","extra","loadResult","normalizeLoadResult","when","_processStoreLoadResult","_this11","resolvePendingDeferred","isFinite","proceedLoadingTotalCount","count","_applyPostProcessFunction","isPlainObject","mapDataRespectingGrouping","eventName","eventHandler"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACAA,OAAO,CAACC,UAAR,GAAqB,KAAK,CAA1B;;AACA,IAAIC,MAAM,GAAGC,sBAAsB,CAACC,OAAO,CAAC,kBAAD,CAAR,CAAnC;;AACA,IAAIC,OAAO,GAAGD,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAIE,OAAO,GAAGF,OAAO,CAAC,yBAAD,CAArB;;AACA,IAAIG,SAAS,GAAGH,OAAO,CAAC,2BAAD,CAAvB;;AACA,IAAII,KAAK,GAAGJ,OAAO,CAAC,uBAAD,CAAnB;;AACA,IAAIK,MAAM,GAAGN,sBAAsB,CAACC,OAAO,CAAC,UAAD,CAAR,CAAnC;;AACA,IAAIM,YAAY,GAAGN,OAAO,CAAC,gBAAD,CAA1B;;AACA,IAAIO,aAAa,GAAGR,sBAAsB,CAACC,OAAO,CAAC,iBAAD,CAAR,CAA1C;;AACA,IAAIQ,gBAAgB,GAAGR,OAAO,CAAC,4BAAD,CAA9B;;AACA,IAAIS,OAAO,GAAGV,sBAAsB,CAACC,OAAO,CAAC,WAAD,CAAR,CAApC;;AACA,IAAIU,MAAM,GAAGV,OAAO,CAAC,wBAAD,CAApB;;AACA,IAAIW,MAAM,GAAGX,OAAO,CAAC,wBAAD,CAApB;;AACA,IAAIY,SAAS,GAAGZ,OAAO,CAAC,2BAAD,CAAvB;;AACA,IAAIa,kBAAkB,GAAGd,sBAAsB,CAACC,OAAO,CAAC,qBAAD,CAAR,CAA/C;;AACA,IAAIc,OAAO,GAAGd,OAAO,CAAC,SAAD,CAArB;;AAEA,SAASD,sBAAT,CAAgCgB,GAAhC,EAAqC;AACjC,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AACjC,eAAWA;AADsB,GAArC;AAGH;;AACD,IAAIlB,UAAU,GAAGC,MAAM,CAACmB,OAAP,CAAeC,OAAf,CAAuB;AACpCC,EAAAA,IAAI,EAAE,UAASC,OAAT,EAAkB;AACpB,QAAIC,qBAAJ;AAAA,QAA2BC,KAAK,GAAG,IAAnC;;AACAF,IAAAA,OAAO,GAAG,CAAC,GAAGN,OAAO,CAACS,0BAAZ,EAAwCH,OAAxC,CAAV;AACA,SAAKI,eAAL,GAAuB,IAAIhB,gBAAgB,CAACiB,cAArB,CAAoC,IAApC,EAA0C;AAC7DC,MAAAA,YAAY,EAAE;AAD+C,KAA1C,CAAvB;AAGA,SAAKC,MAAL,GAAcP,OAAO,CAACQ,KAAtB;AACA,SAAKC,YAAL,GAAoB,CAApB;AACA,QAAIC,cAAc,GAAG,MAAMV,OAAO,CAACW,sBAAnC;;AACA,QAAID,cAAJ,EAAoB;AAChB,UAAIE,iBAAiB,GAAG,KAAK,CAAL,KAAWZ,OAAO,CAACW,sBAAnB,GAA4C,YAAW;AAC3E,eAAO,IAAIT,KAAK,CAACO,YAAjB;AACH,OAFuB,GAEpBT,OAAO,CAACW,sBAFZ;AAGA,UAAIE,YAAJ;;AACA,UAAIC,qBAAqB,GAAG7B,MAAM,CAACY,OAAP,CAAekB,eAAf,CAA+B,UAASC,OAAT,EAAkB;AACzEH,QAAAA,YAAY,CAACI,OAAb;AACAJ,QAAAA,YAAY,CAACK,IAAb,CAAkB,YAAW;AACzB,iBAAOhB,KAAK,CAACiB,OAAN,CAAcH,OAAd,CAAP;AACH,SAFD;AAGAH,QAAAA,YAAY,GAAG,KAAK,CAApB;AACH,OAN2B,EAMzBD,iBANyB,CAA5B;;AAOA,WAAKQ,cAAL,GAAsB,UAASC,IAAT,EAAe;AACjCnB,QAAAA,KAAK,CAACoB,qBAAN,GAA8BR,qBAAqB,CAACO,IAAI,CAACL,OAAN,CAAnD;;AACA,YAAI,CAACH,YAAL,EAAmB;AACfA,UAAAA,YAAY,GAAG,IAAIrB,SAAS,CAAC+B,QAAd,EAAf;AACH;;AACDF,QAAAA,IAAI,CAACG,OAAL,CAAaC,IAAb,CAAkBZ,YAAY,CAACa,OAAb,EAAlB;AACH,OAND;;AAOA,WAAKnB,MAAL,CAAYoB,EAAZ,CAAe,YAAf,EAA6B,KAAKP,cAAlC;AACH,KApBD,MAoBO;AACH,WAAKA,cAAL,GAAsB,UAASJ,OAAT,EAAkB;AACpC,eAAOd,KAAK,CAACiB,OAAN,CAAcH,OAAd,CAAP;AACH,OAFD;;AAGA,WAAKT,MAAL,CAAYoB,EAAZ,CAAe,MAAf,EAAuB,KAAKP,cAA5B;AACH;;AACD,SAAKQ,iBAAL,GAAyB,KAAKC,mBAAL,CAAyB7B,OAAzB,CAAzB;AACA,SAAK8B,QAAL,GAAgB9B,OAAO,CAAC+B,GAAxB;AACA,SAAKC,gBAAL,GAAwBhC,OAAO,CAACiC,WAAhC;AACA,SAAKC,UAAL,GAAkB,KAAK,CAAL,KAAWlC,OAAO,CAACmC,SAAnB,GAA+BnC,OAAO,CAACmC,SAAvC,GAAmD,CAArE;AACA,SAAKC,SAAL,GAAiB,KAAK,CAAL,KAAWpC,OAAO,CAACqC,QAAnB,GAA8BrC,OAAO,CAACqC,QAAtC,GAAiD,EAAlE;AACA,SAAKC,aAAL,GAAqB,CAArB;AACA,SAAKC,UAAL,GAAkB,KAAKC,gBAAL,EAAlB;AACA,SAAKC,YAAL,GAAoB,iBAAiBzC,OAAjB,GAA2BA,OAAO,CAAC0C,WAAnC,GAAiD,IAArE;AACA,SAAKC,gBAAL,GAAwB3C,OAAO,CAAC4C,eAAR,IAA2B,UAAnD;AACA,SAAKC,WAAL,GAAmB7C,OAAO,CAAC8C,UAA3B;AACA,SAAKC,SAAL,GAAiB/C,OAAO,CAACgD,QAAzB;AACA,SAAKC,cAAL,GAAsB,UAAUhD,qBAAqB,GAAGD,OAAO,CAACkD,aAA1C,KAA4D,KAAK,CAAL,KAAWjD,qBAAvE,GAA+FA,qBAA/F,GAAuH,KAA7I;AACA,KAAC,GAAGlB,SAAS,CAACoE,IAAd,EAAoB,CAAC,WAAD,EAAc,aAAd,EAA6B,kBAA7B,EAAiD,uBAAjD,EAA0E,6BAA1E,CAApB,EAA8H,UAASC,CAAT,EAAYC,UAAZ,EAAwB;AAClJ,UAAIA,UAAU,IAAIrD,OAAlB,EAA2B;AACvBE,QAAAA,KAAK,CAACyB,EAAN,CAAS0B,UAAU,CAACC,MAAX,CAAkB,CAAlB,EAAqB,CAArB,EAAwBC,WAAxB,KAAwCF,UAAU,CAACC,MAAX,CAAkB,CAAlB,CAAjD,EAAuEtD,OAAO,CAACqD,UAAD,CAA9E;AACH;AACJ,KAJD;AAKA,SAAKG,iBAAL,GAAyB,IAAI/D,kBAAkB,CAACI,OAAvB,EAAzB;;AACA,SAAK4D,KAAL;AACH,GAvDmC;AAwDpCA,EAAAA,KAAK,EAAE,YAAW;AACd,SAAKC,MAAL,GAAc,EAAd;AACA,SAAKC,SAAL,GAAiB,EAAjB;AACA,SAAKC,WAAL,GAAmB,CAAC,CAApB;AACA,SAAKC,SAAL,GAAiB,KAAjB;;AACA,QAAI,CAAC,CAAC,GAAG7E,KAAK,CAAC8E,SAAV,EAAqB,KAAKf,SAA1B,CAAL,EAA2C;AACvC,WAAKA,SAAL,GAAiB,CAAC,KAAKgB,KAAL,EAAlB;AACH;;AACD,SAAKC,WAAL,GAAmB,CAAC,KAAKjB,SAAzB;AACH,GAjEmC;AAkEpCkB,EAAAA,OAAO,EAAE,YAAW;AAChB,QAAIC,qBAAJ;;AACA,SAAK3D,MAAL,CAAY4D,GAAZ,CAAgB,YAAhB,EAA8B,KAAK/C,cAAnC;;AACA,SAAKb,MAAL,CAAY4D,GAAZ,CAAgB,MAAhB,EAAwB,KAAK/C,cAA7B;;AACA,SAAKhB,eAAL,CAAqB6D,OAArB;;AACAG,IAAAA,YAAY,CAAC,KAAK9C,qBAAN,CAAZ;AACA,WAAO,KAAKf,MAAZ;AACA,cAAU2D,qBAAqB,GAAG,KAAKG,gBAAvC,KAA4D,KAAK,CAAL,KAAWH,qBAAvE,GAA+F,KAAK,CAApG,GAAwGA,qBAAqB,CAACI,KAAtB,EAAxG;;AACA,SAAKd,iBAAL,CAAuBe,SAAvB;;AACA,SAAKC,SAAL,GAAiB,IAAjB;AACH,GA5EmC;AA6EpC3C,EAAAA,mBAAmB,EAAE,UAAS7B,OAAT,EAAkB;AACnC,QAAIyE,MAAM,GAAG,EAAb;AACA,QAAIC,KAAK,GAAG,CAAC,MAAD,EAAS,QAAT,EAAmB,QAAnB,EAA6B,OAA7B,EAAsC,mBAAtC,CAAZ;;AACA,QAAIC,WAAW,GAAG,KAAKpE,MAAL,CAAYqE,kBAAZ,EAAlB;;AACA,QAAID,WAAJ,EAAiB;AACbD,MAAAA,KAAK,GAAGA,KAAK,CAACG,MAAN,CAAaF,WAAb,CAAR;AACH;;AAAA,KAAC,GAAG5F,SAAS,CAACoE,IAAd,EAAoBuB,KAApB,EAA2B,YAAW;AACnCD,MAAAA,MAAM,CAAC,IAAD,CAAN,GAAezE,OAAO,CAAC,IAAD,CAAtB;AACH,KAFA;AAGD,WAAOyE,MAAP;AACH,GAvFmC;AAwFpCK,EAAAA,WAAW,EAAE,YAAW;AACpB,WAAO,KAAKlD,iBAAZ;AACH,GA1FmC;AA2FpCmD,EAAAA,KAAK,EAAE,YAAW;AACd,WAAO,KAAKrB,MAAZ;AACH,GA7FmC;AA8FpCvB,EAAAA,SAAS,EAAE,UAAS6C,QAAT,EAAmB;AAC1B,QAAI,CAAC,CAAC,GAAGhG,KAAK,CAACiG,SAAV,EAAqBD,QAArB,CAAL,EAAqC;AACjC,aAAO,KAAK9C,UAAZ;AACH;;AACD,SAAKA,UAAL,GAAkB8C,QAAlB;AACA,SAAKhB,WAAL,GAAmB,CAAC,KAAKjB,SAAzB;AACH,GApGmC;AAqGpCC,EAAAA,QAAQ,EAAE,UAASkC,KAAT,EAAgB;AACtB,QAAI,CAAC,CAAC,GAAGlG,KAAK,CAACmG,SAAV,EAAqBD,KAArB,CAAL,EAAkC;AAC9B,aAAO,KAAKnC,SAAZ;AACH;;AACD,QAAI,KAAKA,SAAL,KAAmBmC,KAAvB,EAA8B;AAC1B,WAAKnC,SAAL,GAAiBmC,KAAjB;AACA,WAAK/C,SAAL,CAAe,CAAf;AACH;AACJ,GA7GmC;AA8GpCE,EAAAA,QAAQ,EAAE,UAAS6C,KAAT,EAAgB;AACtB,QAAI,CAAC,CAAC,GAAGlG,KAAK,CAACiG,SAAV,EAAqBC,KAArB,CAAL,EAAkC;AAC9B,aAAO,KAAK9C,SAAZ;AACH;;AACD,SAAKA,SAAL,GAAiB8C,KAAjB;AACH,GAnHmC;AAoHpCE,EAAAA,UAAU,EAAE,YAAW;AACnB,WAAO,KAAKpB,WAAZ;AACH,GAtHmC;AAuHpCqB,EAAAA,+BAA+B,EAAE,UAAShC,UAAT,EAAqB;AAClD,QAAIiC,MAAM,GAAG,IAAb;;AACA,WAAO,UAASjE,IAAT,EAAe;AAClB,UAAIkE,cAAc,GAAG,CAAC,GAAG7F,OAAO,CAAC8F,yCAAZ,EAAuDnE,IAAvD,CAArB;;AACA,UAAI,KAAK,CAAL,KAAWkE,cAAf,EAA+B;AAC3B,eAAOD,MAAM,CAAC1D,iBAAP,CAAyByB,UAAzB,CAAP;AACH;;AACDiC,MAAAA,MAAM,CAAC1D,iBAAP,CAAyByB,UAAzB,IAAuCkC,cAAvC;AACH,KAND;AAOH,GAhImC;AAiIpCE,EAAAA,IAAI,EAAE,YAAW;AACb,SAAK,IAAIC,IAAI,GAAGC,SAAS,CAACC,MAArB,EAA6BvE,IAAI,GAAG,IAAIwE,KAAJ,CAAUH,IAAV,CAApC,EAAqDI,IAAI,GAAG,CAAjE,EAAoEA,IAAI,GAAGJ,IAA3E,EAAiFI,IAAI,EAArF,EAAyF;AACrFzE,MAAAA,IAAI,CAACyE,IAAD,CAAJ,GAAaH,SAAS,CAACG,IAAD,CAAtB;AACH;;AACD,WAAO,KAAKT,+BAAL,CAAqC,MAArC,EAA6ChE,IAA7C,CAAP;AACH,GAtImC;AAuIpC0E,EAAAA,MAAM,EAAE,YAAW;AACf,QAAIC,SAAS,GAAG,CAAC,GAAGtG,OAAO,CAAC8F,yCAAZ,EAAuDG,SAAvD,CAAhB;;AACA,QAAI,KAAK,CAAL,KAAWK,SAAf,EAA0B;AACtB,aAAO,KAAKpE,iBAAL,CAAuBmE,MAA9B;AACH;;AACD,SAAKnE,iBAAL,CAAuBmE,MAAvB,GAAgCC,SAAhC;AACA,SAAK7D,SAAL,CAAe,CAAf;AACH,GA9ImC;AA+IpC4B,EAAAA,KAAK,EAAE,YAAW;AACd,SAAK,IAAIkC,KAAK,GAAGN,SAAS,CAACC,MAAtB,EAA8BvE,IAAI,GAAG,IAAIwE,KAAJ,CAAUI,KAAV,CAArC,EAAuDC,KAAK,GAAG,CAApE,EAAuEA,KAAK,GAAGD,KAA/E,EAAsFC,KAAK,EAA3F,EAA+F;AAC3F7E,MAAAA,IAAI,CAAC6E,KAAD,CAAJ,GAAcP,SAAS,CAACO,KAAD,CAAvB;AACH;;AACD,WAAO,KAAKb,+BAAL,CAAqC,OAArC,EAA8ChE,IAA9C,CAAP;AACH,GApJmC;AAqJpC8E,EAAAA,MAAM,EAAE,YAAW;AACf,SAAK,IAAIC,KAAK,GAAGT,SAAS,CAACC,MAAtB,EAA8BvE,IAAI,GAAG,IAAIwE,KAAJ,CAAUO,KAAV,CAArC,EAAuDC,KAAK,GAAG,CAApE,EAAuEA,KAAK,GAAGD,KAA/E,EAAsFC,KAAK,EAA3F,EAA+F;AAC3FhF,MAAAA,IAAI,CAACgF,KAAD,CAAJ,GAAcV,SAAS,CAACU,KAAD,CAAvB;AACH;;AACD,WAAO,KAAKhB,+BAAL,CAAqC,QAArC,EAA+ChE,IAA/C,CAAP;AACH,GA1JmC;AA2JpCiF,EAAAA,iBAAiB,EAAE,UAASpB,KAAT,EAAgB;AAC/B,QAAI,CAAC,CAAC,GAAGlG,KAAK,CAACmG,SAAV,EAAqBD,KAArB,CAAL,EAAkC;AAC9B,aAAO,KAAKtD,iBAAL,CAAuB0E,iBAA9B;AACH;;AACD,SAAK1E,iBAAL,CAAuB0E,iBAAvB,GAA2CpB,KAA3C;AACH,GAhKmC;AAiKpCxC,EAAAA,WAAW,EAAE,UAASwC,KAAT,EAAgB;AACzB,QAAIS,SAAS,CAACC,MAAV,GAAmB,CAAvB,EAA0B;AACtB,aAAO,KAAKnD,YAAZ;AACH;;AACD,SAAKA,YAAL,GAAoByC,KAApB;AACA,SAAK/C,SAAL,CAAe,CAAf;AACH,GAvKmC;AAwKpCS,EAAAA,eAAe,EAAE,UAAS2D,EAAT,EAAa;AAC1B,QAAI,CAAC,CAAC,GAAGvH,KAAK,CAACwH,QAAV,EAAoBD,EAApB,CAAL,EAA8B;AAC1B,aAAO,KAAK5D,gBAAZ;AACH;;AACD,SAAKA,gBAAL,GAAwB4D,EAAxB;AACA,SAAKpE,SAAL,CAAe,CAAf;AACH,GA9KmC;AA+KpCW,EAAAA,UAAU,EAAE,UAAS2D,IAAT,EAAe;AACvB,QAAIC,IAAI,GAAGf,SAAS,CAACC,MAArB;;AACA,QAAI,MAAMc,IAAV,EAAgB;AACZ,aAAO,KAAK7D,WAAZ;AACH;;AACD,QAAI6D,IAAI,GAAG,CAAX,EAAc;AACVD,MAAAA,IAAI,GAAG,GAAGE,KAAH,CAASC,IAAT,CAAcjB,SAAd,CAAP;AACH;;AACD,SAAK9C,WAAL,GAAmB4D,IAAnB;AACA,SAAKtE,SAAL,CAAe,CAAf;AACH,GAzLmC;AA0LpC3B,EAAAA,KAAK,EAAE,YAAW;AACd,WAAO,KAAKD,MAAZ;AACH,GA5LmC;AA6LpCsG,EAAAA,GAAG,EAAE,YAAW;AACZ,QAAIC,YAAJ;;AACA,WAAO,UAAUA,YAAY,GAAG,KAAKvG,MAA9B,KAAyC,KAAK,CAAL,KAAWuG,YAApD,GAAmE,KAAK,CAAxE,GAA4EA,YAAY,CAACD,GAAb,EAAnF;AACH,GAhMmC;AAiMpCE,EAAAA,UAAU,EAAE,YAAW;AACnB,WAAO,KAAKnD,WAAZ;AACH,GAnMmC;AAoMpCoD,EAAAA,QAAQ,EAAE,YAAW;AACjB,WAAO,KAAKnD,SAAZ;AACH,GAtMmC;AAuMpCoD,EAAAA,SAAS,EAAE,YAAW;AAClB,WAAO,KAAK3E,aAAL,GAAqB,CAA5B;AACH,GAzMmC;AA0MpC4E,EAAAA,YAAY,EAAE,YAAW;AACrB,SAAKC,mBAAL,CAAyB,CAAzB;AACH,GA5MmC;AA6MpCC,EAAAA,UAAU,EAAE,YAAW;AACnB,SAAKD,mBAAL,CAAyB,CAAC,CAA1B;AACH,GA/MmC;AAgNpC3E,EAAAA,gBAAgB,EAAE,YAAW;AACzB,WAAO,CAAC,GAAGjD,MAAM,CAAC8H,MAAX,GAAP;AACH,GAlNmC;AAmNpCF,EAAAA,mBAAmB,EAAE,UAASG,SAAT,EAAoB;AACrC,QAAIC,UAAU,GAAG,KAAKN,SAAL,EAAjB;AACA,SAAK3E,aAAL,IAAsBgF,SAAtB;AACA,QAAIE,UAAU,GAAG,KAAKP,SAAL,EAAjB;;AACA,QAAIM,UAAU,GAAGC,UAAjB,EAA6B;AACzB,WAAKpH,eAAL,CAAqBqH,SAArB,CAA+B,gBAA/B,EAAiD,CAACD,UAAD,CAAjD;AACH;AACJ,GA1NmC;AA2NpCE,EAAAA,sBAAsB,EAAE,UAASC,QAAT,EAAmB;AACvC,QAAIC,MAAM,GAAG,IAAb;;AACA,SAAKV,YAAL;AACAS,IAAAA,QAAQ,CAACE,MAAT,CAAgB,YAAW;AACvBD,MAAAA,MAAM,CAACR,UAAP;AACH,KAFD;AAGH,GAjOmC;AAkOpCU,EAAAA,sBAAsB,EAAE,UAASH,QAAT,EAAmB;AACvC,QAAII,MAAM,GAAG,IAAb;;AACAJ,IAAAA,QAAQ,CAACK,IAAT,CAAc,YAAW;AACrB,WAAK,IAAIC,KAAK,GAAGtC,SAAS,CAACC,MAAtB,EAA8BvE,IAAI,GAAG,IAAIwE,KAAJ,CAAUoC,KAAV,CAArC,EAAuDC,KAAK,GAAG,CAApE,EAAuEA,KAAK,GAAGD,KAA/E,EAAsFC,KAAK,EAA3F,EAA+F;AAC3F7G,QAAAA,IAAI,CAAC6G,KAAD,CAAJ,GAAcvC,SAAS,CAACuC,KAAD,CAAvB;AACH;;AACD,UAAI7G,IAAI,CAAC,CAAD,CAAJ,KAAY3B,OAAO,CAACyI,cAAxB,EAAwC;AACpC;AACH;;AACDJ,MAAAA,MAAM,CAAC3H,eAAP,CAAuBqH,SAAvB,CAAiC,WAAjC,EAA8CpG,IAA9C;AACH,KARD;AASH,GA7OmC;AA8OpC+G,EAAAA,YAAY,EAAE,UAAS/G,IAAT,EAAe;AACzB,QAAIgH,IAAI,GAAG,IAAIC,IAAJ,EAAX;;AACA,SAAKlI,eAAL,CAAqBqH,SAArB,CAA+B,SAA/B,EAA0CpG,IAA1C;;AACA,SAAKZ,YAAL,GAAoB,IAAI6H,IAAJ,KAAWD,IAA/B;AACH,GAlPmC;AAmPpCE,EAAAA,yBAAyB,EAAE,UAASZ,QAAT,EAAmB;AAC1C,QAAIa,MAAM,GAAG,IAAb;;AACAb,IAAAA,QAAQ,CAACzG,IAAT,CAAc,YAAW;AACrB,aAAOsH,MAAM,CAACJ,YAAP,EAAP;AACH,KAFD;AAGH,GAxPmC;AAyPpCK,EAAAA,UAAU,EAAE,UAASC,QAAT,EAAmBC,SAAnB,EAA8B;AACtC,QAAIC,MAAM,GAAG,IAAb;;AACA,QAAIC,CAAC,GAAG,IAAIrJ,SAAS,CAAC+B,QAAd,EAAR;AACA,QAAIsF,GAAG,GAAG,KAAKA,GAAL,EAAV;AACA,QAAIrG,KAAK,GAAG,KAAKD,MAAjB;;AACA,QAAIP,OAAO,GAAG,KAAK8I,uBAAL,EAAd;;AACA,QAAIC,UAAU,GAAG,UAASC,IAAT,EAAe;AAC5B,UAAI,CAAC,CAAC,GAAGhK,KAAK,CAAC8E,SAAV,EAAqBkF,IAArB,CAAD,IAA+B,CAAC,GAAG1J,MAAM,CAAC2J,OAAX,EAAoBD,IAApB,CAAnC,EAA8D;AAC1DH,QAAAA,CAAC,CAACK,MAAF,CAAS,IAAI7J,OAAO,CAACQ,OAAR,CAAgBsJ,MAAhB,CAAuBC,KAA3B,CAAiC,OAAjC,CAAT;AACH,OAFD,MAEO;AACH,YAAI,CAACvD,KAAK,CAACwD,OAAN,CAAcL,IAAd,CAAL,EAA0B;AACtBA,UAAAA,IAAI,GAAG,CAACA,IAAD,CAAP;AACH;;AACDH,QAAAA,CAAC,CAAC5H,OAAF,CAAU2H,MAAM,CAACU,iBAAP,CAAyBN,IAAzB,EAA+B,CAA/B,CAAV;AACH;AACJ,KATD;;AAUA,SAAKlB,sBAAL,CAA4Be,CAA5B;;AACA,QAAIlD,SAAS,CAACC,MAAV,GAAmB,CAAvB,EAA0B;AACtB+C,MAAAA,SAAS,GAAGD,QAAZ;AACAA,MAAAA,QAAQ,GAAG7B,GAAX;AACH;;AACD,WAAO7G,OAAO,CAACuJ,IAAf;AACA,WAAOvJ,OAAO,CAAC+D,KAAf;AACA,WAAO/D,OAAO,CAACwJ,OAAf;AACA,WAAOxJ,OAAO,CAACmC,SAAf;AACA,WAAOnC,OAAO,CAACyJ,YAAf;;AACA,QAAIC,gBAAgB,GAAG,YAAW;AAC9B,aAAOlJ,KAAK,YAAYrB,aAAa,CAACU,OAA/B,IAA0C,CAACW,KAAK,CAACmJ,aAAN,EAAlD;AACH,KAFD;;AAGA,KAAC,YAAW;AACR,UAAIjB,QAAQ,KAAK7B,GAAb,IAAoB6C,gBAAgB,EAAxC,EAA4C;AACxC,eAAOlJ,KAAK,CAACoJ,KAAN,CAAYjB,SAAZ,EAAuB3I,OAAvB,CAAP;AACH;;AACDA,MAAAA,OAAO,CAAC6J,IAAR,GAAe,CAAf;AACA7J,MAAAA,OAAO,CAAC+F,MAAR,GAAiB/F,OAAO,CAAC+F,MAAR,GAAiB,CAAC/F,OAAO,CAAC+F,MAAT,EAAiB,CAAC2C,QAAD,EAAWC,SAAX,CAAjB,CAAjB,GAA2D,CAACD,QAAD,EAAWC,SAAX,CAA5E;AACA,aAAOnI,KAAK,CAACsJ,IAAN,CAAW9J,OAAX,CAAP;AACH,KAPD,IAOKgI,IAPL,CAOUa,CAAC,CAACK,MAPZ,EAOoBhI,IAPpB,CAOyB6H,UAPzB;AAQA,WAAOF,CAAC,CAACnH,OAAF,EAAP;AACH,GA/RmC;AAgSpCoI,EAAAA,IAAI,EAAE,YAAW;AACb,QAAIC,MAAM,GAAG,IAAb;;AACA,QAAIlB,CAAC,GAAG,IAAIrJ,SAAS,CAAC+B,QAAd,EAAR;;AACA,QAAIyI,QAAQ,GAAG,YAAW;AACtB,UAAID,MAAM,CAACvF,SAAX,EAAsB;AAClB;AACH;;AACD,UAAI,CAAC,CAAC,GAAG9E,OAAO,CAACuK,SAAZ,EAAuBpB,CAAvB,CAAL,EAAgC;AAC5B;AACH;;AACD,aAAOkB,MAAM,CAACG,cAAP,CAAsBC,aAAtB,EAAqCtB,CAArC,CAAP;AACH,KARD;;AASA,SAAKnB,sBAAL,CAA4BmB,CAA5B;;AACA,SAAKf,sBAAL,CAA4Be,CAA5B;;AACA,SAAKN,yBAAL,CAA+BM,CAA/B;;AACA,QAAIsB,aAAa,GAAG,KAAKC,oBAAL,CAA0BvB,CAA1B,CAApB;;AACA,SAAKzI,eAAL,CAAqBqH,SAArB,CAA+B,2BAA/B,EAA4D,CAAC0C,aAAD,CAA5D;;AACA,SAAK5H,UAAL,CAAgB8H,GAAhB,CAAoB,YAAW;AAC3B,UAAI,aAAa,OAAOF,aAAa,CAACG,KAAtC,EAA6C;AACzCP,QAAAA,MAAM,CAAC1F,gBAAP,GAA0B,CAAC,GAAGvF,OAAO,CAACyL,YAAZ,EAA0BP,QAA1B,EAAoCG,aAAa,CAACG,KAAlD,CAA1B;AACH,OAFD,MAEO;AACHN,QAAAA,QAAQ;AACX;;AACD,aAAOnB,CAAC,CAACnH,OAAF,EAAP;AACH,KAPD;;AAQA,WAAOmH,CAAC,CAACnH,OAAF,CAAU;AACb8I,MAAAA,WAAW,EAAEL,aAAa,CAACK;AADd,KAAV,CAAP;AAGH,GA5TmC;AA6TpCrJ,EAAAA,OAAO,EAAE,UAASH,OAAT,EAAkB;AACvB,QAAIyJ,MAAM,GAAG,IAAb;;AACA,QAAI,KAAKxH,cAAT,EAAyB;AACrB,WAAK6G,IAAL;AACH,KAFD,MAEO;AACH,WAAK1J,eAAL,CAAqBqH,SAArB,CAA+B,UAA/B,EAA2C,CAAC;AACxCzG,QAAAA,OAAO,EAAEA;AAD+B,OAAD,CAA3C;;AAGA,UAAI+C,KAAK,GAAG,KAAKA,KAAL,EAAZ;AACA,UAAIgB,KAAK,GAAG,KAAKA,KAAL,EAAZ;AACA,UAAI2F,UAAU,GAAG,CAAjB;AACA,UAAIC,iBAAiB,GAAG,KAAK3H,QAAL,MAAmBe,KAAnB,GAA2B/C,OAAO,CAAC+E,MAAR,CAAe,UAAS6E,IAAT,EAAe;AAC7E,eAAO,aAAaA,IAAI,CAACC,IAAzB;AACH,OAFkD,CAA3B,GAEnB7J,OAFL;;AAGA,UAAI+C,KAAJ,EAAW;AACP2G,QAAAA,UAAU,GAAG7E,KAAK,CAACwD,OAAN,CAActF,KAAd,IAAuBA,KAAK,CAAC6B,MAA7B,GAAsC,CAAnD;AACH;;AACD,UAAI,KAAK9D,QAAT,EAAmB;AACf6I,QAAAA,iBAAiB,CAACG,OAAlB,CAA0B,UAASF,IAAT,EAAe;AACrC,cAAI,aAAaA,IAAI,CAACC,IAAtB,EAA4B;AACxBD,YAAAA,IAAI,CAAC5B,IAAL,GAAYyB,MAAM,CAAC3I,QAAP,CAAgB8I,IAAI,CAAC5B,IAArB,CAAZ;AACH;AACJ,SAJD;AAKH;;AAAA,OAAC,GAAG9J,YAAY,CAAC6L,UAAjB,EAA6B;AAC1BC,QAAAA,OAAO,EAAE,KAAKxK,KAAL,EADiB;AAE1BwI,QAAAA,IAAI,EAAEjE,KAFoB;AAG1B/D,QAAAA,OAAO,EAAE2J,iBAHiB;AAI1BM,QAAAA,UAAU,EAAEP,UAJc;AAK1BQ,QAAAA,cAAc,EAAE;AALU,OAA7B;;AAOD,WAAK9C,YAAL,CAAkB,CAAC;AACfpH,QAAAA,OAAO,EAAEA;AADM,OAAD,CAAlB;AAGH;AACJ,GA/VmC;AAgWpCoJ,EAAAA,oBAAoB,EAAE,UAASzC,QAAT,EAAmB;AACrC,QAAIwD,MAAM,GAAG,IAAb;;AACA,QAAIX,WAAW,GAAG,KAAKhH,iBAAL,CAAuB6G,GAAvB,CAA2B1C,QAA3B,CAAlB;;AACA,QAAIyD,gBAAgB,GAAG,KAAKtC,uBAAL,EAAvB;;AACAnB,IAAAA,QAAQ,CAACE,MAAT,CAAgB,YAAW;AACvB,aAAOsD,MAAM,CAAC3H,iBAAP,CAAyB6H,MAAzB,CAAgCb,WAAhC,CAAP;AACH,KAFD;AAGA,WAAO;AACHA,MAAAA,WAAW,EAAEA,WADV;AAEHY,MAAAA,gBAAgB,EAAEA;AAFf,KAAP;AAIH,GA3WmC;AA4WpCE,EAAAA,MAAM,EAAE,YAAW;AACf,QAAI9K,KAAK,GAAG,KAAKA,KAAL,EAAZ;;AACA,QAAIA,KAAK,YAAYrB,aAAa,CAACU,OAAnC,EAA4C;AACxCW,MAAAA,KAAK,CAAC+K,iBAAN;AACH;;AACD,SAAK9H,KAAL;;AACA,WAAO,KAAKqG,IAAL,EAAP;AACH,GAnXmC;AAoXpC0B,EAAAA,MAAM,EAAE,UAAShB,WAAT,EAAsB;AAC1B,WAAO,KAAKhH,iBAAL,CAAuBgI,MAAvB,CAA8BhB,WAA9B,CAAP;AACH,GAtXmC;AAuXpCjG,EAAAA,SAAS,EAAE,YAAW;AAClB,WAAO,KAAKf,iBAAL,CAAuBe,SAAvB,EAAP;AACH,GAzXmC;AA0XpCkH,EAAAA,iBAAiB,EAAE,UAASL,gBAAT,EAA2B;AAC1C,QAAI,KAAK5G,SAAT,EAAoB;AAChB;AACH;;AACD,QAAI,KAAKhE,KAAL,GAAakL,iBAAjB,EAAoC;AAChC,WAAKC,gBAAL,CAAsBP,gBAAtB;AACH,KAFD,MAEO;AACHA,MAAAA,gBAAgB,CAACxI,eAAjB,GAAmC,KAAKD,gBAAxC;AACAyI,MAAAA,gBAAgB,CAAC1I,WAAjB,GAA+B,KAAKD,YAApC;AACA2I,MAAAA,gBAAgB,CAACtI,UAAjB,GAA8B,KAAKD,WAAnC;AACH;AACJ,GArYmC;AAsYpCiG,EAAAA,uBAAuB,EAAE,YAAW;AAChC,QAAIrE,MAAM,GAAG,CAAC,GAAG5F,OAAO,CAAC+M,MAAZ,EAAoB,EAApB,EAAwB,KAAKhK,iBAA7B,CAAb;;AACA,SAAK6J,iBAAL,CAAuBhH,MAAvB;;AACA,QAAI,KAAK1B,SAAT,EAAoB;AAChB,UAAI,KAAKX,SAAT,EAAoB;AAChBqC,QAAAA,MAAM,CAAC8E,IAAP,GAAc,KAAKrH,UAAL,GAAkB,KAAKE,SAArC;AACAqC,QAAAA,MAAM,CAACoF,IAAP,GAAc,KAAKzH,SAAnB;AACH;AACJ;;AACDqC,IAAAA,MAAM,CAACoH,QAAP,GAAkB,KAAKlI,SAAvB;AACA,WAAOc,MAAP;AACH,GAjZmC;AAkZpCkH,EAAAA,gBAAgB,EAAE,UAASP,gBAAT,EAA2B;AACzC,QAAIlG,KAAK,GAAG,KAAKzC,YAAjB;AACA,QAAI8D,EAAE,GAAG,KAAK5D,gBAAd;AACA,QAAImJ,QAAQ,GAAG,KAAKjJ,WAApB;AACA,QAAIkJ,YAAY,GAAG,EAAnB;;AACA,QAAI,CAAC7G,KAAL,EAAY;AACR;AACH;;AACD,QAAI,CAAC4G,QAAL,EAAe;AACXA,MAAAA,QAAQ,GAAG,MAAX;AACH;;AACD,QAAI,CAACjG,KAAK,CAACwD,OAAN,CAAcyC,QAAd,CAAL,EAA8B;AAC1BA,MAAAA,QAAQ,GAAG,CAACA,QAAD,CAAX;AACH;;AAAA,KAAC,GAAG/M,SAAS,CAACoE,IAAd,EAAoB2I,QAApB,EAA8B,UAASE,CAAT,EAAYpB,IAAZ,EAAkB;AAC7C,UAAImB,YAAY,CAACnG,MAAjB,EAAyB;AACrBmG,QAAAA,YAAY,CAACtK,IAAb,CAAkB,IAAlB;AACH;;AACDsK,MAAAA,YAAY,CAACtK,IAAb,CAAkB,CAACmJ,IAAD,EAAOrE,EAAP,EAAWrB,KAAX,CAAlB;AACH,KALA;;AAMD,QAAIkG,gBAAgB,CAACrF,MAArB,EAA6B;AACzBqF,MAAAA,gBAAgB,CAACrF,MAAjB,GAA0B,CAACgG,YAAD,EAAeX,gBAAgB,CAACrF,MAAhC,CAA1B;AACH,KAFD,MAEO;AACHqF,MAAAA,gBAAgB,CAACrF,MAAjB,GAA0BgG,YAA1B;AACH;AACJ,GA1amC;AA2apC7B,EAAAA,cAAc,EAAE,UAASpF,WAAT,EAAsBmH,eAAtB,EAAuC;AACnD,QAAIC,OAAO,GAAG,IAAd;;AACA,QAAIC,aAAa,GAAG,UAASnD,IAAT,EAAeoD,KAAf,EAAsB;AACtC,UAAIF,OAAO,CAAC1H,SAAZ,EAAuB;AACnB;AACH;;AACD,UAAI,CAAC,CAAC,GAAG9E,OAAO,CAACuK,SAAZ,EAAuBgC,eAAvB,CAAL,EAA8C;AAC1C;AACH;;AACD,UAAII,UAAU,GAAG,CAAC,GAAGxN,OAAO,CAAC+M,MAAZ,EAAoB,CAAC,GAAGlM,OAAO,CAAC4M,mBAAZ,EAAiCtD,IAAjC,EAAuCoD,KAAvC,CAApB,EAAmEtH,WAAnE,CAAjB;;AACAoH,MAAAA,OAAO,CAAC9L,eAAR,CAAwBqH,SAAxB,CAAkC,qBAAlC,EAAyD,CAAC4E,UAAD,CAAzD;;AACA,OAAC,GAAG7M,SAAS,CAAC+M,IAAd,EAAoBF,UAAU,CAACrD,IAA/B,EAAqC9H,IAArC,CAA0C,UAAS8H,IAAT,EAAe;AACrDqD,QAAAA,UAAU,CAACrD,IAAX,GAAkBA,IAAlB;;AACAkD,QAAAA,OAAO,CAACM,uBAAR,CAAgCH,UAAhC,EAA4CJ,eAA5C;AACH,OAHD,EAGGjE,IAHH,CAGQiE,eAAe,CAAC/C,MAHxB;AAIH,KAbD;;AAcA,QAAIpE,WAAW,CAACkE,IAAhB,EAAsB;AAClB,aAAQ,IAAIxJ,SAAS,CAAC+B,QAAd,EAAD,CAAyBN,OAAzB,CAAiC6D,WAAW,CAACkE,IAA7C,EAAmD9H,IAAnD,CAAwDiL,aAAxD,CAAP;AACH;;AACD,WAAO,KAAK3L,KAAL,GAAasJ,IAAb,CAAkBhF,WAAW,CAACsG,gBAA9B,EAAgDlK,IAAhD,CAAqDiL,aAArD,EAAoEnE,IAApE,CAAyEiE,eAAe,CAAC/C,MAAzF,CAAP;AACH,GA/bmC;AAgcpCsD,EAAAA,uBAAuB,EAAE,UAASH,UAAT,EAAqBJ,eAArB,EAAsC;AAC3D,QAAIQ,OAAO,GAAG,IAAd;;AACA,QAAIzD,IAAI,GAAGqD,UAAU,CAACrD,IAAtB;AACA,QAAIoD,KAAK,GAAGC,UAAU,CAACD,KAAvB;AACA,QAAIhB,gBAAgB,GAAGiB,UAAU,CAACjB,gBAAlC;;AACA,QAAIsB,sBAAsB,GAAG,YAAW;AACpCD,MAAAA,OAAO,CAAC5I,SAAR,GAAoB,IAApB;AACA4I,MAAAA,OAAO,CAAC7I,WAAR,GAAsB+I,QAAQ,CAACP,KAAK,CAACrF,UAAP,CAAR,GAA6BqF,KAAK,CAACrF,UAAnC,GAAgD,CAAC,CAAvE;AACA,aAAOkF,eAAe,CAAChL,OAAhB,CAAwB+H,IAAxB,EAA8BoD,KAA9B,CAAP;AACH,KAJD;;AAKA,QAAIQ,wBAAwB,GAAG,YAAW;AACtCH,MAAAA,OAAO,CAACjM,KAAR,GAAgBuG,UAAhB,CAA2BqE,gBAA3B,EAA6ClK,IAA7C,CAAkD,UAAS2L,KAAT,EAAgB;AAC9DT,QAAAA,KAAK,CAACrF,UAAN,GAAmB8F,KAAnB;AACAH,QAAAA,sBAAsB;AACzB,OAHD,EAGG1E,IAHH,CAGQiE,eAAe,CAAC/C,MAHxB;AAIH,KALD;;AAMA,QAAI,KAAK1E,SAAT,EAAoB;AAChB;AACH;;AACDwE,IAAAA,IAAI,GAAG,KAAK8D,yBAAL,CAA+B,KAAKxD,iBAAL,CAAuBN,IAAvB,CAA/B,CAAP;;AACA,QAAI,CAAC,CAAC,GAAGhK,KAAK,CAAC+N,aAAV,EAAyBX,KAAzB,CAAL,EAAsC;AAClCA,MAAAA,KAAK,GAAG,EAAR;AACH;;AACD,SAAK1I,MAAL,GAAcsF,IAAd;;AACA,QAAI,CAACA,IAAI,CAACpD,MAAN,IAAgB,CAAC,KAAK7C,SAAtB,IAAmC,KAAKX,SAAL,IAAkB4G,IAAI,CAACpD,MAAL,GAAc,KAAKxD,SAA5E,EAAuF;AACnF,WAAK4B,WAAL,GAAmB,IAAnB;AACH;;AACD,QAAIoH,gBAAgB,CAAC9E,iBAAjB,IAAsC,CAACqG,QAAQ,CAACP,KAAK,CAACrF,UAAP,CAAnD,EAAuE;AACnE6F,MAAAA,wBAAwB;AAC3B,KAFD,MAEO;AACHF,MAAAA,sBAAsB;AACzB;AACJ,GAhemC;AAiepCpD,EAAAA,iBAAiB,EAAE,UAASN,IAAT,EAAe;AAC9B,QAAI,KAAKlH,QAAT,EAAmB;AACf,aAAO,CAAC,GAAGpC,OAAO,CAACsN,yBAAZ,EAAuChE,IAAvC,EAA6C,KAAKlH,QAAlD,EAA4D,KAAKiC,KAAL,EAA5D,CAAP;AACH;;AACD,WAAOiF,IAAP;AACH,GAtemC;AAuepC8D,EAAAA,yBAAyB,EAAE,UAAS9D,IAAT,EAAe;AACtC,QAAI,KAAKhH,gBAAT,EAA2B;AACvB,aAAO,KAAKA,gBAAL,CAAsBgH,IAAtB,CAAP;AACH;;AACD,WAAOA,IAAP;AACH,GA5emC;AA6epCrH,EAAAA,EAAE,EAAE,UAASsL,SAAT,EAAoBC,YAApB,EAAkC;AAClC,SAAK9M,eAAL,CAAqBuB,EAArB,CAAwBsL,SAAxB,EAAmCC,YAAnC;;AACA,WAAO,IAAP;AACH,GAhfmC;AAifpC/I,EAAAA,GAAG,EAAE,UAAS8I,SAAT,EAAoBC,YAApB,EAAkC;AACnC,SAAK9M,eAAL,CAAqB+D,GAArB,CAAyB8I,SAAzB,EAAoCC,YAApC;;AACA,WAAO,IAAP;AACH;AApfmC,CAAvB,CAAjB;;AAsfA1O,OAAO,CAACC,UAAR,GAAqBA,UAArB","sourcesContent":["/**\r\n * DevExtreme (data/data_source/data_source.js)\r\n * Version: 20.2.6\r\n * Build date: Tue Mar 16 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.DataSource = void 0;\r\nvar _class = _interopRequireDefault(require(\"../../core/class\"));\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _common = require(\"../../core/utils/common\");\r\nvar _iterator = require(\"../../core/utils/iterator\");\r\nvar _type = require(\"../../core/utils/type\");\r\nvar _utils = _interopRequireDefault(require(\"../utils\"));\r\nvar _array_utils = require(\"../array_utils\");\r\nvar _custom_store = _interopRequireDefault(require(\"../custom_store\"));\r\nvar _events_strategy = require(\"../../core/events_strategy\");\r\nvar _errors = _interopRequireDefault(require(\"../errors\"));\r\nvar _array = require(\"../../core/utils/array\");\r\nvar _queue = require(\"../../core/utils/queue\");\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _operation_manager = _interopRequireDefault(require(\"./operation_manager\"));\r\nvar _utils2 = require(\"./utils\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\nvar DataSource = _class.default.inherit({\r\n    ctor: function(options) {\r\n        var _options$reshapeOnPus, _this = this;\r\n        options = (0, _utils2.normalizeDataSourceOptions)(options);\r\n        this._eventsStrategy = new _events_strategy.EventsStrategy(this, {\r\n            syncStrategy: true\r\n        });\r\n        this._store = options.store;\r\n        this._changedTime = 0;\r\n        var needThrottling = 0 !== options.pushAggregationTimeout;\r\n        if (needThrottling) {\r\n            var throttlingTimeout = void 0 === options.pushAggregationTimeout ? function() {\r\n                return 5 * _this._changedTime\r\n            } : options.pushAggregationTimeout;\r\n            var pushDeferred;\r\n            var throttlingPushHandler = _utils.default.throttleChanges(function(changes) {\r\n                pushDeferred.resolve();\r\n                pushDeferred.done(function() {\r\n                    return _this._onPush(changes)\r\n                });\r\n                pushDeferred = void 0\r\n            }, throttlingTimeout);\r\n            this._onPushHandler = function(args) {\r\n                _this._aggregationTimeoutId = throttlingPushHandler(args.changes);\r\n                if (!pushDeferred) {\r\n                    pushDeferred = new _deferred.Deferred\r\n                }\r\n                args.waitFor.push(pushDeferred.promise())\r\n            };\r\n            this._store.on(\"beforePush\", this._onPushHandler)\r\n        } else {\r\n            this._onPushHandler = function(changes) {\r\n                return _this._onPush(changes)\r\n            };\r\n            this._store.on(\"push\", this._onPushHandler)\r\n        }\r\n        this._storeLoadOptions = this._extractLoadOptions(options);\r\n        this._mapFunc = options.map;\r\n        this._postProcessFunc = options.postProcess;\r\n        this._pageIndex = void 0 !== options.pageIndex ? options.pageIndex : 0;\r\n        this._pageSize = void 0 !== options.pageSize ? options.pageSize : 20;\r\n        this._loadingCount = 0;\r\n        this._loadQueue = this._createLoadQueue();\r\n        this._searchValue = \"searchValue\" in options ? options.searchValue : null;\r\n        this._searchOperation = options.searchOperation || \"contains\";\r\n        this._searchExpr = options.searchExpr;\r\n        this._paginate = options.paginate;\r\n        this._reshapeOnPush = null !== (_options$reshapeOnPus = options.reshapeOnPush) && void 0 !== _options$reshapeOnPus ? _options$reshapeOnPus : false;\r\n        (0, _iterator.each)([\"onChanged\", \"onLoadError\", \"onLoadingChanged\", \"onCustomizeLoadResult\", \"onCustomizeStoreLoadOptions\"], function(_, optionName) {\r\n            if (optionName in options) {\r\n                _this.on(optionName.substr(2, 1).toLowerCase() + optionName.substr(3), options[optionName])\r\n            }\r\n        });\r\n        this._operationManager = new _operation_manager.default;\r\n        this._init()\r\n    },\r\n    _init: function() {\r\n        this._items = [];\r\n        this._userData = {};\r\n        this._totalCount = -1;\r\n        this._isLoaded = false;\r\n        if (!(0, _type.isDefined)(this._paginate)) {\r\n            this._paginate = !this.group()\r\n        }\r\n        this._isLastPage = !this._paginate\r\n    },\r\n    dispose: function() {\r\n        var _this$_delayedLoadTas;\r\n        this._store.off(\"beforePush\", this._onPushHandler);\r\n        this._store.off(\"push\", this._onPushHandler);\r\n        this._eventsStrategy.dispose();\r\n        clearTimeout(this._aggregationTimeoutId);\r\n        delete this._store;\r\n        null === (_this$_delayedLoadTas = this._delayedLoadTask) || void 0 === _this$_delayedLoadTas ? void 0 : _this$_delayedLoadTas.abort();\r\n        this._operationManager.cancelAll();\r\n        this._disposed = true\r\n    },\r\n    _extractLoadOptions: function(options) {\r\n        var result = {};\r\n        var names = [\"sort\", \"filter\", \"select\", \"group\", \"requireTotalCount\"];\r\n        var customNames = this._store._customLoadOptions();\r\n        if (customNames) {\r\n            names = names.concat(customNames)\r\n        }(0, _iterator.each)(names, function() {\r\n            result[this] = options[this]\r\n        });\r\n        return result\r\n    },\r\n    loadOptions: function() {\r\n        return this._storeLoadOptions\r\n    },\r\n    items: function() {\r\n        return this._items\r\n    },\r\n    pageIndex: function(newIndex) {\r\n        if (!(0, _type.isNumeric)(newIndex)) {\r\n            return this._pageIndex\r\n        }\r\n        this._pageIndex = newIndex;\r\n        this._isLastPage = !this._paginate\r\n    },\r\n    paginate: function(value) {\r\n        if (!(0, _type.isBoolean)(value)) {\r\n            return this._paginate\r\n        }\r\n        if (this._paginate !== value) {\r\n            this._paginate = value;\r\n            this.pageIndex(0)\r\n        }\r\n    },\r\n    pageSize: function(value) {\r\n        if (!(0, _type.isNumeric)(value)) {\r\n            return this._pageSize\r\n        }\r\n        this._pageSize = value\r\n    },\r\n    isLastPage: function() {\r\n        return this._isLastPage\r\n    },\r\n    generateStoreLoadOptionAccessor: function(optionName) {\r\n        var _this2 = this;\r\n        return function(args) {\r\n            var normalizedArgs = (0, _utils2.normalizeStoreLoadOptionAccessorArguments)(args);\r\n            if (void 0 === normalizedArgs) {\r\n                return _this2._storeLoadOptions[optionName]\r\n            }\r\n            _this2._storeLoadOptions[optionName] = normalizedArgs\r\n        }\r\n    },\r\n    sort: function() {\r\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\r\n            args[_key] = arguments[_key]\r\n        }\r\n        return this.generateStoreLoadOptionAccessor(\"sort\")(args)\r\n    },\r\n    filter: function() {\r\n        var newFilter = (0, _utils2.normalizeStoreLoadOptionAccessorArguments)(arguments);\r\n        if (void 0 === newFilter) {\r\n            return this._storeLoadOptions.filter\r\n        }\r\n        this._storeLoadOptions.filter = newFilter;\r\n        this.pageIndex(0)\r\n    },\r\n    group: function() {\r\n        for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\r\n            args[_key2] = arguments[_key2]\r\n        }\r\n        return this.generateStoreLoadOptionAccessor(\"group\")(args)\r\n    },\r\n    select: function() {\r\n        for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\r\n            args[_key3] = arguments[_key3]\r\n        }\r\n        return this.generateStoreLoadOptionAccessor(\"select\")(args)\r\n    },\r\n    requireTotalCount: function(value) {\r\n        if (!(0, _type.isBoolean)(value)) {\r\n            return this._storeLoadOptions.requireTotalCount\r\n        }\r\n        this._storeLoadOptions.requireTotalCount = value\r\n    },\r\n    searchValue: function(value) {\r\n        if (arguments.length < 1) {\r\n            return this._searchValue\r\n        }\r\n        this._searchValue = value;\r\n        this.pageIndex(0)\r\n    },\r\n    searchOperation: function(op) {\r\n        if (!(0, _type.isString)(op)) {\r\n            return this._searchOperation\r\n        }\r\n        this._searchOperation = op;\r\n        this.pageIndex(0)\r\n    },\r\n    searchExpr: function(expr) {\r\n        var argc = arguments.length;\r\n        if (0 === argc) {\r\n            return this._searchExpr\r\n        }\r\n        if (argc > 1) {\r\n            expr = [].slice.call(arguments)\r\n        }\r\n        this._searchExpr = expr;\r\n        this.pageIndex(0)\r\n    },\r\n    store: function() {\r\n        return this._store\r\n    },\r\n    key: function() {\r\n        var _this$_store;\r\n        return null === (_this$_store = this._store) || void 0 === _this$_store ? void 0 : _this$_store.key()\r\n    },\r\n    totalCount: function() {\r\n        return this._totalCount\r\n    },\r\n    isLoaded: function() {\r\n        return this._isLoaded\r\n    },\r\n    isLoading: function() {\r\n        return this._loadingCount > 0\r\n    },\r\n    beginLoading: function() {\r\n        this._changeLoadingCount(1)\r\n    },\r\n    endLoading: function() {\r\n        this._changeLoadingCount(-1)\r\n    },\r\n    _createLoadQueue: function() {\r\n        return (0, _queue.create)()\r\n    },\r\n    _changeLoadingCount: function(increment) {\r\n        var oldLoading = this.isLoading();\r\n        this._loadingCount += increment;\r\n        var newLoading = this.isLoading();\r\n        if (oldLoading ^ newLoading) {\r\n            this._eventsStrategy.fireEvent(\"loadingChanged\", [newLoading])\r\n        }\r\n    },\r\n    _scheduleLoadCallbacks: function(deferred) {\r\n        var _this3 = this;\r\n        this.beginLoading();\r\n        deferred.always(function() {\r\n            _this3.endLoading()\r\n        })\r\n    },\r\n    _scheduleFailCallbacks: function(deferred) {\r\n        var _this4 = this;\r\n        deferred.fail(function() {\r\n            for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\r\n                args[_key4] = arguments[_key4]\r\n            }\r\n            if (args[0] === _utils2.CANCELED_TOKEN) {\r\n                return\r\n            }\r\n            _this4._eventsStrategy.fireEvent(\"loadError\", args)\r\n        })\r\n    },\r\n    _fireChanged: function(args) {\r\n        var date = new Date;\r\n        this._eventsStrategy.fireEvent(\"changed\", args);\r\n        this._changedTime = new Date - date\r\n    },\r\n    _scheduleChangedCallbacks: function(deferred) {\r\n        var _this5 = this;\r\n        deferred.done(function() {\r\n            return _this5._fireChanged()\r\n        })\r\n    },\r\n    loadSingle: function(propName, propValue) {\r\n        var _this6 = this;\r\n        var d = new _deferred.Deferred;\r\n        var key = this.key();\r\n        var store = this._store;\r\n        var options = this._createStoreLoadOptions();\r\n        var handleDone = function(data) {\r\n            if (!(0, _type.isDefined)(data) || (0, _array.isEmpty)(data)) {\r\n                d.reject(new _errors.default.errors.Error(\"E4009\"))\r\n            } else {\r\n                if (!Array.isArray(data)) {\r\n                    data = [data]\r\n                }\r\n                d.resolve(_this6._applyMapFunction(data)[0])\r\n            }\r\n        };\r\n        this._scheduleFailCallbacks(d);\r\n        if (arguments.length < 2) {\r\n            propValue = propName;\r\n            propName = key\r\n        }\r\n        delete options.skip;\r\n        delete options.group;\r\n        delete options.refresh;\r\n        delete options.pageIndex;\r\n        delete options.searchString;\r\n        var shouldForceByKey = function() {\r\n            return store instanceof _custom_store.default && !store._byKeyViaLoad()\r\n        };\r\n        (function() {\r\n            if (propName === key || shouldForceByKey()) {\r\n                return store.byKey(propValue, options)\r\n            }\r\n            options.take = 1;\r\n            options.filter = options.filter ? [options.filter, [propName, propValue]] : [propName, propValue];\r\n            return store.load(options)\r\n        })().fail(d.reject).done(handleDone);\r\n        return d.promise()\r\n    },\r\n    load: function() {\r\n        var _this7 = this;\r\n        var d = new _deferred.Deferred;\r\n        var loadTask = function() {\r\n            if (_this7._disposed) {\r\n                return\r\n            }\r\n            if (!(0, _utils2.isPending)(d)) {\r\n                return\r\n            }\r\n            return _this7._loadFromStore(loadOperation, d)\r\n        };\r\n        this._scheduleLoadCallbacks(d);\r\n        this._scheduleFailCallbacks(d);\r\n        this._scheduleChangedCallbacks(d);\r\n        var loadOperation = this._createLoadOperation(d);\r\n        this._eventsStrategy.fireEvent(\"customizeStoreLoadOptions\", [loadOperation]);\r\n        this._loadQueue.add(function() {\r\n            if (\"number\" === typeof loadOperation.delay) {\r\n                _this7._delayedLoadTask = (0, _common.executeAsync)(loadTask, loadOperation.delay)\r\n            } else {\r\n                loadTask()\r\n            }\r\n            return d.promise()\r\n        });\r\n        return d.promise({\r\n            operationId: loadOperation.operationId\r\n        })\r\n    },\r\n    _onPush: function(changes) {\r\n        var _this8 = this;\r\n        if (this._reshapeOnPush) {\r\n            this.load()\r\n        } else {\r\n            this._eventsStrategy.fireEvent(\"changing\", [{\r\n                changes: changes\r\n            }]);\r\n            var group = this.group();\r\n            var items = this.items();\r\n            var groupLevel = 0;\r\n            var dataSourceChanges = this.paginate() || group ? changes.filter(function(item) {\r\n                return \"update\" === item.type\r\n            }) : changes;\r\n            if (group) {\r\n                groupLevel = Array.isArray(group) ? group.length : 1\r\n            }\r\n            if (this._mapFunc) {\r\n                dataSourceChanges.forEach(function(item) {\r\n                    if (\"insert\" === item.type) {\r\n                        item.data = _this8._mapFunc(item.data)\r\n                    }\r\n                })\r\n            }(0, _array_utils.applyBatch)({\r\n                keyInfo: this.store(),\r\n                data: items,\r\n                changes: dataSourceChanges,\r\n                groupCount: groupLevel,\r\n                useInsertIndex: true\r\n            });\r\n            this._fireChanged([{\r\n                changes: changes\r\n            }])\r\n        }\r\n    },\r\n    _createLoadOperation: function(deferred) {\r\n        var _this9 = this;\r\n        var operationId = this._operationManager.add(deferred);\r\n        var storeLoadOptions = this._createStoreLoadOptions();\r\n        deferred.always(function() {\r\n            return _this9._operationManager.remove(operationId)\r\n        });\r\n        return {\r\n            operationId: operationId,\r\n            storeLoadOptions: storeLoadOptions\r\n        }\r\n    },\r\n    reload: function() {\r\n        var store = this.store();\r\n        if (store instanceof _custom_store.default) {\r\n            store.clearRawDataCache()\r\n        }\r\n        this._init();\r\n        return this.load()\r\n    },\r\n    cancel: function(operationId) {\r\n        return this._operationManager.cancel(operationId)\r\n    },\r\n    cancelAll: function() {\r\n        return this._operationManager.cancelAll()\r\n    },\r\n    _addSearchOptions: function(storeLoadOptions) {\r\n        if (this._disposed) {\r\n            return\r\n        }\r\n        if (this.store()._useDefaultSearch) {\r\n            this._addSearchFilter(storeLoadOptions)\r\n        } else {\r\n            storeLoadOptions.searchOperation = this._searchOperation;\r\n            storeLoadOptions.searchValue = this._searchValue;\r\n            storeLoadOptions.searchExpr = this._searchExpr\r\n        }\r\n    },\r\n    _createStoreLoadOptions: function() {\r\n        var result = (0, _extend.extend)({}, this._storeLoadOptions);\r\n        this._addSearchOptions(result);\r\n        if (this._paginate) {\r\n            if (this._pageSize) {\r\n                result.skip = this._pageIndex * this._pageSize;\r\n                result.take = this._pageSize\r\n            }\r\n        }\r\n        result.userData = this._userData;\r\n        return result\r\n    },\r\n    _addSearchFilter: function(storeLoadOptions) {\r\n        var value = this._searchValue;\r\n        var op = this._searchOperation;\r\n        var selector = this._searchExpr;\r\n        var searchFilter = [];\r\n        if (!value) {\r\n            return\r\n        }\r\n        if (!selector) {\r\n            selector = \"this\"\r\n        }\r\n        if (!Array.isArray(selector)) {\r\n            selector = [selector]\r\n        }(0, _iterator.each)(selector, function(i, item) {\r\n            if (searchFilter.length) {\r\n                searchFilter.push(\"or\")\r\n            }\r\n            searchFilter.push([item, op, value])\r\n        });\r\n        if (storeLoadOptions.filter) {\r\n            storeLoadOptions.filter = [searchFilter, storeLoadOptions.filter]\r\n        } else {\r\n            storeLoadOptions.filter = searchFilter\r\n        }\r\n    },\r\n    _loadFromStore: function(loadOptions, pendingDeferred) {\r\n        var _this10 = this;\r\n        var handleSuccess = function(data, extra) {\r\n            if (_this10._disposed) {\r\n                return\r\n            }\r\n            if (!(0, _utils2.isPending)(pendingDeferred)) {\r\n                return\r\n            }\r\n            var loadResult = (0, _extend.extend)((0, _utils2.normalizeLoadResult)(data, extra), loadOptions);\r\n            _this10._eventsStrategy.fireEvent(\"customizeLoadResult\", [loadResult]);\r\n            (0, _deferred.when)(loadResult.data).done(function(data) {\r\n                loadResult.data = data;\r\n                _this10._processStoreLoadResult(loadResult, pendingDeferred)\r\n            }).fail(pendingDeferred.reject)\r\n        };\r\n        if (loadOptions.data) {\r\n            return (new _deferred.Deferred).resolve(loadOptions.data).done(handleSuccess)\r\n        }\r\n        return this.store().load(loadOptions.storeLoadOptions).done(handleSuccess).fail(pendingDeferred.reject)\r\n    },\r\n    _processStoreLoadResult: function(loadResult, pendingDeferred) {\r\n        var _this11 = this;\r\n        var data = loadResult.data;\r\n        var extra = loadResult.extra;\r\n        var storeLoadOptions = loadResult.storeLoadOptions;\r\n        var resolvePendingDeferred = function() {\r\n            _this11._isLoaded = true;\r\n            _this11._totalCount = isFinite(extra.totalCount) ? extra.totalCount : -1;\r\n            return pendingDeferred.resolve(data, extra)\r\n        };\r\n        var proceedLoadingTotalCount = function() {\r\n            _this11.store().totalCount(storeLoadOptions).done(function(count) {\r\n                extra.totalCount = count;\r\n                resolvePendingDeferred()\r\n            }).fail(pendingDeferred.reject)\r\n        };\r\n        if (this._disposed) {\r\n            return\r\n        }\r\n        data = this._applyPostProcessFunction(this._applyMapFunction(data));\r\n        if (!(0, _type.isPlainObject)(extra)) {\r\n            extra = {}\r\n        }\r\n        this._items = data;\r\n        if (!data.length || !this._paginate || this._pageSize && data.length < this._pageSize) {\r\n            this._isLastPage = true\r\n        }\r\n        if (storeLoadOptions.requireTotalCount && !isFinite(extra.totalCount)) {\r\n            proceedLoadingTotalCount()\r\n        } else {\r\n            resolvePendingDeferred()\r\n        }\r\n    },\r\n    _applyMapFunction: function(data) {\r\n        if (this._mapFunc) {\r\n            return (0, _utils2.mapDataRespectingGrouping)(data, this._mapFunc, this.group())\r\n        }\r\n        return data\r\n    },\r\n    _applyPostProcessFunction: function(data) {\r\n        if (this._postProcessFunc) {\r\n            return this._postProcessFunc(data)\r\n        }\r\n        return data\r\n    },\r\n    on: function(eventName, eventHandler) {\r\n        this._eventsStrategy.on(eventName, eventHandler);\r\n        return this\r\n    },\r\n    off: function(eventName, eventHandler) {\r\n        this._eventsStrategy.off(eventName, eventHandler);\r\n        return this\r\n    }\r\n});\r\nexports.DataSource = DataSource;\r\n"]},"metadata":{},"sourceType":"script"}