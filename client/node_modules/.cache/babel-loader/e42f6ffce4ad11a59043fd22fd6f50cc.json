{"ast":null,"code":"/**\r\n * DevExtreme (ui/collection/ui.collection_widget.live_update.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.default = void 0;\n\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\n\nvar _uiCollection_widget = _interopRequireDefault(require(\"./ui.collection_widget.edit\"));\n\nvar _extend = require(\"../../core/utils/extend\");\n\nvar _array_utils = require(\"../../data/array_utils\");\n\nvar _utils = _interopRequireDefault(require(\"../../data/utils\"));\n\nvar _deferred = require(\"../../core/utils/deferred\");\n\nvar _array_compare = require(\"../../core/utils/array_compare\");\n\nvar _dom_adapter = _interopRequireDefault(require(\"../../core/dom_adapter\"));\n\nvar _common = require(\"../../core/utils/common\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar PRIVATE_KEY_FIELD = \"__dx_key__\";\n\nvar _default = _uiCollection_widget.default.inherit({\n  _getDefaultOptions: function () {\n    return (0, _extend.extend)(this.callBase(), {\n      repaintChangesOnly: false\n    });\n  },\n  ctor: function () {\n    var _this = this;\n\n    this.callBase.apply(this, arguments);\n    this._customizeStoreLoadOptions = function (e) {\n      var dataSource = _this._dataSource;\n\n      if (dataSource && !dataSource.isLoaded()) {\n        _this._correctionIndex = 0;\n      }\n\n      if (_this._correctionIndex && e.storeLoadOptions) {\n        e.storeLoadOptions.skip += _this._correctionIndex;\n      }\n    }, this._dataSource && this._dataSource.on(\"customizeStoreLoadOptions\", this._customizeStoreLoadOptions);\n  },\n  reload: function () {\n    this._correctionIndex = 0;\n  },\n  _init: function () {\n    this.callBase();\n\n    this._refreshItemsCache();\n\n    this._correctionIndex = 0;\n  },\n  _findItemElementByKey: function (key) {\n    var _this2 = this;\n\n    var result = (0, _renderer.default)();\n    var keyExpr = this.key();\n    this.itemElements().each(function (_, item) {\n      var $item = (0, _renderer.default)(item);\n\n      var itemData = _this2._getItemData($item);\n\n      if (keyExpr ? _utils.default.keysEqual(keyExpr, _this2.keyOf(itemData), key) : _this2._isItemEquals(itemData, key)) {\n        result = $item;\n        return false;\n      }\n    });\n    return result;\n  },\n  _dataSourceChangedHandler: function (newItems, e) {\n    if (null !== e && void 0 !== e && e.changes) {\n      this._modifyByChanges(e.changes);\n    } else {\n      this.callBase(newItems, e);\n\n      this._refreshItemsCache();\n    }\n  },\n  _isItemEquals: function (item1, item2) {\n    if (item1 && item1[PRIVATE_KEY_FIELD]) {\n      item1 = item1.data;\n    }\n\n    try {\n      return JSON.stringify(item1) === JSON.stringify(item2);\n    } catch (e) {\n      return item1 === item2;\n    }\n  },\n  _isItemStrictEquals: function (item1, item2) {\n    return this._isItemEquals(item1, item2);\n  },\n  _partialRefresh: function () {\n    var _this3 = this;\n\n    if (this.option(\"repaintChangesOnly\")) {\n      var keyOf = function (data) {\n        if (data && void 0 !== data[PRIVATE_KEY_FIELD]) {\n          return data[PRIVATE_KEY_FIELD];\n        }\n\n        return _this3.keyOf(data);\n      };\n\n      var result = (0, _array_compare.findChanges)(this._itemsCache, this._editStrategy.itemsGetter(), keyOf, this._isItemStrictEquals.bind(this));\n\n      if (result && this._itemsCache.length) {\n        this._modifyByChanges(result, true);\n\n        this._renderEmptyMessage();\n\n        return true;\n      } else {\n        this._refreshItemsCache();\n      }\n    }\n\n    return false;\n  },\n  _refreshItemsCache: function () {\n    if (this.option(\"repaintChangesOnly\")) {\n      var items = this._editStrategy.itemsGetter();\n\n      try {\n        this._itemsCache = (0, _extend.extend)(true, [], items);\n\n        if (!this.key()) {\n          this._itemsCache = this._itemsCache.map(function (itemCache, index) {\n            var _ref;\n\n            return _ref = {}, _defineProperty(_ref, PRIVATE_KEY_FIELD, items[index]), _defineProperty(_ref, \"data\", itemCache), _ref;\n          });\n        }\n      } catch (e) {\n        this._itemsCache = (0, _extend.extend)([], items);\n      }\n    }\n  },\n  _dispose: function () {\n    this._dataSource && this._dataSource.off(\"customizeStoreLoadOptions\", this._customizeStoreLoadOptions);\n    this.callBase();\n  },\n  _updateByChange: function (keyInfo, items, change, isPartialRefresh) {\n    var _this4 = this;\n\n    if (isPartialRefresh) {\n      this._renderItem(change.index, change.data, null, this._findItemElementByKey(change.key));\n    } else {\n      var changedItem = items[(0, _array_utils.indexByKey)(keyInfo, items, change.key)];\n\n      if (changedItem) {\n        (0, _array_utils.update)(keyInfo, items, change.key, change.data).done(function () {\n          _this4._renderItem(items.indexOf(changedItem), changedItem, null, _this4._findItemElementByKey(change.key));\n        });\n      }\n    }\n  },\n  _insertByChange: function (keyInfo, items, change, isPartialRefresh) {\n    var _this5 = this;\n\n    (0, _deferred.when)(isPartialRefresh || (0, _array_utils.insert)(keyInfo, items, change.data, change.index)).done(function () {\n      var _change$index;\n\n      _this5._beforeItemElementInserted(change);\n\n      _this5._renderItem(null !== (_change$index = change.index) && void 0 !== _change$index ? _change$index : items.length, change.data);\n\n      _this5._afterItemElementInserted();\n\n      _this5._correctionIndex++;\n    });\n  },\n  _updateSelectionAfterRemoveByChange: function (removeIndex) {\n    var selectedIndex = this.option(\"selectedIndex\");\n\n    if (selectedIndex > removeIndex) {\n      this.option(\"selectedIndex\", selectedIndex - 1);\n    } else {\n      if (selectedIndex === removeIndex && 1 === this.option(\"selectedItems\").length) {\n        this.option(\"selectedItems\", []);\n      } else {\n        this._normalizeSelectedItems();\n      }\n    }\n  },\n  _beforeItemElementInserted: function (change) {\n    var selectedIndex = this.option(\"selectedIndex\");\n\n    if (change.index <= selectedIndex) {\n      this.option(\"selectedIndex\", selectedIndex + 1);\n    }\n  },\n  _afterItemElementInserted: _common.noop,\n  _removeByChange: function (keyInfo, items, change, isPartialRefresh) {\n    var _this6 = this;\n\n    var index = isPartialRefresh ? change.index : (0, _array_utils.indexByKey)(keyInfo, items, change.key);\n    var removedItem = isPartialRefresh ? change.oldItem : items[index];\n\n    if (removedItem) {\n      var $removedItemElement = this._findItemElementByKey(change.key);\n\n      var deletedActionArgs = this._extendActionArgs($removedItemElement);\n\n      this._waitDeletingPrepare($removedItemElement).done(function () {\n        if (isPartialRefresh) {\n          _this6._updateIndicesAfterIndex(index - 1);\n\n          _this6._afterItemElementDeleted($removedItemElement, deletedActionArgs);\n\n          _this6._updateSelectionAfterRemoveByChange(index);\n        } else {\n          _this6._deleteItemElementByIndex(index);\n\n          _this6._afterItemElementDeleted($removedItemElement, deletedActionArgs);\n        }\n      });\n\n      this._correctionIndex--;\n    }\n  },\n  _modifyByChanges: function (changes, isPartialRefresh) {\n    var _this7 = this;\n\n    var items = this._editStrategy.itemsGetter();\n\n    var keyInfo = {\n      key: this.key.bind(this),\n      keyOf: this.keyOf.bind(this)\n    };\n    var dataSource = this._dataSource;\n    var paginate = dataSource && dataSource.paginate();\n    var group = dataSource && dataSource.group();\n\n    if (paginate || group) {\n      changes = changes.filter(function (item) {\n        return \"insert\" !== item.type || void 0 !== item.index;\n      });\n    }\n\n    changes.forEach(function (change) {\n      return _this7[\"_\".concat(change.type, \"ByChange\")](keyInfo, items, change, isPartialRefresh);\n    });\n    this._renderedItemsCount = items.length;\n\n    this._refreshItemsCache();\n\n    this._fireContentReadyAction();\n  },\n  _appendItemToContainer: function ($container, $itemFrame, index) {\n    var nextSiblingElement = $container.children(this._itemSelector()).get(index);\n\n    _dom_adapter.default.insertElement($container.get(0), $itemFrame.get(0), nextSiblingElement);\n  },\n  _optionChanged: function (args) {\n    switch (args.name) {\n      case \"items\":\n        var isItemsUpdated = this._partialRefresh(args.value);\n\n        if (!isItemsUpdated) {\n          this.callBase(args);\n        }\n\n        break;\n\n      case \"dataSource\":\n        if (!this.option(\"repaintChangesOnly\") || !args.value) {\n          this.option(\"items\", []);\n        }\n\n        this.callBase(args);\n        break;\n\n      case \"repaintChangesOnly\":\n        break;\n\n      default:\n        this.callBase(args);\n    }\n  }\n});\n\nexports.default = _default;\nmodule.exports = exports.default;","map":{"version":3,"sources":["C:/Smart-Virtual-Classroom/client/node_modules/devextreme/ui/collection/ui.collection_widget.live_update.js"],"names":["exports","default","_renderer","_interopRequireDefault","require","_uiCollection_widget","_extend","_array_utils","_utils","_deferred","_array_compare","_dom_adapter","_common","obj","__esModule","_defineProperty","key","value","Object","defineProperty","enumerable","configurable","writable","PRIVATE_KEY_FIELD","_default","inherit","_getDefaultOptions","extend","callBase","repaintChangesOnly","ctor","_this","apply","arguments","_customizeStoreLoadOptions","e","dataSource","_dataSource","isLoaded","_correctionIndex","storeLoadOptions","skip","on","reload","_init","_refreshItemsCache","_findItemElementByKey","_this2","result","keyExpr","itemElements","each","_","item","$item","itemData","_getItemData","keysEqual","keyOf","_isItemEquals","_dataSourceChangedHandler","newItems","changes","_modifyByChanges","item1","item2","data","JSON","stringify","_isItemStrictEquals","_partialRefresh","_this3","option","findChanges","_itemsCache","_editStrategy","itemsGetter","bind","length","_renderEmptyMessage","items","map","itemCache","index","_ref","_dispose","off","_updateByChange","keyInfo","change","isPartialRefresh","_this4","_renderItem","changedItem","indexByKey","update","done","indexOf","_insertByChange","_this5","when","insert","_change$index","_beforeItemElementInserted","_afterItemElementInserted","_updateSelectionAfterRemoveByChange","removeIndex","selectedIndex","_normalizeSelectedItems","noop","_removeByChange","_this6","removedItem","oldItem","$removedItemElement","deletedActionArgs","_extendActionArgs","_waitDeletingPrepare","_updateIndicesAfterIndex","_afterItemElementDeleted","_deleteItemElementByIndex","_this7","paginate","group","filter","type","forEach","concat","_renderedItemsCount","_fireContentReadyAction","_appendItemToContainer","$container","$itemFrame","nextSiblingElement","children","_itemSelector","get","insertElement","_optionChanged","args","name","isItemsUpdated","module"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (ui/collection/ui.collection_widget.live_update.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.default = void 0;\r\nvar _renderer = _interopRequireDefault(require(\"../../core/renderer\"));\r\nvar _uiCollection_widget = _interopRequireDefault(require(\"./ui.collection_widget.edit\"));\r\nvar _extend = require(\"../../core/utils/extend\");\r\nvar _array_utils = require(\"../../data/array_utils\");\r\nvar _utils = _interopRequireDefault(require(\"../../data/utils\"));\r\nvar _deferred = require(\"../../core/utils/deferred\");\r\nvar _array_compare = require(\"../../core/utils/array_compare\");\r\nvar _dom_adapter = _interopRequireDefault(require(\"../../core/dom_adapter\"));\r\nvar _common = require(\"../../core/utils/common\");\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _defineProperty(obj, key, value) {\r\n    if (key in obj) {\r\n        Object.defineProperty(obj, key, {\r\n            value: value,\r\n            enumerable: true,\r\n            configurable: true,\r\n            writable: true\r\n        })\r\n    } else {\r\n        obj[key] = value\r\n    }\r\n    return obj\r\n}\r\nvar PRIVATE_KEY_FIELD = \"__dx_key__\";\r\nvar _default = _uiCollection_widget.default.inherit({\r\n    _getDefaultOptions: function() {\r\n        return (0, _extend.extend)(this.callBase(), {\r\n            repaintChangesOnly: false\r\n        })\r\n    },\r\n    ctor: function() {\r\n        var _this = this;\r\n        this.callBase.apply(this, arguments);\r\n        this._customizeStoreLoadOptions = function(e) {\r\n            var dataSource = _this._dataSource;\r\n            if (dataSource && !dataSource.isLoaded()) {\r\n                _this._correctionIndex = 0\r\n            }\r\n            if (_this._correctionIndex && e.storeLoadOptions) {\r\n                e.storeLoadOptions.skip += _this._correctionIndex\r\n            }\r\n        }, this._dataSource && this._dataSource.on(\"customizeStoreLoadOptions\", this._customizeStoreLoadOptions)\r\n    },\r\n    reload: function() {\r\n        this._correctionIndex = 0\r\n    },\r\n    _init: function() {\r\n        this.callBase();\r\n        this._refreshItemsCache();\r\n        this._correctionIndex = 0\r\n    },\r\n    _findItemElementByKey: function(key) {\r\n        var _this2 = this;\r\n        var result = (0, _renderer.default)();\r\n        var keyExpr = this.key();\r\n        this.itemElements().each(function(_, item) {\r\n            var $item = (0, _renderer.default)(item);\r\n            var itemData = _this2._getItemData($item);\r\n            if (keyExpr ? _utils.default.keysEqual(keyExpr, _this2.keyOf(itemData), key) : _this2._isItemEquals(itemData, key)) {\r\n                result = $item;\r\n                return false\r\n            }\r\n        });\r\n        return result\r\n    },\r\n    _dataSourceChangedHandler: function(newItems, e) {\r\n        if (null !== e && void 0 !== e && e.changes) {\r\n            this._modifyByChanges(e.changes)\r\n        } else {\r\n            this.callBase(newItems, e);\r\n            this._refreshItemsCache()\r\n        }\r\n    },\r\n    _isItemEquals: function(item1, item2) {\r\n        if (item1 && item1[PRIVATE_KEY_FIELD]) {\r\n            item1 = item1.data\r\n        }\r\n        try {\r\n            return JSON.stringify(item1) === JSON.stringify(item2)\r\n        } catch (e) {\r\n            return item1 === item2\r\n        }\r\n    },\r\n    _isItemStrictEquals: function(item1, item2) {\r\n        return this._isItemEquals(item1, item2)\r\n    },\r\n    _partialRefresh: function() {\r\n        var _this3 = this;\r\n        if (this.option(\"repaintChangesOnly\")) {\r\n            var keyOf = function(data) {\r\n                if (data && void 0 !== data[PRIVATE_KEY_FIELD]) {\r\n                    return data[PRIVATE_KEY_FIELD]\r\n                }\r\n                return _this3.keyOf(data)\r\n            };\r\n            var result = (0, _array_compare.findChanges)(this._itemsCache, this._editStrategy.itemsGetter(), keyOf, this._isItemStrictEquals.bind(this));\r\n            if (result && this._itemsCache.length) {\r\n                this._modifyByChanges(result, true);\r\n                this._renderEmptyMessage();\r\n                return true\r\n            } else {\r\n                this._refreshItemsCache()\r\n            }\r\n        }\r\n        return false\r\n    },\r\n    _refreshItemsCache: function() {\r\n        if (this.option(\"repaintChangesOnly\")) {\r\n            var items = this._editStrategy.itemsGetter();\r\n            try {\r\n                this._itemsCache = (0, _extend.extend)(true, [], items);\r\n                if (!this.key()) {\r\n                    this._itemsCache = this._itemsCache.map(function(itemCache, index) {\r\n                        var _ref;\r\n                        return _ref = {}, _defineProperty(_ref, PRIVATE_KEY_FIELD, items[index]), _defineProperty(_ref, \"data\", itemCache), _ref\r\n                    })\r\n                }\r\n            } catch (e) {\r\n                this._itemsCache = (0, _extend.extend)([], items)\r\n            }\r\n        }\r\n    },\r\n    _dispose: function() {\r\n        this._dataSource && this._dataSource.off(\"customizeStoreLoadOptions\", this._customizeStoreLoadOptions);\r\n        this.callBase()\r\n    },\r\n    _updateByChange: function(keyInfo, items, change, isPartialRefresh) {\r\n        var _this4 = this;\r\n        if (isPartialRefresh) {\r\n            this._renderItem(change.index, change.data, null, this._findItemElementByKey(change.key))\r\n        } else {\r\n            var changedItem = items[(0, _array_utils.indexByKey)(keyInfo, items, change.key)];\r\n            if (changedItem) {\r\n                (0, _array_utils.update)(keyInfo, items, change.key, change.data).done(function() {\r\n                    _this4._renderItem(items.indexOf(changedItem), changedItem, null, _this4._findItemElementByKey(change.key))\r\n                })\r\n            }\r\n        }\r\n    },\r\n    _insertByChange: function(keyInfo, items, change, isPartialRefresh) {\r\n        var _this5 = this;\r\n        (0, _deferred.when)(isPartialRefresh || (0, _array_utils.insert)(keyInfo, items, change.data, change.index)).done(function() {\r\n            var _change$index;\r\n            _this5._beforeItemElementInserted(change);\r\n            _this5._renderItem(null !== (_change$index = change.index) && void 0 !== _change$index ? _change$index : items.length, change.data);\r\n            _this5._afterItemElementInserted();\r\n            _this5._correctionIndex++\r\n        })\r\n    },\r\n    _updateSelectionAfterRemoveByChange: function(removeIndex) {\r\n        var selectedIndex = this.option(\"selectedIndex\");\r\n        if (selectedIndex > removeIndex) {\r\n            this.option(\"selectedIndex\", selectedIndex - 1)\r\n        } else {\r\n            if (selectedIndex === removeIndex && 1 === this.option(\"selectedItems\").length) {\r\n                this.option(\"selectedItems\", [])\r\n            } else {\r\n                this._normalizeSelectedItems()\r\n            }\r\n        }\r\n    },\r\n    _beforeItemElementInserted: function(change) {\r\n        var selectedIndex = this.option(\"selectedIndex\");\r\n        if (change.index <= selectedIndex) {\r\n            this.option(\"selectedIndex\", selectedIndex + 1)\r\n        }\r\n    },\r\n    _afterItemElementInserted: _common.noop,\r\n    _removeByChange: function(keyInfo, items, change, isPartialRefresh) {\r\n        var _this6 = this;\r\n        var index = isPartialRefresh ? change.index : (0, _array_utils.indexByKey)(keyInfo, items, change.key);\r\n        var removedItem = isPartialRefresh ? change.oldItem : items[index];\r\n        if (removedItem) {\r\n            var $removedItemElement = this._findItemElementByKey(change.key);\r\n            var deletedActionArgs = this._extendActionArgs($removedItemElement);\r\n            this._waitDeletingPrepare($removedItemElement).done(function() {\r\n                if (isPartialRefresh) {\r\n                    _this6._updateIndicesAfterIndex(index - 1);\r\n                    _this6._afterItemElementDeleted($removedItemElement, deletedActionArgs);\r\n                    _this6._updateSelectionAfterRemoveByChange(index)\r\n                } else {\r\n                    _this6._deleteItemElementByIndex(index);\r\n                    _this6._afterItemElementDeleted($removedItemElement, deletedActionArgs)\r\n                }\r\n            });\r\n            this._correctionIndex--\r\n        }\r\n    },\r\n    _modifyByChanges: function(changes, isPartialRefresh) {\r\n        var _this7 = this;\r\n        var items = this._editStrategy.itemsGetter();\r\n        var keyInfo = {\r\n            key: this.key.bind(this),\r\n            keyOf: this.keyOf.bind(this)\r\n        };\r\n        var dataSource = this._dataSource;\r\n        var paginate = dataSource && dataSource.paginate();\r\n        var group = dataSource && dataSource.group();\r\n        if (paginate || group) {\r\n            changes = changes.filter(function(item) {\r\n                return \"insert\" !== item.type || void 0 !== item.index\r\n            })\r\n        }\r\n        changes.forEach(function(change) {\r\n            return _this7[\"_\".concat(change.type, \"ByChange\")](keyInfo, items, change, isPartialRefresh)\r\n        });\r\n        this._renderedItemsCount = items.length;\r\n        this._refreshItemsCache();\r\n        this._fireContentReadyAction()\r\n    },\r\n    _appendItemToContainer: function($container, $itemFrame, index) {\r\n        var nextSiblingElement = $container.children(this._itemSelector()).get(index);\r\n        _dom_adapter.default.insertElement($container.get(0), $itemFrame.get(0), nextSiblingElement)\r\n    },\r\n    _optionChanged: function(args) {\r\n        switch (args.name) {\r\n            case \"items\":\r\n                var isItemsUpdated = this._partialRefresh(args.value);\r\n                if (!isItemsUpdated) {\r\n                    this.callBase(args)\r\n                }\r\n                break;\r\n            case \"dataSource\":\r\n                if (!this.option(\"repaintChangesOnly\") || !args.value) {\r\n                    this.option(\"items\", [])\r\n                }\r\n                this.callBase(args);\r\n                break;\r\n            case \"repaintChangesOnly\":\r\n                break;\r\n            default:\r\n                this.callBase(args)\r\n        }\r\n    }\r\n});\r\nexports.default = _default;\r\nmodule.exports = exports.default;\r\n"]},"metadata":{},"sourceType":"script"}