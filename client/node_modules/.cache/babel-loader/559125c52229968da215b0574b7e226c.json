{"ast":null,"code":"/**\r\n * DevExtreme (data/array_utils.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\n\"use strict\";\n\nexports.applyBatch = applyBatch;\nexports.createObjectWithChanges = createObjectWithChanges;\nexports.update = update;\nexports.insert = insert;\nexports.remove = remove;\nexports.indexByKey = indexByKey;\nexports.applyChanges = applyChanges;\n\nvar _type = require(\"../core/utils/type\");\n\nvar _config = _interopRequireDefault(require(\"../core/config\"));\n\nvar _guid = _interopRequireDefault(require(\"../core/guid\"));\n\nvar _extend = require(\"../core/utils/extend\");\n\nvar _errors = _interopRequireDefault(require(\"./errors\"));\n\nvar _object = require(\"../core/utils/object\");\n\nvar _data = require(\"../core/utils/data\");\n\nvar _utils = _interopRequireDefault(require(\"./utils\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) {\n    return;\n  }\n\n  if (\"string\" === typeof o) {\n    return _arrayLikeToArray(o, minLen);\n  }\n\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n\n  if (\"Object\" === n && o.constructor) {\n    n = o.constructor.name;\n  }\n\n  if (\"Map\" === n || \"Set\" === n) {\n    return Array.from(o);\n  }\n\n  if (\"Arguments\" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) {\n    return _arrayLikeToArray(o, minLen);\n  }\n}\n\nfunction _iterableToArray(iter) {\n  if (\"undefined\" !== typeof Symbol && null != iter[Symbol.iterator] || null != iter[\"@@iterator\"]) {\n    return Array.from(iter);\n  }\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    return _arrayLikeToArray(arr);\n  }\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (null == len || len > arr.length) {\n    len = arr.length;\n  }\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction hasKey(target, keyOrKeys) {\n  var key;\n  var keys = \"string\" === typeof keyOrKeys ? keyOrKeys.split() : keyOrKeys.slice();\n\n  while (keys.length) {\n    key = keys.shift();\n\n    if (key in target) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction findItems(keyInfo, items, key, groupCount) {\n  var childItems;\n  var result;\n\n  if (groupCount) {\n    for (var i = 0; i < items.length; i++) {\n      childItems = items[i].items || items[i].collapsedItems || [];\n      result = findItems(keyInfo, childItems || [], key, groupCount - 1);\n\n      if (result) {\n        return result;\n      }\n    }\n  } else {\n    if (indexByKey(keyInfo, items, key) >= 0) {\n      return items;\n    }\n  }\n}\n\nfunction getItems(keyInfo, items, key, groupCount) {\n  if (groupCount) {\n    return findItems(keyInfo, items, key, groupCount) || [];\n  }\n\n  return items;\n}\n\nfunction generateDataByKeyMap(keyInfo, array) {\n  if (keyInfo.key() && (!array._dataByKeyMap || array._dataByKeyMapLength !== array.length)) {\n    var dataByKeyMap = {};\n    var arrayLength = array.length;\n\n    for (var i = 0; i < arrayLength; i++) {\n      dataByKeyMap[JSON.stringify(keyInfo.keyOf(array[i]))] = array[i];\n    }\n\n    array._dataByKeyMap = dataByKeyMap;\n    array._dataByKeyMapLength = arrayLength;\n  }\n}\n\nfunction getCacheValue(array, key) {\n  if (array._dataByKeyMap) {\n    return array._dataByKeyMap[JSON.stringify(key)];\n  }\n}\n\nfunction getHasKeyCacheValue(array, key) {\n  if (array._dataByKeyMap) {\n    return array._dataByKeyMap[JSON.stringify(key)];\n  }\n\n  return true;\n}\n\nfunction setDataByKeyMapValue(array, key, data) {\n  if (array._dataByKeyMap) {\n    array._dataByKeyMap[JSON.stringify(key)] = data;\n    array._dataByKeyMapLength += data ? 1 : -1;\n  }\n}\n\nfunction createObjectWithChanges(target, changes) {\n  var result = target ? Object.create(Object.getPrototypeOf(target)) : {};\n  var targetWithoutPrototype = (0, _extend.extendFromObject)({}, target);\n  (0, _object.deepExtendArraySafe)(result, targetWithoutPrototype, true, true);\n  return (0, _object.deepExtendArraySafe)(result, changes, true, true);\n}\n\nfunction applyBatch(_ref) {\n  var keyInfo = _ref.keyInfo,\n      data = _ref.data,\n      changes = _ref.changes,\n      groupCount = _ref.groupCount,\n      useInsertIndex = _ref.useInsertIndex,\n      immutable = _ref.immutable,\n      disableCache = _ref.disableCache,\n      logError = _ref.logError;\n  var resultItems = true === immutable ? _toConsumableArray(data) : data;\n  changes.forEach(function (item) {\n    var items = \"insert\" === item.type ? resultItems : getItems(keyInfo, resultItems, item.key, groupCount);\n    !disableCache && generateDataByKeyMap(keyInfo, items);\n\n    switch (item.type) {\n      case \"update\":\n        update(keyInfo, items, item.key, item.data, true, immutable, logError);\n        break;\n\n      case \"insert\":\n        insert(keyInfo, items, item.data, useInsertIndex && (0, _type.isDefined)(item.index) ? item.index : -1, true, logError);\n        break;\n\n      case \"remove\":\n        remove(keyInfo, items, item.key, true, logError);\n    }\n  });\n  return resultItems;\n}\n\nfunction getErrorResult(isBatch, logError, errorCode) {\n  return !isBatch ? _utils.default.rejectedPromise(_errors.default.errors.Error(errorCode)) : logError && _errors.default.errors.log(errorCode);\n}\n\nfunction applyChanges(data, changes) {\n  var options = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\n  var _options$keyExpr = options.keyExpr,\n      keyExpr = void 0 === _options$keyExpr ? \"id\" : _options$keyExpr,\n      _options$immutable = options.immutable,\n      immutable = void 0 === _options$immutable ? true : _options$immutable;\n  var keyGetter = (0, _data.compileGetter)(keyExpr);\n  var keyInfo = {\n    key: function () {\n      return keyExpr;\n    },\n    keyOf: function (obj) {\n      return keyGetter(obj);\n    }\n  };\n  return applyBatch({\n    keyInfo: keyInfo,\n    data: data,\n    changes: changes,\n    immutable: immutable,\n    disableCache: true,\n    logError: true\n  });\n}\n\nfunction update(keyInfo, array, key, data, isBatch, immutable, logError) {\n  var target;\n  var extendComplexObject = true;\n  var keyExpr = keyInfo.key();\n\n  if (keyExpr) {\n    if (hasKey(data, keyExpr) && !_utils.default.keysEqual(keyExpr, key, keyInfo.keyOf(data))) {\n      return getErrorResult(isBatch, logError, \"E4017\");\n    }\n\n    target = getCacheValue(array, key);\n\n    if (!target) {\n      var index = indexByKey(keyInfo, array, key);\n\n      if (index < 0) {\n        return getErrorResult(isBatch, logError, \"E4009\");\n      }\n\n      target = array[index];\n\n      if (true === immutable && (0, _type.isDefined)(target)) {\n        var newTarget = createObjectWithChanges(target, data);\n        array[index] = newTarget;\n        return !isBatch && _utils.default.trivialPromise(newTarget, key);\n      }\n    }\n  } else {\n    target = key;\n  }\n\n  (0, _object.deepExtendArraySafe)(target, data, extendComplexObject);\n\n  if (!isBatch) {\n    if ((0, _config.default)().useLegacyStoreResult) {\n      return _utils.default.trivialPromise(key, data);\n    } else {\n      return _utils.default.trivialPromise(target, key);\n    }\n  }\n}\n\nfunction insert(keyInfo, array, data, index, isBatch, logError) {\n  var keyValue;\n  var keyExpr = keyInfo.key();\n  var obj = (0, _type.isPlainObject)(data) ? (0, _extend.extend)({}, data) : data;\n\n  if (keyExpr) {\n    keyValue = keyInfo.keyOf(obj);\n\n    if (void 0 === keyValue || \"object\" === _typeof(keyValue) && (0, _type.isEmptyObject)(keyValue)) {\n      if (Array.isArray(keyExpr)) {\n        throw _errors.default.errors.Error(\"E4007\");\n      }\n\n      keyValue = obj[keyExpr] = String(new _guid.default());\n    } else {\n      if (void 0 !== array[indexByKey(keyInfo, array, keyValue)]) {\n        return getErrorResult(isBatch, logError, \"E4008\");\n      }\n    }\n  } else {\n    keyValue = obj;\n  }\n\n  if (index >= 0) {\n    array.splice(index, 0, obj);\n  } else {\n    array.push(obj);\n  }\n\n  setDataByKeyMapValue(array, keyValue, obj);\n\n  if (!isBatch) {\n    return _utils.default.trivialPromise((0, _config.default)().useLegacyStoreResult ? data : obj, keyValue);\n  }\n}\n\nfunction remove(keyInfo, array, key, isBatch, logError) {\n  var index = indexByKey(keyInfo, array, key);\n\n  if (index > -1) {\n    array.splice(index, 1);\n    setDataByKeyMapValue(array, key, null);\n  }\n\n  if (!isBatch) {\n    return _utils.default.trivialPromise(key);\n  } else {\n    if (index < 0) {\n      return getErrorResult(isBatch, logError, \"E4009\");\n    }\n  }\n}\n\nfunction indexByKey(keyInfo, array, key) {\n  var keyExpr = keyInfo.key();\n\n  if (!getHasKeyCacheValue(array, key)) {\n    return -1;\n  }\n\n  for (var i = 0, arrayLength = array.length; i < arrayLength; i++) {\n    if (_utils.default.keysEqual(keyExpr, keyInfo.keyOf(array[i]), key)) {\n      return i;\n    }\n  }\n\n  return -1;\n}","map":{"version":3,"sources":["C:/Smart-Virtual-Classroom/client/node_modules/devextreme/data/array_utils.js"],"names":["exports","applyBatch","createObjectWithChanges","update","insert","remove","indexByKey","applyChanges","_type","require","_config","_interopRequireDefault","_guid","_extend","_errors","_object","_data","_utils","obj","__esModule","_typeof","Symbol","iterator","constructor","prototype","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","TypeError","o","minLen","_arrayLikeToArray","n","Object","toString","call","slice","name","Array","from","test","iter","isArray","len","length","i","arr2","hasKey","target","keyOrKeys","key","keys","split","shift","findItems","keyInfo","items","groupCount","childItems","result","collapsedItems","getItems","generateDataByKeyMap","array","_dataByKeyMap","_dataByKeyMapLength","dataByKeyMap","arrayLength","JSON","stringify","keyOf","getCacheValue","getHasKeyCacheValue","setDataByKeyMapValue","data","changes","create","getPrototypeOf","targetWithoutPrototype","extendFromObject","deepExtendArraySafe","_ref","useInsertIndex","immutable","disableCache","logError","resultItems","forEach","item","type","isDefined","index","getErrorResult","isBatch","errorCode","default","rejectedPromise","errors","Error","log","options","arguments","_options$keyExpr","keyExpr","_options$immutable","keyGetter","compileGetter","extendComplexObject","keysEqual","newTarget","trivialPromise","useLegacyStoreResult","keyValue","isPlainObject","extend","isEmptyObject","String","splice","push"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (data/array_utils.js)\r\n * Version: 20.2.7\r\n * Build date: Thu Apr 22 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\n\"use strict\";\r\nexports.applyBatch = applyBatch;\r\nexports.createObjectWithChanges = createObjectWithChanges;\r\nexports.update = update;\r\nexports.insert = insert;\r\nexports.remove = remove;\r\nexports.indexByKey = indexByKey;\r\nexports.applyChanges = applyChanges;\r\nvar _type = require(\"../core/utils/type\");\r\nvar _config = _interopRequireDefault(require(\"../core/config\"));\r\nvar _guid = _interopRequireDefault(require(\"../core/guid\"));\r\nvar _extend = require(\"../core/utils/extend\");\r\nvar _errors = _interopRequireDefault(require(\"./errors\"));\r\nvar _object = require(\"../core/utils/object\");\r\nvar _data = require(\"../core/utils/data\");\r\nvar _utils = _interopRequireDefault(require(\"./utils\"));\r\n\r\nfunction _interopRequireDefault(obj) {\r\n    return obj && obj.__esModule ? obj : {\r\n        \"default\": obj\r\n    }\r\n}\r\n\r\nfunction _typeof(obj) {\r\n    \"@babel/helpers - typeof\";\r\n    if (\"function\" === typeof Symbol && \"symbol\" === typeof Symbol.iterator) {\r\n        _typeof = function(obj) {\r\n            return typeof obj\r\n        }\r\n    } else {\r\n        _typeof = function(obj) {\r\n            return obj && \"function\" === typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj\r\n        }\r\n    }\r\n    return _typeof(obj)\r\n}\r\n\r\nfunction _toConsumableArray(arr) {\r\n    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread()\r\n}\r\n\r\nfunction _nonIterableSpread() {\r\n    throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")\r\n}\r\n\r\nfunction _unsupportedIterableToArray(o, minLen) {\r\n    if (!o) {\r\n        return\r\n    }\r\n    if (\"string\" === typeof o) {\r\n        return _arrayLikeToArray(o, minLen)\r\n    }\r\n    var n = Object.prototype.toString.call(o).slice(8, -1);\r\n    if (\"Object\" === n && o.constructor) {\r\n        n = o.constructor.name\r\n    }\r\n    if (\"Map\" === n || \"Set\" === n) {\r\n        return Array.from(o)\r\n    }\r\n    if (\"Arguments\" === n || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) {\r\n        return _arrayLikeToArray(o, minLen)\r\n    }\r\n}\r\n\r\nfunction _iterableToArray(iter) {\r\n    if (\"undefined\" !== typeof Symbol && null != iter[Symbol.iterator] || null != iter[\"@@iterator\"]) {\r\n        return Array.from(iter)\r\n    }\r\n}\r\n\r\nfunction _arrayWithoutHoles(arr) {\r\n    if (Array.isArray(arr)) {\r\n        return _arrayLikeToArray(arr)\r\n    }\r\n}\r\n\r\nfunction _arrayLikeToArray(arr, len) {\r\n    if (null == len || len > arr.length) {\r\n        len = arr.length\r\n    }\r\n    for (var i = 0, arr2 = new Array(len); i < len; i++) {\r\n        arr2[i] = arr[i]\r\n    }\r\n    return arr2\r\n}\r\n\r\nfunction hasKey(target, keyOrKeys) {\r\n    var key;\r\n    var keys = \"string\" === typeof keyOrKeys ? keyOrKeys.split() : keyOrKeys.slice();\r\n    while (keys.length) {\r\n        key = keys.shift();\r\n        if (key in target) {\r\n            return true\r\n        }\r\n    }\r\n    return false\r\n}\r\n\r\nfunction findItems(keyInfo, items, key, groupCount) {\r\n    var childItems;\r\n    var result;\r\n    if (groupCount) {\r\n        for (var i = 0; i < items.length; i++) {\r\n            childItems = items[i].items || items[i].collapsedItems || [];\r\n            result = findItems(keyInfo, childItems || [], key, groupCount - 1);\r\n            if (result) {\r\n                return result\r\n            }\r\n        }\r\n    } else {\r\n        if (indexByKey(keyInfo, items, key) >= 0) {\r\n            return items\r\n        }\r\n    }\r\n}\r\n\r\nfunction getItems(keyInfo, items, key, groupCount) {\r\n    if (groupCount) {\r\n        return findItems(keyInfo, items, key, groupCount) || []\r\n    }\r\n    return items\r\n}\r\n\r\nfunction generateDataByKeyMap(keyInfo, array) {\r\n    if (keyInfo.key() && (!array._dataByKeyMap || array._dataByKeyMapLength !== array.length)) {\r\n        var dataByKeyMap = {};\r\n        var arrayLength = array.length;\r\n        for (var i = 0; i < arrayLength; i++) {\r\n            dataByKeyMap[JSON.stringify(keyInfo.keyOf(array[i]))] = array[i]\r\n        }\r\n        array._dataByKeyMap = dataByKeyMap;\r\n        array._dataByKeyMapLength = arrayLength\r\n    }\r\n}\r\n\r\nfunction getCacheValue(array, key) {\r\n    if (array._dataByKeyMap) {\r\n        return array._dataByKeyMap[JSON.stringify(key)]\r\n    }\r\n}\r\n\r\nfunction getHasKeyCacheValue(array, key) {\r\n    if (array._dataByKeyMap) {\r\n        return array._dataByKeyMap[JSON.stringify(key)]\r\n    }\r\n    return true\r\n}\r\n\r\nfunction setDataByKeyMapValue(array, key, data) {\r\n    if (array._dataByKeyMap) {\r\n        array._dataByKeyMap[JSON.stringify(key)] = data;\r\n        array._dataByKeyMapLength += data ? 1 : -1\r\n    }\r\n}\r\n\r\nfunction createObjectWithChanges(target, changes) {\r\n    var result = target ? Object.create(Object.getPrototypeOf(target)) : {};\r\n    var targetWithoutPrototype = (0, _extend.extendFromObject)({}, target);\r\n    (0, _object.deepExtendArraySafe)(result, targetWithoutPrototype, true, true);\r\n    return (0, _object.deepExtendArraySafe)(result, changes, true, true)\r\n}\r\n\r\nfunction applyBatch(_ref) {\r\n    var keyInfo = _ref.keyInfo,\r\n        data = _ref.data,\r\n        changes = _ref.changes,\r\n        groupCount = _ref.groupCount,\r\n        useInsertIndex = _ref.useInsertIndex,\r\n        immutable = _ref.immutable,\r\n        disableCache = _ref.disableCache,\r\n        logError = _ref.logError;\r\n    var resultItems = true === immutable ? _toConsumableArray(data) : data;\r\n    changes.forEach(function(item) {\r\n        var items = \"insert\" === item.type ? resultItems : getItems(keyInfo, resultItems, item.key, groupCount);\r\n        !disableCache && generateDataByKeyMap(keyInfo, items);\r\n        switch (item.type) {\r\n            case \"update\":\r\n                update(keyInfo, items, item.key, item.data, true, immutable, logError);\r\n                break;\r\n            case \"insert\":\r\n                insert(keyInfo, items, item.data, useInsertIndex && (0, _type.isDefined)(item.index) ? item.index : -1, true, logError);\r\n                break;\r\n            case \"remove\":\r\n                remove(keyInfo, items, item.key, true, logError)\r\n        }\r\n    });\r\n    return resultItems\r\n}\r\n\r\nfunction getErrorResult(isBatch, logError, errorCode) {\r\n    return !isBatch ? _utils.default.rejectedPromise(_errors.default.errors.Error(errorCode)) : logError && _errors.default.errors.log(errorCode)\r\n}\r\n\r\nfunction applyChanges(data, changes) {\r\n    var options = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : {};\r\n    var _options$keyExpr = options.keyExpr,\r\n        keyExpr = void 0 === _options$keyExpr ? \"id\" : _options$keyExpr,\r\n        _options$immutable = options.immutable,\r\n        immutable = void 0 === _options$immutable ? true : _options$immutable;\r\n    var keyGetter = (0, _data.compileGetter)(keyExpr);\r\n    var keyInfo = {\r\n        key: function() {\r\n            return keyExpr\r\n        },\r\n        keyOf: function(obj) {\r\n            return keyGetter(obj)\r\n        }\r\n    };\r\n    return applyBatch({\r\n        keyInfo: keyInfo,\r\n        data: data,\r\n        changes: changes,\r\n        immutable: immutable,\r\n        disableCache: true,\r\n        logError: true\r\n    })\r\n}\r\n\r\nfunction update(keyInfo, array, key, data, isBatch, immutable, logError) {\r\n    var target;\r\n    var extendComplexObject = true;\r\n    var keyExpr = keyInfo.key();\r\n    if (keyExpr) {\r\n        if (hasKey(data, keyExpr) && !_utils.default.keysEqual(keyExpr, key, keyInfo.keyOf(data))) {\r\n            return getErrorResult(isBatch, logError, \"E4017\")\r\n        }\r\n        target = getCacheValue(array, key);\r\n        if (!target) {\r\n            var index = indexByKey(keyInfo, array, key);\r\n            if (index < 0) {\r\n                return getErrorResult(isBatch, logError, \"E4009\")\r\n            }\r\n            target = array[index];\r\n            if (true === immutable && (0, _type.isDefined)(target)) {\r\n                var newTarget = createObjectWithChanges(target, data);\r\n                array[index] = newTarget;\r\n                return !isBatch && _utils.default.trivialPromise(newTarget, key)\r\n            }\r\n        }\r\n    } else {\r\n        target = key\r\n    }(0, _object.deepExtendArraySafe)(target, data, extendComplexObject);\r\n    if (!isBatch) {\r\n        if ((0, _config.default)().useLegacyStoreResult) {\r\n            return _utils.default.trivialPromise(key, data)\r\n        } else {\r\n            return _utils.default.trivialPromise(target, key)\r\n        }\r\n    }\r\n}\r\n\r\nfunction insert(keyInfo, array, data, index, isBatch, logError) {\r\n    var keyValue;\r\n    var keyExpr = keyInfo.key();\r\n    var obj = (0, _type.isPlainObject)(data) ? (0, _extend.extend)({}, data) : data;\r\n    if (keyExpr) {\r\n        keyValue = keyInfo.keyOf(obj);\r\n        if (void 0 === keyValue || \"object\" === _typeof(keyValue) && (0, _type.isEmptyObject)(keyValue)) {\r\n            if (Array.isArray(keyExpr)) {\r\n                throw _errors.default.errors.Error(\"E4007\")\r\n            }\r\n            keyValue = obj[keyExpr] = String(new _guid.default)\r\n        } else {\r\n            if (void 0 !== array[indexByKey(keyInfo, array, keyValue)]) {\r\n                return getErrorResult(isBatch, logError, \"E4008\")\r\n            }\r\n        }\r\n    } else {\r\n        keyValue = obj\r\n    }\r\n    if (index >= 0) {\r\n        array.splice(index, 0, obj)\r\n    } else {\r\n        array.push(obj)\r\n    }\r\n    setDataByKeyMapValue(array, keyValue, obj);\r\n    if (!isBatch) {\r\n        return _utils.default.trivialPromise((0, _config.default)().useLegacyStoreResult ? data : obj, keyValue)\r\n    }\r\n}\r\n\r\nfunction remove(keyInfo, array, key, isBatch, logError) {\r\n    var index = indexByKey(keyInfo, array, key);\r\n    if (index > -1) {\r\n        array.splice(index, 1);\r\n        setDataByKeyMapValue(array, key, null)\r\n    }\r\n    if (!isBatch) {\r\n        return _utils.default.trivialPromise(key)\r\n    } else {\r\n        if (index < 0) {\r\n            return getErrorResult(isBatch, logError, \"E4009\")\r\n        }\r\n    }\r\n}\r\n\r\nfunction indexByKey(keyInfo, array, key) {\r\n    var keyExpr = keyInfo.key();\r\n    if (!getHasKeyCacheValue(array, key)) {\r\n        return -1\r\n    }\r\n    for (var i = 0, arrayLength = array.length; i < arrayLength; i++) {\r\n        if (_utils.default.keysEqual(keyExpr, keyInfo.keyOf(array[i]), key)) {\r\n            return i\r\n        }\r\n    }\r\n    return -1\r\n}\r\n"]},"metadata":{},"sourceType":"script"}